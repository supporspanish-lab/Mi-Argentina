<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Barra de Potencia Vertical</title>
    <style>
        body {
            display: flex;
            justify-content: flex-start; /* Alinea el contenido a la izquierda */
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding-left: 50px; /* Añade un poco de espacio desde el borde izquierdo */
            background-color: #2c3e50; /* Un fondo más oscuro para que resalte */
            font-family: sans-serif;
        }
        
        /* --- MODIFICACIÓN: Wrapper principal para posicionar todo --- */
        #powerBarWrapper {
            position: relative; /* Para que el texto del porcentaje se posicione respecto a este */
            /* padding-top: 30px; // Ya no es necesario */
        }

        /* --- NUEVO: Contenedor de recorte (Clipping Mask) --- */
        #powerBarClippingContainer {
            position: relative; /* Necesario para que los elementos absolutos internos se posicionen correctamente */
            width: 40px; /* Mismo ancho que la barra */
            height: 300px; /* Misma altura que la barra */
            border-radius: 25px; /* Mismo radio para que el recorte sea redondeado */
            overflow: hidden; /* ¡La magia está aquí! Oculta todo lo que se salga. */
        }

        #newPowerBarContainer {
            width: 40px; /* Ancho de la barra */
            height: 300px; /* Altura total de la barra */
            /* --- NUEVO: Degradado de fondo con líneas --- */
            background: 
                /* Capa 2: Líneas horizontales repetidas */
                repeating-linear-gradient(
                    to top,
                    transparent, transparent 19px, /* 19px de espacio transparente */
                    rgba(0, 0, 0, 0.3) 19px, rgba(0, 0, 0, 0.3) 20px /* 1px de línea oscura */
                ),
                /* Capa 1: Degradado de color de fondo */
                linear-gradient(to top, #2ecc71, #f1c40f, #e74c3c); /* Verde -> Amarillo -> Rojo */

            border: 2px solid #333;
            border-radius: 25px;
            position: absolute; /* Se posiciona dentro del contenedor de recorte */
        }

        #newPowerBarHandle {
            width: 280px; /* Altura visual del taco (después de rotar) */
            height: 45px; /* Ancho visual del taco (después de rotar) */
            object-fit: contain;
            position: absolute;
            /* --- CORRECCIÓN: Posicionamiento relativo al contenedor de recorte --- */
            left: -120px; /* Ajuste para centrar el taco sobre la barra (que está en la misma posición) */
            transform: rotate(270deg); /* Solo rotar */
            top: 0; /* La posición 'top' será controlada por JS */
            transform-origin: center center; /* Asegurar que la rotación sea desde el centro */
            cursor: grab;
        }
    </style>
</head>
<body>
    <div id="powerBarWrapper">
        <!-- --- NUEVO: Contenedor de recorte que envuelve la barra y el taco --- -->
        <div id="powerBarClippingContainer">
            <div id="newPowerBarContainer"></div>
            <!-- El taco ahora está DENTRO del contenedor de recorte -->
            <div id="newPowerBarHandle" style="background-image: url('imajenes/taco.png'); background-size: contain; background-repeat: no-repeat; background-position: center;"></div>
        </div>
    </div>

    <script>
        const newPowerBarContainer = document.getElementById('newPowerBarContainer');
        const newPowerBarHandle = document.getElementById('newPowerBarHandle');

        let isDragging = false;
        let powerPercent = 0;
        let dragStartY = 0; // --- NUEVO: Para guardar la posición Y inicial del arrastre

        // --- CORRECCIÓN: El evento ahora se escucha en todo el contenedor de la barra ---
        newPowerBarContainer.addEventListener('pointerdown', (e) => {
            isDragging = true;
            newPowerBarContainer.setPointerCapture(e.pointerId); // Capturar el puntero en el contenedor
            e.preventDefault(); // Prevenir el comportamiento por defecto del navegador

            // Guardar la posición Y inicial y resetear la barra a 0%
            dragStartY = e.clientY;
            powerPercent = 0;
            updatePowerBar(0); // Actualizar la UI a 0%
        });

        document.addEventListener('pointermove', (e) => {
            if (!isDragging) return;

            const rect = newPowerBarContainer.getBoundingClientRect();
            const containerHeight = rect.height;

            // --- CORRECCIÓN: El arrastre ahora es de abajo hacia arriba para cargar potencia ---
            const dragDistance = e.clientY - dragStartY;

            // --- CORRECCIÓN: La potencia y la posición visual ahora se basan en el mismo cálculo ---
            // Esto sincroniza perfectamente el movimiento del taco con el porcentaje.
            // El recorrido total para llegar al 100% es la altura de la barra.
            // --- CORRECCIÓN: Se limita el recorrido a 1.0 para que no pase del 100%.
            const newPowerPercent = Math.max(0, Math.min(dragDistance / containerHeight, 1.0));
            
            // Guardamos la potencia para el cálculo de disparo y la posición visual.
            powerPercent = newPowerPercent; 
            // --- CORRECCIÓN: Como ya no hay sobrerrecorrido, solo pasamos un valor.
            // Ambos argumentos (display y posición) usarán el mismo porcentaje.
            updatePowerBar(powerPercent, powerPercent);
        });

        document.addEventListener('pointerup', (e) => {
            if (isDragging) {
                isDragging = false;
                try {
                    // --- CORRECCIÓN: Usar el 'e' del evento para obtener el pointerId ---
                    if (e.pointerId) newPowerBarContainer.releasePointerCapture(e.pointerId);
                } catch (err) { /* La captura del puntero ya no existía, no hay problema. */ }
                
                // --- CORRECCIÓN: Mostrar la potencia real de disparo (limitada a 100%) ---
                console.log(`Disparo con potencia: ${Math.round(Math.min(powerPercent, 1) * 100)}%`);

                // Animar la barra de vuelta a 0%
                newPowerBarHandle.style.transition = 'top 0.3s ease-out';
                updatePowerBar(0, 0); // Resetear tanto la potencia como la posición visual
                // Quitar la transición después de la animación para que el arrastre sea instantáneo
                setTimeout(() => {
                    newPowerBarHandle.style.transition = '';
                }, 300);
            }
        });

        // Función que actualiza la UI de la barra de potencia
        function updatePowerBar(powerPercent, visualPercent) {
            // Si visualPercent no se proporciona, se usa powerPercent.
            const displayPercent = visualPercent !== undefined ? visualPercent : powerPercent;
            const containerHeight = newPowerBarContainer.offsetHeight;

            // --- CORRECCIÓN: El taco empieza abajo y se mueve hacia arriba ---
            // 1. La posición inicial (0%) es abajo del todo. 
            //    Para que empiece más abajo, multiplica containerHeight por un número mayor (ej: 1.5).
            const startPosition = containerHeight * 1.4;
            // 2. A medida que se arrastra, el taco sube. El recorrido es la altura del contenedor.
            const topPosition = startPosition - (displayPercent * containerHeight);

            // Actualizar la posición del taco
            newPowerBarHandle.style.top = `${topPosition}px`;
        }

        // Inicializar la barra de potencia a 0
        updatePowerBar(0, 0);


    </script>
</body>
</html>