<!DOCTYPE html><html lang="es"><head>
        
        <script type="importmap">{"imports":{"@modelcontextprotocol/sdk/":"https://aistudiocdn.com/@modelcontextprotocol/sdk/dist/esm/","https://aistudiocdn.com/@modelcontextprotocol/sdk@^1.11.0/es2022/":"https://aistudiocdn.com/@modelcontextprotocol/sdk@^1.11.0/es2022/dist/esm/","https://aistudiocdn.com/@modelcontextprotocol/sdk@^1.11.0/client/index?target=es2022":"https://aistudiocdn.com/@modelcontextprotocol/sdk@^1.11.0/dist/esm/client/index?target=es2022","https://aistudiocdn.com/@modelcontextprotocol/sdk@^1.11.0/types?target=es2022":"https://aistudiocdn.com/@modelcontextprotocol/sdk@^1.11.0/dist/esm/types?target=es2022","@/index":"data:application/javascript;base64,ZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsICgpID0+IHsKICAgIC8vIC0tLSBFbGVtZW50IFNlbGVjdG9ycyAtLS0KICAgIGNvbnN0IGxvZ2luU2NyZWVuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvZ2luLXNjcmVlbicpOwogICAgY29uc3QgbWFpblNjcmVlbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYWluLXNjcmVlbicpOwogICAgY29uc3QgZG9jdW1lbnRvc1NjcmVlbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkb2N1bWVudG9zLXNjcmVlbicpOwogICAgY29uc3QgZWRpdG9yU2NyZWVuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXRvci1zY3JlZW4nKTsKICAgIGNvbnN0IGRuaURldGFpbHNTY3JlZW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZG5pLWRldGFpbHMtc2NyZWVuJyk7CiAgICBjb25zdCB0ZWxlZm9ub3NTY3JlZW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGVsZWZvbm9zLXNjcmVlbicpOwogICAgY29uc3QgYm90dG9tTmF2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JvdHRvbS1uYXYnKTsKICAgIGNvbnN0IGxvYWRpbmdPdmVybGF5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRpbmctb3ZlcmxheScpOwogICAgY29uc3QgbG9naW5Mb2FkaW5nT3ZlcmxheSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2dpbi1sb2FkaW5nLW92ZXJsYXknKTsKICAgIGNvbnN0IGFjdGlvbkxvYWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhY3Rpb24tbG9hZGVyJyk7CiAgICAvLyBMb2dpbiBzY3JlZW4gZWxlbWVudHMKICAgIGNvbnN0IGxvZ2luQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvZ2luLWJ0bicpOwogICAgY29uc3QgZ3Vlc3RMb2dpbkJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdndWVzdC1sb2dpbi1idG4nKTsKICAgIGNvbnN0IHVzZXJuYW1lSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndXNlcm5hbWUtaW5wdXQnKTsKICAgIGNvbnN0IHBhc3N3b3JkSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFzc3dvcmQtaW5wdXQnKTsKICAgIGNvbnN0IGxvZ2luRXJyb3JNc2cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9naW4tZXJyb3ItbXNnJyk7CiAgICBjb25zdCBkb3dubG9hZEFwcEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkb3dubG9hZC1hcHAtYnRuJyk7CiAgICAvLyBOYXZpZ2F0aW9uIGJ1dHRvbnMKICAgIGNvbnN0IGRvY3VtZW50b3NCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZG9jdW1lbnRvcy1idG4nKTsKICAgIGNvbnN0IGVkaXRvckJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlZGl0b3ItYnRuJyk7CiAgICBjb25zdCB0ZWxlZm9ub3NCdG5Eb2NzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RlbGVmb25vcy1idG4tZG9jcycpOwogICAgY29uc3QgdGVsZWZvbm9zQnRuRGV0YWlscyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0ZWxlZm9ub3MtYnRuLWRldGFpbHMnKTsKICAgIGNvbnN0IHRlbGVmb25vc0luaWNpb0J0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0ZWxlZm9ub3MtaW5pY2lvLWJ0bicpOwogICAgY29uc3QgYmFja0J0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdiYWNrLWJ0bicpOwogICAgY29uc3QgZWRpdG9yQmFja0J0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlZGl0b3ItYmFjay1idG4nKTsKICAgIGNvbnN0IGRldGFpbHNCYWNrQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RldGFpbHMtYmFjay1idG4nKTsKICAgIGNvbnN0IGluaWNpb0J0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbmljaW8tYnRuJyk7CiAgICAvLyBETkkgQ2FyZCBlbGVtZW50cwogICAgY29uc3Qgc29saWNpdGFyRG5pQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NvbGljaXRhci1kbmktYnRuJyk7CiAgICBjb25zdCBkbmlJbml0aWFsVmlldyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkbmktaW5pdGlhbC12aWV3Jyk7CiAgICBjb25zdCBkbmlTb2xpY2l0dWRWaWV3ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RuaS1zb2xpY2l0dWQtdmlldycpOwogICAgY29uc3QgZG5pQ2FyZEhlYWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkbmktY2FyZC1oZWFkZXInKTsKICAgIGNvbnN0IGRuaUNhcmRCb2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RuaS1jYXJkLWJvZHknKTsKICAgIGNvbnN0IGNvbmZpcm1hclNvbGljaXR1ZEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb25maXJtYXItc29saWNpdHVkLWJ0bicpOwogICAgY29uc3QgZG5pRGlnaXRhbERpc3BsYXkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZG5pLWRpZ2l0YWwtZGlzcGxheScpOwogICAgY29uc3QgbWFpbkRuaVByb2ZpbGVQaWMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFpbi1kbmktcHJvZmlsZS1waWMnKTsKICAgIGNvbnN0IG1haW5EbmlQcm9maWxlSW1hZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFpbi1kbmktcHJvZmlsZS1pbWFnZScpOwogICAgY29uc3QgdmVyRGV0YWxsZUJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd2ZXItZGV0YWxsZS1idG4nKTsKICAgIGNvbnN0IHZlckRuaURpZ2l0YWxCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmVyLWRuaS1kaWdpdGFsLWJ0bicpOwogICAgLy8gSGVhZGVyIGVsZW1lbnRzIGZvciBkeW5hbWljIGNvbnRlbnQKICAgIGNvbnN0IGRvY3VtZW50b3NIZWFkZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZG9jdW1lbnRvcy1oZWFkZXInKTsKICAgIGNvbnN0IGRvY3VtZW50b3NIZWFkZXJUaXRsZSA9IGRvY3VtZW50b3NIZWFkZXIucXVlcnlTZWxlY3RvcignaDInKTsKICAgIGNvbnN0IHJlZnJlc2hJY29uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlZnJlc2gtaWNvbicpOwogICAgY29uc3Qgd2VsY29tZU5hbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd2VsY29tZS1uYW1lJyk7CiAgICBjb25zdCBkbmlEaWdpdGFsVGl0bGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZG5pLWRpZ2l0YWwtdGl0bGUnKTsKICAgIGNvbnN0IHNvbGljaXR1ZERuaU5hbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc29saWNpdHVkLWRuaS1uYW1lJyk7CiAgICAvLyBFZGl0b3Igc2NyZWVuIGNvbnRyb2xzIChJbWFnZSkKICAgIGNvbnN0IGVkaXRvckRuaVByb2ZpbGVQaWMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWRpdG9yLWRuaS1wcm9maWxlLXBpYycpOwogICAgY29uc3QgZWRpdG9yRG5pUHJvZmlsZUltYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXRvci1kbmktcHJvZmlsZS1pbWFnZScpOwogICAgY29uc3QgaW1hZ2VVcmxJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbWFnZS11cmwtaW5wdXQnKTsKICAgIGNvbnN0IHRvcFNsaWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b3Atc2xpZGVyJyk7CiAgICBjb25zdCBsZWZ0U2xpZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xlZnQtc2xpZGVyJyk7CiAgICBjb25zdCB3aWR0aFNsaWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3aWR0aC1zbGlkZXInKTsKICAgIGNvbnN0IGhlaWdodFNsaWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZWlnaHQtc2xpZGVyJyk7CiAgICBjb25zdCB0b3BWYWx1ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b3AtdmFsdWUnKTsKICAgIGNvbnN0IGxlZnRWYWx1ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsZWZ0LXZhbHVlJyk7CiAgICBjb25zdCB3aWR0aFZhbHVlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3dpZHRoLXZhbHVlJyk7CiAgICBjb25zdCBoZWlnaHRWYWx1ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZWlnaHQtdmFsdWUnKTsKICAgIC8vIEVkaXRvciBzY3JlZW4gY29udHJvbHMgKFFSKQogICAgY29uc3QgbWFpbkRuaVFyUGljID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21haW4tZG5pLXFyLXBpYycpOwogICAgY29uc3QgbWFpbkRuaVFySW1hZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFpbi1kbmktcXItaW1hZ2UnKTsKICAgIGNvbnN0IGVkaXRvckRuaVFyUGljID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXRvci1kbmktcXItcGljJyk7CiAgICBjb25zdCBlZGl0b3JEbmlRckltYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXRvci1kbmktcXItaW1hZ2UnKTsKICAgIGNvbnN0IHFyVXJsSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXItdXJsLWlucHV0Jyk7CiAgICBjb25zdCBxclRvcFNsaWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxci10b3Atc2xpZGVyJyk7CiAgICBjb25zdCBxckxlZnRTbGlkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXItbGVmdC1zbGlkZXInKTsKICAgIGNvbnN0IHFyV2lkdGhTbGlkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXItd2lkdGgtc2xpZGVyJyk7CiAgICBjb25zdCBxckhlaWdodFNsaWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxci1oZWlnaHQtc2xpZGVyJyk7CiAgICBjb25zdCBxclRvcFZhbHVlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FyLXRvcC12YWx1ZScpOwogICAgY29uc3QgcXJMZWZ0VmFsdWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXItbGVmdC12YWx1ZScpOwogICAgY29uc3QgcXJXaWR0aFZhbHVlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FyLXdpZHRoLXZhbHVlJyk7CiAgICBjb25zdCBxckhlaWdodFZhbHVlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FyLWhlaWdodC12YWx1ZScpOwogICAgY29uc3QgZGV0YWlsc0JhcmNvZGVJbWFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZXRhaWxzLWJhcmNvZGUtaW1hZ2UnKTsKICAgIGNvbnN0IGRldGFpbHNQcm9maWxlSW1hZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGV0YWlscy1wcm9maWxlLWltYWdlJyk7CiAgICAvLyBFZGl0b3Igc2NyZWVuIGNvbnRyb2xzIChCYWNrIEltYWdlKQogICAgY29uc3QgbWFpbkRuaUJhY2tJbWFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYWluLWRuaS1iYWNrLWltYWdlJyk7CiAgICBjb25zdCBlZGl0b3JEbmlCYWNrSW1hZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWRpdG9yLWRuaS1iYWNrLWltYWdlJyk7CiAgICBjb25zdCBkbmlCYWNrVXJsSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZG5pLWJhY2stdXJsLWlucHV0Jyk7CiAgICAvLyBVc2VyIE1lbnUgRWxlbWVudHMKICAgIGNvbnN0IHVzZXJQcm9maWxlQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VzZXItcHJvZmlsZS1idG4nKTsKICAgIGNvbnN0IHByb2ZpbGVBcnJvdyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9maWxlLWFycm93Jyk7CiAgICBjb25zdCB1c2VyTWVudSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1c2VyLW1lbnUnKTsKICAgIGNvbnN0IG1lbnVFZGl0b3JCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWVudS1lZGl0b3ItYnRuJyk7CiAgICBjb25zdCBtZW51VXNlck5hbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWVudS11c2VyLW5hbWUnKTsKICAgIGNvbnN0IG1lbnVVc2VySWQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWVudS11c2VyLWlkJyk7CiAgICAvLyBFZGl0b3IgVXNlciBNYW5hZ2VtZW50CiAgICBjb25zdCBuZXdVc2VybmFtZUlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25ldy11c2VybmFtZS1pbnB1dCcpOwogICAgY29uc3QgbmV3UGFzc3dvcmRJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZXctcGFzc3dvcmQtaW5wdXQnKTsKICAgIGNvbnN0IG5ld1VzZXJSb2xlU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25ldy11c2VyLXJvbGUtc2VsZWN0Jyk7CiAgICBjb25zdCBzYXZlVXNlckJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzYXZlLXVzZXItYnRuJyk7CiAgICBjb25zdCB1c2VyTGlzdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1c2VyLWxpc3QnKTsKICAgIGNvbnN0IGltcG9ydFVzZXJzQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ltcG9ydC11c2Vycy1idG4nKTsKICAgIGNvbnN0IGltcG9ydFVzZXJzSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW1wb3J0LXVzZXJzLWlucHV0Jyk7CiAgICBjb25zdCBleHBvcnRVc2Vyc0J0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdleHBvcnQtdXNlcnMtYnRuJyk7CiAgICAvLyAtLS0gU3RhdGUgLS0tCiAgICBjb25zdCBVU0VSU19TVE9SQUdFX0tFWSA9ICdtaUFyZ2VudGluYVVzZXJzJzsKICAgIGxldCBjdXJyZW50bHlFZGl0aW5nVXNlciA9IG51bGw7CiAgICBsZXQgbG9nZ2VkSW5Vc2VyID0gbnVsbDsKICAgIGxldCBpc0ZsaXBwZWQgPSBmYWxzZTsKICAgIC8vIC0tLSBDb3JlIEFwcCBMb2dpYyAmIEZ1bmN0aW9ucyAtLS0KICAgIC8vIC0tLSBBUEkgU0lNVUxBVE9SIChmb3IgbGl2ZSBhcHApIC0tLQogICAgYXN5bmMgZnVuY3Rpb24gYXBpQ2FsbChhY3Rpb24sIHBheWxvYWQgPSB7fSkgewogICAgICAgIGNvbnNvbGUubG9nKGBBUEkgQ2FsbCAoU2ltdWxhdGVkKTogJHthY3Rpb259YCwgcGF5bG9hZCk7CiAgICAgICAgY29uc3QgZ2V0VXNlcnMgPSAoKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHVzZXJzSnNvbiA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKFVTRVJTX1NUT1JBR0VfS0VZKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHJldHVybiB1c2Vyc0pzb24gPyBKU09OLnBhcnNlKHVzZXJzSnNvbikgOiBbXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIFtdOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBjb25zdCBzYXZlVXNlcnMgPSAodXNlcnMpID0+IHsKICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oVVNFUlNfU1RPUkFHRV9LRVksIEpTT04uc3RyaW5naWZ5KHVzZXJzLCBudWxsLCAyKSk7CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoYWN0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnbG9naW4nOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgdXNlcm5hbWUsIHBhc3N3b3JkIH0gPSBwYXlsb2FkOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB1c2VycyA9IGdldFVzZXJzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGZvdW5kVXNlciA9IHVzZXJzLmZpbmQoKHUpID0+IHUudXNlcm5hbWUgPT09IHVzZXJuYW1lICYmIHUucGFzc3dvcmQgPT09IHBhc3N3b3JkKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZvdW5kVXNlcikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh7IHN1Y2Nlc3M6IHRydWUsIHVzZXI6IGZvdW5kVXNlciB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoeyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogJ1VzdWFyaW8gbyBjb250cmFzZcOxYSBpbmNvcnJlY3Rvcy4nIH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjYXNlICdnZXRfdXNlcnMnOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZ2V0VXNlcnMoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjYXNlICdzYXZlX3VzZXInOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCB1c2VycyA9IGdldFVzZXJzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgaXNFZGl0aW5nLCBjdXJyZW50bHlFZGl0aW5nVXNlciwgdXNlckRhdGEgfSA9IHBheWxvYWQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgdXNlcm5hbWUgfSA9IHVzZXJEYXRhOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB1c2VyRXhpc3RzID0gdXNlcnMuc29tZSgodSkgPT4gdS51c2VybmFtZSA9PT0gdXNlcm5hbWUgJiYgKCFpc0VkaXRpbmcgfHwgY3VycmVudGx5RWRpdGluZ1VzZXIgIT09IHVzZXJuYW1lKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1c2VyRXhpc3RzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IGBFbCBub21icmUgZGUgdXN1YXJpbyAiJHt1c2VybmFtZX0iIHlhIGV4aXN0ZS5gIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc0VkaXRpbmcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJzID0gdXNlcnMubWFwKCh1KSA9PiAodS51c2VybmFtZSA9PT0gY3VycmVudGx5RWRpdGluZ1VzZXIgPyB7IC4uLnUsIC4uLnVzZXJEYXRhLCBwYXNzd29yZDogdXNlckRhdGEucGFzc3dvcmQgfHwgdS5wYXNzd29yZCB9IDogdSkpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcnMucHVzaCh1c2VyRGF0YSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgc2F2ZVVzZXJzKHVzZXJzKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh7IHN1Y2Nlc3M6IHRydWUsIG1lc3NhZ2U6ICdVc3VhcmlvIGd1YXJkYWRvIGNvbiDDqXhpdG8uJyB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNhc2UgJ2RlbGV0ZV91c2VyJzogewogICAgICAgICAgICAgICAgICAgICAgICBsZXQgdXNlcnMgPSBnZXRVc2VycygpOwogICAgICAgICAgICAgICAgICAgICAgICB1c2VycyA9IHVzZXJzLmZpbHRlcigodSkgPT4gdS51c2VybmFtZSAhPT0gcGF5bG9hZC51c2VybmFtZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVVc2Vycyh1c2Vycyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoeyBzdWNjZXNzOiB0cnVlLCBtZXNzYWdlOiAnVXN1YXJpbyBlbGltaW5hZG8uJyB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNhc2UgJ2ltcG9ydF91c2Vycyc6IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZC51c2VycykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVVc2VycyhwYXlsb2FkLnVzZXJzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoeyBzdWNjZXNzOiB0cnVlLCBtZXNzYWdlOiAnVXN1YXJpb3MgaW1wb3J0YWRvcyBjb24gw6l4aXRvLicgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6ICdEYXRvcyBpbnbDoWxpZG9zLicgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdCh7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBgQWNjacOzbiBkZXNjb25vY2lkYTogJHthY3Rpb259YCB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgMjUwKTsKICAgICAgICB9KTsKICAgIH0KICAgIC8vIC0tLSBVc2VyIE1hbmFnZW1lbnQgJiBBdXRoIC0tLQogICAgZnVuY3Rpb24gdXBkYXRlVWlGb3JVc2VyUm9sZSgpIHsKICAgICAgICBjb25zdCBpc0FkbWluID0gbG9nZ2VkSW5Vc2VyPy5yb2xlID09PSAnYWRtaW4nOwogICAgICAgIGlmIChlZGl0b3JCdG4pCiAgICAgICAgICAgIGVkaXRvckJ0bi5zdHlsZS5kaXNwbGF5ID0gaXNBZG1pbiA/ICdmbGV4JyA6ICdub25lJzsKICAgICAgICBpZiAobWVudUVkaXRvckJ0bikKICAgICAgICAgICAgbWVudUVkaXRvckJ0bi5zdHlsZS5kaXNwbGF5ID0gaXNBZG1pbiA/ICdibG9jaycgOiAnbm9uZSc7CiAgICB9CiAgICBmdW5jdGlvbiBnYXRoZXJDdXJyZW50RG5pRGF0YSgpIHsKICAgICAgICBjb25zdCBkYXRhID0ge307CiAgICAgICAgY29uc3QgaW5wdXRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnI2VkaXRvci1zY3JlZW4gLmN1c3RvbS1pbnB1dCwgI2VkaXRvci1zY3JlZW4gaW5wdXRbdHlwZT0icmFuZ2UiXSwgI2VkaXRvci1zY3JlZW4gLmN1c3RvbS1zZWxlY3QnKTsKICAgICAgICBpbnB1dHMuZm9yRWFjaChpbnB1dCA9PiB7CiAgICAgICAgICAgIGNvbnN0IGVsID0gaW5wdXQ7CiAgICAgICAgICAgIGRhdGFbZWwuaWRdID0gZWwudmFsdWU7CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIGRhdGE7CiAgICB9CiAgICBmdW5jdGlvbiBhcHBseVVzZXJEYXRhKGRuaURhdGEpIHsKICAgICAgICBpZiAoIWRuaURhdGEpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBjb25zdCBpbnB1dHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcjZWRpdG9yLXNjcmVlbiAuY3VzdG9tLWlucHV0LCAjZWRpdG9yLXNjcmVlbiBpbnB1dFt0eXBlPSJyYW5nZSJdLCAjZWRpdG9yLXNjcmVlbiAuY3VzdG9tLXNlbGVjdCcpOwogICAgICAgIGlucHV0cy5mb3JFYWNoKGlucHV0ID0+IHsKICAgICAgICAgICAgY29uc3QgZWwgPSBpbnB1dDsKICAgICAgICAgICAgaWYgKGRuaURhdGFbZWwuaWRdICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIGVsLnZhbHVlID0gZG5pRGF0YVtlbC5pZF07CiAgICAgICAgICAgICAgICBlbC5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgnaW5wdXQnLCB7IGJ1YmJsZXM6IHRydWUgfSkpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CiAgICBhc3luYyBmdW5jdGlvbiBkZWxldGVVc2VyKHVzZXJuYW1lVG9EZWxldGUpIHsKICAgICAgICBpZiAoIWNvbmZpcm0oYMK/RXN0w6Egc2VndXJvIGRlIHF1ZSBkZXNlYSBlbGltaW5hciBhbCB1c3VhcmlvICIke3VzZXJuYW1lVG9EZWxldGV9Ij9gKSkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGFwaUNhbGwoJ2RlbGV0ZV91c2VyJywgeyB1c2VybmFtZTogdXNlcm5hbWVUb0RlbGV0ZSB9KTsKICAgICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHsKICAgICAgICAgICAgaWYgKHVzZXJuYW1lVG9EZWxldGUgPT09IGN1cnJlbnRseUVkaXRpbmdVc2VyKSB7CiAgICAgICAgICAgICAgICByZXNldFVzZXJGb3JtKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVuZGVyVXNlckxpc3QoKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGFsZXJ0KGBFcnJvcjogJHtyZXN1bHQubWVzc2FnZSB8fCAnTm8gc2UgcHVkbyBlbGltaW5hciBhbCB1c3VhcmlvLid9YCk7CiAgICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gcmVzZXRVc2VyRm9ybSgpIHsKICAgICAgICBuZXdVc2VybmFtZUlucHV0LnZhbHVlID0gJyc7CiAgICAgICAgbmV3UGFzc3dvcmRJbnB1dC52YWx1ZSA9ICcnOwogICAgICAgIGlmIChuZXdVc2VyUm9sZVNlbGVjdCkKICAgICAgICAgICAgbmV3VXNlclJvbGVTZWxlY3QudmFsdWUgPSAndXNlcic7CiAgICAgICAgc2F2ZVVzZXJCdG4udGV4dENvbnRlbnQgPSAnR3VhcmRhciBOdWV2byBVc3VhcmlvJzsKICAgICAgICBjdXJyZW50bHlFZGl0aW5nVXNlciA9IG51bGw7CiAgICB9CiAgICBhc3luYyBmdW5jdGlvbiByZW5kZXJVc2VyTGlzdCgpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBjb25zdCB1c2VycyA9IGF3YWl0IGFwaUNhbGwoJ2dldF91c2VycycpOwogICAgICAgICAgICB1c2VyTGlzdC5pbm5lckhUTUwgPSAnJzsgLy8gQ2xlYXIgY3VycmVudCBsaXN0CiAgICAgICAgICAgIGlmICghdXNlcnMgfHwgIUFycmF5LmlzQXJyYXkodXNlcnMpIHx8IHVzZXJzLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgdXNlckxpc3QuaW5uZXJIVE1MID0gJzxwIHN0eWxlPSJjb2xvcjogdmFyKC0tdGV4dC1saWdodCk7IHRleHQtYWxpZ246IGNlbnRlcjsiPk5vIGhheSB1c3VhcmlvcyBndWFyZGFkb3MuPC9wPic7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdXNlcnMuZm9yRWFjaCgodXNlcikgPT4gewogICAgICAgICAgICAgICAgY29uc3QgdXNlckl0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICAgICAgICAgIHVzZXJJdGVtLmNsYXNzTmFtZSA9ICd1c2VyLWxpc3QtaXRlbSc7CiAgICAgICAgICAgICAgICBjb25zdCB1c2VyTmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTsKICAgICAgICAgICAgICAgIHVzZXJOYW1lLmNsYXNzTmFtZSA9ICd1c2VyLWxpc3QtaXRlbS1uYW1lJzsKICAgICAgICAgICAgICAgIHVzZXJOYW1lLnRleHRDb250ZW50ID0gYCR7dXNlci51c2VybmFtZX0gKCR7dXNlci5yb2xlIHx8ICd1c2VyJ30pYDsKICAgICAgICAgICAgICAgIGNvbnN0IGFjdGlvbnNDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICAgICAgICAgIGFjdGlvbnNDb250YWluZXIuY2xhc3NOYW1lID0gJ3VzZXItbGlzdC1pdGVtLWFjdGlvbnMnOwogICAgICAgICAgICAgICAgY29uc3QgZWRpdEJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpOwogICAgICAgICAgICAgICAgZWRpdEJ0bi50ZXh0Q29udGVudCA9ICdFZGl0YXInOwogICAgICAgICAgICAgICAgZWRpdEJ0bi5jbGFzc05hbWUgPSAnZWRpdC1idG4nOwogICAgICAgICAgICAgICAgZWRpdEJ0bi5vbmNsaWNrID0gKCkgPT4gewogICAgICAgICAgICAgICAgICAgIGFwcGx5VXNlckRhdGEodXNlci5kbmlEYXRhKTsKICAgICAgICAgICAgICAgICAgICBuZXdVc2VybmFtZUlucHV0LnZhbHVlID0gdXNlci51c2VybmFtZTsKICAgICAgICAgICAgICAgICAgICBuZXdQYXNzd29yZElucHV0LnZhbHVlID0gJyc7IC8vIERvbid0IHNob3cgcGFzc3dvcmQKICAgICAgICAgICAgICAgICAgICBuZXdQYXNzd29yZElucHV0LnBsYWNlaG9sZGVyID0gIkRlamFyIGVuIGJsYW5jbyBwYXJhIG5vIGNhbWJpYXIiOwogICAgICAgICAgICAgICAgICAgIGlmIChuZXdVc2VyUm9sZVNlbGVjdCkKICAgICAgICAgICAgICAgICAgICAgICAgbmV3VXNlclJvbGVTZWxlY3QudmFsdWUgPSB1c2VyLnJvbGUgfHwgJ3VzZXInOwogICAgICAgICAgICAgICAgICAgIHNhdmVVc2VyQnRuLnRleHRDb250ZW50ID0gJ0FjdHVhbGl6YXIgVXN1YXJpbyc7CiAgICAgICAgICAgICAgICAgICAgY3VycmVudGx5RWRpdGluZ1VzZXIgPSB1c2VyLnVzZXJuYW1lOwogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5zY3JvbGxUbygwLCAwKTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBjb25zdCBkZWxldGVCdG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTsKICAgICAgICAgICAgICAgIGRlbGV0ZUJ0bi50ZXh0Q29udGVudCA9ICdFbGltaW5hcic7CiAgICAgICAgICAgICAgICBkZWxldGVCdG4uY2xhc3NOYW1lID0gJ2RlbGV0ZS1idG4nOwogICAgICAgICAgICAgICAgZGVsZXRlQnRuLm9uY2xpY2sgPSAoKSA9PiBkZWxldGVVc2VyKHVzZXIudXNlcm5hbWUpOwogICAgICAgICAgICAgICAgYWN0aW9uc0NvbnRhaW5lci5hcHBlbmRDaGlsZChlZGl0QnRuKTsKICAgICAgICAgICAgICAgIGFjdGlvbnNDb250YWluZXIuYXBwZW5kQ2hpbGQoZGVsZXRlQnRuKTsKICAgICAgICAgICAgICAgIHVzZXJJdGVtLmFwcGVuZENoaWxkKHVzZXJOYW1lKTsKICAgICAgICAgICAgICAgIHVzZXJJdGVtLmFwcGVuZENoaWxkKGFjdGlvbnNDb250YWluZXIpOwogICAgICAgICAgICAgICAgdXNlckxpc3QuYXBwZW5kQ2hpbGQodXNlckl0ZW0pOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIGZldGNoaW5nIHVzZXJzOiIsIGVycm9yKTsKICAgICAgICAgICAgdXNlckxpc3QuaW5uZXJIVE1MID0gJzxwIHN0eWxlPSJjb2xvcjogcmVkOyB0ZXh0LWFsaWduOiBjZW50ZXI7Ij5FcnJvciBhbCBjYXJnYXIgbGEgbGlzdGEgZGUgdXN1YXJpb3MuPC9wPic7CiAgICAgICAgfQogICAgfQogICAgLy8gLS0tIFVJIEhlbHBlcnMgLS0tCiAgICBmdW5jdGlvbiBzZXR1cFNsaWRlcihzbGlkZXIsIHRhcmdldHMsIHByb3BlcnR5LCB2YWx1ZVNwYW4sIHVuaXQgPSAnJScpIHsKICAgICAgICBpZiAoc2xpZGVyICYmIHRhcmdldHMgJiYgdGFyZ2V0cy5sZW5ndGggPiAwICYmIHZhbHVlU3BhbikgewogICAgICAgICAgICBjb25zdCB1cGRhdGUgPSAoKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHNsaWRlci52YWx1ZTsKICAgICAgICAgICAgICAgIHRhcmdldHMuZm9yRWFjaCh0YXJnZXQgPT4gewogICAgICAgICAgICAgICAgICAgIGlmICh0YXJnZXQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0LnN0eWxlW3Byb3BlcnR5XSA9IGAke3ZhbHVlfSR7dW5pdH1gOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgdmFsdWVTcGFuLnRleHRDb250ZW50ID0gdmFsdWU7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHNsaWRlci5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIHVwZGF0ZSk7CiAgICAgICAgICAgIHVwZGF0ZSgpOyAvLyBTZXQgaW5pdGlhbCB2YWx1ZQogICAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIHVwZGF0ZUR5bmFtaWNIZWFkZXJEYXRhKCkgewogICAgICAgIGNvbnN0IGFwZWxsaWRvSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYXBlbGxpZG8taW5wdXQnKTsKICAgICAgICBjb25zdCBub21icmVJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdub21icmUtaW5wdXQnKTsKICAgICAgICBjb25zdCBjdWlsSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3VpbC1pbnB1dCcpOwogICAgICAgIGlmIChhcGVsbGlkb0lucHV0ICYmIG5vbWJyZUlucHV0ICYmIGN1aWxJbnB1dCkgewogICAgICAgICAgICBjb25zdCBhcGVsbGlkbyA9IGFwZWxsaWRvSW5wdXQudmFsdWU7CiAgICAgICAgICAgIGNvbnN0IG5vbWJyZSA9IG5vbWJyZUlucHV0LnZhbHVlOwogICAgICAgICAgICBjb25zdCBjdWlsID0gY3VpbElucHV0LnZhbHVlOwogICAgICAgICAgICBjb25zdCBkcm9wZG93bk5hbWUgPSBgJHtub21icmV9ICR7YXBlbGxpZG99YDsKICAgICAgICAgICAgY29uc3QgZG5pVGl0bGVOYW1lID0gYCR7YXBlbGxpZG99ICR7bm9tYnJlfWA7CiAgICAgICAgICAgIGNvbnN0IG1lbnVOYW1lID0gYCR7bm9tYnJlfSAke2FwZWxsaWRvfWA7CiAgICAgICAgICAgIGlmICh3ZWxjb21lTmFtZSkKICAgICAgICAgICAgICAgIHdlbGNvbWVOYW1lLnRleHRDb250ZW50ID0gbm9tYnJlOwogICAgICAgICAgICBpZiAoZG5pRGlnaXRhbFRpdGxlKQogICAgICAgICAgICAgICAgZG5pRGlnaXRhbFRpdGxlLnRleHRDb250ZW50ID0gZG5pVGl0bGVOYW1lOwogICAgICAgICAgICBpZiAoc29saWNpdHVkRG5pTmFtZSkKICAgICAgICAgICAgICAgIHNvbGljaXR1ZERuaU5hbWUudGV4dENvbnRlbnQgPSBkcm9wZG93bk5hbWU7CiAgICAgICAgICAgIGlmIChtZW51VXNlck5hbWUpCiAgICAgICAgICAgICAgICBtZW51VXNlck5hbWUudGV4dENvbnRlbnQgPSBtZW51TmFtZTsKICAgICAgICAgICAgaWYgKG1lbnVVc2VySWQpCiAgICAgICAgICAgICAgICBtZW51VXNlcklkLnRleHRDb250ZW50ID0gY3VpbDsKICAgICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBzZXR1cFRleHRDb250cm9sKGZpZWxkKSB7CiAgICAgICAgY29uc3QgdGV4dElucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYCR7ZmllbGR9LWlucHV0YCk7CiAgICAgICAgY29uc3QgdG9wU2xpZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYCR7ZmllbGR9LXRvcC1zbGlkZXJgKTsKICAgICAgICBjb25zdCBsZWZ0U2xpZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYCR7ZmllbGR9LWxlZnQtc2xpZGVyYCk7CiAgICAgICAgY29uc3QgZm9udHNpemVTbGlkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgJHtmaWVsZH0tZm9udHNpemUtc2xpZGVyYCk7CiAgICAgICAgY29uc3QgZm9udFNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGAke2ZpZWxkfS1mb250LXNlbGVjdGApOwogICAgICAgIGNvbnN0IHRvcFZhbHVlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYCR7ZmllbGR9LXRvcC12YWx1ZWApOwogICAgICAgIGNvbnN0IGxlZnRWYWx1ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGAke2ZpZWxkfS1sZWZ0LXZhbHVlYCk7CiAgICAgICAgY29uc3QgZm9udHNpemVWYWx1ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGAke2ZpZWxkfS1mb250c2l6ZS12YWx1ZWApOwogICAgICAgIGNvbnN0IG1haW5UYXJnZXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgbWFpbi1kbmktJHtmaWVsZH1gKTsKICAgICAgICBjb25zdCBlZGl0b3JUYXJnZXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgZWRpdG9yLWRuaS0ke2ZpZWxkfWApOwogICAgICAgIGNvbnN0IHRhcmdldHMgPSBbbWFpblRhcmdldCwgZWRpdG9yVGFyZ2V0XS5maWx0ZXIoZWwgPT4gZWwpOwogICAgICAgIGlmICh0ZXh0SW5wdXQgJiYgdGFyZ2V0cy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZSA9ICgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IG5ld1ZhbHVlID0gdGV4dElucHV0LnZhbHVlOwogICAgICAgICAgICAgICAgdGFyZ2V0cy5mb3JFYWNoKHRhcmdldCA9PiB0YXJnZXQudGV4dENvbnRlbnQgPSBuZXdWYWx1ZSk7CiAgICAgICAgICAgICAgICBpZiAoZmllbGQgPT09ICdub21icmUnIHx8IGZpZWxkID09PSAnYXBlbGxpZG8nIHx8IGZpZWxkID09PSAnY3VpbCcpIHsKICAgICAgICAgICAgICAgICAgICB1cGRhdGVEeW5hbWljSGVhZGVyRGF0YSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgICB0ZXh0SW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCB1cGRhdGUpOwogICAgICAgICAgICB1cGRhdGUoKTsKICAgICAgICB9CiAgICAgICAgc2V0dXBTbGlkZXIodG9wU2xpZGVyLCB0YXJnZXRzLCAndG9wJywgdG9wVmFsdWUsICclJyk7CiAgICAgICAgc2V0dXBTbGlkZXIobGVmdFNsaWRlciwgdGFyZ2V0cywgJ2xlZnQnLCBsZWZ0VmFsdWUsICclJyk7CiAgICAgICAgc2V0dXBTbGlkZXIoZm9udHNpemVTbGlkZXIsIHRhcmdldHMsICdmb250U2l6ZScsIGZvbnRzaXplVmFsdWUsICdweCcpOwogICAgICAgIGlmIChmb250U2VsZWN0ICYmIHRhcmdldHMubGVuZ3RoID4gMCkgewogICAgICAgICAgICBjb25zdCB1cGRhdGUgPSAoKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBuZXdGb250ID0gZm9udFNlbGVjdC52YWx1ZTsKICAgICAgICAgICAgICAgIHRhcmdldHMuZm9yRWFjaCh0YXJnZXQgPT4gewogICAgICAgICAgICAgICAgICAgIGlmICh0YXJnZXQpCiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldC5zdHlsZS5mb250RmFtaWx5ID0gbmV3Rm9udDsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9OwogICAgICAgICAgICBmb250U2VsZWN0LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgdXBkYXRlKTsKICAgICAgICAgICAgdXBkYXRlKCk7CiAgICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gcmVzZXREbmlDYXJkKCkgewogICAgICAgIGlmIChkbmlDYXJkSGVhZGVyKQogICAgICAgICAgICBkbmlDYXJkSGVhZGVyLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7CiAgICAgICAgaWYgKGRuaUluaXRpYWxWaWV3KQogICAgICAgICAgICBkbmlJbml0aWFsVmlldy5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICBpZiAoZG5pU29saWNpdHVkVmlldykKICAgICAgICAgICAgZG5pU29saWNpdHVkVmlldy5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgIGlmIChkbmlEaWdpdGFsRGlzcGxheSkKICAgICAgICAgICAgZG5pRGlnaXRhbERpc3BsYXkuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICBpZiAoZG5pQ2FyZEJvZHkpCiAgICAgICAgICAgIGRuaUNhcmRCb2R5LmNsYXNzTGlzdC5yZW1vdmUoJ25vLWhlYWRlcicpOwogICAgICAgIGlmIChkb2N1bWVudG9zSGVhZGVyVGl0bGUpCiAgICAgICAgICAgIGRvY3VtZW50b3NIZWFkZXJUaXRsZS50ZXh0Q29udGVudCA9ICdEb2N1bWVudG9zJzsKICAgICAgICBpZiAocmVmcmVzaEljb24pCiAgICAgICAgICAgIHJlZnJlc2hJY29uLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgaWYgKGRvY3VtZW50b3NIZWFkZXIpCiAgICAgICAgICAgIGRvY3VtZW50b3NIZWFkZXIuc3R5bGUuanVzdGlmeUNvbnRlbnQgPSAnZmxleC1zdGFydCc7CiAgICAgICAgY29uc3QgZG5pRmxpcHBlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkbmktZmxpcHBlcicpOwogICAgICAgIGlmIChkbmlGbGlwcGVyICYmIGlzRmxpcHBlZCkgewogICAgICAgICAgICBkbmlGbGlwcGVyLnN0eWxlLnRyYW5zaXRpb24gPSAndHJhbnNmb3JtIDAuNnMgY3ViaWMtYmV6aWVyKDAuMzQsIDEuNTYsIDAuNjQsIDEpJzsKICAgICAgICAgICAgZG5pRmxpcHBlci5zdHlsZS50cmFuc2Zvcm0gPSAncm90YXRlWSgwZGVnKSc7CiAgICAgICAgfQogICAgICAgIGlzRmxpcHBlZCA9IGZhbHNlOwogICAgfQogICAgZnVuY3Rpb24gc2hvd1NjcmVlbihzY3JlZW5OYW1lKSB7CiAgICAgICAgW2xvZ2luU2NyZWVuLCBtYWluU2NyZWVuLCBkb2N1bWVudG9zU2NyZWVuLCBlZGl0b3JTY3JlZW4sIGRuaURldGFpbHNTY3JlZW4sIHRlbGVmb25vc1NjcmVlbl0uZm9yRWFjaChzID0+IHMuc3R5bGUuZGlzcGxheSA9ICdub25lJyk7CiAgICAgICAgaWYgKGJvdHRvbU5hdikKICAgICAgICAgICAgYm90dG9tTmF2LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgc3dpdGNoIChzY3JlZW5OYW1lKSB7CiAgICAgICAgICAgIGNhc2UgJ2xvZ2luJzoKICAgICAgICAgICAgICAgIGxvZ2luU2NyZWVuLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAnbWFpbic6CiAgICAgICAgICAgICAgICBtYWluU2NyZWVuLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7CiAgICAgICAgICAgICAgICByZXNldERuaUNhcmQoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdkb2N1bWVudG9zJzoKICAgICAgICAgICAgICAgIGRvY3VtZW50b3NTY3JlZW4uc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsKICAgICAgICAgICAgICAgIGlmIChib3R0b21OYXYpCiAgICAgICAgICAgICAgICAgICAgYm90dG9tTmF2LnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAnZWRpdG9yJzoKICAgICAgICAgICAgICAgIGlmIChsb2dnZWRJblVzZXI/LnJvbGUgPT09ICdhZG1pbicpIHsKICAgICAgICAgICAgICAgICAgICBlZGl0b3JTY3JlZW4uc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIGFsZXJ0KCdBY2Nlc28gZGVuZWdhZG8uIFNlIHJlcXVpZXJlbiBwZXJtaXNvcyBkZSBhZG1pbmlzdHJhZG9yLicpOwogICAgICAgICAgICAgICAgICAgIHNob3dTY3JlZW4oJ21haW4nKTsgLy8gUmVkaXJlY3QgdG8gYSBzYWZlIHNjcmVlbgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ2RldGFpbHMnOgogICAgICAgICAgICAgICAgZG5pRGV0YWlsc1NjcmVlbi5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ3RlbGVmb25vcyc6CiAgICAgICAgICAgICAgICB0ZWxlZm9ub3NTY3JlZW4uc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIHNob3dEbmlEaWdpdGFsVmlldygpIHsKICAgICAgICBpZiAoZG5pSW5pdGlhbFZpZXcpCiAgICAgICAgICAgIGRuaUluaXRpYWxWaWV3LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgaWYgKGRuaVNvbGljaXR1ZFZpZXcpCiAgICAgICAgICAgIGRuaVNvbGljaXR1ZFZpZXcuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICBpZiAoZG5pRGlnaXRhbERpc3BsYXkpCiAgICAgICAgICAgIGRuaURpZ2l0YWxEaXNwbGF5LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgIGlmIChkbmlDYXJkSGVhZGVyKQogICAgICAgICAgICBkbmlDYXJkSGVhZGVyLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgaWYgKGRuaUNhcmRCb2R5KQogICAgICAgICAgICBkbmlDYXJkQm9keS5jbGFzc0xpc3QuYWRkKCduby1oZWFkZXInKTsKICAgICAgICBpZiAoZG9jdW1lbnRvc0hlYWRlclRpdGxlKQogICAgICAgICAgICBkb2N1bWVudG9zSGVhZGVyVGl0bGUudGV4dENvbnRlbnQgPSAnRE5JIERpZ2l0YWwnOwogICAgICAgIGlmIChyZWZyZXNoSWNvbikKICAgICAgICAgICAgcmVmcmVzaEljb24uc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgaWYgKGRvY3VtZW50b3NIZWFkZXIpCiAgICAgICAgICAgIGRvY3VtZW50b3NIZWFkZXIuc3R5bGUuanVzdGlmeUNvbnRlbnQgPSAnc3BhY2UtYmV0d2Vlbic7CiAgICB9CiAgICBmdW5jdGlvbiBwb3B1bGF0ZURuaURldGFpbHMoKSB7CiAgICAgICAgY29uc3QgZG5pID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RvY3VtZW50by1pbnB1dCcpLnZhbHVlOwogICAgICAgIGNvbnN0IHRyYW1pdGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndHJhbWl0ZS1pbnB1dCcpLnZhbHVlOwogICAgICAgIGNvbnN0IGVtaXNpb24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZW1pc2lvbi1pbnB1dCcpLnZhbHVlOwogICAgICAgIGNvbnN0IHZlbmNpbWllbnRvID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ZlbmNpbWllbnRvLWlucHV0JykudmFsdWU7CiAgICAgICAgY29uc3Qgbm9tYnJlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25vbWJyZS1pbnB1dCcpLnZhbHVlOwogICAgICAgIGNvbnN0IGFwZWxsaWRvID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FwZWxsaWRvLWlucHV0JykudmFsdWU7CiAgICAgICAgY29uc3Qgc2V4byA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZXhvLWlucHV0JykudmFsdWU7CiAgICAgICAgY29uc3QgbmFjaW1pZW50byA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduYWNpbWllbnRvLWlucHV0JykudmFsdWU7CiAgICAgICAgY29uc3QgZG9taWNpbGlvID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RvbWljaWxpby1pbnB1dCcpLnZhbHVlOwogICAgICAgIGNvbnN0IGN1aWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3VpbC1pbnB1dCcpLnZhbHVlOwogICAgICAgIGNvbnN0IG5hY2lvbmFsaWRhZCA9ICdBUic7CiAgICAgICAgY29uc3QgbHVnYXJOYWNpbWllbnRvID0gJ0FSR0VOVElOQSc7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RldGFpbHMtZG5pJykudGV4dENvbnRlbnQgPSBkbmk7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RldGFpbHMtdHJhbWl0ZScpLnRleHRDb250ZW50ID0gdHJhbWl0ZTsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGV0YWlscy1lbWlzaW9uJykudGV4dENvbnRlbnQgPSBlbWlzaW9uOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZXRhaWxzLXZlbmNpbWllbnRvJykudGV4dENvbnRlbnQgPSB2ZW5jaW1pZW50bzsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGV0YWlscy1ub21icmUnKS50ZXh0Q29udGVudCA9IG5vbWJyZTsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGV0YWlscy1hcGVsbGlkbycpLnRleHRDb250ZW50ID0gYXBlbGxpZG87CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RldGFpbHMtY3VpbCcpLnRleHRDb250ZW50ID0gY3VpbDsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGV0YWlscy1zZXhvJykudGV4dENvbnRlbnQgPSBzZXhvOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZXRhaWxzLW5hY2ltaWVudG8nKS50ZXh0Q29udGVudCA9IG5hY2ltaWVudG87CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RldGFpbHMtbmFjaW9uYWxpZGFkJykudGV4dENvbnRlbnQgPSBuYWNpb25hbGlkYWQ7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RldGFpbHMtbHVnYXItbmFjaW1pZW50bycpLnRleHRDb250ZW50ID0gbHVnYXJOYWNpbWllbnRvOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZXRhaWxzLWRvbWljaWxpbycpLnRleHRDb250ZW50ID0gZG9taWNpbGlvOwogICAgfQogICAgLy8gLS0tIEZsaXBwZXIgJiBDYXJvdXNlbCBIZWxwZXJzIC0tLQogICAgZnVuY3Rpb24gc2V0dXBGbGlwcGVyKGNvbnRhaW5lciwgZmxpcHBlcikgewogICAgICAgIGlmICghY29udGFpbmVyIHx8ICFmbGlwcGVyKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgbGV0IGlzRHJhZ2dpbmcgPSBmYWxzZSwgc3RhcnRYID0gMCwgc3RhcnRBbmdsZSA9IDAsIGN1cnJlbnRBbmdsZSA9IDA7CiAgICAgICAgY29uc3QgZ2V0RXZlbnRYID0gKGUpID0+IGUudHlwZS5pbmNsdWRlcygnbW91c2UnKSA/IGUuc2NyZWVuWCA6IGUuY2hhbmdlZFRvdWNoZXNbMF0uc2NyZWVuWDsKICAgICAgICBjb25zdCBoYW5kbGVEcmFnU3RhcnQgPSAoZSkgPT4gewogICAgICAgICAgICBpZiAoZS50eXBlID09PSAnbW91c2Vkb3duJyAmJiBlLmJ1dHRvbiAhPT0gMCkKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgaXNEcmFnZ2luZyA9IHRydWU7CiAgICAgICAgICAgIHN0YXJ0WCA9IGdldEV2ZW50WChlKTsKICAgICAgICAgICAgc3RhcnRBbmdsZSA9IGN1cnJlbnRBbmdsZTsKICAgICAgICAgICAgZmxpcHBlci5zdHlsZS50cmFuc2l0aW9uID0gJ25vbmUnOwogICAgICAgICAgICBpZiAoZS50eXBlICE9PSAndG91Y2hzdGFydCcpCiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgfTsKICAgICAgICBjb25zdCBoYW5kbGVEcmFnTW92ZSA9IChlKSA9PiB7CiAgICAgICAgICAgIGlmICghaXNEcmFnZ2luZykKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBjb25zdCBkZWx0YVggPSBnZXRFdmVudFgoZSkgLSBzdGFydFg7CiAgICAgICAgICAgIGNvbnN0IHJvdGF0aW9uU2Vuc2l0aXZpdHkgPSAxODAgLyBjb250YWluZXIub2Zmc2V0V2lkdGg7CiAgICAgICAgICAgIGN1cnJlbnRBbmdsZSA9IHN0YXJ0QW5nbGUgKyAoZGVsdGFYICogcm90YXRpb25TZW5zaXRpdml0eSk7CiAgICAgICAgICAgIGZsaXBwZXIuc3R5bGUudHJhbnNmb3JtID0gYHJvdGF0ZVkoJHtjdXJyZW50QW5nbGV9ZGVnKWA7CiAgICAgICAgfTsKICAgICAgICBjb25zdCBoYW5kbGVEcmFnRW5kID0gKCkgPT4gewogICAgICAgICAgICBpZiAoIWlzRHJhZ2dpbmcpCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGlzRHJhZ2dpbmcgPSBmYWxzZTsKICAgICAgICAgICAgZmxpcHBlci5zdHlsZS50cmFuc2l0aW9uID0gJ3RyYW5zZm9ybSAwLjZzIGN1YmljLWJlemllcigwLjM0LCAxLjU2LCAwLjY0LCAxKSc7CiAgICAgICAgICAgIGNvbnN0IGZpbmFsUm90YXRpb24gPSBNYXRoLnJvdW5kKGN1cnJlbnRBbmdsZSAvIDE4MCkgKiAxODA7CiAgICAgICAgICAgIGlmIChjb250YWluZXIuaWQuaW5jbHVkZXMoJ21haW4tZG5pJykpIHsKICAgICAgICAgICAgICAgIGlzRmxpcHBlZCA9IChNYXRoLnJvdW5kKGZpbmFsUm90YXRpb24gLyAxODApICUgMikgIT09IDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZmxpcHBlci5zdHlsZS50cmFuc2Zvcm0gPSBgcm90YXRlWSgke2ZpbmFsUm90YXRpb259ZGVnKWA7CiAgICAgICAgICAgIGN1cnJlbnRBbmdsZSA9IGZpbmFsUm90YXRpb247CiAgICAgICAgfTsKICAgICAgICBjb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgaGFuZGxlRHJhZ1N0YXJ0KTsKICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCBoYW5kbGVEcmFnTW92ZSk7CiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIGhhbmRsZURyYWdFbmQpOwogICAgICAgIGNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgaGFuZGxlRHJhZ1N0YXJ0LCB7IHBhc3NpdmU6IGZhbHNlIH0pOwogICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNobW92ZScsIGhhbmRsZURyYWdNb3ZlLCB7IHBhc3NpdmU6IGZhbHNlIH0pOwogICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgaGFuZGxlRHJhZ0VuZCk7CiAgICB9CiAgICBmdW5jdGlvbiBzZXR1cENhcm91c2VsKCkgewogICAgICAgIGNvbnN0IGNhcm91c2VsV3JhcHBlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlZGl0b3ItY2Fyb3VzZWwtd3JhcHBlcicpOwogICAgICAgIGNvbnN0IGNhcm91c2VsVHJhY2sgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWRpdG9yLWNhcm91c2VsLXRyYWNrJyk7CiAgICAgICAgY29uc3Qgc2xpZGVzID0gY2Fyb3VzZWxUcmFjayA/IEFycmF5LmZyb20oY2Fyb3VzZWxUcmFjay5jaGlsZHJlbikgOiBbXTsKICAgICAgICBjb25zdCBkb3RzQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXRvci1jYXJvdXNlbC1kb3RzJyk7CiAgICAgICAgaWYgKGNhcm91c2VsV3JhcHBlciAmJiBjYXJvdXNlbFRyYWNrICYmIHNsaWRlcy5sZW5ndGggPiAwICYmIGRvdHNDb250YWluZXIpIHsKICAgICAgICAgICAgbGV0IGN1cnJlbnRJbmRleCA9IDAsIGlzRHJhZ2dpbmcgPSBmYWxzZSwgc3RhcnRQb3MgPSAwLCBjdXJyZW50VHJhbnNsYXRlID0gMCwgcHJldlRyYW5zbGF0ZSA9IDAsIGFuaW1hdGlvbklEOwogICAgICAgICAgICBjb25zdCBzbGlkZVdpZHRoID0gKCkgPT4gc2xpZGVzWzBdLm9mZnNldFdpZHRoOwogICAgICAgICAgICBkb3RzQ29udGFpbmVyLmlubmVySFRNTCA9ICcnOwogICAgICAgICAgICBzbGlkZXMuZm9yRWFjaCgoXywgaSkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgZG90ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpOwogICAgICAgICAgICAgICAgZG90LmNsYXNzTGlzdC5hZGQoJ2Nhcm91c2VsLWRvdCcpOwogICAgICAgICAgICAgICAgaWYgKGkgPT09IDApCiAgICAgICAgICAgICAgICAgICAgZG90LmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgZG90LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gZ29Ub1NsaWRlKGkpKTsKICAgICAgICAgICAgICAgIGRvdHNDb250YWluZXIuYXBwZW5kQ2hpbGQoZG90KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGNvbnN0IGRvdHMgPSBBcnJheS5mcm9tKGRvdHNDb250YWluZXIuY2hpbGRyZW4pOwogICAgICAgICAgICBmdW5jdGlvbiBnb1RvU2xpZGUoc2xpZGVJbmRleCkgewogICAgICAgICAgICAgICAgaWYgKHNsaWRlSW5kZXggPCAwIHx8IHNsaWRlSW5kZXggPj0gc2xpZGVzLmxlbmd0aCkKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICBjb25zdCBvZmZzZXQgPSAtc2xpZGVJbmRleCAqIHNsaWRlV2lkdGgoKTsKICAgICAgICAgICAgICAgIGNhcm91c2VsVHJhY2suc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZVgoJHtvZmZzZXR9cHgpYDsKICAgICAgICAgICAgICAgIGNhcm91c2VsVHJhY2suc3R5bGUudHJhbnNpdGlvbiA9ICd0cmFuc2Zvcm0gMC4zcyBlYXNlLWluLW91dCc7CiAgICAgICAgICAgICAgICBjdXJyZW50SW5kZXggPSBzbGlkZUluZGV4OwogICAgICAgICAgICAgICAgZG90cy5mb3JFYWNoKChkb3QsIGkpID0+IGRvdC5jbGFzc0xpc3QudG9nZ2xlKCdhY3RpdmUnLCBpID09PSBjdXJyZW50SW5kZXgpKTsKICAgICAgICAgICAgICAgIHByZXZUcmFuc2xhdGUgPSBvZmZzZXQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgZ2V0UG9zaXRpb25YID0gKGUpID0+IGUudHlwZS5pbmNsdWRlcygnbW91c2UnKSA/IGUucGFnZVggOiBlLnRvdWNoZXNbMF0uY2xpZW50WDsKICAgICAgICAgICAgY29uc3QgdG91Y2hTdGFydCA9IChlKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoZS50YXJnZXQuY2xvc2VzdCgnLmNvbnRyb2wtZ3JvdXAnKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICBpc0RyYWdnaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHN0YXJ0UG9zID0gZ2V0UG9zaXRpb25YKGUpOwogICAgICAgICAgICAgICAgYW5pbWF0aW9uSUQgPSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0aW9uKTsKICAgICAgICAgICAgICAgIGNhcm91c2VsVHJhY2suc3R5bGUudHJhbnNpdGlvbiA9ICdub25lJzsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgY29uc3QgdG91Y2hNb3ZlID0gKGUpID0+IHsKICAgICAgICAgICAgICAgIGlmIChpc0RyYWdnaW5nKQogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRUcmFuc2xhdGUgPSBwcmV2VHJhbnNsYXRlICsgZ2V0UG9zaXRpb25YKGUpIC0gc3RhcnRQb3M7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGNvbnN0IHRvdWNoRW5kID0gKCkgPT4gewogICAgICAgICAgICAgICAgaWYgKCFpc0RyYWdnaW5nKQogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIGlzRHJhZ2dpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgIGNhbmNlbEFuaW1hdGlvbkZyYW1lKGFuaW1hdGlvbklEKTsKICAgICAgICAgICAgICAgIGNvbnN0IG1vdmVkQnkgPSBjdXJyZW50VHJhbnNsYXRlIC0gcHJldlRyYW5zbGF0ZTsKICAgICAgICAgICAgICAgIGlmIChtb3ZlZEJ5IDwgLTEwMCAmJiBjdXJyZW50SW5kZXggPCBzbGlkZXMubGVuZ3RoIC0gMSkKICAgICAgICAgICAgICAgICAgICBjdXJyZW50SW5kZXgrKzsKICAgICAgICAgICAgICAgIGlmIChtb3ZlZEJ5ID4gMTAwICYmIGN1cnJlbnRJbmRleCA+IDApCiAgICAgICAgICAgICAgICAgICAgY3VycmVudEluZGV4LS07CiAgICAgICAgICAgICAgICBnb1RvU2xpZGUoY3VycmVudEluZGV4KTsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgZnVuY3Rpb24gYW5pbWF0aW9uKCkgewogICAgICAgICAgICAgICAgY2Fyb3VzZWxUcmFjay5zdHlsZS50cmFuc2Zvcm0gPSBgdHJhbnNsYXRlWCgke2N1cnJlbnRUcmFuc2xhdGV9cHgpYDsKICAgICAgICAgICAgICAgIGlmIChpc0RyYWdnaW5nKQogICAgICAgICAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRpb24pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHNsaWRlcy5mb3JFYWNoKHNsaWRlID0+IHsKICAgICAgICAgICAgICAgIFsndG91Y2hzdGFydCcsICdtb3VzZWRvd24nXS5mb3JFYWNoKGV2dCA9PiBzbGlkZS5hZGRFdmVudExpc3RlbmVyKGV2dCwgdG91Y2hTdGFydCkpOwogICAgICAgICAgICAgICAgWyd0b3VjaGVuZCcsICdtb3VzZXVwJywgJ21vdXNlbGVhdmUnXS5mb3JFYWNoKGV2dCA9PiBzbGlkZS5hZGRFdmVudExpc3RlbmVyKGV2dCwgdG91Y2hFbmQpKTsKICAgICAgICAgICAgICAgIFsndG91Y2htb3ZlJywgJ21vdXNlbW92ZSddLmZvckVhY2goZXZ0ID0+IHNsaWRlLmFkZEV2ZW50TGlzdGVuZXIoZXZ0LCB0b3VjaE1vdmUpKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIG5ldyBSZXNpemVPYnNlcnZlcigoKSA9PiBnb1RvU2xpZGUoY3VycmVudEluZGV4KSkub2JzZXJ2ZShjYXJvdXNlbFdyYXBwZXIpOwogICAgICAgIH0KICAgIH0KICAgIC8vIC0tLSBEb3dubG9hZCBGdW5jdGlvbiAtLS0KICAgIGFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlQW5kRG93bmxvYWRIdG1sKCkgewogICAgICAgIGlmICh0eXBlb2YgSlNaaXAgPT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgIGFsZXJ0KCdFcnJvcjogTGEgbGlicmVyw61hIGRlIGNvbXByZXNpw7NuIG5vIHNlIGhhIGNhcmdhZG8uIFBvciBmYXZvciwgcmV2aXNlIHN1IGNvbmV4acOzbiBhIGludGVybmV0LicpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNvbnN0IGxvYWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhY3Rpb24tbG9hZGVyJyk7CiAgICAgICAgaWYgKGxvYWRlcikKICAgICAgICAgICAgbG9hZGVyLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIDEuIEZldGNoIGV4dGVybmFsIGZpbGVzIGFuZCBnZXQgc3R5bGVzCiAgICAgICAgICAgIGNvbnN0IFttYW5pZmVzdENvbnRlbnQsIHN3Q29udGVudF0gPSBhd2FpdCBQcm9taXNlLmFsbChbCiAgICAgICAgICAgICAgICBmZXRjaCgnbWFuaWZlc3QuanNvbicpLnRoZW4ocmVzID0+IHJlcy50ZXh0KCkpLAogICAgICAgICAgICAgICAgZmV0Y2goJ3N3LmpzJykudGhlbihyZXMgPT4gcmVzLnRleHQoKSkKICAgICAgICAgICAgXSk7CiAgICAgICAgICAgIGNvbnN0IHN0eWxlQ29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ3N0eWxlJykuaW5uZXJIVE1MOwogICAgICAgICAgICAvLyAyLiBDcmVhdGUgUEhQIGJhY2tlbmQgY29udGVudAogICAgICAgICAgICBjb25zdCBwaHBDb250ZW50ID0gYDw/cGhwCmhlYWRlcignQ29udGVudC1UeXBlOiBhcHBsaWNhdGlvbi9qc29uJyk7CmVycm9yX3JlcG9ydGluZygwKTsgLy8gT3B0aW9uYWw6IFR1cm4gb2ZmIGZvciBwcm9kdWN0aW9uCgokdXNlcnNfZmlsZSA9ICd1c3Vhcmlvcy5qc29uJzsKJHJlcXVlc3RfcGF5bG9hZCA9IGpzb25fZGVjb2RlKGZpbGVfZ2V0X2NvbnRlbnRzKCdwaHA6Ly9pbnB1dCcpLCB0cnVlKTsKJGFjdGlvbiA9ICRfR0VUWydhY3Rpb24nXSA/PyAkcmVxdWVzdF9wYXlsb2FkWydhY3Rpb24nXSA/PyBudWxsOwoKZnVuY3Rpb24gZ2V0X3VzZXJzKCRmaWxlKSB7CiAgICBpZiAoIWZpbGVfZXhpc3RzKCRmaWxlKSkgewogICAgICAgIGZpbGVfcHV0X2NvbnRlbnRzKCRmaWxlLCAnW10nKTsKICAgICAgICByZXR1cm4gW107CiAgICB9CiAgICAkY29udGVudCA9IGZpbGVfZ2V0X2NvbnRlbnRzKCRmaWxlKTsKICAgICR1c2VycyA9IGpzb25fZGVjb2RlKCRjb250ZW50LCB0cnVlKTsKICAgIHJldHVybiBpc19hcnJheSgkdXNlcnMpID8gJHVzZXJzIDogW107Cn0KCmZ1bmN0aW9uIHNhdmVfdXNlcnMoJGZpbGUsICR1c2VycykgewogICAgLy8gVXNlIGFycmF5X3ZhbHVlcyB0byByZXNldCBrZXlzIGFmdGVyIGZpbHRlcmluZwogICAgZmlsZV9wdXRfY29udGVudHMoJGZpbGUsIGpzb25fZW5jb2RlKGFycmF5X3ZhbHVlcygkdXNlcnMpLCBKU09OX1BSRVRUWV9QUklOVCB8IEpTT05fVU5FU0NBUEVEX1VOSUNPREUpKTsKfQoKc3dpdGNoICgkYWN0aW9uKSB7CiAgICBjYXNlICdsb2dpbic6CiAgICAgICAgJHVzZXJuYW1lID0gJHJlcXVlc3RfcGF5bG9hZFsndXNlcm5hbWUnXSA/PyAnJzsKICAgICAgICAkcGFzc3dvcmQgPSAkcmVxdWVzdF9wYXlsb2FkWydwYXNzd29yZCddID8/ICcnOwogICAgICAgICR1c2VycyA9IGdldF91c2VycygkdXNlcnNfZmlsZSk7CiAgICAgICAgJGZvdW5kX3VzZXIgPSBudWxsOwogICAgICAgIGZvcmVhY2ggKCR1c2VycyBhcyAkdXNlcikgewogICAgICAgICAgICBpZiAoJHVzZXJbJ3VzZXJuYW1lJ10gPT09ICR1c2VybmFtZSAmJiAkdXNlclsncGFzc3dvcmQnXSA9PT0gJHBhc3N3b3JkKSB7CiAgICAgICAgICAgICAgICAkZm91bmRfdXNlciA9ICR1c2VyOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCRmb3VuZF91c2VyKSB7CiAgICAgICAgICAgIGVjaG8ganNvbl9lbmNvZGUoWydzdWNjZXNzJyA9PiB0cnVlLCAndXNlcicgPT4gJGZvdW5kX3VzZXJdKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBlY2hvIGpzb25fZW5jb2RlKFsnc3VjY2VzcycgPT4gZmFsc2UsICdtZXNzYWdlJyA9PiAnVXN1YXJpbyBvIGNvbnRyYXNlw7FhIGluY29ycmVjdG9zLiddKTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CgogICAgY2FzZSAnZ2V0X3VzZXJzJzoKICAgICAgICBlY2hvIGpzb25fZW5jb2RlKGdldF91c2VycygkdXNlcnNfZmlsZSkpOwogICAgICAgIGJyZWFrOwoKICAgIGNhc2UgJ3NhdmVfdXNlcic6CiAgICAgICAgJHVzZXJzID0gZ2V0X3VzZXJzKCR1c2Vyc19maWxlKTsKICAgICAgICAkdXNlcl9kYXRhID0gJHJlcXVlc3RfcGF5bG9hZFsndXNlckRhdGEnXTsKICAgICAgICAkaXNfZWRpdGluZyA9ICRyZXF1ZXN0X3BheWxvYWRbJ2lzRWRpdGluZyddOwogICAgICAgICRjdXJyZW50bHlfZWRpdGluZ191c2VyID0gJHJlcXVlc3RfcGF5bG9hZFsnY3VycmVudGx5RWRpdGluZ1VzZXInXTsKICAgICAgICAkdXNlcm5hbWUgPSAkdXNlcl9kYXRhWyd1c2VybmFtZSddOwogICAgICAgIAogICAgICAgICR1c2VyX2V4aXN0cyA9IGZhbHNlOwogICAgICAgIGZvcmVhY2ggKCR1c2VycyBhcyAkdXNlcikgewogICAgICAgICAgICBpZiAoJHVzZXJbJ3VzZXJuYW1lJ10gPT09ICR1c2VybmFtZSAmJiAoISRpc19lZGl0aW5nIHx8ICRjdXJyZW50bHlfZWRpdGluZ191c2VyICE9PSAkdXNlcm5hbWUpKSB7CiAgICAgICAgICAgICAgICAkdXNlcl9leGlzdHMgPSB0cnVlOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICgkdXNlcl9leGlzdHMpIHsKICAgICAgICAgICAgZWNobyBqc29uX2VuY29kZShbJ3N1Y2Nlc3MnID0+IGZhbHNlLCAnbWVzc2FnZScgPT4gIkVsIG5vbWJyZSBkZSB1c3VhcmlvICd7JHVzZXJuYW1lfScgeWEgZXhpc3RlLiJdKTsKICAgICAgICAgICAgZXhpdDsKICAgICAgICB9CgogICAgICAgIGlmICgkaXNfZWRpdGluZykgewogICAgICAgICAgICAkZm91bmQgPSBmYWxzZTsKICAgICAgICAgICAgZm9yZWFjaCAoJHVzZXJzIGFzICYkdXNlcikgeyAvLyBVc2UgcmVmZXJlbmNlIHRvIG1vZGlmeSBpbiBwbGFjZQogICAgICAgICAgICAgICAgaWYgKCR1c2VyWyd1c2VybmFtZSddID09PSAkY3VycmVudGx5X2VkaXRpbmdfdXNlcikgewogICAgICAgICAgICAgICAgICAgICR1c2VyWyd1c2VybmFtZSddID0gJHVzZXJfZGF0YVsndXNlcm5hbWUnXTsKICAgICAgICAgICAgICAgICAgICAkdXNlclsncm9sZSddID0gJHVzZXJfZGF0YVsncm9sZSddOwogICAgICAgICAgICAgICAgICAgICR1c2VyWydkbmlEYXRhJ10gPSAkdXNlcl9kYXRhWydkbmlEYXRhJ107CiAgICAgICAgICAgICAgICAgICAgaWYgKCFlbXB0eSgkdXNlcl9kYXRhWydwYXNzd29yZCddKSkgewogICAgICAgICAgICAgICAgICAgICAgICAkdXNlclsncGFzc3dvcmQnXSA9ICR1c2VyX2RhdGFbJ3Bhc3N3b3JkJ107CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICRmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYoISRmb3VuZCkgeyAvLyBJZiBvcmlnaW5hbCB1c2VyIG5vdCBmb3VuZCAoZS5nLiwgZGVsZXRlZCksIGFkZCBhcyBuZXcKICAgICAgICAgICAgICAgICAkdXNlcnNbXSA9ICR1c2VyX2RhdGE7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkdXNlcnNbXSA9ICR1c2VyX2RhdGE7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHNhdmVfdXNlcnMoJHVzZXJzX2ZpbGUsICR1c2Vycyk7CiAgICAgICAgZWNobyBqc29uX2VuY29kZShbJ3N1Y2Nlc3MnID0+IHRydWUsICdtZXNzYWdlJyA9PiAnVXN1YXJpbyBndWFyZGFkbyBjb24gw6l4aXRvLiddKTsKICAgICAgICBicmVhazsKCiAgICBjYXNlICdkZWxldGVfdXNlcic6CiAgICAgICAgJHVzZXJuYW1lX3RvX2RlbGV0ZSA9ICRyZXF1ZXN0X3BheWxvYWRbJ3VzZXJuYW1lJ107CiAgICAgICAgJHVzZXJzID0gZ2V0X3VzZXJzKCR1c2Vyc19maWxlKTsKICAgICAgICAkdXNlcnMgPSBhcnJheV9maWx0ZXIoJHVzZXJzLCBmdW5jdGlvbigkdXNlcikgdXNlICgkdXNlcm5hbWVfdG9fZGVsZXRlKSB7CiAgICAgICAgICAgIHJldHVybiAkdXNlclsndXNlcm5hbWUnXSAhPT0gJHVzZXJuYW1lX3RvX2RlbGV0ZTsKICAgICAgICB9KTsKICAgICAgICBzYXZlX3VzZXJzKCR1c2Vyc19maWxlLCAkdXNlcnMpOwogICAgICAgIGVjaG8ganNvbl9lbmNvZGUoWydzdWNjZXNzJyA9PiB0cnVlLCAnbWVzc2FnZScgPT4gJ1VzdWFyaW8gZWxpbWluYWRvLiddKTsKICAgICAgICBicmVhazsKCiAgICBjYXNlICdpbXBvcnRfdXNlcnMnOgogICAgICAgICRuZXdfdXNlcnMgPSAkcmVxdWVzdF9wYXlsb2FkWyd1c2VycyddOwogICAgICAgIGlmIChpc19hcnJheSgkbmV3X3VzZXJzKSkgewogICAgICAgICAgICBzYXZlX3VzZXJzKCR1c2Vyc19maWxlLCAkbmV3X3VzZXJzKTsKICAgICAgICAgICAgZWNobyBqc29uX2VuY29kZShbJ3N1Y2Nlc3MnID0+IHRydWUsICdtZXNzYWdlJyA9PiAnVXN1YXJpb3MgaW1wb3J0YWRvcyBjb24gw6l4aXRvLiddKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBlY2hvIGpzb25fZW5jb2RlKFsnc3VjY2VzcycgPT4gZmFsc2UsICdtZXNzYWdlJyA9PiAnRGF0b3MgaW52w6FsaWRvcy4nXSk7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICAgIAogICAgZGVmYXVsdDoKICAgICAgICBlY2hvIGpzb25fZW5jb2RlKFsnc3VjY2VzcycgPT4gZmFsc2UsICdtZXNzYWdlJyA9PiAnQWNjacOzbiBubyB2w6FsaWRhLiddKTsKICAgICAgICBicmVhazsKfQo/PmA7CiAgICAgICAgICAgIC8vIDMuIENyZWF0ZSB0aGUgbWFpbiBzY3JpcHQgY29udGVudCwgZW5zdXJpbmcgaXQgdXNlcyB0aGUgUEhQIGJhY2tlbmQuCiAgICAgICAgICAgIGNvbnN0IG1haW5TY3JpcHRDb250ZW50ID0gYApkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgKCkgPT4gewogICAgLy8gLS0tIEVsZW1lbnQgU2VsZWN0b3JzIChzYW1lIGFzIGxpdmUgYXBwKSAtLS0KICAgIGNvbnN0IGxvZ2luU2NyZWVuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvZ2luLXNjcmVlbicpOwogICAgY29uc3QgbWFpblNjcmVlbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYWluLXNjcmVlbicpOwogICAgY29uc3QgZG9jdW1lbnRvc1NjcmVlbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkb2N1bWVudG9zLXNjcmVlbicpOwogICAgY29uc3QgZWRpdG9yU2NyZWVuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXRvci1zY3JlZW4nKTsKICAgIGNvbnN0IGRuaURldGFpbHNTY3JlZW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZG5pLWRldGFpbHMtc2NyZWVuJyk7CiAgICBjb25zdCB0ZWxlZm9ub3NTY3JlZW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGVsZWZvbm9zLXNjcmVlbicpOwogICAgY29uc3QgYm90dG9tTmF2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JvdHRvbS1uYXYnKTsKICAgIGNvbnN0IGxvYWRpbmdPdmVybGF5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRpbmctb3ZlcmxheScpOwogICAgY29uc3QgbG9naW5Mb2FkaW5nT3ZlcmxheSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2dpbi1sb2FkaW5nLW92ZXJsYXknKTsKICAgIGNvbnN0IGFjdGlvbkxvYWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhY3Rpb24tbG9hZGVyJyk7CiAgICBjb25zdCBsb2dpbkJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2dpbi1idG4nKTsKICAgIGNvbnN0IGd1ZXN0TG9naW5CdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3Vlc3QtbG9naW4tYnRuJyk7CiAgICBjb25zdCB1c2VybmFtZUlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VzZXJuYW1lLWlucHV0Jyk7CiAgICBjb25zdCBwYXNzd29yZElucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Bhc3N3b3JkLWlucHV0Jyk7CiAgICBjb25zdCBsb2dpbkVycm9yTXNnID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvZ2luLWVycm9yLW1zZycpOwogICAgY29uc3QgZG9jdW1lbnRvc0J0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkb2N1bWVudG9zLWJ0bicpOwogICAgY29uc3QgZWRpdG9yQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXRvci1idG4nKTsKICAgIGNvbnN0IHRlbGVmb25vc0J0bkRvY3MgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGVsZWZvbm9zLWJ0bi1kb2NzJyk7CiAgICBjb25zdCB0ZWxlZm9ub3NCdG5EZXRhaWxzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RlbGVmb25vcy1idG4tZGV0YWlscycpOwogICAgY29uc3QgdGVsZWZvbm9zSW5pY2lvQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RlbGVmb25vcy1pbmljaW8tYnRuJyk7CiAgICBjb25zdCBiYWNrQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JhY2stYnRuJyk7CiAgICBjb25zdCBlZGl0b3JCYWNrQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXRvci1iYWNrLWJ0bicpOwogICAgY29uc3QgZGV0YWlsc0JhY2tCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGV0YWlscy1iYWNrLWJ0bicpOwogICAgY29uc3QgaW5pY2lvQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2luaWNpby1idG4nKTsKICAgIGNvbnN0IHNvbGljaXRhckRuaUJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzb2xpY2l0YXItZG5pLWJ0bicpOwogICAgY29uc3QgZG5pSW5pdGlhbFZpZXcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZG5pLWluaXRpYWwtdmlldycpOwogICAgY29uc3QgZG5pU29saWNpdHVkVmlldyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkbmktc29saWNpdHVkLXZpZXcnKTsKICAgIGNvbnN0IGRuaUNhcmRIZWFkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZG5pLWNhcmQtaGVhZGVyJyk7CiAgICBjb25zdCBkbmlDYXJkQm9keSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkbmktY2FyZC1ib2R5Jyk7CiAgICBjb25zdCBjb25maXJtYXJTb2xpY2l0dWRCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZmlybWFyLXNvbGljaXR1ZC1idG4nKTsKICAgIGNvbnN0IGRuaURpZ2l0YWxEaXNwbGF5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RuaS1kaWdpdGFsLWRpc3BsYXknKTsKICAgIGNvbnN0IG1haW5EbmlQcm9maWxlUGljID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21haW4tZG5pLXByb2ZpbGUtcGljJyk7CiAgICBjb25zdCBtYWluRG5pUHJvZmlsZUltYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21haW4tZG5pLXByb2ZpbGUtaW1hZ2UnKTsKICAgIGNvbnN0IHZlckRldGFsbGVCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmVyLWRldGFsbGUtYnRuJyk7CiAgICBjb25zdCB2ZXJEbmlEaWdpdGFsQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Zlci1kbmktZGlnaXRhbC1idG4nKTsKICAgIGNvbnN0IGRvY3VtZW50b3NIZWFkZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZG9jdW1lbnRvcy1oZWFkZXInKTsKICAgIGNvbnN0IGRvY3VtZW50b3NIZWFkZXJUaXRsZSA9IGRvY3VtZW50b3NIZWFkZXIucXVlcnlTZWxlY3RvcignaDInKTsKICAgIGNvbnN0IHJlZnJlc2hJY29uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlZnJlc2gtaWNvbicpOwogICAgY29uc3Qgd2VsY29tZU5hbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd2VsY29tZS1uYW1lJyk7CiAgICBjb25zdCBkbmlEaWdpdGFsVGl0bGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZG5pLWRpZ2l0YWwtdGl0bGUnKTsKICAgIGNvbnN0IHNvbGljaXR1ZERuaU5hbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc29saWNpdHVkLWRuaS1uYW1lJyk7CiAgICBjb25zdCBlZGl0b3JEbmlQcm9maWxlUGljID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXRvci1kbmktcHJvZmlsZS1waWMnKTsKICAgIGNvbnN0IGVkaXRvckRuaVByb2ZpbGVJbWFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlZGl0b3ItZG5pLXByb2ZpbGUtaW1hZ2UnKTsKICAgIGNvbnN0IGltYWdlVXJsSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW1hZ2UtdXJsLWlucHV0Jyk7CiAgICBjb25zdCB0b3BTbGlkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9wLXNsaWRlcicpOwogICAgY29uc3QgbGVmdFNsaWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsZWZ0LXNsaWRlcicpOwogICAgY29uc3Qgd2lkdGhTbGlkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd2lkdGgtc2xpZGVyJyk7CiAgICBjb25zdCBoZWlnaHRTbGlkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVpZ2h0LXNsaWRlcicpOwogICAgY29uc3QgdG9wVmFsdWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9wLXZhbHVlJyk7CiAgICBjb25zdCBsZWZ0VmFsdWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGVmdC12YWx1ZScpOwogICAgY29uc3Qgd2lkdGhWYWx1ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3aWR0aC12YWx1ZScpOwogICAgY29uc3QgaGVpZ2h0VmFsdWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVpZ2h0LXZhbHVlJyk7CiAgICBjb25zdCBtYWluRG5pUXJQaWMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFpbi1kbmktcXItcGljJyk7CiAgICBjb25zdCBtYWluRG5pUXJJbWFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYWluLWRuaS1xci1pbWFnZScpOwogICAgY29uc3QgZWRpdG9yRG5pUXJQaWMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWRpdG9yLWRuaS1xci1waWMnKTsKICAgIGNvbnN0IGVkaXRvckRuaVFySW1hZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWRpdG9yLWRuaS1xci1pbWFnZScpOwogICAgY29uc3QgcXJVcmxJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxci11cmwtaW5wdXQnKTsKICAgIGNvbnN0IHFyVG9wU2xpZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FyLXRvcC1zbGlkZXInKTsKICAgIGNvbnN0IHFyTGVmdFNsaWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxci1sZWZ0LXNsaWRlcicpOwogICAgY29uc3QgcXJXaWR0aFNsaWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxci13aWR0aC1zbGlkZXInKTsKICAgIGNvbnN0IHFySGVpZ2h0U2xpZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FyLWhlaWdodC1zbGlkZXInKTsKICAgIGNvbnN0IHFyVG9wVmFsdWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXItdG9wLXZhbHVlJyk7CiAgICBjb25zdCBxckxlZnRWYWx1ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxci1sZWZ0LXZhbHVlJyk7CiAgICBjb25zdCBxcldpZHRoVmFsdWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXItd2lkdGgtdmFsdWUnKTsKICAgIGNvbnN0IHFySGVpZ2h0VmFsdWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXItaGVpZ2h0LXZhbHVlJyk7CiAgICBjb25zdCBkZXRhaWxzQmFyY29kZUltYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RldGFpbHMtYmFyY29kZS1pbWFnZScpOwogICAgY29uc3QgZGV0YWlsc1Byb2ZpbGVJbWFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZXRhaWxzLXByb2ZpbGUtaW1hZ2UnKTsKICAgIGNvbnN0IG1haW5EbmlCYWNrSW1hZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFpbi1kbmktYmFjay1pbWFnZScpOwogICAgY29uc3QgZWRpdG9yRG5pQmFja0ltYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXRvci1kbmktYmFjay1pbWFnZScpOwogICAgY29uc3QgZG5pQmFja1VybElucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RuaS1iYWNrLXVybC1pbnB1dCcpOwogICAgY29uc3QgdXNlclByb2ZpbGVCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndXNlci1wcm9maWxlLWJ0bicpOwogICAgY29uc3QgcHJvZmlsZUFycm93ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2ZpbGUtYXJyb3cnKTsKICAgIGNvbnN0IHVzZXJNZW51ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VzZXItbWVudScpOwogICAgY29uc3QgbWVudUVkaXRvckJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZW51LWVkaXRvci1idG4nKTsKICAgIGNvbnN0IG1lbnVVc2VyTmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZW51LXVzZXItbmFtZScpOwogICAgY29uc3QgbWVudVVzZXJJZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZW51LXVzZXItaWQnKTsKICAgIGNvbnN0IG5ld1VzZXJuYW1lSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmV3LXVzZXJuYW1lLWlucHV0Jyk7CiAgICBjb25zdCBuZXdQYXNzd29yZElucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25ldy1wYXNzd29yZC1pbnB1dCcpOwogICAgY29uc3QgbmV3VXNlclJvbGVTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmV3LXVzZXItcm9sZS1zZWxlY3QnKTsKICAgIGNvbnN0IHNhdmVVc2VyQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NhdmUtdXNlci1idG4nKTsKICAgIGNvbnN0IHVzZXJMaXN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VzZXItbGlzdCcpOwogICAgY29uc3QgaW1wb3J0VXNlcnNCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW1wb3J0LXVzZXJzLWJ0bicpOwogICAgY29uc3QgaW1wb3J0VXNlcnNJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbXBvcnQtdXNlcnMtaW5wdXQnKTsKICAgIGNvbnN0IGV4cG9ydFVzZXJzQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V4cG9ydC11c2Vycy1idG4nKTsKICAgIAogICAgLy8gLS0tIFN0YXRlIC0tLQogICAgbGV0IGN1cnJlbnRseUVkaXRpbmdVc2VyID0gbnVsbDsKICAgIGxldCBsb2dnZWRJblVzZXIgPSBudWxsOwogICAgbGV0IGlzRmxpcHBlZCA9IGZhbHNlOwoKICAgIC8vIC0tLSBTZXJ2aWNlIFdvcmtlciBSZWdpc3RyYXRpb24gLS0tCiAgICBpZiAoJ3NlcnZpY2VXb3JrZXInIGluIG5hdmlnYXRvcikgewogICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgKCkgPT4gewogICAgICAgICAgICBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5yZWdpc3RlcignLi9zdy5qcycpLnRoZW4ocmVnID0+IGNvbnNvbGUubG9nKCdTVyByZWdpc3RlcmVkLicsIHJlZykpLmNhdGNoKGVyciA9PiBjb25zb2xlLmxvZygnU1cgcmVnaXN0cmF0aW9uIGZhaWxlZDonLCBlcnIpKTsKICAgICAgICB9KTsKICAgIH0KCiAgICAvLyAtLS0gQVBJIENvbW11bmljYXRpb24gKFBIUCBCYWNrZW5kKSAtLS0KICAgIGFzeW5jIGZ1bmN0aW9uIGFwaUNhbGwoYWN0aW9uLCBwYXlsb2FkID0ge30pIHsKICAgICAgICAvLyBGb3IgR0VUIHJlcXVlc3RzLCBhcHBlbmQgYWN0aW9uIHRvIHF1ZXJ5IHN0cmluZy4gRm9yIG90aGVycywgc2VuZCBpbiBib2R5LgogICAgICAgIGNvbnN0IGlzR2V0ID0gYWN0aW9uID09PSAnZ2V0X3VzZXJzJzsKICAgICAgICBjb25zdCB1cmwgPSBpc0dldCA/IFxgYXBpLnBocD9hY3Rpb249XCR7YWN0aW9ufVxgIDogJ2FwaS5waHAnOwogICAgICAgIAogICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7CiAgICAgICAgICAgIG1ldGhvZDogaXNHZXQgPyAnR0VUJyA6ICdQT1NUJywKICAgICAgICAgICAgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH0sCiAgICAgICAgICAgIGJvZHk6IGlzR2V0ID8gbnVsbCA6IEpTT04uc3RyaW5naWZ5KHsgYWN0aW9uLCAuLi5wYXlsb2FkIH0pCiAgICAgICAgfTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmwsIG9wdGlvbnMpOwogICAgICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdBUEkgRXJyb3IgUmVzcG9uc2U6JywgYXdhaXQgcmVzcG9uc2UudGV4dCgpKTsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTmV0d29yayByZXNwb25zZSB3YXMgbm90IG9rJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTsKICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCdBUEkgQ2FsbCBFcnJvcjonLCBlcnJvcik7CiAgICAgICAgICAgIGFsZXJ0KCdFcnJvciBkZSBjb25leGnDs24gY29uIGVsIHNlcnZpZG9yLiBBc2Vnw7pyZXNlIGRlIHF1ZSBsYSBhcGxpY2FjacOzbiBzZSBlc3TDoSBlamVjdXRhbmRvIGVuIHVuIHNlcnZpZG9yIFBIUCAocG9yIGVqZW1wbG8sIFhBTVBQLCBXQU1QLCBNQU1QKSB5IG5vIGNvbW8gdW4gYXJjaGl2byBsb2NhbCAoZmlsZTovLykuJyk7CiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiAnRXJyb3IgZGUgY29uZXhpw7NuIGNvbiBlbCBzZXJ2aWRvci4nIH07CiAgICAgICAgfQogICAgfQoKICAgIC8vIC0tLSBVc2VyIE1hbmFnZW1lbnQgJiBBdXRoIC0tLQogICAgZnVuY3Rpb24gdXBkYXRlVWlGb3JVc2VyUm9sZSgpIHsKICAgICAgICBjb25zdCBpc0FkbWluID0gbG9nZ2VkSW5Vc2VyICYmIGxvZ2dlZEluVXNlci5yb2xlID09PSAnYWRtaW4nOwogICAgICAgIGlmIChlZGl0b3JCdG4pIGVkaXRvckJ0bi5zdHlsZS5kaXNwbGF5ID0gaXNBZG1pbiA/ICdmbGV4JyA6ICdub25lJzsKICAgICAgICBpZiAobWVudUVkaXRvckJ0bikgbWVudUVkaXRvckJ0bi5zdHlsZS5kaXNwbGF5ID0gaXNBZG1pbiA/ICdibG9jaycgOiAnbm9uZSc7CiAgICB9CgogICAgZnVuY3Rpb24gZ2F0aGVyQ3VycmVudERuaURhdGEoKSB7CiAgICAgICAgY29uc3QgZGF0YSA9IHt9OwogICAgICAgIGNvbnN0IGlucHV0cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJyNlZGl0b3Itc2NyZWVuIC5jdXN0b20taW5wdXQsICNlZGl0b3Itc2NyZWVuIGlucHV0W3R5cGU9InJhbmdlIl0sICNlZGl0b3Itc2NyZWVuIC5jdXN0b20tc2VsZWN0Jyk7CiAgICAgICAgaW5wdXRzLmZvckVhY2goaW5wdXQgPT4gewogICAgICAgICAgICBkYXRhW2lucHV0LmlkXSA9IGlucHV0LnZhbHVlOwogICAgICAgIH0pOwogICAgICAgIHJldHVybiBkYXRhOwogICAgfQoKICAgIGZ1bmN0aW9uIGFwcGx5VXNlckRhdGEoZG5pRGF0YSkgewogICAgICAgIGlmICghZG5pRGF0YSkgcmV0dXJuOwogICAgICAgIGNvbnN0IGlucHV0cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJyNlZGl0b3Itc2NyZWVuIC5jdXN0b20taW5wdXQsICNlZGl0b3Itc2NyZWVuIGlucHV0W3R5cGU9InJhbmdlIl0sICNlZGl0b3Itc2NyZWVuIC5jdXN0b20tc2VsZWN0Jyk7CiAgICAgICAgaW5wdXRzLmZvckVhY2goaW5wdXQgPT4gewogICAgICAgICAgICBpZiAoZG5pRGF0YVtpbnB1dC5pZF0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgaW5wdXQudmFsdWUgPSBkbmlEYXRhW2lucHV0LmlkXTsKICAgICAgICAgICAgICAgIGlucHV0LmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCdpbnB1dCcsIHsgYnViYmxlczogdHJ1ZSB9KSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KCiAgICBhc3luYyBmdW5jdGlvbiBkZWxldGVVc2VyKHVzZXJuYW1lVG9EZWxldGUpIHsKICAgICAgICBpZiAoIWNvbmZpcm0oXGDCv0VzdMOhIHNlZ3VybyBkZSBxdWUgZGVzZWEgZWxpbWluYXIgYWwgdXN1YXJpbyAiXCR7dXNlcm5hbWVUb0RlbGV0ZX0iP1xgKSkgcmV0dXJuOwogICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGFwaUNhbGwoJ2RlbGV0ZV91c2VyJywgeyB1c2VybmFtZTogdXNlcm5hbWVUb0RlbGV0ZSB9KTsKICAgICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHsKICAgICAgICAgICAgaWYgKHVzZXJuYW1lVG9EZWxldGUgPT09IGN1cnJlbnRseUVkaXRpbmdVc2VyKSB7CiAgICAgICAgICAgICAgICByZXNldFVzZXJGb3JtKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVuZGVyVXNlckxpc3QoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBhbGVydChcYEVycm9yOiBcJHtyZXN1bHQubWVzc2FnZSB8fCAnTm8gc2UgcHVkbyBlbGltaW5hciBhbCB1c3VhcmlvLid9XGApOwogICAgICAgIH0KICAgIH0KICAgIAogICAgZnVuY3Rpb24gcmVzZXRVc2VyRm9ybSgpIHsKICAgICAgICBuZXdVc2VybmFtZUlucHV0LnZhbHVlID0gJyc7CiAgICAgICAgbmV3UGFzc3dvcmRJbnB1dC52YWx1ZSA9ICcnOwogICAgICAgIGlmIChuZXdVc2VyUm9sZVNlbGVjdCkgbmV3VXNlclJvbGVTZWxlY3QudmFsdWUgPSAndXNlcic7CiAgICAgICAgc2F2ZVVzZXJCdG4udGV4dENvbnRlbnQgPSAnR3VhcmRhciBOdWV2byBVc3VhcmlvJzsKICAgICAgICBjdXJyZW50bHlFZGl0aW5nVXNlciA9IG51bGw7CiAgICB9CgogICAgYXN5bmMgZnVuY3Rpb24gcmVuZGVyVXNlckxpc3QoKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY29uc3QgdXNlcnMgPSBhd2FpdCBhcGlDYWxsKCdnZXRfdXNlcnMnKTsKICAgICAgICAgICAgdXNlckxpc3QuaW5uZXJIVE1MID0gJyc7CiAgICAgICAgICAgIGlmICghdXNlcnMgfHwgIUFycmF5LmlzQXJyYXkodXNlcnMpIHx8IHVzZXJzLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgdXNlckxpc3QuaW5uZXJIVE1MID0gJzxwIHN0eWxlPSJjb2xvcjogdmFyKC0tdGV4dC1saWdodCk7IHRleHQtYWxpZ246IGNlbnRlcjsiPk5vIGhheSB1c3VhcmlvcyBndWFyZGFkb3MuPC9wPic7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdXNlcnMuZm9yRWFjaCh1c2VyID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IHVzZXJJdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgICAgICB1c2VySXRlbS5jbGFzc05hbWUgPSAndXNlci1saXN0LWl0ZW0nOwogICAgICAgICAgICAgICAgY29uc3QgdXNlck5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7CiAgICAgICAgICAgICAgICB1c2VyTmFtZS5jbGFzc05hbWUgPSAndXNlci1saXN0LWl0ZW0tbmFtZSc7CiAgICAgICAgICAgICAgICB1c2VyTmFtZS50ZXh0Q29udGVudCA9IFxgXCR7dXNlci51c2VybmFtZX0gKFwke3VzZXIucm9sZSB8fCAndXNlcid9KVxgOwogICAgICAgICAgICAgICAgY29uc3QgYWN0aW9uc0NvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgICAgICAgICAgYWN0aW9uc0NvbnRhaW5lci5jbGFzc05hbWUgPSAndXNlci1saXN0LWl0ZW0tYWN0aW9ucyc7CiAgICAgICAgICAgICAgICBjb25zdCBlZGl0QnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7CiAgICAgICAgICAgICAgICBlZGl0QnRuLnRleHRDb250ZW50ID0gJ0VkaXRhcic7CiAgICAgICAgICAgICAgICBlZGl0QnRuLmNsYXNzTmFtZSA9ICdlZGl0LWJ0bic7CiAgICAgICAgICAgICAgICBlZGl0QnRuLm9uY2xpY2sgPSAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgYXBwbHlVc2VyRGF0YSh1c2VyLmRuaURhdGEpOwogICAgICAgICAgICAgICAgICAgIG5ld1VzZXJuYW1lSW5wdXQudmFsdWUgPSB1c2VyLnVzZXJuYW1lOwogICAgICAgICAgICAgICAgICAgIG5ld1Bhc3N3b3JkSW5wdXQudmFsdWUgPSAnJzsKICAgICAgICAgICAgICAgICAgICBuZXdQYXNzd29yZElucHV0LnBsYWNlaG9sZGVyID0gIkRlamFyIGVuIGJsYW5jbyBwYXJhIG5vIGNhbWJpYXIiOwogICAgICAgICAgICAgICAgICAgIGlmKG5ld1VzZXJSb2xlU2VsZWN0KSBuZXdVc2VyUm9sZVNlbGVjdC52YWx1ZSA9IHVzZXIucm9sZSB8fCAndXNlcic7CiAgICAgICAgICAgICAgICAgICAgc2F2ZVVzZXJCdG4udGV4dENvbnRlbnQgPSAnQWN0dWFsaXphciBVc3VhcmlvJzsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50bHlFZGl0aW5nVXNlciA9IHVzZXIudXNlcm5hbWU7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LnNjcm9sbFRvKDAsMCk7CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgY29uc3QgZGVsZXRlQnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7CiAgICAgICAgICAgICAgICBkZWxldGVCdG4udGV4dENvbnRlbnQgPSAnRWxpbWluYXInOwogICAgICAgICAgICAgICAgZGVsZXRlQnRuLmNsYXNzTmFtZSA9ICdkZWxldGUtYnRuJzsKICAgICAgICAgICAgICAgIGRlbGV0ZUJ0bi5vbmNsaWNrID0gKCkgPT4gZGVsZXRlVXNlcih1c2VyLnVzZXJuYW1lKTsKICAgICAgICAgICAgICAgIGFjdGlvbnNDb250YWluZXIuYXBwZW5kQ2hpbGQoZWRpdEJ0bik7CiAgICAgICAgICAgICAgICBhY3Rpb25zQ29udGFpbmVyLmFwcGVuZENoaWxkKGRlbGV0ZUJ0bik7CiAgICAgICAgICAgICAgICB1c2VySXRlbS5hcHBlbmRDaGlsZCh1c2VyTmFtZSk7CiAgICAgICAgICAgICAgICB1c2VySXRlbS5hcHBlbmRDaGlsZChhY3Rpb25zQ29udGFpbmVyKTsKICAgICAgICAgICAgICAgIHVzZXJMaXN0LmFwcGVuZENoaWxkKHVzZXJJdGVtKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgZmV0Y2hpbmcgdXNlcnM6IiwgZXJyb3IpOwogICAgICAgICAgICB1c2VyTGlzdC5pbm5lckhUTUwgPSAnPHAgc3R5bGU9ImNvbG9yOiByZWQ7IHRleHQtYWxpZ246IGNlbnRlcjsiPkVycm9yIGFsIGNhcmdhciBsYSBsaXN0YSBkZSB1c3Vhcmlvcy48L3A+JzsKICAgICAgICB9CiAgICB9CgogICAgLy8gLS0tIENvcmUgQXBwIExvZ2ljIC0tLQogICAgZnVuY3Rpb24gc2V0dXBTbGlkZXIoc2xpZGVyLCB0YXJnZXRzLCBwcm9wZXJ0eSwgdmFsdWVTcGFuLCB1bml0ID0gJyUnKSB7CiAgICAgICAgaWYgKHNsaWRlciAmJiB0YXJnZXRzICYmIHRhcmdldHMubGVuZ3RoID4gMCAmJiB2YWx1ZVNwYW4pIHsKICAgICAgICAgICAgY29uc3QgdXBkYXRlID0gKCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBzbGlkZXIudmFsdWU7CiAgICAgICAgICAgICAgICB0YXJnZXRzLmZvckVhY2godGFyZ2V0ID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAodGFyZ2V0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldC5zdHlsZVtwcm9wZXJ0eV0gPSBcYFwke3ZhbHVlfVwke3VuaXR9XGA7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB2YWx1ZVNwYW4udGV4dENvbnRlbnQgPSB2YWx1ZTsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgc2xpZGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgdXBkYXRlKTsKICAgICAgICAgICAgdXBkYXRlKCk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHVwZGF0ZUR5bmFtaWNIZWFkZXJEYXRhKCkgewogICAgICAgIGNvbnN0IGFwZWxsaWRvSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYXBlbGxpZG8taW5wdXQnKTsKICAgICAgICBjb25zdCBub21icmVJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdub21icmUtaW5wdXQnKTsKICAgICAgICBjb25zdCBjdWlsSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3VpbC1pbnB1dCcpOwogICAgICAgIAogICAgICAgIGlmIChhcGVsbGlkb0lucHV0ICYmIG5vbWJyZUlucHV0ICYmIGN1aWxJbnB1dCkgewogICAgICAgICAgICBjb25zdCBhcGVsbGlkbyA9IGFwZWxsaWRvSW5wdXQudmFsdWU7CiAgICAgICAgICAgIGNvbnN0IG5vbWJyZSA9IG5vbWJyZUlucHV0LnZhbHVlOwogICAgICAgICAgICBjb25zdCBjdWlsID0gY3VpbElucHV0LnZhbHVlOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgZHJvcGRvd25OYW1lID0gXGBcJHtub21icmV9IFwke2FwZWxsaWRvfVxgOyAKICAgICAgICAgICAgY29uc3QgZG5pVGl0bGVOYW1lID0gXGBcJHthcGVsbGlkb30gXCR7bm9tYnJlfVxgOwogICAgICAgICAgICBjb25zdCBtZW51TmFtZSA9IFxgXCR7bm9tYnJlfSBcJHthcGVsbGlkb31cYDsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICh3ZWxjb21lTmFtZSkgd2VsY29tZU5hbWUudGV4dENvbnRlbnQgPSBub21icmU7CiAgICAgICAgICAgIGlmIChkbmlEaWdpdGFsVGl0bGUpIGRuaURpZ2l0YWxUaXRsZS50ZXh0Q29udGVudCA9IGRuaVRpdGxlTmFtZTsKICAgICAgICAgICAgaWYgKHNvbGljaXR1ZERuaU5hbWUpIHNvbGljaXR1ZERuaU5hbWUudGV4dENvbnRlbnQgPSBkcm9wZG93bk5hbWU7CiAgICAgICAgICAgIGlmIChtZW51VXNlck5hbWUpIG1lbnVVc2VyTmFtZS50ZXh0Q29udGVudCA9IG1lbnVOYW1lOwogICAgICAgICAgICBpZiAobWVudVVzZXJJZCkgbWVudVVzZXJJZC50ZXh0Q29udGVudCA9IGN1aWw7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHNldHVwVGV4dENvbnRyb2woZmllbGQpIHsKICAgICAgICBjb25zdCB0ZXh0SW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcYFwke2ZpZWxkfS1pbnB1dFxgKTsKICAgICAgICBjb25zdCB0b3BTbGlkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcYFwke2ZpZWxkfS10b3Atc2xpZGVyXGApOwogICAgICAgIGNvbnN0IGxlZnRTbGlkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcYFwke2ZpZWxkfS1sZWZ0LXNsaWRlclxgKTsKICAgICAgICBjb25zdCBmb250c2l6ZVNsaWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFxgXCR7ZmllbGR9LWZvbnRzaXplLXNsaWRlclxgKTsKICAgICAgICBjb25zdCBmb250U2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXGBcJHtmaWVsZH0tZm9udC1zZWxlY3RcYCk7CiAgICAgICAgY29uc3QgdG9wVmFsdWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcYFwke2ZpZWxkfS10b3AtdmFsdWVcYCk7CiAgICAgICAgY29uc3QgbGVmdFZhbHVlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXGBcJHtmaWVsZH0tbGVmdC12YWx1ZVxgKTsKICAgICAgICBjb25zdCBmb250c2l6ZVZhbHVlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXGBcJHtmaWVsZH0tZm9udHNpemUtdmFsdWVcYCk7CiAgICAgICAgY29uc3QgbWFpblRhcmdldCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFxgbWFpbi1kbmktXCR7ZmllbGR9XGApOwogICAgICAgIGNvbnN0IGVkaXRvclRhcmdldCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFxgZWRpdG9yLWRuaS1cJHtmaWVsZH1cYCk7CiAgICAgICAgY29uc3QgdGFyZ2V0cyA9IFttYWluVGFyZ2V0LCBlZGl0b3JUYXJnZXRdLmZpbHRlcihlbCA9PiBlbCk7CgogICAgICAgIGlmICh0ZXh0SW5wdXQgJiYgdGFyZ2V0cy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZSA9ICgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IG5ld1ZhbHVlID0gdGV4dElucHV0LnZhbHVlOwogICAgICAgICAgICAgICAgdGFyZ2V0cy5mb3JFYWNoKHRhcmdldCA9PiB0YXJnZXQudGV4dENvbnRlbnQgPSBuZXdWYWx1ZSk7CiAgICAgICAgICAgICAgICBpZiAoZmllbGQgPT09ICdub21icmUnIHx8IGZpZWxkID09PSAnYXBlbGxpZG8nIHx8IGZpZWxkID09PSAnY3VpbCcpIHsKICAgICAgICAgICAgICAgICAgICB1cGRhdGVEeW5hbWljSGVhZGVyRGF0YSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgICB0ZXh0SW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCB1cGRhdGUpOwogICAgICAgICAgICB1cGRhdGUoKTsKICAgICAgICB9CgogICAgICAgIHNldHVwU2xpZGVyKHRvcFNsaWRlciwgdGFyZ2V0cywgJ3RvcCcsIHRvcFZhbHVlLCAnJScpOwogICAgICAgIHNldHVwU2xpZGVyKGxlZnRTbGlkZXIsIHRhcmdldHMsICdsZWZ0JywgbGVmdFZhbHVlLCAnJScpOwogICAgICAgIHNldHVwU2xpZGVyKGZvbnRzaXplU2xpZGVyLCB0YXJnZXRzLCAnZm9udFNpemUnLCBmb250c2l6ZVZhbHVlLCAncHgnKTsKCiAgICAgICAgaWYgKGZvbnRTZWxlY3QgJiYgdGFyZ2V0cy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZSA9ICgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IG5ld0ZvbnQgPSBmb250U2VsZWN0LnZhbHVlOwogICAgICAgICAgICAgICAgdGFyZ2V0cy5mb3JFYWNoKHRhcmdldCA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRhcmdldCkgdGFyZ2V0LnN0eWxlLmZvbnRGYW1pbHkgPSBuZXdGb250OwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGZvbnRTZWxlY3QuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCB1cGRhdGUpOwogICAgICAgICAgICB1cGRhdGUoKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gcmVzZXREbmlDYXJkKCkgewogICAgICAgIGlmIChkbmlDYXJkSGVhZGVyKSBkbmlDYXJkSGVhZGVyLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7CiAgICAgICAgaWYgKGRuaUluaXRpYWxWaWV3KSBkbmlJbml0aWFsVmlldy5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICBpZiAoZG5pU29saWNpdHVkVmlldykgZG5pU29saWNpdHVkVmlldy5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgIGlmIChkbmlEaWdpdGFsRGlzcGxheSkgZG5pRGlnaXRhbERpc3BsYXkuc3R5bGUuZGlzcGxheSA9ICdub25lJzsgCiAgICAgICAgaWYgKGRuaUNhcmRCb2R5KSBkbmlDYXJkQm9keS5jbGFzc0xpc3QucmVtb3ZlKCduby1oZWFkZXInKTsKICAgICAgICBpZiAoZG9jdW1lbnRvc0hlYWRlclRpdGxlKSBkb2N1bWVudG9zSGVhZGVyVGl0bGUudGV4dENvbnRlbnQgPSAnRG9jdW1lbnRvcyc7CiAgICAgICAgaWYgKHJlZnJlc2hJY29uKSByZWZyZXNoSWNvbi5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgIGlmIChkb2N1bWVudG9zSGVhZGVyKSBkb2N1bWVudG9zSGVhZGVyLnN0eWxlLmp1c3RpZnlDb250ZW50ID0gJ2ZsZXgtc3RhcnQnOwoKICAgICAgICBjb25zdCBkbmlGbGlwcGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RuaS1mbGlwcGVyJyk7CiAgICAgICAgaWYoZG5pRmxpcHBlciAmJiBpc0ZsaXBwZWQpIHsKICAgICAgICAgICAgIGRuaUZsaXBwZXIuc3R5bGUudHJhbnNpdGlvbiA9ICd0cmFuc2Zvcm0gMC42cyBjdWJpYy1iZXppZXIoMC4zNCwgMS41NiwgMC42NCwgMSknOwogICAgICAgICAgICAgZG5pRmxpcHBlci5zdHlsZS50cmFuc2Zvcm0gPSAncm90YXRlWSgwZGVnKSc7CiAgICAgICAgfQogICAgICAgIGlzRmxpcHBlZCA9IGZhbHNlOwogICAgfQoKICAgIGZ1bmN0aW9uIHNob3dTY3JlZW4oc2NyZWVuTmFtZSkgewogICAgICAgIFtsb2dpblNjcmVlbiwgbWFpblNjcmVlbiwgZG9jdW1lbnRvc1NjcmVlbiwgZWRpdG9yU2NyZWVuLCBkbmlEZXRhaWxzU2NyZWVuLCB0ZWxlZm9ub3NTY3JlZW5dLmZvckVhY2gocyA9PiBzLnN0eWxlLmRpc3BsYXkgPSAnbm9uZScpOwogICAgICAgIGlmIChib3R0b21OYXYpIGJvdHRvbU5hdi5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwoKICAgICAgICBzd2l0Y2ggKHNjcmVlbk5hbWUpIHsKICAgICAgICAgICAgY2FzZSAnbG9naW4nOiBsb2dpblNjcmVlbi5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOyBicmVhazsKICAgICAgICAgICAgY2FzZSAnbWFpbic6IG1haW5TY3JlZW4uc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsgcmVzZXREbmlDYXJkKCk7IGJyZWFrOwogICAgICAgICAgICBjYXNlICdkb2N1bWVudG9zJzogZG9jdW1lbnRvc1NjcmVlbi5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOyBpZiAoYm90dG9tTmF2KSBib3R0b21OYXYuc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ2VkaXRvcic6CiAgICAgICAgICAgICAgICAgaWYgKGxvZ2dlZEluVXNlciAmJiBsb2dnZWRJblVzZXIucm9sZSA9PT0gJ2FkbWluJykgewogICAgICAgICAgICAgICAgICAgIGVkaXRvclNjcmVlbi5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBhbGVydCgnQWNjZXNvIGRlbmVnYWRvLiBTZSByZXF1aWVyZW4gcGVybWlzb3MgZGUgYWRtaW5pc3RyYWRvci4nKTsKICAgICAgICAgICAgICAgICAgICBzaG93U2NyZWVuKCdtYWluJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAnZGV0YWlscyc6IGRuaURldGFpbHNTY3JlZW4uc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ3RlbGVmb25vcyc6IHRlbGVmb25vc1NjcmVlbi5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOyBicmVhazsKICAgICAgICB9CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHNob3dEbmlEaWdpdGFsVmlldygpIHsKICAgICAgICBpZiAoZG5pSW5pdGlhbFZpZXcpIGRuaUluaXRpYWxWaWV3LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgaWYgKGRuaVNvbGljaXR1ZFZpZXcpIGRuaVNvbGljaXR1ZFZpZXcuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICBpZiAoZG5pRGlnaXRhbERpc3BsYXkpIGRuaURpZ2l0YWxEaXNwbGF5LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgIGlmIChkbmlDYXJkSGVhZGVyKSBkbmlDYXJkSGVhZGVyLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgaWYgKGRuaUNhcmRCb2R5KSBkbmlDYXJkQm9keS5jbGFzc0xpc3QuYWRkKCduby1oZWFkZXInKTsKICAgICAgICBpZiAoZG9jdW1lbnRvc0hlYWRlclRpdGxlKSBkb2N1bWVudG9zSGVhZGVyVGl0bGUudGV4dENvbnRlbnQgPSAnRE5JIERpZ2l0YWwnOwogICAgICAgIGlmIChyZWZyZXNoSWNvbikgcmVmcmVzaEljb24uc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgaWYgKGRvY3VtZW50b3NIZWFkZXIpIGRvY3VtZW50b3NIZWFkZXIuc3R5bGUuanVzdGlmeUNvbnRlbnQgPSAnc3BhY2UtYmV0d2Vlbic7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHBvcHVsYXRlRG5pRGV0YWlscygpIHsKICAgICAgICBjb25zdCBkbmkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZG9jdW1lbnRvLWlucHV0JykudmFsdWU7CiAgICAgICAgY29uc3QgdHJhbWl0ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0cmFtaXRlLWlucHV0JykudmFsdWU7CiAgICAgICAgY29uc3QgZW1pc2lvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlbWlzaW9uLWlucHV0JykudmFsdWU7CiAgICAgICAgY29uc3QgdmVuY2ltaWVudG8gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmVuY2ltaWVudG8taW5wdXQnKS52YWx1ZTsKICAgICAgICBjb25zdCBub21icmUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbm9tYnJlLWlucHV0JykudmFsdWU7CiAgICAgICAgY29uc3QgYXBlbGxpZG8gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYXBlbGxpZG8taW5wdXQnKS52YWx1ZTsKICAgICAgICBjb25zdCBzZXhvID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NleG8taW5wdXQnKS52YWx1ZTsKICAgICAgICBjb25zdCBuYWNpbWllbnRvID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25hY2ltaWVudG8taW5wdXQnKS52YWx1ZTsKICAgICAgICBjb25zdCBkb21pY2lsaW8gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZG9taWNpbGlvLWlucHV0JykudmFsdWU7CiAgICAgICAgY29uc3QgY3VpbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdWlsLWlucHV0JykudmFsdWU7CiAgICAgICAgY29uc3QgbmFjaW9uYWxpZGFkID0gJ0FSJzsKICAgICAgICBjb25zdCBsdWdhck5hY2ltaWVudG8gPSAnQVJHRU5USU5BJzsKICAgIAogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZXRhaWxzLWRuaScpLnRleHRDb250ZW50ID0gZG5pOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZXRhaWxzLXRyYW1pdGUnKS50ZXh0Q29udGVudCA9IHRyYW1pdGU7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RldGFpbHMtZW1pc2lvbicpLnRleHRDb250ZW50ID0gZW1pc2lvbjsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGV0YWlscy12ZW5jaW1pZW50bycpLnRleHRDb250ZW50ID0gdmVuY2ltaWVudG87CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RldGFpbHMtbm9tYnJlJykudGV4dENvbnRlbnQgPSBub21icmU7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RldGFpbHMtYXBlbGxpZG8nKS50ZXh0Q29udGVudCA9IGFwZWxsaWRvOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZXRhaWxzLWN1aWwnKS50ZXh0Q29udGVudCA9IGN1aWw7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RldGFpbHMtc2V4bycpLnRleHRDb250ZW50ID0gc2V4bzsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGV0YWlscy1uYWNpbWllbnRvJykudGV4dENvbnRlbnQgPSBuYWNpbWllbnRvOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZXRhaWxzLW5hY2lvbmFsaWRhZCcpLnRleHRDb250ZW50ID0gbmFjaW9uYWxpZGFkOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZXRhaWxzLWx1Z2FyLW5hY2ltaWVudG8nKS50ZXh0Q29udGVudCA9IGx1Z2FyTmFjaW1pZW50bzsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGV0YWlscy1kb21pY2lsaW8nKS50ZXh0Q29udGVudCA9IGRvbWljaWxpbzsKICAgIH0KCiAgICAvLyAtLS0gRmxpcHBlciAmIENhcm91c2VsIEhlbHBlcnMgLS0tCiAgICBmdW5jdGlvbiBzZXR1cEZsaXBwZXIoY29udGFpbmVyLCBmbGlwcGVyKSB7CiAgICAgICAgaWYgKCFjb250YWluZXIgfHwgIWZsaXBwZXIpIHJldHVybjsKCiAgICAgICAgbGV0IGlzRHJhZ2dpbmcgPSBmYWxzZSwgc3RhcnRYID0gMCwgc3RhcnRBbmdsZSA9IDAsIGN1cnJlbnRBbmdsZSA9IDA7CiAgICAgICAgY29uc3QgZ2V0RXZlbnRYID0gKGUpID0+IGUudHlwZS5pbmNsdWRlcygnbW91c2UnKSA/IGUuc2NyZWVuWCA6IGUuY2hhbmdlZFRvdWNoZXNbMF0uc2NyZWVuWDsKICAgICAgICAKICAgICAgICBjb25zdCBoYW5kbGVEcmFnU3RhcnQgPSAoZSkgPT4gewogICAgICAgICAgICBpZiAoZS50eXBlID09PSAnbW91c2Vkb3duJyAmJiBlLmJ1dHRvbiAhPT0gMCkgcmV0dXJuOwogICAgICAgICAgICBpc0RyYWdnaW5nID0gdHJ1ZTsKICAgICAgICAgICAgc3RhcnRYID0gZ2V0RXZlbnRYKGUpOwogICAgICAgICAgICBzdGFydEFuZ2xlID0gY3VycmVudEFuZ2xlOwogICAgICAgICAgICBmbGlwcGVyLnN0eWxlLnRyYW5zaXRpb24gPSAnbm9uZSc7CiAgICAgICAgICAgIGlmIChlLnR5cGUgIT09ICd0b3VjaHN0YXJ0JykgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIH07CgogICAgICAgIGNvbnN0IGhhbmRsZURyYWdNb3ZlID0gKGUpID0+IHsKICAgICAgICAgICAgaWYgKCFpc0RyYWdnaW5nKSByZXR1cm47CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgY29uc3QgZGVsdGFYID0gZ2V0RXZlbnRYKGUpIC0gc3RhcnRYOwogICAgICAgICAgICBjb25zdCByb3RhdGlvblNlbnNpdGl2aXR5ID0gMTgwIC8gY29udGFpbmVyLm9mZnNldFdpZHRoOwogICAgICAgICAgICBjdXJyZW50QW5nbGUgPSBzdGFydEFuZ2xlICsgKGRlbHRhWCAqIHJvdGF0aW9uU2Vuc2l0aXZpdHkpOwogICAgICAgICAgICBmbGlwcGVyLnN0eWxlLnRyYW5zZm9ybSA9IFxgcm90YXRlWShcJHtjdXJyZW50QW5nbGV9ZGVnKVxgOwogICAgICAgIH07CiAgICAgICAgCiAgICAgICAgY29uc3QgaGFuZGxlRHJhZ0VuZCA9ICgpID0+IHsKICAgICAgICAgICAgaWYgKCFpc0RyYWdnaW5nKSByZXR1cm47CiAgICAgICAgICAgIGlzRHJhZ2dpbmcgPSBmYWxzZTsKICAgICAgICAgICAgZmxpcHBlci5zdHlsZS50cmFuc2l0aW9uID0gJ3RyYW5zZm9ybSAwLjZzIGN1YmljLWJlemllcigwLjM0LCAxLjU2LCAwLjY0LCAxKSc7CiAgICAgICAgICAgIGNvbnN0IGZpbmFsUm90YXRpb24gPSBNYXRoLnJvdW5kKGN1cnJlbnRBbmdsZSAvIDE4MCkgKiAxODA7CiAgICAgICAgICAgIGlmIChjb250YWluZXIuaWQuaW5jbHVkZXMoJ21haW4tZG5pJykpIHsKICAgICAgICAgICAgICAgICBpc0ZsaXBwZWQgPSAoTWF0aC5yb3VuZChmaW5hbFJvdGF0aW9uIC8gMTgwKSAlIDIpICE9PSAwOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZsaXBwZXIuc3R5bGUudHJhbnNmb3JtID0gXGByb3RhdGVZKFwke2ZpbmFsUm90YXRpb259ZGVnKVxgOwogICAgICAgICAgICBjdXJyZW50QW5nbGUgPSBmaW5hbFJvdGF0aW9uOwogICAgICAgIH07CgogICAgICAgIGNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBoYW5kbGVEcmFnU3RhcnQpOwogICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIGhhbmRsZURyYWdNb3ZlKTsKICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgaGFuZGxlRHJhZ0VuZCk7CiAgICAgICAgY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCBoYW5kbGVEcmFnU3RhcnQsIHsgcGFzc2l2ZTogZmFsc2UgfSk7CiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJywgaGFuZGxlRHJhZ01vdmUsIHsgcGFzc2l2ZTogZmFsc2UgfSk7CiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCBoYW5kbGVEcmFnRW5kKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gc2V0dXBDYXJvdXNlbCgpIHsKICAgICAgICBjb25zdCBjYXJvdXNlbFdyYXBwZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWRpdG9yLWNhcm91c2VsLXdyYXBwZXInKTsKICAgICAgICBjb25zdCBjYXJvdXNlbFRyYWNrID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXRvci1jYXJvdXNlbC10cmFjaycpOwogICAgICAgIGNvbnN0IHNsaWRlcyA9IGNhcm91c2VsVHJhY2sgPyBBcnJheS5mcm9tKGNhcm91c2VsVHJhY2suY2hpbGRyZW4pIDogW107CiAgICAgICAgY29uc3QgZG90c0NvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlZGl0b3ItY2Fyb3VzZWwtZG90cycpOwogICAgICAgIAogICAgICAgIGlmIChjYXJvdXNlbFdyYXBwZXIgJiYgY2Fyb3VzZWxUcmFjayAmJiBzbGlkZXMubGVuZ3RoID4gMCAmJiBkb3RzQ29udGFpbmVyKSB7CiAgICAgICAgICAgIGxldCBjdXJyZW50SW5kZXggPSAwLCBpc0RyYWdnaW5nID0gZmFsc2UsIHN0YXJ0UG9zID0gMCwgY3VycmVudFRyYW5zbGF0ZSA9IDAsIHByZXZUcmFuc2xhdGUgPSAwLCBhbmltYXRpb25JRDsKICAgICAgICAgICAgY29uc3Qgc2xpZGVXaWR0aCA9ICgpID0+IHNsaWRlc1swXS5vZmZzZXRXaWR0aDsKICAgIAogICAgICAgICAgICBkb3RzQ29udGFpbmVyLmlubmVySFRNTCA9ICcnOwogICAgICAgICAgICBzbGlkZXMuZm9yRWFjaCgoXywgaSkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgZG90ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpOwogICAgICAgICAgICAgICAgZG90LmNsYXNzTGlzdC5hZGQoJ2Nhcm91c2VsLWRvdCcpOwogICAgICAgICAgICAgICAgaWYgKGkgPT09IDApIGRvdC5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgIGRvdC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IGdvVG9TbGlkZShpKSk7CiAgICAgICAgICAgICAgICBkb3RzQ29udGFpbmVyLmFwcGVuZENoaWxkKGRvdCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBjb25zdCBkb3RzID0gQXJyYXkuZnJvbShkb3RzQ29udGFpbmVyLmNoaWxkcmVuKTsKICAgIAogICAgICAgICAgICBmdW5jdGlvbiBnb1RvU2xpZGUoc2xpZGVJbmRleCkgewogICAgICAgICAgICAgICAgaWYgKHNsaWRlSW5kZXggPCAwIHx8IHNsaWRlSW5kZXggPj0gc2xpZGVzLmxlbmd0aCkgcmV0dXJuOwogICAgICAgICAgICAgICAgY29uc3Qgb2Zmc2V0ID0gLXNsaWRlSW5kZXggKiBzbGlkZVdpZHRoKCk7CiAgICAgICAgICAgICAgICBjYXJvdXNlbFRyYWNrLnN0eWxlLnRyYW5zZm9ybSA9IFxgdHJhbnNsYXRlWChcJHtvZmZzZXR9cHgpXGA7CiAgICAgICAgICAgICAgICBjYXJvdXNlbFRyYWNrLnN0eWxlLnRyYW5zaXRpb24gPSAndHJhbnNmb3JtIDAuM3MgZWFzZS1pbi1vdXQnOwogICAgICAgICAgICAgICAgY3VycmVudEluZGV4ID0gc2xpZGVJbmRleDsKICAgICAgICAgICAgICAgIGRvdHMuZm9yRWFjaCgoZG90LCBpKSA9PiBkb3QuY2xhc3NMaXN0LnRvZ2dsZSgnYWN0aXZlJywgaSA9PT0gY3VycmVudEluZGV4KSk7CiAgICAgICAgICAgICAgICBwcmV2VHJhbnNsYXRlID0gb2Zmc2V0OwogICAgICAgICAgICB9CiAgICAKICAgICAgICAgICAgY29uc3QgZ2V0UG9zaXRpb25YID0gKGUpID0+IGUudHlwZS5pbmNsdWRlcygnbW91c2UnKSA/IGUucGFnZVggOiBlLnRvdWNoZXNbMF0uY2xpZW50WDsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IHRvdWNoU3RhcnQgPSAoZSkgPT4gewogICAgICAgICAgICAgICAgaWYgKGUudGFyZ2V0LmNsb3Nlc3QoJy5jb250cm9sLWdyb3VwJykpIHJldHVybjsKICAgICAgICAgICAgICAgIGlzRHJhZ2dpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgc3RhcnRQb3MgPSBnZXRQb3NpdGlvblgoZSk7CiAgICAgICAgICAgICAgICBhbmltYXRpb25JRCA9IHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRpb24pOwogICAgICAgICAgICAgICAgY2Fyb3VzZWxUcmFjay5zdHlsZS50cmFuc2l0aW9uID0gJ25vbmUnOwogICAgICAgICAgICB9CiAgICAKICAgICAgICAgICAgY29uc3QgdG91Y2hNb3ZlID0gKGUpID0+IHsKICAgICAgICAgICAgICAgIGlmIChpc0RyYWdnaW5nKSBjdXJyZW50VHJhbnNsYXRlID0gcHJldlRyYW5zbGF0ZSArIGdldFBvc2l0aW9uWChlKSAtIHN0YXJ0UG9zOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCB0b3VjaEVuZCA9ICgpID0+IHsKICAgICAgICAgICAgICAgIGlmICghaXNEcmFnZ2luZykgcmV0dXJuOwogICAgICAgICAgICAgICAgaXNEcmFnZ2luZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgY2FuY2VsQW5pbWF0aW9uRnJhbWUoYW5pbWF0aW9uSUQpOwogICAgICAgICAgICAgICAgY29uc3QgbW92ZWRCeSA9IGN1cnJlbnRUcmFuc2xhdGUgLSBwcmV2VHJhbnNsYXRlOwogICAgICAgICAgICAgICAgaWYgKG1vdmVkQnkgPCAtMTAwICYmIGN1cnJlbnRJbmRleCA8IHNsaWRlcy5sZW5ndGggLSAxKSBjdXJyZW50SW5kZXgrKzsKICAgICAgICAgICAgICAgIGlmIChtb3ZlZEJ5ID4gMTAwICYmIGN1cnJlbnRJbmRleCA+IDApIGN1cnJlbnRJbmRleC0tOwogICAgICAgICAgICAgICAgZ29Ub1NsaWRlKGN1cnJlbnRJbmRleCk7CiAgICAgICAgICAgIH0KICAgIAogICAgICAgICAgICBmdW5jdGlvbiBhbmltYXRpb24oKSB7CiAgICAgICAgICAgICAgICBjYXJvdXNlbFRyYWNrLnN0eWxlLnRyYW5zZm9ybSA9IFxgdHJhbnNsYXRlWChcJHtjdXJyZW50VHJhbnNsYXRlfXB4KVxgOwogICAgICAgICAgICAgICAgaWYgKGlzRHJhZ2dpbmcpIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRpb24pOwogICAgICAgICAgICB9CiAgICAKICAgICAgICAgICAgc2xpZGVzLmZvckVhY2goc2xpZGUgPT4gewogICAgICAgICAgICAgICAgWyd0b3VjaHN0YXJ0JywgJ21vdXNlZG93biddLmZvckVhY2goZXZ0ID0+IHNsaWRlLmFkZEV2ZW50TGlzdGVuZXIoZXZ0LCB0b3VjaFN0YXJ0KSk7CiAgICAgICAgICAgICAgICBbJ3RvdWNoZW5kJywgJ21vdXNldXAnLCAnbW91c2VsZWF2ZSddLmZvckVhY2goZXZ0ID0+IHNsaWRlLmFkZEV2ZW50TGlzdGVuZXIoZXZ0LCB0b3VjaEVuZCkpOwogICAgICAgICAgICAgICAgWyd0b3VjaG1vdmUnLCAnbW91c2Vtb3ZlJ10uZm9yRWFjaChldnQgPT4gc2xpZGUuYWRkRXZlbnRMaXN0ZW5lcihldnQsIHRvdWNoTW92ZSkpOwogICAgICAgICAgICB9KTsKICAgIAogICAgICAgICAgICBuZXcgUmVzaXplT2JzZXJ2ZXIoKCkgPT4gZ29Ub1NsaWRlKGN1cnJlbnRJbmRleCkpLm9ic2VydmUoY2Fyb3VzZWxXcmFwcGVyKTsKICAgICAgICB9CiAgICB9CgogICAgLy8gLS0tIEV2ZW50IExpc3RlbmVycyAtLS0KICAgIGlmIChsb2dpbkJ0bikgewogICAgICAgIGxvZ2luQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKGUpID0+IHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBsb2dpbkVycm9yTXNnLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgIGNvbnN0IHVzZXJuYW1lID0gdXNlcm5hbWVJbnB1dC52YWx1ZTsKICAgICAgICAgICAgY29uc3QgcGFzc3dvcmQgPSBwYXNzd29yZElucHV0LnZhbHVlOwogICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBhcGlDYWxsKCdsb2dpbicsIHsgdXNlcm5hbWUsIHBhc3N3b3JkIH0pOwogICAgICAgICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHsKICAgICAgICAgICAgICAgIGlmIChsb2dpbkxvYWRpbmdPdmVybGF5KSBsb2dpbkxvYWRpbmdPdmVybGF5LnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7CiAgICAgICAgICAgICAgICBsb2dnZWRJblVzZXIgPSByZXN1bHQudXNlcjsKICAgICAgICAgICAgICAgIGFwcGx5VXNlckRhdGEocmVzdWx0LnVzZXIuZG5pRGF0YSk7CiAgICAgICAgICAgICAgICB1cGRhdGVVaUZvclVzZXJSb2xlKCk7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAobG9naW5Mb2FkaW5nT3ZlcmxheSkgbG9naW5Mb2FkaW5nT3ZlcmxheS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICAgICAgICAgIHNob3dTY3JlZW4oJ21haW4nKTsKICAgICAgICAgICAgICAgIH0sIDIwMDApOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbG9naW5FcnJvck1zZy50ZXh0Q29udGVudCA9IHJlc3VsdC5tZXNzYWdlIHx8ICdVc3VhcmlvIG8gY29udHJhc2XDsWEgaW5jb3JyZWN0b3MuJzsKICAgICAgICAgICAgICAgIGxvZ2luRXJyb3JNc2cuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KCiAgICBpZiAoZ3Vlc3RMb2dpbkJ0bikgewogICAgICAgIGd1ZXN0TG9naW5CdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIGlmIChsb2dpbkxvYWRpbmdPdmVybGF5KSBsb2dpbkxvYWRpbmdPdmVybGF5LnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7CiAgICAgICAgICAgIGxvZ2dlZEluVXNlciA9IHsgdXNlcm5hbWU6ICdJbnZpdGFkbycsIHJvbGU6ICdhZG1pbicgfTsKICAgICAgICAgICAgdXBkYXRlVWlGb3JVc2VyUm9sZSgpOwogICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgIGlmIChsb2dpbkxvYWRpbmdPdmVybGF5KSBsb2dpbkxvYWRpbmdPdmVybGF5LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgICAgICBzaG93U2NyZWVuKCdtYWluJyk7CiAgICAgICAgICAgIH0sIDE1MDApOwogICAgICAgIH0pOwogICAgfQoKICAgIGlmIChzYXZlVXNlckJ0bikgewogICAgICAgIHNhdmVVc2VyQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKCkgPT4gewogICAgICAgICAgICBjb25zdCB1c2VybmFtZSA9IG5ld1VzZXJuYW1lSW5wdXQudmFsdWUudHJpbSgpOwogICAgICAgICAgICBjb25zdCBwYXNzd29yZCA9IG5ld1Bhc3N3b3JkSW5wdXQudmFsdWUudHJpbSgpOwogICAgICAgICAgICBjb25zdCByb2xlID0gbmV3VXNlclJvbGVTZWxlY3QudmFsdWU7CiAgICAgICAgICAgIGNvbnN0IGlzRWRpdGluZyA9ICEhY3VycmVudGx5RWRpdGluZ1VzZXI7CiAgICAgICAgICAgIGlmICghdXNlcm5hbWUpIHsgYWxlcnQoJ1BvciBmYXZvciwgaW5ncmVzZSB1biBub21icmUgZGUgdXN1YXJpby4nKTsgcmV0dXJuOyB9CiAgICAgICAgICAgIGlmICghaXNFZGl0aW5nICYmICFwYXNzd29yZCkgeyBhbGVydCgnUG9yIGZhdm9yLCBpbmdyZXNlIHVuYSBjb250cmFzZcOxYSBwYXJhIGVsIG51ZXZvIHVzdWFyaW8uJyk7IHJldHVybjsgfQogICAgICAgICAgICBpZiAocGFzc3dvcmQgJiYgcGFzc3dvcmQubGVuZ3RoIDwgNikgeyBhbGVydCgnTGEgY29udHJhc2XDsWEgZGViZSB0ZW5lciBhbCBtZW5vcyA2IGNhcmFjdGVyZXMuJyk7IHJldHVybjsgfQogICAgICAgICAgICBjb25zdCB1c2VyRGF0YSA9IHsgdXNlcm5hbWUsIHBhc3N3b3JkLCByb2xlLCBkbmlEYXRhOiBnYXRoZXJDdXJyZW50RG5pRGF0YSgpIH07CiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGFwaUNhbGwoJ3NhdmVfdXNlcicsIHsgaXNFZGl0aW5nLCBjdXJyZW50bHlFZGl0aW5nVXNlciwgdXNlckRhdGEgfSk7CiAgICAgICAgICAgIGlmIChyZXN1bHQuc3VjY2VzcykgewogICAgICAgICAgICAgICAgYWxlcnQocmVzdWx0Lm1lc3NhZ2UgfHwgXGDCoVVzdWFyaW8gIlwke3VzZXJuYW1lfSIgZ3VhcmRhZG8gY29uIMOpeGl0byFcYCk7CiAgICAgICAgICAgICAgICByZXNldFVzZXJGb3JtKCk7CiAgICAgICAgICAgICAgICByZW5kZXJVc2VyTGlzdCgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgYWxlcnQoXGBFcnJvcjogXCR7cmVzdWx0Lm1lc3NhZ2UgfHwgJ05vIHNlIHB1ZG8gZ3VhcmRhciBlbCB1c3VhcmlvLid9XGApOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CgogICAgaWYgKGV4cG9ydFVzZXJzQnRuKSB7CiAgICAgICAgZXhwb3J0VXNlcnNCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHVzZXJzID0gYXdhaXQgYXBpQ2FsbCgnZ2V0X3VzZXJzJyk7CiAgICAgICAgICAgIGlmICghdXNlcnMgfHwgdXNlcnMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgICBhbGVydCgnTm8gaGF5IHVzdWFyaW9zIHBhcmEgZXhwb3J0YXIuJyk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgZGF0YVN0ciA9IEpTT04uc3RyaW5naWZ5KHVzZXJzLCBudWxsLCAyKTsKICAgICAgICAgICAgY29uc3QgZGF0YUJsb2IgPSBuZXcgQmxvYihbZGF0YVN0cl0sIHt0eXBlOiAiYXBwbGljYXRpb24vanNvbiJ9KTsKICAgICAgICAgICAgY29uc3QgdXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTChkYXRhQmxvYik7CiAgICAgICAgICAgIGNvbnN0IGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7CiAgICAgICAgICAgIGEuaHJlZiA9IHVybDsKICAgICAgICAgICAgYS5kb3dubG9hZCA9ICd1c3Vhcmlvcy5qc29uJzsKICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChhKTsKICAgICAgICAgICAgYS5jbGljaygpOwogICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGEpOwogICAgICAgICAgICBVUkwucmV2b2tlT2JqZWN0VVJMKHVybCk7CiAgICAgICAgfSk7CiAgICB9CgogICAgaWYgKGltcG9ydFVzZXJzSW5wdXQpIHsKICAgICAgICBpbXBvcnRVc2Vyc0lucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIChldmVudCkgPT4gewogICAgICAgICAgICBjb25zdCBmaWxlID0gZXZlbnQudGFyZ2V0LmZpbGVzPy5bMF07CiAgICAgICAgICAgIGlmICghZmlsZSkgcmV0dXJuOwogICAgICAgICAgICBpZiAoIWNvbmZpcm0oJ8K/RXN0w6Egc2VndXJvPyBFc3RvIHJlZW1wbGF6YXLDoSB0b2RvcyBsb3MgdXN1YXJpb3MgZ3VhcmRhZG9zIGFjdHVhbG1lbnRlLicpKSB7CiAgICAgICAgICAgICAgICAgZXZlbnQudGFyZ2V0LnZhbHVlID0gJyc7IHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwogICAgICAgICAgICByZWFkZXIub25sb2FkID0gYXN5bmMgKGUpID0+IHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29udGVudCA9IGUudGFyZ2V0Py5yZXN1bHQ7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdXNlcnMgPSBKU09OLnBhcnNlKGNvbnRlbnQpOwogICAgICAgICAgICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheSh1c2VycykpIHRocm93IG5ldyBFcnJvcignRWwgYXJjaGl2byBKU09OIG5vIGVzIHVuIGFycmF5IHbDoWxpZG8uJyk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYXBpQ2FsbCgnaW1wb3J0X3VzZXJzJywgeyB1c2VycyB9KTsKICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVuZGVyVXNlckxpc3QoKTsKICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnQoJ8KhVXN1YXJpb3MgaW1wb3J0YWRvcyBjb24gw6l4aXRvIScpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihyZXN1bHQubWVzc2FnZSB8fCAnRXJyb3IgZW4gZWwgc2Vydmlkb3IuJyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICBhbGVydCgnRXJyb3IgYWwgaW1wb3J0YXIgZWwgYXJjaGl2bzogJyArIGVycm9yLm1lc3NhZ2UpOwogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpOwogICAgICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICAgZXZlbnQudGFyZ2V0LnZhbHVlID0gJyc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHJlYWRlci5yZWFkQXNUZXh0KGZpbGUpOwogICAgICAgIH0pOwogICAgfQoKICAgIGlmIChpbWFnZVVybElucHV0ICYmIG1haW5EbmlQcm9maWxlSW1hZ2UgJiYgZWRpdG9yRG5pUHJvZmlsZUltYWdlKSB7CiAgICAgICAgaW1hZ2VVcmxJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsICgpID0+IHsKICAgICAgICAgICAgY29uc3QgbmV3VXJsID0gaW1hZ2VVcmxJbnB1dC52YWx1ZTsKICAgICAgICAgICAgbWFpbkRuaVByb2ZpbGVJbWFnZS5zcmMgPSBuZXdVcmw7CiAgICAgICAgICAgIGVkaXRvckRuaVByb2ZpbGVJbWFnZS5zcmMgPSBuZXdVcmw7CiAgICAgICAgICAgIGlmIChkZXRhaWxzUHJvZmlsZUltYWdlKSBkZXRhaWxzUHJvZmlsZUltYWdlLnNyYyA9IG5ld1VybDsKICAgICAgICB9KTsKICAgIH0KCiAgICBpZiAoZG5pQmFja1VybElucHV0ICYmIG1haW5EbmlCYWNrSW1hZ2UgJiYgZWRpdG9yRG5pQmFja0ltYWdlKSB7CiAgICAgICAgZG5pQmFja1VybElucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgKCkgPT4gewogICAgICAgICAgICBjb25zdCBuZXdVcmwgPSBkbmlCYWNrVXJsSW5wdXQudmFsdWU7CiAgICAgICAgICAgIG1haW5EbmlCYWNrSW1hZ2Uuc3JjID0gbmV3VXJsOwogICAgICAgICAgICBlZGl0b3JEbmlCYWNrSW1hZ2Uuc3JjID0gbmV3VXJsOwogICAgICAgIH0pOwogICAgfQoKICAgIGlmIChxclVybElucHV0KSB7CiAgICAgICAgcXJVcmxJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsICgpID0+IHsKICAgICAgICAgICAgY29uc3QgbmV3VXJsID0gcXJVcmxJbnB1dC52YWx1ZTsKICAgICAgICAgICAgaWYgKG1haW5EbmlRckltYWdlKSBtYWluRG5pUXJJbWFnZS5zcmMgPSBuZXdVcmw7CiAgICAgICAgICAgIGlmIChlZGl0b3JEbmlRckltYWdlKSBlZGl0b3JEbmlRckltYWdlLnNyYyA9IG5ld1VybDsKICAgICAgICAgICAgaWYgKGRldGFpbHNCYXJjb2RlSW1hZ2UpIGRldGFpbHNCYXJjb2RlSW1hZ2Uuc3JjID0gbmV3VXJsOwogICAgICAgIH0pOwogICAgfQoKICAgIGlmIChkb2N1bWVudG9zQnRuKSB7CiAgICAgICAgZG9jdW1lbnRvc0J0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgaWYgKGxvYWRpbmdPdmVybGF5KSBsb2FkaW5nT3ZlcmxheS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICBzaG93U2NyZWVuKCdkb2N1bWVudG9zJyk7CiAgICAgICAgICAgICAgICBpZiAobG9hZGluZ092ZXJsYXkpIGxvYWRpbmdPdmVybGF5LmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICB9LCAxNTAwKTsKICAgICAgICB9KTsKICAgIH0KICAgIAogICAgaWYgKHZlckRuaURpZ2l0YWxCdG4pIHsKICAgICAgICB2ZXJEbmlEaWdpdGFsQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBpZiAoYWN0aW9uTG9hZGVyKSBhY3Rpb25Mb2FkZXIuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgc2hvd0RuaURpZ2l0YWxWaWV3KCk7CiAgICAgICAgICAgICAgICBpZiAoYWN0aW9uTG9hZGVyKSBhY3Rpb25Mb2FkZXIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgICAgIH0sIDE1MDApOwogICAgICAgIH0pOwogICAgfQoKICAgIGlmIChlZGl0b3JCdG4pIHsKICAgICAgICBlZGl0b3JCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIHNob3dTY3JlZW4oJ2VkaXRvcicpOwogICAgICAgIH0pOwogICAgfQoKICAgIGlmIChiYWNrQnRuKSB7CiAgICAgICAgYmFja0J0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgIGlmKGRuaURpZ2l0YWxEaXNwbGF5ICYmIGdldENvbXB1dGVkU3R5bGUoZG5pRGlnaXRhbERpc3BsYXkpLmRpc3BsYXkgIT09ICdub25lJykgewogICAgICAgICAgICAgICAgcmVzZXREbmlDYXJkKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgc2hvd1NjcmVlbignbWFpbicpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CiAgICAKICAgIGlmIChkZXRhaWxzQmFja0J0bikgewogICAgICAgIGRldGFpbHNCYWNrQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBzaG93U2NyZWVuKCdkb2N1bWVudG9zJyk7CiAgICAgICAgICAgIHNob3dEbmlEaWdpdGFsVmlldygpOwogICAgICAgIH0pOwogICAgfQoKICAgIGlmIChlZGl0b3JCYWNrQnRuKSB7CiAgICAgICAgZWRpdG9yQmFja0J0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgc2hvd1NjcmVlbignbWFpbicpOwogICAgICAgIH0pOwogICAgfQoKICAgIGlmIChpbmljaW9CdG4pIHsKICAgICAgICBpbmljaW9CdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgc2hvd1NjcmVlbignbWFpbicpOwogICAgICAgIH0pOwogICAgfQoKICAgIGNvbnN0IGhhbmRsZVRlbGVmb25vc05hdiA9IChlKSA9PiB7CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIGlmIChsb2FkaW5nT3ZlcmxheSkgbG9hZGluZ092ZXJsYXkuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgIHNob3dTY3JlZW4oJ3RlbGVmb25vcycpOwogICAgICAgICAgICBpZiAobG9hZGluZ092ZXJsYXkpIGxvYWRpbmdPdmVybGF5LmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgIH0sIDE1MDApOwogICAgfTsKCiAgICBpZiAodGVsZWZvbm9zQnRuRG9jcykgdGVsZWZvbm9zQnRuRG9jcy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZVRlbGVmb25vc05hdik7CiAgICBpZiAodGVsZWZvbm9zQnRuRGV0YWlscykgdGVsZWZvbm9zQnRuRGV0YWlscy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZVRlbGVmb25vc05hdik7CiAgICBpZiAodGVsZWZvbm9zSW5pY2lvQnRuKSB7CiAgICAgICAgdGVsZWZvbm9zSW5pY2lvQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBpZiAobG9hZGluZ092ZXJsYXkpIGxvYWRpbmdPdmVybGF5LmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgIHNob3dTY3JlZW4oJ21haW4nKTsKICAgICAgICAgICAgICAgIGlmIChsb2FkaW5nT3ZlcmxheSkgbG9hZGluZ092ZXJsYXkuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgICAgIH0sIDE1MDApOwogICAgICAgIH0pOwogICAgfQoKICAgIGlmIChzb2xpY2l0YXJEbmlCdG4pIHsKICAgICAgICBzb2xpY2l0YXJEbmlCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIGlmIChhY3Rpb25Mb2FkZXIpIGFjdGlvbkxvYWRlci5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoZG5pSW5pdGlhbFZpZXcpIGRuaUluaXRpYWxWaWV3LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgICAgICBpZiAoZG5pQ2FyZEhlYWRlcikgZG5pQ2FyZEhlYWRlci5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICAgICAgaWYgKGRuaVNvbGljaXR1ZFZpZXcpIGRuaVNvbGljaXR1ZFZpZXcuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgICAgICAgICBpZiAoZG5pQ2FyZEJvZHkpIGRuaUNhcmRCb2R5LmNsYXNzTGlzdC5hZGQoJ25vLWhlYWRlcicpOwogICAgICAgICAgICAgICAgaWYgKGFjdGlvbkxvYWRlcikgYWN0aW9uTG9hZGVyLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICB9LCAxNTAwKTsKICAgICAgICB9KTsKICAgIH0KICAgIAogICAgaWYgKGNvbmZpcm1hclNvbGljaXR1ZEJ0bikgewogICAgICAgIGNvbmZpcm1hclNvbGljaXR1ZEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgaWYgKGFjdGlvbkxvYWRlcikgYWN0aW9uTG9hZGVyLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgIGlmIChkbmlTb2xpY2l0dWRWaWV3KSBkbmlTb2xpY2l0dWRWaWV3LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgICAgICBzaG93RG5pRGlnaXRhbFZpZXcoKTsKICAgICAgICAgICAgICAgIGlmIChhY3Rpb25Mb2FkZXIpIGFjdGlvbkxvYWRlci5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgfSwgMTUwMCk7CiAgICAgICAgfSk7CiAgICB9CiAgICAKICAgIGlmICh2ZXJEZXRhbGxlQnRuKSB7CiAgICAgICAgdmVyRGV0YWxsZUJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgcG9wdWxhdGVEbmlEZXRhaWxzKCk7CiAgICAgICAgICAgIHNob3dTY3JlZW4oJ2RldGFpbHMnKTsKICAgICAgICB9KTsKICAgIH0KCiAgICBpZiAodXNlclByb2ZpbGVCdG4gJiYgdXNlck1lbnUgJiYgcHJvZmlsZUFycm93KSB7CiAgICAgICAgdXNlclByb2ZpbGVCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgICB1c2VyTWVudS5jbGFzc0xpc3QudG9nZ2xlKCdhY3RpdmUnKTsKICAgICAgICAgICAgcHJvZmlsZUFycm93LmNsYXNzTGlzdC50b2dnbGUoJ3JvdGF0ZWQnKTsKICAgICAgICB9KTsKCiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgICAgICAgICBpZiAodXNlck1lbnUuY2xhc3NMaXN0LmNvbnRhaW5zKCdhY3RpdmUnKSkgewogICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0ID0gZS50YXJnZXQ7CiAgICAgICAgICAgICAgICBpZiAoIXVzZXJNZW51LmNvbnRhaW5zKHRhcmdldCkgJiYgIXVzZXJQcm9maWxlQnRuLmNvbnRhaW5zKHRhcmdldCkpIHsKICAgICAgICAgICAgICAgICAgICB1c2VyTWVudS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgICAgICBwcm9maWxlQXJyb3cuY2xhc3NMaXN0LnJlbW92ZSgncm90YXRlZCcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CgogICAgaWYgKG1lbnVFZGl0b3JCdG4pIHsKICAgICAgICBtZW51RWRpdG9yQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBzaG93U2NyZWVuKCdlZGl0b3InKTsKICAgICAgICAgICAgaWYgKHVzZXJNZW51ICYmIHByb2ZpbGVBcnJvdykgewogICAgICAgICAgICAgICAgIHVzZXJNZW51LmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgIHByb2ZpbGVBcnJvdy5jbGFzc0xpc3QucmVtb3ZlKCdyb3RhdGVkJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KCiAgICBpZiAodXNlck1lbnUgJiYgcHJvZmlsZUFycm93KSB7CiAgICAgICAgY29uc3Qgc2VsZWN0b3IgPSAnLnVzZXItbWVudS1saXN0IGE6bm90KCNtZW51LWVkaXRvci1idG4pLCAudXNlci1tZW51LWZvb3RlciBhJzsKICAgICAgICBjb25zdCBpbmFjdGl2ZUxpbmtzID0gdXNlck1lbnUucXVlcnlTZWxlY3RvckFsbChzZWxlY3Rvcik7CiAgICAgICAgaW5hY3RpdmVMaW5rcy5mb3JFYWNoKGxpbmsgPT4gewogICAgICAgICAgICBsaW5rLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgIHVzZXJNZW51LmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgcHJvZmlsZUFycm93LmNsYXNzTGlzdC5yZW1vdmUoJ3JvdGF0ZWQnKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICB9CgogICAgY29uc3QgZG5pQ2FyZCA9IGRvY3VtZW50b3NTY3JlZW4ucXVlcnlTZWxlY3RvcignLmRuaS1jYXJkJyk7CiAgICBpZiAoZG5pQ2FyZEhlYWRlciAmJiBkbmlDYXJkKSB7CiAgICAgICAgZG5pQ2FyZEhlYWRlci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgICAgY29uc3QgaXNJbml0aWFsU3RhdGUgPSBnZXRDb21wdXRlZFN0eWxlKGRuaUluaXRpYWxWaWV3KS5kaXNwbGF5ICE9PSAnbm9uZScgfHwgZ2V0Q29tcHV0ZWRTdHlsZShkbmlTb2xpY2l0dWRWaWV3KS5kaXNwbGF5ICE9PSAnbm9uZSc7CiAgICAgICAgICAgIGlmIChpc0luaXRpYWxTdGF0ZSkgewogICAgICAgICAgICAgICAgZG5pQ2FyZC5jbGFzc0xpc3QudG9nZ2xlKCdpcy1jb2xsYXBzZWQnKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfQp9KTtgOwogICAgICAgICAgICAvLyA0LiBDcmVhdGUgZmluYWwgSFRNTCBjb250ZW50CiAgICAgICAgICAgIGNvbnN0IGh0bWxEb2MgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xvbmVOb2RlKHRydWUpOwogICAgICAgICAgICBodG1sRG9jLnF1ZXJ5U2VsZWN0b3IoJyNhY3Rpb24tbG9hZGVyJyk/LmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICBodG1sRG9jLnF1ZXJ5U2VsZWN0b3IoJ3N0eWxlJykucmVtb3ZlKCk7CiAgICAgICAgICAgIGNvbnN0IGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaW5rJyk7CiAgICAgICAgICAgIGxpbmsucmVsID0gJ3N0eWxlc2hlZXQnOwogICAgICAgICAgICBsaW5rLmhyZWYgPSAnc3R5bGUuY3NzJzsKICAgICAgICAgICAgaHRtbERvYy5xdWVyeVNlbGVjdG9yKCdoZWFkJykuYXBwZW5kQ2hpbGQobGluayk7CiAgICAgICAgICAgIGh0bWxEb2MucXVlcnlTZWxlY3Rvcignc2NyaXB0W3R5cGU9Im1vZHVsZSJdJyk/LnJlbW92ZSgpOwogICAgICAgICAgICBBcnJheS5mcm9tKGh0bWxEb2MucXVlcnlTZWxlY3RvckFsbCgnc2NyaXB0JykpLmZpbmQocyA9PiBzLnNyYy5pbmNsdWRlcygnanN6aXAnKSk/LnJlbW92ZSgpOwogICAgICAgICAgICBjb25zdCBkb3dubG9hZEJ0bkluQ2xvbmUgPSBodG1sRG9jLnF1ZXJ5U2VsZWN0b3IoJyNkb3dubG9hZC1hcHAtYnRuJyk7CiAgICAgICAgICAgIGlmIChkb3dubG9hZEJ0bkluQ2xvbmUpIHsKICAgICAgICAgICAgICAgIGRvd25sb2FkQnRuSW5DbG9uZS5wcmV2aW91c0VsZW1lbnRTaWJsaW5nPy5yZW1vdmUoKTsgLy8gcmVtb3ZlIGhvcml6b250YWwgcnVsZQogICAgICAgICAgICAgICAgZG93bmxvYWRCdG5JbkNsb25lLnJlbW92ZSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IG5ld1NjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpOwogICAgICAgICAgICBuZXdTY3JpcHQuc3JjID0gYGFwcC5qcz92PSR7bmV3IERhdGUoKS5nZXRUaW1lKCl9YDsgLy8gQ2FjaGUgYnVzdGluZwogICAgICAgICAgICBodG1sRG9jLnF1ZXJ5U2VsZWN0b3IoJ2JvZHknKS5hcHBlbmRDaGlsZChuZXdTY3JpcHQpOwogICAgICAgICAgICBjb25zdCBmaW5hbEh0bWwgPSAnPCFET0NUWVBFIGh0bWw+XFxuJyArIGh0bWxEb2Mub3V0ZXJIVE1MOwogICAgICAgICAgICAvLyA1LiBaaXAgYW5kIERvd25sb2FkCiAgICAgICAgICAgIGNvbnN0IHppcCA9IG5ldyBKU1ppcCgpOwogICAgICAgICAgICB6aXAuZmlsZSgiaW5kZXguaHRtbCIsIGZpbmFsSHRtbCk7CiAgICAgICAgICAgIHppcC5maWxlKCJzdHlsZS5jc3MiLCBzdHlsZUNvbnRlbnQpOwogICAgICAgICAgICB6aXAuZmlsZSgiYXBwLmpzIiwgbWFpblNjcmlwdENvbnRlbnQpOwogICAgICAgICAgICB6aXAuZmlsZSgiYXBpLnBocCIsIHBocENvbnRlbnQpOwogICAgICAgICAgICB6aXAuZmlsZSgibWFuaWZlc3QuanNvbiIsIG1hbmlmZXN0Q29udGVudCk7CiAgICAgICAgICAgIHppcC5maWxlKCJzdy5qcyIsIHN3Q29udGVudCk7CiAgICAgICAgICAgIHppcC5maWxlKCJ1c3Vhcmlvcy5qc29uIiwgIltdIik7CiAgICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSBhd2FpdCB6aXAuZ2VuZXJhdGVBc3luYyh7IHR5cGU6ICJibG9iIiB9KTsKICAgICAgICAgICAgY29uc3QgdXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTChjb250ZW50KTsKICAgICAgICAgICAgY29uc3QgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsKICAgICAgICAgICAgYS5ocmVmID0gdXJsOwogICAgICAgICAgICBhLmRvd25sb2FkID0gJ21pLWFyZ2VudGluYS1hcHAuemlwJzsKICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChhKTsKICAgICAgICAgICAgYS5jbGljaygpOwogICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGEpOwogICAgICAgICAgICBVUkwucmV2b2tlT2JqZWN0VVJMKHVybCk7CiAgICAgICAgfQogICAgICAgIGNhdGNoIChlcnJvcikgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBnZW5lcmF0aW5nIFpJUDoiLCBlcnJvcik7CiAgICAgICAgICAgIGFsZXJ0KCJPY3VycmnDsyB1biBlcnJvciBhbCBnZW5lcmFyIGVsIGFyY2hpdm8gWklQLiIpOwogICAgICAgIH0KICAgICAgICBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKGxvYWRlcikKICAgICAgICAgICAgICAgIGxvYWRlci5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICB9CiAgICB9CiAgICAvLyAtLS0gRXZlbnQgTGlzdGVuZXJzIC0tLQogICAgaWYgKGxvZ2luQnRuKSB7CiAgICAgICAgbG9naW5CdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoZSkgPT4gewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIGxvZ2luRXJyb3JNc2cuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgY29uc3QgdXNlcm5hbWUgPSB1c2VybmFtZUlucHV0LnZhbHVlOwogICAgICAgICAgICBjb25zdCBwYXNzd29yZCA9IHBhc3N3b3JkSW5wdXQudmFsdWU7CiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGFwaUNhbGwoJ2xvZ2luJywgeyB1c2VybmFtZSwgcGFzc3dvcmQgfSk7CiAgICAgICAgICAgIGlmIChyZXN1bHQuc3VjY2VzcykgewogICAgICAgICAgICAgICAgaWYgKGxvZ2luTG9hZGluZ092ZXJsYXkpCiAgICAgICAgICAgICAgICAgICAgbG9naW5Mb2FkaW5nT3ZlcmxheS5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOwogICAgICAgICAgICAgICAgbG9nZ2VkSW5Vc2VyID0gcmVzdWx0LnVzZXI7CiAgICAgICAgICAgICAgICBhcHBseVVzZXJEYXRhKHJlc3VsdC51c2VyLmRuaURhdGEpOwogICAgICAgICAgICAgICAgdXBkYXRlVWlGb3JVc2VyUm9sZSgpOwogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGxvZ2luTG9hZGluZ092ZXJsYXkpCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2luTG9hZGluZ092ZXJsYXkuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgICAgICAgICBzaG93U2NyZWVuKCdtYWluJyk7CiAgICAgICAgICAgICAgICB9LCAyMDAwKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGxvZ2luRXJyb3JNc2cudGV4dENvbnRlbnQgPSByZXN1bHQubWVzc2FnZSB8fCAnVXN1YXJpbyBvIGNvbnRyYXNlw7FhIGluY29ycmVjdG9zLic7CiAgICAgICAgICAgICAgICBsb2dpbkVycm9yTXNnLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CiAgICBpZiAoZ3Vlc3RMb2dpbkJ0bikgewogICAgICAgIGd1ZXN0TG9naW5CdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIGlmIChsb2dpbkxvYWRpbmdPdmVybGF5KQogICAgICAgICAgICAgICAgbG9naW5Mb2FkaW5nT3ZlcmxheS5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOwogICAgICAgICAgICBsb2dnZWRJblVzZXIgPSB7IHVzZXJuYW1lOiAnSW52aXRhZG8nLCByb2xlOiAnYWRtaW4nIH07CiAgICAgICAgICAgIHVwZGF0ZVVpRm9yVXNlclJvbGUoKTsKICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAobG9naW5Mb2FkaW5nT3ZlcmxheSkKICAgICAgICAgICAgICAgICAgICBsb2dpbkxvYWRpbmdPdmVybGF5LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgICAgICBzaG93U2NyZWVuKCdtYWluJyk7CiAgICAgICAgICAgIH0sIDE1MDApOwogICAgICAgIH0pOwogICAgfQogICAgaWYgKHNhdmVVc2VyQnRuKSB7CiAgICAgICAgc2F2ZVVzZXJCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHVzZXJuYW1lID0gbmV3VXNlcm5hbWVJbnB1dC52YWx1ZS50cmltKCk7CiAgICAgICAgICAgIGNvbnN0IHBhc3N3b3JkID0gbmV3UGFzc3dvcmRJbnB1dC52YWx1ZS50cmltKCk7CiAgICAgICAgICAgIGNvbnN0IHJvbGUgPSBuZXdVc2VyUm9sZVNlbGVjdC52YWx1ZTsKICAgICAgICAgICAgY29uc3QgaXNFZGl0aW5nID0gISFjdXJyZW50bHlFZGl0aW5nVXNlcjsKICAgICAgICAgICAgaWYgKCF1c2VybmFtZSkgewogICAgICAgICAgICAgICAgYWxlcnQoJ1BvciBmYXZvciwgaW5ncmVzZSB1biBub21icmUgZGUgdXN1YXJpby4nKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIWlzRWRpdGluZyAmJiAhcGFzc3dvcmQpIHsKICAgICAgICAgICAgICAgIGFsZXJ0KCdQb3IgZmF2b3IsIGluZ3Jlc2UgdW5hIGNvbnRyYXNlw7FhIHBhcmEgZWwgbnVldm8gdXN1YXJpby4nKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocGFzc3dvcmQgJiYgcGFzc3dvcmQubGVuZ3RoIDwgNikgewogICAgICAgICAgICAgICAgYWxlcnQoJ0xhIGNvbnRyYXNlw7FhIGRlYmUgdGVuZXIgYWwgbWVub3MgNiBjYXJhY3RlcmVzLicpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IHVzZXJEYXRhID0geyB1c2VybmFtZSwgcGFzc3dvcmQsIHJvbGUsIGRuaURhdGE6IGdhdGhlckN1cnJlbnREbmlEYXRhKCkgfTsKICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYXBpQ2FsbCgnc2F2ZV91c2VyJywgeyBpc0VkaXRpbmcsIGN1cnJlbnRseUVkaXRpbmdVc2VyLCB1c2VyRGF0YSB9KTsKICAgICAgICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7CiAgICAgICAgICAgICAgICBhbGVydChyZXN1bHQubWVzc2FnZSB8fCBgwqFVc3VhcmlvICIke3VzZXJuYW1lfSIgZ3VhcmRhZG8gY29uIMOpeGl0byFgKTsKICAgICAgICAgICAgICAgIHJlc2V0VXNlckZvcm0oKTsKICAgICAgICAgICAgICAgIHJlbmRlclVzZXJMaXN0KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBhbGVydChgRXJyb3I6ICR7cmVzdWx0Lm1lc3NhZ2UgfHwgJ05vIHNlIHB1ZG8gZ3VhcmRhciBlbCB1c3VhcmlvLid9YCk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KICAgIGlmIChleHBvcnRVc2Vyc0J0bikgewogICAgICAgIGV4cG9ydFVzZXJzQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKCkgPT4gewogICAgICAgICAgICBjb25zdCB1c2VycyA9IGF3YWl0IGFwaUNhbGwoJ2dldF91c2VycycpOwogICAgICAgICAgICBpZiAoIXVzZXJzIHx8IHVzZXJzLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgYWxlcnQoJ05vIGhheSB1c3VhcmlvcyBwYXJhIGV4cG9ydGFyLicpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGRhdGFTdHIgPSBKU09OLnN0cmluZ2lmeSh1c2VycywgbnVsbCwgMik7CiAgICAgICAgICAgIGNvbnN0IGRhdGFCbG9iID0gbmV3IEJsb2IoW2RhdGFTdHJdLCB7IHR5cGU6ICJhcHBsaWNhdGlvbi9qc29uIiB9KTsKICAgICAgICAgICAgY29uc3QgdXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTChkYXRhQmxvYik7CiAgICAgICAgICAgIGNvbnN0IGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7CiAgICAgICAgICAgIGEuaHJlZiA9IHVybDsKICAgICAgICAgICAgYS5kb3dubG9hZCA9ICd1c3Vhcmlvcy5qc29uJzsKICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChhKTsKICAgICAgICAgICAgYS5jbGljaygpOwogICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGEpOwogICAgICAgICAgICBVUkwucmV2b2tlT2JqZWN0VVJMKHVybCk7CiAgICAgICAgfSk7CiAgICB9CiAgICBpZiAoaW1wb3J0VXNlcnNJbnB1dCkgewogICAgICAgIGltcG9ydFVzZXJzSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKGV2ZW50KSA9PiB7CiAgICAgICAgICAgIGNvbnN0IGZpbGUgPSBldmVudC50YXJnZXQuZmlsZXM/LlswXTsKICAgICAgICAgICAgaWYgKCFmaWxlKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBpZiAoIWNvbmZpcm0oJ8K/RXN0w6Egc2VndXJvPyBFc3RvIHJlZW1wbGF6YXLDoSB0b2RvcyBsb3MgdXN1YXJpb3MgZ3VhcmRhZG9zIGFjdHVhbG1lbnRlLicpKSB7CiAgICAgICAgICAgICAgICBldmVudC50YXJnZXQudmFsdWUgPSAnJzsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwogICAgICAgICAgICByZWFkZXIub25sb2FkID0gYXN5bmMgKGUpID0+IHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29udGVudCA9IGUudGFyZ2V0Py5yZXN1bHQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFjb250ZW50KQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0VsIGFyY2hpdm8gZXN0w6EgdmFjw61vLicpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHVzZXJzID0gSlNPTi5wYXJzZShjb250ZW50KTsKICAgICAgICAgICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkodXNlcnMpKQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0VsIGFyY2hpdm8gSlNPTiBubyBlcyB1biBhcnJheSB2w6FsaWRvLicpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGFwaUNhbGwoJ2ltcG9ydF91c2VycycsIHsgdXNlcnMgfSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlbmRlclVzZXJMaXN0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0KCfCoVVzdWFyaW9zIGltcG9ydGFkb3MgY29uIMOpeGl0byEnKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihyZXN1bHQubWVzc2FnZSB8fCAnRXJyb3IgZW4gZWwgc2Vydmlkb3IuJyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICAgICAgYWxlcnQoJ0Vycm9yIGFsIGltcG9ydGFyIGVsIGFyY2hpdm86ICcgKyBlcnJvci5tZXNzYWdlKTsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZpbmFsbHkgewogICAgICAgICAgICAgICAgICAgIGV2ZW50LnRhcmdldC52YWx1ZSA9ICcnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgICByZWFkZXIucmVhZEFzVGV4dChmaWxlKTsKICAgICAgICB9KTsKICAgIH0KICAgIGlmIChpbWFnZVVybElucHV0ICYmIG1haW5EbmlQcm9maWxlSW1hZ2UgJiYgZWRpdG9yRG5pUHJvZmlsZUltYWdlKSB7CiAgICAgICAgaW1hZ2VVcmxJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsICgpID0+IHsKICAgICAgICAgICAgY29uc3QgbmV3VXJsID0gaW1hZ2VVcmxJbnB1dC52YWx1ZTsKICAgICAgICAgICAgbWFpbkRuaVByb2ZpbGVJbWFnZS5zcmMgPSBuZXdVcmw7CiAgICAgICAgICAgIGVkaXRvckRuaVByb2ZpbGVJbWFnZS5zcmMgPSBuZXdVcmw7CiAgICAgICAgICAgIGlmIChkZXRhaWxzUHJvZmlsZUltYWdlKQogICAgICAgICAgICAgICAgZGV0YWlsc1Byb2ZpbGVJbWFnZS5zcmMgPSBuZXdVcmw7CiAgICAgICAgfSk7CiAgICB9CiAgICBpZiAoZG5pQmFja1VybElucHV0ICYmIG1haW5EbmlCYWNrSW1hZ2UgJiYgZWRpdG9yRG5pQmFja0ltYWdlKSB7CiAgICAgICAgZG5pQmFja1VybElucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgKCkgPT4gewogICAgICAgICAgICBjb25zdCBuZXdVcmwgPSBkbmlCYWNrVXJsSW5wdXQudmFsdWU7CiAgICAgICAgICAgIG1haW5EbmlCYWNrSW1hZ2Uuc3JjID0gbmV3VXJsOwogICAgICAgICAgICBlZGl0b3JEbmlCYWNrSW1hZ2Uuc3JjID0gbmV3VXJsOwogICAgICAgIH0pOwogICAgfQogICAgaWYgKHFyVXJsSW5wdXQpIHsKICAgICAgICBxclVybElucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgKCkgPT4gewogICAgICAgICAgICBjb25zdCBuZXdVcmwgPSBxclVybElucHV0LnZhbHVlOwogICAgICAgICAgICBpZiAobWFpbkRuaVFySW1hZ2UpCiAgICAgICAgICAgICAgICBtYWluRG5pUXJJbWFnZS5zcmMgPSBuZXdVcmw7CiAgICAgICAgICAgIGlmIChlZGl0b3JEbmlRckltYWdlKQogICAgICAgICAgICAgICAgZWRpdG9yRG5pUXJJbWFnZS5zcmMgPSBuZXdVcmw7CiAgICAgICAgICAgIGlmIChkZXRhaWxzQmFyY29kZUltYWdlKQogICAgICAgICAgICAgICAgZGV0YWlsc0JhcmNvZGVJbWFnZS5zcmMgPSBuZXdVcmw7CiAgICAgICAgfSk7CiAgICB9CiAgICBpZiAoZG9jdW1lbnRvc0J0bikgewogICAgICAgIGRvY3VtZW50b3NCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIGlmIChsb2FkaW5nT3ZlcmxheSkKICAgICAgICAgICAgICAgIGxvYWRpbmdPdmVybGF5LmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgIHNob3dTY3JlZW4oJ2RvY3VtZW50b3MnKTsKICAgICAgICAgICAgICAgIGlmIChsb2FkaW5nT3ZlcmxheSkKICAgICAgICAgICAgICAgICAgICBsb2FkaW5nT3ZlcmxheS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgfSwgMTUwMCk7CiAgICAgICAgfSk7CiAgICB9CiAgICBpZiAodmVyRG5pRGlnaXRhbEJ0bikgewogICAgICAgIHZlckRuaURpZ2l0YWxCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIGlmIChhY3Rpb25Mb2FkZXIpCiAgICAgICAgICAgICAgICBhY3Rpb25Mb2FkZXIuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgc2hvd0RuaURpZ2l0YWxWaWV3KCk7CiAgICAgICAgICAgICAgICBpZiAoYWN0aW9uTG9hZGVyKQogICAgICAgICAgICAgICAgICAgIGFjdGlvbkxvYWRlci5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgfSwgMTUwMCk7CiAgICAgICAgfSk7CiAgICB9CiAgICBpZiAoZWRpdG9yQnRuKSB7CiAgICAgICAgZWRpdG9yQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBzaG93U2NyZWVuKCdlZGl0b3InKTsKICAgICAgICB9KTsKICAgIH0KICAgIGlmIChiYWNrQnRuKSB7CiAgICAgICAgYmFja0J0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgaWYgKGRuaURpZ2l0YWxEaXNwbGF5ICYmIGdldENvbXB1dGVkU3R5bGUoZG5pRGlnaXRhbERpc3BsYXkpLmRpc3BsYXkgIT09ICdub25lJykgewogICAgICAgICAgICAgICAgcmVzZXREbmlDYXJkKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBzaG93U2NyZWVuKCdtYWluJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KICAgIGlmIChkZXRhaWxzQmFja0J0bikgewogICAgICAgIGRldGFpbHNCYWNrQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBzaG93U2NyZWVuKCdkb2N1bWVudG9zJyk7CiAgICAgICAgICAgIHNob3dEbmlEaWdpdGFsVmlldygpOwogICAgICAgIH0pOwogICAgfQogICAgaWYgKGVkaXRvckJhY2tCdG4pIHsKICAgICAgICBlZGl0b3JCYWNrQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBzaG93U2NyZWVuKCdtYWluJyk7CiAgICAgICAgfSk7CiAgICB9CiAgICBpZiAoaW5pY2lvQnRuKSB7CiAgICAgICAgaW5pY2lvQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBzaG93U2NyZWVuKCdtYWluJyk7CiAgICAgICAgfSk7CiAgICB9CiAgICBjb25zdCBoYW5kbGVUZWxlZm9ub3NOYXYgPSAoZSkgPT4gewogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICBpZiAobG9hZGluZ092ZXJsYXkpCiAgICAgICAgICAgIGxvYWRpbmdPdmVybGF5LmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICBzaG93U2NyZWVuKCd0ZWxlZm9ub3MnKTsKICAgICAgICAgICAgaWYgKGxvYWRpbmdPdmVybGF5KQogICAgICAgICAgICAgICAgbG9hZGluZ092ZXJsYXkuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgfSwgMTUwMCk7CiAgICB9OwogICAgaWYgKHRlbGVmb25vc0J0bkRvY3MpCiAgICAgICAgdGVsZWZvbm9zQnRuRG9jcy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZVRlbGVmb25vc05hdik7CiAgICBpZiAodGVsZWZvbm9zQnRuRGV0YWlscykKICAgICAgICB0ZWxlZm9ub3NCdG5EZXRhaWxzLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlVGVsZWZvbm9zTmF2KTsKICAgIGlmICh0ZWxlZm9ub3NJbmljaW9CdG4pIHsKICAgICAgICB0ZWxlZm9ub3NJbmljaW9CdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIGlmIChsb2FkaW5nT3ZlcmxheSkKICAgICAgICAgICAgICAgIGxvYWRpbmdPdmVybGF5LmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgIHNob3dTY3JlZW4oJ21haW4nKTsKICAgICAgICAgICAgICAgIGlmIChsb2FkaW5nT3ZlcmxheSkKICAgICAgICAgICAgICAgICAgICBsb2FkaW5nT3ZlcmxheS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgfSwgMTUwMCk7CiAgICAgICAgfSk7CiAgICB9CiAgICBpZiAoc29saWNpdGFyRG5pQnRuKSB7CiAgICAgICAgc29saWNpdGFyRG5pQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBpZiAoYWN0aW9uTG9hZGVyKQogICAgICAgICAgICAgICAgYWN0aW9uTG9hZGVyLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgIGlmIChkbmlJbml0aWFsVmlldykKICAgICAgICAgICAgICAgICAgICBkbmlJbml0aWFsVmlldy5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICAgICAgaWYgKGRuaUNhcmRIZWFkZXIpCiAgICAgICAgICAgICAgICAgICAgZG5pQ2FyZEhlYWRlci5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICAgICAgaWYgKGRuaVNvbGljaXR1ZFZpZXcpCiAgICAgICAgICAgICAgICAgICAgZG5pU29saWNpdHVkVmlldy5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICAgICAgICAgIGlmIChkbmlDYXJkQm9keSkKICAgICAgICAgICAgICAgICAgICBkbmlDYXJkQm9keS5jbGFzc0xpc3QuYWRkKCduby1oZWFkZXInKTsKICAgICAgICAgICAgICAgIGlmIChhY3Rpb25Mb2FkZXIpCiAgICAgICAgICAgICAgICAgICAgYWN0aW9uTG9hZGVyLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICB9LCAxNTAwKTsKICAgICAgICB9KTsKICAgIH0KICAgIGlmIChjb25maXJtYXJTb2xpY2l0dWRCdG4pIHsKICAgICAgICBjb25maXJtYXJTb2xpY2l0dWRCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIGlmIChhY3Rpb25Mb2FkZXIpCiAgICAgICAgICAgICAgICBhY3Rpb25Mb2FkZXIuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgaWYgKGRuaVNvbGljaXR1ZFZpZXcpCiAgICAgICAgICAgICAgICAgICAgZG5pU29saWNpdHVkVmlldy5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICAgICAgc2hvd0RuaURpZ2l0YWxWaWV3KCk7CiAgICAgICAgICAgICAgICBpZiAoYWN0aW9uTG9hZGVyKQogICAgICAgICAgICAgICAgICAgIGFjdGlvbkxvYWRlci5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgfSwgMTUwMCk7CiAgICAgICAgfSk7CiAgICB9CiAgICBpZiAodmVyRGV0YWxsZUJ0bikgewogICAgICAgIHZlckRldGFsbGVCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIHBvcHVsYXRlRG5pRGV0YWlscygpOwogICAgICAgICAgICBzaG93U2NyZWVuKCdkZXRhaWxzJyk7CiAgICAgICAgfSk7CiAgICB9CiAgICBpZiAodXNlclByb2ZpbGVCdG4gJiYgdXNlck1lbnUgJiYgcHJvZmlsZUFycm93KSB7CiAgICAgICAgdXNlclByb2ZpbGVCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgICB1c2VyTWVudS5jbGFzc0xpc3QudG9nZ2xlKCdhY3RpdmUnKTsKICAgICAgICAgICAgcHJvZmlsZUFycm93LmNsYXNzTGlzdC50b2dnbGUoJ3JvdGF0ZWQnKTsKICAgICAgICB9KTsKICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICAgICAgICAgIGlmICh1c2VyTWVudS5jbGFzc0xpc3QuY29udGFpbnMoJ2FjdGl2ZScpKSB7CiAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXQgPSBlLnRhcmdldDsKICAgICAgICAgICAgICAgIGlmICghdXNlck1lbnUuY29udGFpbnModGFyZ2V0KSAmJiAhdXNlclByb2ZpbGVCdG4uY29udGFpbnModGFyZ2V0KSkgewogICAgICAgICAgICAgICAgICAgIHVzZXJNZW51LmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgICAgIHByb2ZpbGVBcnJvdy5jbGFzc0xpc3QucmVtb3ZlKCdyb3RhdGVkJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KICAgIGlmIChtZW51RWRpdG9yQnRuKSB7CiAgICAgICAgbWVudUVkaXRvckJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgc2hvd1NjcmVlbignZWRpdG9yJyk7CiAgICAgICAgICAgIGlmICh1c2VyTWVudSAmJiBwcm9maWxlQXJyb3cpIHsKICAgICAgICAgICAgICAgIHVzZXJNZW51LmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgcHJvZmlsZUFycm93LmNsYXNzTGlzdC5yZW1vdmUoJ3JvdGF0ZWQnKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfQogICAgaWYgKHVzZXJNZW51ICYmIHByb2ZpbGVBcnJvdykgewogICAgICAgIGNvbnN0IHNlbGVjdG9yID0gJy51c2VyLW1lbnUtbGlzdCBhOm5vdCgjbWVudS1lZGl0b3ItYnRuKSwgLnVzZXItbWVudS1mb290ZXIgYSc7CiAgICAgICAgY29uc3QgaW5hY3RpdmVMaW5rcyA9IHVzZXJNZW51LnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpOwogICAgICAgIGluYWN0aXZlTGlua3MuZm9yRWFjaChsaW5rID0+IHsKICAgICAgICAgICAgbGluay5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICB1c2VyTWVudS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgIHByb2ZpbGVBcnJvdy5jbGFzc0xpc3QucmVtb3ZlKCdyb3RhdGVkJyk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgfQogICAgY29uc3QgZG5pQ2FyZCA9IGRvY3VtZW50b3NTY3JlZW4ucXVlcnlTZWxlY3RvcignLmRuaS1jYXJkJyk7CiAgICBpZiAoZG5pQ2FyZEhlYWRlciAmJiBkbmlDYXJkKSB7CiAgICAgICAgZG5pQ2FyZEhlYWRlci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgICAgY29uc3QgaXNJbml0aWFsU3RhdGUgPSAoZG5pSW5pdGlhbFZpZXcgJiYgZ2V0Q29tcHV0ZWRTdHlsZShkbmlJbml0aWFsVmlldykuZGlzcGxheSAhPT0gJ25vbmUnKSB8fAogICAgICAgICAgICAgICAgKGRuaVNvbGljaXR1ZFZpZXcgJiYgZ2V0Q29tcHV0ZWRTdHlsZShkbmlTb2xpY2l0dWRWaWV3KS5kaXNwbGF5ICE9PSAnbm9uZScpOwogICAgICAgICAgICBpZiAoaXNJbml0aWFsU3RhdGUpIHsKICAgICAgICAgICAgICAgIGRuaUNhcmQuY2xhc3NMaXN0LnRvZ2dsZSgnaXMtY29sbGFwc2VkJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KICAgIGlmIChkb3dubG9hZEFwcEJ0bikgewogICAgICAgIGRvd25sb2FkQXBwQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZ2VuZXJhdGVBbmREb3dubG9hZEh0bWwpOwogICAgfQogICAgLy8gSGFuZGxlIFRpbmEgbGlua3MgdG8gb3BlbiBXaGF0c0FwcAogICAgY29uc3QgdGluYUxpbmtzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnRpbmEtbGluaycpOwogICAgdGluYUxpbmtzLmZvckVhY2gobGluayA9PiB7CiAgICAgICAgbGluay5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgY29uc3Qgd2hhdHNhcHBVcmwgPSAnaHR0cHM6Ly93YS5tZS81NDkxMTM5MTAxMDEwJzsKICAgICAgICAgICAgd2luZG93Lm9wZW4od2hhdHNhcHBVcmwsICdfYmxhbmsnLCAnbm9vcGVuZXIsbm9yZWZlcnJlcicpOwogICAgICAgIH0pOwogICAgfSk7CiAgICAvLyBQcmV2ZW50IHBsYWNlaG9sZGVyIGxpbmtzIGZyb20gbmF2aWdhdGluZyBhd2F5IGZyb20gdGhlIGFwcAogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnYVtocmVmPSIjIl06bm90KC50aW5hLWxpbmspJykuZm9yRWFjaChsaW5rID0+IHsKICAgICAgICBsaW5rLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIH0pOwogICAgfSk7CiAgICAvLyAtLS0gSW5pdGlhbCBTZXR1cCAtLS0KICAgIGNvbnN0IHByb2ZpbGVQaWNUYXJnZXRzID0gW2VkaXRvckRuaVByb2ZpbGVQaWMsIG1haW5EbmlQcm9maWxlUGljXTsKICAgIHNldHVwU2xpZGVyKHRvcFNsaWRlciwgcHJvZmlsZVBpY1RhcmdldHMsICd0b3AnLCB0b3BWYWx1ZSwgJyUnKTsKICAgIHNldHVwU2xpZGVyKGxlZnRTbGlkZXIsIHByb2ZpbGVQaWNUYXJnZXRzLCAnbGVmdCcsIGxlZnRWYWx1ZSwgJyUnKTsKICAgIHNldHVwU2xpZGVyKHdpZHRoU2xpZGVyLCBwcm9maWxlUGljVGFyZ2V0cywgJ3dpZHRoJywgd2lkdGhWYWx1ZSwgJyUnKTsKICAgIHNldHVwU2xpZGVyKGhlaWdodFNsaWRlciwgcHJvZmlsZVBpY1RhcmdldHMsICdoZWlnaHQnLCBoZWlnaHRWYWx1ZSwgJyUnKTsKICAgIGNvbnN0IHFyUGljVGFyZ2V0cyA9IFtlZGl0b3JEbmlRclBpYywgbWFpbkRuaVFyUGljXTsKICAgIHNldHVwU2xpZGVyKHFyVG9wU2xpZGVyLCBxclBpY1RhcmdldHMsICd0b3AnLCBxclRvcFZhbHVlLCAnJScpOwogICAgc2V0dXBTbGlkZXIocXJMZWZ0U2xpZGVyLCBxclBpY1RhcmdldHMsICdsZWZ0JywgcXJMZWZ0VmFsdWUsICclJyk7CiAgICBzZXR1cFNsaWRlcihxcldpZHRoU2xpZGVyLCBxclBpY1RhcmdldHMsICd3aWR0aCcsIHFyV2lkdGhWYWx1ZSwgJyUnKTsKICAgIHNldHVwU2xpZGVyKHFySGVpZ2h0U2xpZGVyLCBxclBpY1RhcmdldHMsICdoZWlnaHQnLCBxckhlaWdodFZhbHVlLCAnJScpOwogICAgY29uc3QgdGV4dEZpZWxkcyA9IFsnYXBlbGxpZG8nLCAnbm9tYnJlJywgJ2RvY3VtZW50bycsICduYWNpbWllbnRvJywgJ3RyYW1pdGUnLCAnZWplbXBsYXInLCAnZW1pc2lvbicsICd2ZW5jaW1pZW50bycsICdkb21pY2lsaW8nLCAnc2V4bycsICdjdWlsJ107CiAgICB0ZXh0RmllbGRzLmZvckVhY2goc2V0dXBUZXh0Q29udHJvbCk7CiAgICBzZXR1cEZsaXBwZXIoZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmRuaS1mbGlwcGVyLWNvbnRhaW5lcicpLCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZG5pLWZsaXBwZXInKSk7CiAgICBzZXR1cEZsaXBwZXIoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXRvci1kbmktZmxpcHBlci1jb250YWluZXInKSwgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXRvci1kbmktZmxpcHBlcicpKTsKICAgIHNldHVwQ2Fyb3VzZWwoKTsKICAgIGNvbnN0IGluaXRpYWxEYXRhID0gZ2F0aGVyQ3VycmVudERuaURhdGEoKTsKICAgIGFwcGx5VXNlckRhdGEoaW5pdGlhbERhdGEpOwogICAgcmVuZGVyVXNlckxpc3QoKTsKfSk7Cg==","@":"data:application/javascript;base64,ZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsICgpID0+IHsKICAgIC8vIC0tLSBFbGVtZW50IFNlbGVjdG9ycyAtLS0KICAgIGNvbnN0IGxvZ2luU2NyZWVuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvZ2luLXNjcmVlbicpOwogICAgY29uc3QgbWFpblNjcmVlbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYWluLXNjcmVlbicpOwogICAgY29uc3QgZG9jdW1lbnRvc1NjcmVlbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkb2N1bWVudG9zLXNjcmVlbicpOwogICAgY29uc3QgZWRpdG9yU2NyZWVuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXRvci1zY3JlZW4nKTsKICAgIGNvbnN0IGRuaURldGFpbHNTY3JlZW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZG5pLWRldGFpbHMtc2NyZWVuJyk7CiAgICBjb25zdCB0ZWxlZm9ub3NTY3JlZW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGVsZWZvbm9zLXNjcmVlbicpOwogICAgY29uc3QgYm90dG9tTmF2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JvdHRvbS1uYXYnKTsKICAgIGNvbnN0IGxvYWRpbmdPdmVybGF5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRpbmctb3ZlcmxheScpOwogICAgY29uc3QgbG9naW5Mb2FkaW5nT3ZlcmxheSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2dpbi1sb2FkaW5nLW92ZXJsYXknKTsKICAgIGNvbnN0IGFjdGlvbkxvYWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhY3Rpb24tbG9hZGVyJyk7CiAgICAvLyBMb2dpbiBzY3JlZW4gZWxlbWVudHMKICAgIGNvbnN0IGxvZ2luQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvZ2luLWJ0bicpOwogICAgY29uc3QgZ3Vlc3RMb2dpbkJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdndWVzdC1sb2dpbi1idG4nKTsKICAgIGNvbnN0IHVzZXJuYW1lSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndXNlcm5hbWUtaW5wdXQnKTsKICAgIGNvbnN0IHBhc3N3b3JkSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFzc3dvcmQtaW5wdXQnKTsKICAgIGNvbnN0IGxvZ2luRXJyb3JNc2cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9naW4tZXJyb3ItbXNnJyk7CiAgICBjb25zdCBkb3dubG9hZEFwcEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkb3dubG9hZC1hcHAtYnRuJyk7CiAgICAvLyBOYXZpZ2F0aW9uIGJ1dHRvbnMKICAgIGNvbnN0IGRvY3VtZW50b3NCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZG9jdW1lbnRvcy1idG4nKTsKICAgIGNvbnN0IGVkaXRvckJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlZGl0b3ItYnRuJyk7CiAgICBjb25zdCB0ZWxlZm9ub3NCdG5Eb2NzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RlbGVmb25vcy1idG4tZG9jcycpOwogICAgY29uc3QgdGVsZWZvbm9zQnRuRGV0YWlscyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0ZWxlZm9ub3MtYnRuLWRldGFpbHMnKTsKICAgIGNvbnN0IHRlbGVmb25vc0luaWNpb0J0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0ZWxlZm9ub3MtaW5pY2lvLWJ0bicpOwogICAgY29uc3QgYmFja0J0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdiYWNrLWJ0bicpOwogICAgY29uc3QgZWRpdG9yQmFja0J0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlZGl0b3ItYmFjay1idG4nKTsKICAgIGNvbnN0IGRldGFpbHNCYWNrQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RldGFpbHMtYmFjay1idG4nKTsKICAgIGNvbnN0IGluaWNpb0J0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbmljaW8tYnRuJyk7CiAgICAvLyBETkkgQ2FyZCBlbGVtZW50cwogICAgY29uc3Qgc29saWNpdGFyRG5pQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NvbGljaXRhci1kbmktYnRuJyk7CiAgICBjb25zdCBkbmlJbml0aWFsVmlldyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkbmktaW5pdGlhbC12aWV3Jyk7CiAgICBjb25zdCBkbmlTb2xpY2l0dWRWaWV3ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RuaS1zb2xpY2l0dWQtdmlldycpOwogICAgY29uc3QgZG5pQ2FyZEhlYWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkbmktY2FyZC1oZWFkZXInKTsKICAgIGNvbnN0IGRuaUNhcmRCb2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RuaS1jYXJkLWJvZHknKTsKICAgIGNvbnN0IGNvbmZpcm1hclNvbGljaXR1ZEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb25maXJtYXItc29saWNpdHVkLWJ0bicpOwogICAgY29uc3QgZG5pRGlnaXRhbERpc3BsYXkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZG5pLWRpZ2l0YWwtZGlzcGxheScpOwogICAgY29uc3QgbWFpbkRuaVByb2ZpbGVQaWMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFpbi1kbmktcHJvZmlsZS1waWMnKTsKICAgIGNvbnN0IG1haW5EbmlQcm9maWxlSW1hZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFpbi1kbmktcHJvZmlsZS1pbWFnZScpOwogICAgY29uc3QgdmVyRGV0YWxsZUJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd2ZXItZGV0YWxsZS1idG4nKTsKICAgIGNvbnN0IHZlckRuaURpZ2l0YWxCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmVyLWRuaS1kaWdpdGFsLWJ0bicpOwogICAgLy8gSGVhZGVyIGVsZW1lbnRzIGZvciBkeW5hbWljIGNvbnRlbnQKICAgIGNvbnN0IGRvY3VtZW50b3NIZWFkZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZG9jdW1lbnRvcy1oZWFkZXInKTsKICAgIGNvbnN0IGRvY3VtZW50b3NIZWFkZXJUaXRsZSA9IGRvY3VtZW50b3NIZWFkZXIucXVlcnlTZWxlY3RvcignaDInKTsKICAgIGNvbnN0IHJlZnJlc2hJY29uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlZnJlc2gtaWNvbicpOwogICAgY29uc3Qgd2VsY29tZU5hbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd2VsY29tZS1uYW1lJyk7CiAgICBjb25zdCBkbmlEaWdpdGFsVGl0bGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZG5pLWRpZ2l0YWwtdGl0bGUnKTsKICAgIGNvbnN0IHNvbGljaXR1ZERuaU5hbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc29saWNpdHVkLWRuaS1uYW1lJyk7CiAgICAvLyBFZGl0b3Igc2NyZWVuIGNvbnRyb2xzIChJbWFnZSkKICAgIGNvbnN0IGVkaXRvckRuaVByb2ZpbGVQaWMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWRpdG9yLWRuaS1wcm9maWxlLXBpYycpOwogICAgY29uc3QgZWRpdG9yRG5pUHJvZmlsZUltYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXRvci1kbmktcHJvZmlsZS1pbWFnZScpOwogICAgY29uc3QgaW1hZ2VVcmxJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbWFnZS11cmwtaW5wdXQnKTsKICAgIGNvbnN0IHRvcFNsaWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b3Atc2xpZGVyJyk7CiAgICBjb25zdCBsZWZ0U2xpZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xlZnQtc2xpZGVyJyk7CiAgICBjb25zdCB3aWR0aFNsaWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3aWR0aC1zbGlkZXInKTsKICAgIGNvbnN0IGhlaWdodFNsaWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZWlnaHQtc2xpZGVyJyk7CiAgICBjb25zdCB0b3BWYWx1ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b3AtdmFsdWUnKTsKICAgIGNvbnN0IGxlZnRWYWx1ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsZWZ0LXZhbHVlJyk7CiAgICBjb25zdCB3aWR0aFZhbHVlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3dpZHRoLXZhbHVlJyk7CiAgICBjb25zdCBoZWlnaHRWYWx1ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZWlnaHQtdmFsdWUnKTsKICAgIC8vIEVkaXRvciBzY3JlZW4gY29udHJvbHMgKFFSKQogICAgY29uc3QgbWFpbkRuaVFyUGljID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21haW4tZG5pLXFyLXBpYycpOwogICAgY29uc3QgbWFpbkRuaVFySW1hZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFpbi1kbmktcXItaW1hZ2UnKTsKICAgIGNvbnN0IGVkaXRvckRuaVFyUGljID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXRvci1kbmktcXItcGljJyk7CiAgICBjb25zdCBlZGl0b3JEbmlRckltYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXRvci1kbmktcXItaW1hZ2UnKTsKICAgIGNvbnN0IHFyVXJsSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXItdXJsLWlucHV0Jyk7CiAgICBjb25zdCBxclRvcFNsaWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxci10b3Atc2xpZGVyJyk7CiAgICBjb25zdCBxckxlZnRTbGlkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXItbGVmdC1zbGlkZXInKTsKICAgIGNvbnN0IHFyV2lkdGhTbGlkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXItd2lkdGgtc2xpZGVyJyk7CiAgICBjb25zdCBxckhlaWdodFNsaWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxci1oZWlnaHQtc2xpZGVyJyk7CiAgICBjb25zdCBxclRvcFZhbHVlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FyLXRvcC12YWx1ZScpOwogICAgY29uc3QgcXJMZWZ0VmFsdWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXItbGVmdC12YWx1ZScpOwogICAgY29uc3QgcXJXaWR0aFZhbHVlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FyLXdpZHRoLXZhbHVlJyk7CiAgICBjb25zdCBxckhlaWdodFZhbHVlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FyLWhlaWdodC12YWx1ZScpOwogICAgY29uc3QgZGV0YWlsc0JhcmNvZGVJbWFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZXRhaWxzLWJhcmNvZGUtaW1hZ2UnKTsKICAgIGNvbnN0IGRldGFpbHNQcm9maWxlSW1hZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGV0YWlscy1wcm9maWxlLWltYWdlJyk7CiAgICAvLyBFZGl0b3Igc2NyZWVuIGNvbnRyb2xzIChCYWNrIEltYWdlKQogICAgY29uc3QgbWFpbkRuaUJhY2tJbWFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYWluLWRuaS1iYWNrLWltYWdlJyk7CiAgICBjb25zdCBlZGl0b3JEbmlCYWNrSW1hZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWRpdG9yLWRuaS1iYWNrLWltYWdlJyk7CiAgICBjb25zdCBkbmlCYWNrVXJsSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZG5pLWJhY2stdXJsLWlucHV0Jyk7CiAgICAvLyBVc2VyIE1lbnUgRWxlbWVudHMKICAgIGNvbnN0IHVzZXJQcm9maWxlQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VzZXItcHJvZmlsZS1idG4nKTsKICAgIGNvbnN0IHByb2ZpbGVBcnJvdyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9maWxlLWFycm93Jyk7CiAgICBjb25zdCB1c2VyTWVudSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1c2VyLW1lbnUnKTsKICAgIGNvbnN0IG1lbnVFZGl0b3JCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWVudS1lZGl0b3ItYnRuJyk7CiAgICBjb25zdCBtZW51VXNlck5hbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWVudS11c2VyLW5hbWUnKTsKICAgIGNvbnN0IG1lbnVVc2VySWQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWVudS11c2VyLWlkJyk7CiAgICAvLyBFZGl0b3IgVXNlciBNYW5hZ2VtZW50CiAgICBjb25zdCBuZXdVc2VybmFtZUlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25ldy11c2VybmFtZS1pbnB1dCcpOwogICAgY29uc3QgbmV3UGFzc3dvcmRJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZXctcGFzc3dvcmQtaW5wdXQnKTsKICAgIGNvbnN0IG5ld1VzZXJSb2xlU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25ldy11c2VyLXJvbGUtc2VsZWN0Jyk7CiAgICBjb25zdCBzYXZlVXNlckJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzYXZlLXVzZXItYnRuJyk7CiAgICBjb25zdCB1c2VyTGlzdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1c2VyLWxpc3QnKTsKICAgIGNvbnN0IGltcG9ydFVzZXJzQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ltcG9ydC11c2Vycy1idG4nKTsKICAgIGNvbnN0IGltcG9ydFVzZXJzSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW1wb3J0LXVzZXJzLWlucHV0Jyk7CiAgICBjb25zdCBleHBvcnRVc2Vyc0J0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdleHBvcnQtdXNlcnMtYnRuJyk7CiAgICAvLyAtLS0gU3RhdGUgLS0tCiAgICBjb25zdCBVU0VSU19TVE9SQUdFX0tFWSA9ICdtaUFyZ2VudGluYVVzZXJzJzsKICAgIGxldCBjdXJyZW50bHlFZGl0aW5nVXNlciA9IG51bGw7CiAgICBsZXQgbG9nZ2VkSW5Vc2VyID0gbnVsbDsKICAgIGxldCBpc0ZsaXBwZWQgPSBmYWxzZTsKICAgIC8vIC0tLSBDb3JlIEFwcCBMb2dpYyAmIEZ1bmN0aW9ucyAtLS0KICAgIC8vIC0tLSBBUEkgU0lNVUxBVE9SIChmb3IgbGl2ZSBhcHApIC0tLQogICAgYXN5bmMgZnVuY3Rpb24gYXBpQ2FsbChhY3Rpb24sIHBheWxvYWQgPSB7fSkgewogICAgICAgIGNvbnNvbGUubG9nKGBBUEkgQ2FsbCAoU2ltdWxhdGVkKTogJHthY3Rpb259YCwgcGF5bG9hZCk7CiAgICAgICAgY29uc3QgZ2V0VXNlcnMgPSAoKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHVzZXJzSnNvbiA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKFVTRVJTX1NUT1JBR0VfS0VZKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHJldHVybiB1c2Vyc0pzb24gPyBKU09OLnBhcnNlKHVzZXJzSnNvbikgOiBbXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIFtdOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBjb25zdCBzYXZlVXNlcnMgPSAodXNlcnMpID0+IHsKICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oVVNFUlNfU1RPUkFHRV9LRVksIEpTT04uc3RyaW5naWZ5KHVzZXJzLCBudWxsLCAyKSk7CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoYWN0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnbG9naW4nOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgdXNlcm5hbWUsIHBhc3N3b3JkIH0gPSBwYXlsb2FkOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB1c2VycyA9IGdldFVzZXJzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGZvdW5kVXNlciA9IHVzZXJzLmZpbmQoKHUpID0+IHUudXNlcm5hbWUgPT09IHVzZXJuYW1lICYmIHUucGFzc3dvcmQgPT09IHBhc3N3b3JkKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZvdW5kVXNlcikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh7IHN1Y2Nlc3M6IHRydWUsIHVzZXI6IGZvdW5kVXNlciB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoeyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogJ1VzdWFyaW8gbyBjb250cmFzZcOxYSBpbmNvcnJlY3Rvcy4nIH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjYXNlICdnZXRfdXNlcnMnOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZ2V0VXNlcnMoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjYXNlICdzYXZlX3VzZXInOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCB1c2VycyA9IGdldFVzZXJzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgaXNFZGl0aW5nLCBjdXJyZW50bHlFZGl0aW5nVXNlciwgdXNlckRhdGEgfSA9IHBheWxvYWQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgdXNlcm5hbWUgfSA9IHVzZXJEYXRhOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB1c2VyRXhpc3RzID0gdXNlcnMuc29tZSgodSkgPT4gdS51c2VybmFtZSA9PT0gdXNlcm5hbWUgJiYgKCFpc0VkaXRpbmcgfHwgY3VycmVudGx5RWRpdGluZ1VzZXIgIT09IHVzZXJuYW1lKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1c2VyRXhpc3RzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IGBFbCBub21icmUgZGUgdXN1YXJpbyAiJHt1c2VybmFtZX0iIHlhIGV4aXN0ZS5gIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc0VkaXRpbmcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJzID0gdXNlcnMubWFwKCh1KSA9PiAodS51c2VybmFtZSA9PT0gY3VycmVudGx5RWRpdGluZ1VzZXIgPyB7IC4uLnUsIC4uLnVzZXJEYXRhLCBwYXNzd29yZDogdXNlckRhdGEucGFzc3dvcmQgfHwgdS5wYXNzd29yZCB9IDogdSkpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcnMucHVzaCh1c2VyRGF0YSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgc2F2ZVVzZXJzKHVzZXJzKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh7IHN1Y2Nlc3M6IHRydWUsIG1lc3NhZ2U6ICdVc3VhcmlvIGd1YXJkYWRvIGNvbiDDqXhpdG8uJyB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNhc2UgJ2RlbGV0ZV91c2VyJzogewogICAgICAgICAgICAgICAgICAgICAgICBsZXQgdXNlcnMgPSBnZXRVc2VycygpOwogICAgICAgICAgICAgICAgICAgICAgICB1c2VycyA9IHVzZXJzLmZpbHRlcigodSkgPT4gdS51c2VybmFtZSAhPT0gcGF5bG9hZC51c2VybmFtZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVVc2Vycyh1c2Vycyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoeyBzdWNjZXNzOiB0cnVlLCBtZXNzYWdlOiAnVXN1YXJpbyBlbGltaW5hZG8uJyB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNhc2UgJ2ltcG9ydF91c2Vycyc6IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZC51c2VycykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVVc2VycyhwYXlsb2FkLnVzZXJzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoeyBzdWNjZXNzOiB0cnVlLCBtZXNzYWdlOiAnVXN1YXJpb3MgaW1wb3J0YWRvcyBjb24gw6l4aXRvLicgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6ICdEYXRvcyBpbnbDoWxpZG9zLicgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdCh7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBgQWNjacOzbiBkZXNjb25vY2lkYTogJHthY3Rpb259YCB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgMjUwKTsKICAgICAgICB9KTsKICAgIH0KICAgIC8vIC0tLSBVc2VyIE1hbmFnZW1lbnQgJiBBdXRoIC0tLQogICAgZnVuY3Rpb24gdXBkYXRlVWlGb3JVc2VyUm9sZSgpIHsKICAgICAgICBjb25zdCBpc0FkbWluID0gbG9nZ2VkSW5Vc2VyPy5yb2xlID09PSAnYWRtaW4nOwogICAgICAgIGlmIChlZGl0b3JCdG4pCiAgICAgICAgICAgIGVkaXRvckJ0bi5zdHlsZS5kaXNwbGF5ID0gaXNBZG1pbiA/ICdmbGV4JyA6ICdub25lJzsKICAgICAgICBpZiAobWVudUVkaXRvckJ0bikKICAgICAgICAgICAgbWVudUVkaXRvckJ0bi5zdHlsZS5kaXNwbGF5ID0gaXNBZG1pbiA/ICdibG9jaycgOiAnbm9uZSc7CiAgICB9CiAgICBmdW5jdGlvbiBnYXRoZXJDdXJyZW50RG5pRGF0YSgpIHsKICAgICAgICBjb25zdCBkYXRhID0ge307CiAgICAgICAgY29uc3QgaW5wdXRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnI2VkaXRvci1zY3JlZW4gLmN1c3RvbS1pbnB1dCwgI2VkaXRvci1zY3JlZW4gaW5wdXRbdHlwZT0icmFuZ2UiXSwgI2VkaXRvci1zY3JlZW4gLmN1c3RvbS1zZWxlY3QnKTsKICAgICAgICBpbnB1dHMuZm9yRWFjaChpbnB1dCA9PiB7CiAgICAgICAgICAgIGNvbnN0IGVsID0gaW5wdXQ7CiAgICAgICAgICAgIGRhdGFbZWwuaWRdID0gZWwudmFsdWU7CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIGRhdGE7CiAgICB9CiAgICBmdW5jdGlvbiBhcHBseVVzZXJEYXRhKGRuaURhdGEpIHsKICAgICAgICBpZiAoIWRuaURhdGEpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBjb25zdCBpbnB1dHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcjZWRpdG9yLXNjcmVlbiAuY3VzdG9tLWlucHV0LCAjZWRpdG9yLXNjcmVlbiBpbnB1dFt0eXBlPSJyYW5nZSJdLCAjZWRpdG9yLXNjcmVlbiAuY3VzdG9tLXNlbGVjdCcpOwogICAgICAgIGlucHV0cy5mb3JFYWNoKGlucHV0ID0+IHsKICAgICAgICAgICAgY29uc3QgZWwgPSBpbnB1dDsKICAgICAgICAgICAgaWYgKGRuaURhdGFbZWwuaWRdICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIGVsLnZhbHVlID0gZG5pRGF0YVtlbC5pZF07CiAgICAgICAgICAgICAgICBlbC5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgnaW5wdXQnLCB7IGJ1YmJsZXM6IHRydWUgfSkpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CiAgICBhc3luYyBmdW5jdGlvbiBkZWxldGVVc2VyKHVzZXJuYW1lVG9EZWxldGUpIHsKICAgICAgICBpZiAoIWNvbmZpcm0oYMK/RXN0w6Egc2VndXJvIGRlIHF1ZSBkZXNlYSBlbGltaW5hciBhbCB1c3VhcmlvICIke3VzZXJuYW1lVG9EZWxldGV9Ij9gKSkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGFwaUNhbGwoJ2RlbGV0ZV91c2VyJywgeyB1c2VybmFtZTogdXNlcm5hbWVUb0RlbGV0ZSB9KTsKICAgICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHsKICAgICAgICAgICAgaWYgKHVzZXJuYW1lVG9EZWxldGUgPT09IGN1cnJlbnRseUVkaXRpbmdVc2VyKSB7CiAgICAgICAgICAgICAgICByZXNldFVzZXJGb3JtKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVuZGVyVXNlckxpc3QoKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGFsZXJ0KGBFcnJvcjogJHtyZXN1bHQubWVzc2FnZSB8fCAnTm8gc2UgcHVkbyBlbGltaW5hciBhbCB1c3VhcmlvLid9YCk7CiAgICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gcmVzZXRVc2VyRm9ybSgpIHsKICAgICAgICBuZXdVc2VybmFtZUlucHV0LnZhbHVlID0gJyc7CiAgICAgICAgbmV3UGFzc3dvcmRJbnB1dC52YWx1ZSA9ICcnOwogICAgICAgIGlmIChuZXdVc2VyUm9sZVNlbGVjdCkKICAgICAgICAgICAgbmV3VXNlclJvbGVTZWxlY3QudmFsdWUgPSAndXNlcic7CiAgICAgICAgc2F2ZVVzZXJCdG4udGV4dENvbnRlbnQgPSAnR3VhcmRhciBOdWV2byBVc3VhcmlvJzsKICAgICAgICBjdXJyZW50bHlFZGl0aW5nVXNlciA9IG51bGw7CiAgICB9CiAgICBhc3luYyBmdW5jdGlvbiByZW5kZXJVc2VyTGlzdCgpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBjb25zdCB1c2VycyA9IGF3YWl0IGFwaUNhbGwoJ2dldF91c2VycycpOwogICAgICAgICAgICB1c2VyTGlzdC5pbm5lckhUTUwgPSAnJzsgLy8gQ2xlYXIgY3VycmVudCBsaXN0CiAgICAgICAgICAgIGlmICghdXNlcnMgfHwgIUFycmF5LmlzQXJyYXkodXNlcnMpIHx8IHVzZXJzLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgdXNlckxpc3QuaW5uZXJIVE1MID0gJzxwIHN0eWxlPSJjb2xvcjogdmFyKC0tdGV4dC1saWdodCk7IHRleHQtYWxpZ246IGNlbnRlcjsiPk5vIGhheSB1c3VhcmlvcyBndWFyZGFkb3MuPC9wPic7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdXNlcnMuZm9yRWFjaCgodXNlcikgPT4gewogICAgICAgICAgICAgICAgY29uc3QgdXNlckl0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICAgICAgICAgIHVzZXJJdGVtLmNsYXNzTmFtZSA9ICd1c2VyLWxpc3QtaXRlbSc7CiAgICAgICAgICAgICAgICBjb25zdCB1c2VyTmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTsKICAgICAgICAgICAgICAgIHVzZXJOYW1lLmNsYXNzTmFtZSA9ICd1c2VyLWxpc3QtaXRlbS1uYW1lJzsKICAgICAgICAgICAgICAgIHVzZXJOYW1lLnRleHRDb250ZW50ID0gYCR7dXNlci51c2VybmFtZX0gKCR7dXNlci5yb2xlIHx8ICd1c2VyJ30pYDsKICAgICAgICAgICAgICAgIGNvbnN0IGFjdGlvbnNDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICAgICAgICAgIGFjdGlvbnNDb250YWluZXIuY2xhc3NOYW1lID0gJ3VzZXItbGlzdC1pdGVtLWFjdGlvbnMnOwogICAgICAgICAgICAgICAgY29uc3QgZWRpdEJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpOwogICAgICAgICAgICAgICAgZWRpdEJ0bi50ZXh0Q29udGVudCA9ICdFZGl0YXInOwogICAgICAgICAgICAgICAgZWRpdEJ0bi5jbGFzc05hbWUgPSAnZWRpdC1idG4nOwogICAgICAgICAgICAgICAgZWRpdEJ0bi5vbmNsaWNrID0gKCkgPT4gewogICAgICAgICAgICAgICAgICAgIGFwcGx5VXNlckRhdGEodXNlci5kbmlEYXRhKTsKICAgICAgICAgICAgICAgICAgICBuZXdVc2VybmFtZUlucHV0LnZhbHVlID0gdXNlci51c2VybmFtZTsKICAgICAgICAgICAgICAgICAgICBuZXdQYXNzd29yZElucHV0LnZhbHVlID0gJyc7IC8vIERvbid0IHNob3cgcGFzc3dvcmQKICAgICAgICAgICAgICAgICAgICBuZXdQYXNzd29yZElucHV0LnBsYWNlaG9sZGVyID0gIkRlamFyIGVuIGJsYW5jbyBwYXJhIG5vIGNhbWJpYXIiOwogICAgICAgICAgICAgICAgICAgIGlmIChuZXdVc2VyUm9sZVNlbGVjdCkKICAgICAgICAgICAgICAgICAgICAgICAgbmV3VXNlclJvbGVTZWxlY3QudmFsdWUgPSB1c2VyLnJvbGUgfHwgJ3VzZXInOwogICAgICAgICAgICAgICAgICAgIHNhdmVVc2VyQnRuLnRleHRDb250ZW50ID0gJ0FjdHVhbGl6YXIgVXN1YXJpbyc7CiAgICAgICAgICAgICAgICAgICAgY3VycmVudGx5RWRpdGluZ1VzZXIgPSB1c2VyLnVzZXJuYW1lOwogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5zY3JvbGxUbygwLCAwKTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBjb25zdCBkZWxldGVCdG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTsKICAgICAgICAgICAgICAgIGRlbGV0ZUJ0bi50ZXh0Q29udGVudCA9ICdFbGltaW5hcic7CiAgICAgICAgICAgICAgICBkZWxldGVCdG4uY2xhc3NOYW1lID0gJ2RlbGV0ZS1idG4nOwogICAgICAgICAgICAgICAgZGVsZXRlQnRuLm9uY2xpY2sgPSAoKSA9PiBkZWxldGVVc2VyKHVzZXIudXNlcm5hbWUpOwogICAgICAgICAgICAgICAgYWN0aW9uc0NvbnRhaW5lci5hcHBlbmRDaGlsZChlZGl0QnRuKTsKICAgICAgICAgICAgICAgIGFjdGlvbnNDb250YWluZXIuYXBwZW5kQ2hpbGQoZGVsZXRlQnRuKTsKICAgICAgICAgICAgICAgIHVzZXJJdGVtLmFwcGVuZENoaWxkKHVzZXJOYW1lKTsKICAgICAgICAgICAgICAgIHVzZXJJdGVtLmFwcGVuZENoaWxkKGFjdGlvbnNDb250YWluZXIpOwogICAgICAgICAgICAgICAgdXNlckxpc3QuYXBwZW5kQ2hpbGQodXNlckl0ZW0pOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIGZldGNoaW5nIHVzZXJzOiIsIGVycm9yKTsKICAgICAgICAgICAgdXNlckxpc3QuaW5uZXJIVE1MID0gJzxwIHN0eWxlPSJjb2xvcjogcmVkOyB0ZXh0LWFsaWduOiBjZW50ZXI7Ij5FcnJvciBhbCBjYXJnYXIgbGEgbGlzdGEgZGUgdXN1YXJpb3MuPC9wPic7CiAgICAgICAgfQogICAgfQogICAgLy8gLS0tIFVJIEhlbHBlcnMgLS0tCiAgICBmdW5jdGlvbiBzZXR1cFNsaWRlcihzbGlkZXIsIHRhcmdldHMsIHByb3BlcnR5LCB2YWx1ZVNwYW4sIHVuaXQgPSAnJScpIHsKICAgICAgICBpZiAoc2xpZGVyICYmIHRhcmdldHMgJiYgdGFyZ2V0cy5sZW5ndGggPiAwICYmIHZhbHVlU3BhbikgewogICAgICAgICAgICBjb25zdCB1cGRhdGUgPSAoKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHNsaWRlci52YWx1ZTsKICAgICAgICAgICAgICAgIHRhcmdldHMuZm9yRWFjaCh0YXJnZXQgPT4gewogICAgICAgICAgICAgICAgICAgIGlmICh0YXJnZXQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0LnN0eWxlW3Byb3BlcnR5XSA9IGAke3ZhbHVlfSR7dW5pdH1gOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgdmFsdWVTcGFuLnRleHRDb250ZW50ID0gdmFsdWU7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHNsaWRlci5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIHVwZGF0ZSk7CiAgICAgICAgICAgIHVwZGF0ZSgpOyAvLyBTZXQgaW5pdGlhbCB2YWx1ZQogICAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIHVwZGF0ZUR5bmFtaWNIZWFkZXJEYXRhKCkgewogICAgICAgIGNvbnN0IGFwZWxsaWRvSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYXBlbGxpZG8taW5wdXQnKTsKICAgICAgICBjb25zdCBub21icmVJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdub21icmUtaW5wdXQnKTsKICAgICAgICBjb25zdCBjdWlsSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3VpbC1pbnB1dCcpOwogICAgICAgIGlmIChhcGVsbGlkb0lucHV0ICYmIG5vbWJyZUlucHV0ICYmIGN1aWxJbnB1dCkgewogICAgICAgICAgICBjb25zdCBhcGVsbGlkbyA9IGFwZWxsaWRvSW5wdXQudmFsdWU7CiAgICAgICAgICAgIGNvbnN0IG5vbWJyZSA9IG5vbWJyZUlucHV0LnZhbHVlOwogICAgICAgICAgICBjb25zdCBjdWlsID0gY3VpbElucHV0LnZhbHVlOwogICAgICAgICAgICBjb25zdCBkcm9wZG93bk5hbWUgPSBgJHtub21icmV9ICR7YXBlbGxpZG99YDsKICAgICAgICAgICAgY29uc3QgZG5pVGl0bGVOYW1lID0gYCR7YXBlbGxpZG99ICR7bm9tYnJlfWA7CiAgICAgICAgICAgIGNvbnN0IG1lbnVOYW1lID0gYCR7bm9tYnJlfSAke2FwZWxsaWRvfWA7CiAgICAgICAgICAgIGlmICh3ZWxjb21lTmFtZSkKICAgICAgICAgICAgICAgIHdlbGNvbWVOYW1lLnRleHRDb250ZW50ID0gbm9tYnJlOwogICAgICAgICAgICBpZiAoZG5pRGlnaXRhbFRpdGxlKQogICAgICAgICAgICAgICAgZG5pRGlnaXRhbFRpdGxlLnRleHRDb250ZW50ID0gZG5pVGl0bGVOYW1lOwogICAgICAgICAgICBpZiAoc29saWNpdHVkRG5pTmFtZSkKICAgICAgICAgICAgICAgIHNvbGljaXR1ZERuaU5hbWUudGV4dENvbnRlbnQgPSBkcm9wZG93bk5hbWU7CiAgICAgICAgICAgIGlmIChtZW51VXNlck5hbWUpCiAgICAgICAgICAgICAgICBtZW51VXNlck5hbWUudGV4dENvbnRlbnQgPSBtZW51TmFtZTsKICAgICAgICAgICAgaWYgKG1lbnVVc2VySWQpCiAgICAgICAgICAgICAgICBtZW51VXNlcklkLnRleHRDb250ZW50ID0gY3VpbDsKICAgICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBzZXR1cFRleHRDb250cm9sKGZpZWxkKSB7CiAgICAgICAgY29uc3QgdGV4dElucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYCR7ZmllbGR9LWlucHV0YCk7CiAgICAgICAgY29uc3QgdG9wU2xpZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYCR7ZmllbGR9LXRvcC1zbGlkZXJgKTsKICAgICAgICBjb25zdCBsZWZ0U2xpZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYCR7ZmllbGR9LWxlZnQtc2xpZGVyYCk7CiAgICAgICAgY29uc3QgZm9udHNpemVTbGlkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgJHtmaWVsZH0tZm9udHNpemUtc2xpZGVyYCk7CiAgICAgICAgY29uc3QgZm9udFNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGAke2ZpZWxkfS1mb250LXNlbGVjdGApOwogICAgICAgIGNvbnN0IHRvcFZhbHVlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYCR7ZmllbGR9LXRvcC12YWx1ZWApOwogICAgICAgIGNvbnN0IGxlZnRWYWx1ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGAke2ZpZWxkfS1sZWZ0LXZhbHVlYCk7CiAgICAgICAgY29uc3QgZm9udHNpemVWYWx1ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGAke2ZpZWxkfS1mb250c2l6ZS12YWx1ZWApOwogICAgICAgIGNvbnN0IG1haW5UYXJnZXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgbWFpbi1kbmktJHtmaWVsZH1gKTsKICAgICAgICBjb25zdCBlZGl0b3JUYXJnZXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgZWRpdG9yLWRuaS0ke2ZpZWxkfWApOwogICAgICAgIGNvbnN0IHRhcmdldHMgPSBbbWFpblRhcmdldCwgZWRpdG9yVGFyZ2V0XS5maWx0ZXIoZWwgPT4gZWwpOwogICAgICAgIGlmICh0ZXh0SW5wdXQgJiYgdGFyZ2V0cy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZSA9ICgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IG5ld1ZhbHVlID0gdGV4dElucHV0LnZhbHVlOwogICAgICAgICAgICAgICAgdGFyZ2V0cy5mb3JFYWNoKHRhcmdldCA9PiB0YXJnZXQudGV4dENvbnRlbnQgPSBuZXdWYWx1ZSk7CiAgICAgICAgICAgICAgICBpZiAoZmllbGQgPT09ICdub21icmUnIHx8IGZpZWxkID09PSAnYXBlbGxpZG8nIHx8IGZpZWxkID09PSAnY3VpbCcpIHsKICAgICAgICAgICAgICAgICAgICB1cGRhdGVEeW5hbWljSGVhZGVyRGF0YSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgICB0ZXh0SW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCB1cGRhdGUpOwogICAgICAgICAgICB1cGRhdGUoKTsKICAgICAgICB9CiAgICAgICAgc2V0dXBTbGlkZXIodG9wU2xpZGVyLCB0YXJnZXRzLCAndG9wJywgdG9wVmFsdWUsICclJyk7CiAgICAgICAgc2V0dXBTbGlkZXIobGVmdFNsaWRlciwgdGFyZ2V0cywgJ2xlZnQnLCBsZWZ0VmFsdWUsICclJyk7CiAgICAgICAgc2V0dXBTbGlkZXIoZm9udHNpemVTbGlkZXIsIHRhcmdldHMsICdmb250U2l6ZScsIGZvbnRzaXplVmFsdWUsICdweCcpOwogICAgICAgIGlmIChmb250U2VsZWN0ICYmIHRhcmdldHMubGVuZ3RoID4gMCkgewogICAgICAgICAgICBjb25zdCB1cGRhdGUgPSAoKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBuZXdGb250ID0gZm9udFNlbGVjdC52YWx1ZTsKICAgICAgICAgICAgICAgIHRhcmdldHMuZm9yRWFjaCh0YXJnZXQgPT4gewogICAgICAgICAgICAgICAgICAgIGlmICh0YXJnZXQpCiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldC5zdHlsZS5mb250RmFtaWx5ID0gbmV3Rm9udDsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9OwogICAgICAgICAgICBmb250U2VsZWN0LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgdXBkYXRlKTsKICAgICAgICAgICAgdXBkYXRlKCk7CiAgICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gcmVzZXREbmlDYXJkKCkgewogICAgICAgIGlmIChkbmlDYXJkSGVhZGVyKQogICAgICAgICAgICBkbmlDYXJkSGVhZGVyLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7CiAgICAgICAgaWYgKGRuaUluaXRpYWxWaWV3KQogICAgICAgICAgICBkbmlJbml0aWFsVmlldy5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICBpZiAoZG5pU29saWNpdHVkVmlldykKICAgICAgICAgICAgZG5pU29saWNpdHVkVmlldy5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgIGlmIChkbmlEaWdpdGFsRGlzcGxheSkKICAgICAgICAgICAgZG5pRGlnaXRhbERpc3BsYXkuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICBpZiAoZG5pQ2FyZEJvZHkpCiAgICAgICAgICAgIGRuaUNhcmRCb2R5LmNsYXNzTGlzdC5yZW1vdmUoJ25vLWhlYWRlcicpOwogICAgICAgIGlmIChkb2N1bWVudG9zSGVhZGVyVGl0bGUpCiAgICAgICAgICAgIGRvY3VtZW50b3NIZWFkZXJUaXRsZS50ZXh0Q29udGVudCA9ICdEb2N1bWVudG9zJzsKICAgICAgICBpZiAocmVmcmVzaEljb24pCiAgICAgICAgICAgIHJlZnJlc2hJY29uLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgaWYgKGRvY3VtZW50b3NIZWFkZXIpCiAgICAgICAgICAgIGRvY3VtZW50b3NIZWFkZXIuc3R5bGUuanVzdGlmeUNvbnRlbnQgPSAnZmxleC1zdGFydCc7CiAgICAgICAgY29uc3QgZG5pRmxpcHBlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkbmktZmxpcHBlcicpOwogICAgICAgIGlmIChkbmlGbGlwcGVyICYmIGlzRmxpcHBlZCkgewogICAgICAgICAgICBkbmlGbGlwcGVyLnN0eWxlLnRyYW5zaXRpb24gPSAndHJhbnNmb3JtIDAuNnMgY3ViaWMtYmV6aWVyKDAuMzQsIDEuNTYsIDAuNjQsIDEpJzsKICAgICAgICAgICAgZG5pRmxpcHBlci5zdHlsZS50cmFuc2Zvcm0gPSAncm90YXRlWSgwZGVnKSc7CiAgICAgICAgfQogICAgICAgIGlzRmxpcHBlZCA9IGZhbHNlOwogICAgfQogICAgZnVuY3Rpb24gc2hvd1NjcmVlbihzY3JlZW5OYW1lKSB7CiAgICAgICAgW2xvZ2luU2NyZWVuLCBtYWluU2NyZWVuLCBkb2N1bWVudG9zU2NyZWVuLCBlZGl0b3JTY3JlZW4sIGRuaURldGFpbHNTY3JlZW4sIHRlbGVmb25vc1NjcmVlbl0uZm9yRWFjaChzID0+IHMuc3R5bGUuZGlzcGxheSA9ICdub25lJyk7CiAgICAgICAgaWYgKGJvdHRvbU5hdikKICAgICAgICAgICAgYm90dG9tTmF2LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgc3dpdGNoIChzY3JlZW5OYW1lKSB7CiAgICAgICAgICAgIGNhc2UgJ2xvZ2luJzoKICAgICAgICAgICAgICAgIGxvZ2luU2NyZWVuLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAnbWFpbic6CiAgICAgICAgICAgICAgICBtYWluU2NyZWVuLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7CiAgICAgICAgICAgICAgICByZXNldERuaUNhcmQoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdkb2N1bWVudG9zJzoKICAgICAgICAgICAgICAgIGRvY3VtZW50b3NTY3JlZW4uc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsKICAgICAgICAgICAgICAgIGlmIChib3R0b21OYXYpCiAgICAgICAgICAgICAgICAgICAgYm90dG9tTmF2LnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAnZWRpdG9yJzoKICAgICAgICAgICAgICAgIGlmIChsb2dnZWRJblVzZXI/LnJvbGUgPT09ICdhZG1pbicpIHsKICAgICAgICAgICAgICAgICAgICBlZGl0b3JTY3JlZW4uc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIGFsZXJ0KCdBY2Nlc28gZGVuZWdhZG8uIFNlIHJlcXVpZXJlbiBwZXJtaXNvcyBkZSBhZG1pbmlzdHJhZG9yLicpOwogICAgICAgICAgICAgICAgICAgIHNob3dTY3JlZW4oJ21haW4nKTsgLy8gUmVkaXJlY3QgdG8gYSBzYWZlIHNjcmVlbgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ2RldGFpbHMnOgogICAgICAgICAgICAgICAgZG5pRGV0YWlsc1NjcmVlbi5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ3RlbGVmb25vcyc6CiAgICAgICAgICAgICAgICB0ZWxlZm9ub3NTY3JlZW4uc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIHNob3dEbmlEaWdpdGFsVmlldygpIHsKICAgICAgICBpZiAoZG5pSW5pdGlhbFZpZXcpCiAgICAgICAgICAgIGRuaUluaXRpYWxWaWV3LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgaWYgKGRuaVNvbGljaXR1ZFZpZXcpCiAgICAgICAgICAgIGRuaVNvbGljaXR1ZFZpZXcuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICBpZiAoZG5pRGlnaXRhbERpc3BsYXkpCiAgICAgICAgICAgIGRuaURpZ2l0YWxEaXNwbGF5LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgIGlmIChkbmlDYXJkSGVhZGVyKQogICAgICAgICAgICBkbmlDYXJkSGVhZGVyLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgaWYgKGRuaUNhcmRCb2R5KQogICAgICAgICAgICBkbmlDYXJkQm9keS5jbGFzc0xpc3QuYWRkKCduby1oZWFkZXInKTsKICAgICAgICBpZiAoZG9jdW1lbnRvc0hlYWRlclRpdGxlKQogICAgICAgICAgICBkb2N1bWVudG9zSGVhZGVyVGl0bGUudGV4dENvbnRlbnQgPSAnRE5JIERpZ2l0YWwnOwogICAgICAgIGlmIChyZWZyZXNoSWNvbikKICAgICAgICAgICAgcmVmcmVzaEljb24uc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgaWYgKGRvY3VtZW50b3NIZWFkZXIpCiAgICAgICAgICAgIGRvY3VtZW50b3NIZWFkZXIuc3R5bGUuanVzdGlmeUNvbnRlbnQgPSAnc3BhY2UtYmV0d2Vlbic7CiAgICB9CiAgICBmdW5jdGlvbiBwb3B1bGF0ZURuaURldGFpbHMoKSB7CiAgICAgICAgY29uc3QgZG5pID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RvY3VtZW50by1pbnB1dCcpLnZhbHVlOwogICAgICAgIGNvbnN0IHRyYW1pdGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndHJhbWl0ZS1pbnB1dCcpLnZhbHVlOwogICAgICAgIGNvbnN0IGVtaXNpb24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZW1pc2lvbi1pbnB1dCcpLnZhbHVlOwogICAgICAgIGNvbnN0IHZlbmNpbWllbnRvID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ZlbmNpbWllbnRvLWlucHV0JykudmFsdWU7CiAgICAgICAgY29uc3Qgbm9tYnJlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25vbWJyZS1pbnB1dCcpLnZhbHVlOwogICAgICAgIGNvbnN0IGFwZWxsaWRvID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FwZWxsaWRvLWlucHV0JykudmFsdWU7CiAgICAgICAgY29uc3Qgc2V4byA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZXhvLWlucHV0JykudmFsdWU7CiAgICAgICAgY29uc3QgbmFjaW1pZW50byA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduYWNpbWllbnRvLWlucHV0JykudmFsdWU7CiAgICAgICAgY29uc3QgZG9taWNpbGlvID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RvbWljaWxpby1pbnB1dCcpLnZhbHVlOwogICAgICAgIGNvbnN0IGN1aWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3VpbC1pbnB1dCcpLnZhbHVlOwogICAgICAgIGNvbnN0IG5hY2lvbmFsaWRhZCA9ICdBUic7CiAgICAgICAgY29uc3QgbHVnYXJOYWNpbWllbnRvID0gJ0FSR0VOVElOQSc7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RldGFpbHMtZG5pJykudGV4dENvbnRlbnQgPSBkbmk7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RldGFpbHMtdHJhbWl0ZScpLnRleHRDb250ZW50ID0gdHJhbWl0ZTsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGV0YWlscy1lbWlzaW9uJykudGV4dENvbnRlbnQgPSBlbWlzaW9uOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZXRhaWxzLXZlbmNpbWllbnRvJykudGV4dENvbnRlbnQgPSB2ZW5jaW1pZW50bzsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGV0YWlscy1ub21icmUnKS50ZXh0Q29udGVudCA9IG5vbWJyZTsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGV0YWlscy1hcGVsbGlkbycpLnRleHRDb250ZW50ID0gYXBlbGxpZG87CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RldGFpbHMtY3VpbCcpLnRleHRDb250ZW50ID0gY3VpbDsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGV0YWlscy1zZXhvJykudGV4dENvbnRlbnQgPSBzZXhvOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZXRhaWxzLW5hY2ltaWVudG8nKS50ZXh0Q29udGVudCA9IG5hY2ltaWVudG87CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RldGFpbHMtbmFjaW9uYWxpZGFkJykudGV4dENvbnRlbnQgPSBuYWNpb25hbGlkYWQ7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RldGFpbHMtbHVnYXItbmFjaW1pZW50bycpLnRleHRDb250ZW50ID0gbHVnYXJOYWNpbWllbnRvOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZXRhaWxzLWRvbWljaWxpbycpLnRleHRDb250ZW50ID0gZG9taWNpbGlvOwogICAgfQogICAgLy8gLS0tIEZsaXBwZXIgJiBDYXJvdXNlbCBIZWxwZXJzIC0tLQogICAgZnVuY3Rpb24gc2V0dXBGbGlwcGVyKGNvbnRhaW5lciwgZmxpcHBlcikgewogICAgICAgIGlmICghY29udGFpbmVyIHx8ICFmbGlwcGVyKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgbGV0IGlzRHJhZ2dpbmcgPSBmYWxzZSwgc3RhcnRYID0gMCwgc3RhcnRBbmdsZSA9IDAsIGN1cnJlbnRBbmdsZSA9IDA7CiAgICAgICAgY29uc3QgZ2V0RXZlbnRYID0gKGUpID0+IGUudHlwZS5pbmNsdWRlcygnbW91c2UnKSA/IGUuc2NyZWVuWCA6IGUuY2hhbmdlZFRvdWNoZXNbMF0uc2NyZWVuWDsKICAgICAgICBjb25zdCBoYW5kbGVEcmFnU3RhcnQgPSAoZSkgPT4gewogICAgICAgICAgICBpZiAoZS50eXBlID09PSAnbW91c2Vkb3duJyAmJiBlLmJ1dHRvbiAhPT0gMCkKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgaXNEcmFnZ2luZyA9IHRydWU7CiAgICAgICAgICAgIHN0YXJ0WCA9IGdldEV2ZW50WChlKTsKICAgICAgICAgICAgc3RhcnRBbmdsZSA9IGN1cnJlbnRBbmdsZTsKICAgICAgICAgICAgZmxpcHBlci5zdHlsZS50cmFuc2l0aW9uID0gJ25vbmUnOwogICAgICAgICAgICBpZiAoZS50eXBlICE9PSAndG91Y2hzdGFydCcpCiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgfTsKICAgICAgICBjb25zdCBoYW5kbGVEcmFnTW92ZSA9IChlKSA9PiB7CiAgICAgICAgICAgIGlmICghaXNEcmFnZ2luZykKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBjb25zdCBkZWx0YVggPSBnZXRFdmVudFgoZSkgLSBzdGFydFg7CiAgICAgICAgICAgIGNvbnN0IHJvdGF0aW9uU2Vuc2l0aXZpdHkgPSAxODAgLyBjb250YWluZXIub2Zmc2V0V2lkdGg7CiAgICAgICAgICAgIGN1cnJlbnRBbmdsZSA9IHN0YXJ0QW5nbGUgKyAoZGVsdGFYICogcm90YXRpb25TZW5zaXRpdml0eSk7CiAgICAgICAgICAgIGZsaXBwZXIuc3R5bGUudHJhbnNmb3JtID0gYHJvdGF0ZVkoJHtjdXJyZW50QW5nbGV9ZGVnKWA7CiAgICAgICAgfTsKICAgICAgICBjb25zdCBoYW5kbGVEcmFnRW5kID0gKCkgPT4gewogICAgICAgICAgICBpZiAoIWlzRHJhZ2dpbmcpCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGlzRHJhZ2dpbmcgPSBmYWxzZTsKICAgICAgICAgICAgZmxpcHBlci5zdHlsZS50cmFuc2l0aW9uID0gJ3RyYW5zZm9ybSAwLjZzIGN1YmljLWJlemllcigwLjM0LCAxLjU2LCAwLjY0LCAxKSc7CiAgICAgICAgICAgIGNvbnN0IGZpbmFsUm90YXRpb24gPSBNYXRoLnJvdW5kKGN1cnJlbnRBbmdsZSAvIDE4MCkgKiAxODA7CiAgICAgICAgICAgIGlmIChjb250YWluZXIuaWQuaW5jbHVkZXMoJ21haW4tZG5pJykpIHsKICAgICAgICAgICAgICAgIGlzRmxpcHBlZCA9IChNYXRoLnJvdW5kKGZpbmFsUm90YXRpb24gLyAxODApICUgMikgIT09IDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZmxpcHBlci5zdHlsZS50cmFuc2Zvcm0gPSBgcm90YXRlWSgke2ZpbmFsUm90YXRpb259ZGVnKWA7CiAgICAgICAgICAgIGN1cnJlbnRBbmdsZSA9IGZpbmFsUm90YXRpb247CiAgICAgICAgfTsKICAgICAgICBjb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgaGFuZGxlRHJhZ1N0YXJ0KTsKICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCBoYW5kbGVEcmFnTW92ZSk7CiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIGhhbmRsZURyYWdFbmQpOwogICAgICAgIGNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgaGFuZGxlRHJhZ1N0YXJ0LCB7IHBhc3NpdmU6IGZhbHNlIH0pOwogICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNobW92ZScsIGhhbmRsZURyYWdNb3ZlLCB7IHBhc3NpdmU6IGZhbHNlIH0pOwogICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgaGFuZGxlRHJhZ0VuZCk7CiAgICB9CiAgICBmdW5jdGlvbiBzZXR1cENhcm91c2VsKCkgewogICAgICAgIGNvbnN0IGNhcm91c2VsV3JhcHBlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlZGl0b3ItY2Fyb3VzZWwtd3JhcHBlcicpOwogICAgICAgIGNvbnN0IGNhcm91c2VsVHJhY2sgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWRpdG9yLWNhcm91c2VsLXRyYWNrJyk7CiAgICAgICAgY29uc3Qgc2xpZGVzID0gY2Fyb3VzZWxUcmFjayA/IEFycmF5LmZyb20oY2Fyb3VzZWxUcmFjay5jaGlsZHJlbikgOiBbXTsKICAgICAgICBjb25zdCBkb3RzQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXRvci1jYXJvdXNlbC1kb3RzJyk7CiAgICAgICAgaWYgKGNhcm91c2VsV3JhcHBlciAmJiBjYXJvdXNlbFRyYWNrICYmIHNsaWRlcy5sZW5ndGggPiAwICYmIGRvdHNDb250YWluZXIpIHsKICAgICAgICAgICAgbGV0IGN1cnJlbnRJbmRleCA9IDAsIGlzRHJhZ2dpbmcgPSBmYWxzZSwgc3RhcnRQb3MgPSAwLCBjdXJyZW50VHJhbnNsYXRlID0gMCwgcHJldlRyYW5zbGF0ZSA9IDAsIGFuaW1hdGlvbklEOwogICAgICAgICAgICBjb25zdCBzbGlkZVdpZHRoID0gKCkgPT4gc2xpZGVzWzBdLm9mZnNldFdpZHRoOwogICAgICAgICAgICBkb3RzQ29udGFpbmVyLmlubmVySFRNTCA9ICcnOwogICAgICAgICAgICBzbGlkZXMuZm9yRWFjaCgoXywgaSkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgZG90ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpOwogICAgICAgICAgICAgICAgZG90LmNsYXNzTGlzdC5hZGQoJ2Nhcm91c2VsLWRvdCcpOwogICAgICAgICAgICAgICAgaWYgKGkgPT09IDApCiAgICAgICAgICAgICAgICAgICAgZG90LmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgZG90LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gZ29Ub1NsaWRlKGkpKTsKICAgICAgICAgICAgICAgIGRvdHNDb250YWluZXIuYXBwZW5kQ2hpbGQoZG90KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGNvbnN0IGRvdHMgPSBBcnJheS5mcm9tKGRvdHNDb250YWluZXIuY2hpbGRyZW4pOwogICAgICAgICAgICBmdW5jdGlvbiBnb1RvU2xpZGUoc2xpZGVJbmRleCkgewogICAgICAgICAgICAgICAgaWYgKHNsaWRlSW5kZXggPCAwIHx8IHNsaWRlSW5kZXggPj0gc2xpZGVzLmxlbmd0aCkKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICBjb25zdCBvZmZzZXQgPSAtc2xpZGVJbmRleCAqIHNsaWRlV2lkdGgoKTsKICAgICAgICAgICAgICAgIGNhcm91c2VsVHJhY2suc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZVgoJHtvZmZzZXR9cHgpYDsKICAgICAgICAgICAgICAgIGNhcm91c2VsVHJhY2suc3R5bGUudHJhbnNpdGlvbiA9ICd0cmFuc2Zvcm0gMC4zcyBlYXNlLWluLW91dCc7CiAgICAgICAgICAgICAgICBjdXJyZW50SW5kZXggPSBzbGlkZUluZGV4OwogICAgICAgICAgICAgICAgZG90cy5mb3JFYWNoKChkb3QsIGkpID0+IGRvdC5jbGFzc0xpc3QudG9nZ2xlKCdhY3RpdmUnLCBpID09PSBjdXJyZW50SW5kZXgpKTsKICAgICAgICAgICAgICAgIHByZXZUcmFuc2xhdGUgPSBvZmZzZXQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgZ2V0UG9zaXRpb25YID0gKGUpID0+IGUudHlwZS5pbmNsdWRlcygnbW91c2UnKSA/IGUucGFnZVggOiBlLnRvdWNoZXNbMF0uY2xpZW50WDsKICAgICAgICAgICAgY29uc3QgdG91Y2hTdGFydCA9IChlKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoZS50YXJnZXQuY2xvc2VzdCgnLmNvbnRyb2wtZ3JvdXAnKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICBpc0RyYWdnaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHN0YXJ0UG9zID0gZ2V0UG9zaXRpb25YKGUpOwogICAgICAgICAgICAgICAgYW5pbWF0aW9uSUQgPSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0aW9uKTsKICAgICAgICAgICAgICAgIGNhcm91c2VsVHJhY2suc3R5bGUudHJhbnNpdGlvbiA9ICdub25lJzsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgY29uc3QgdG91Y2hNb3ZlID0gKGUpID0+IHsKICAgICAgICAgICAgICAgIGlmIChpc0RyYWdnaW5nKQogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRUcmFuc2xhdGUgPSBwcmV2VHJhbnNsYXRlICsgZ2V0UG9zaXRpb25YKGUpIC0gc3RhcnRQb3M7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGNvbnN0IHRvdWNoRW5kID0gKCkgPT4gewogICAgICAgICAgICAgICAgaWYgKCFpc0RyYWdnaW5nKQogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIGlzRHJhZ2dpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgIGNhbmNlbEFuaW1hdGlvbkZyYW1lKGFuaW1hdGlvbklEKTsKICAgICAgICAgICAgICAgIGNvbnN0IG1vdmVkQnkgPSBjdXJyZW50VHJhbnNsYXRlIC0gcHJldlRyYW5zbGF0ZTsKICAgICAgICAgICAgICAgIGlmIChtb3ZlZEJ5IDwgLTEwMCAmJiBjdXJyZW50SW5kZXggPCBzbGlkZXMubGVuZ3RoIC0gMSkKICAgICAgICAgICAgICAgICAgICBjdXJyZW50SW5kZXgrKzsKICAgICAgICAgICAgICAgIGlmIChtb3ZlZEJ5ID4gMTAwICYmIGN1cnJlbnRJbmRleCA+IDApCiAgICAgICAgICAgICAgICAgICAgY3VycmVudEluZGV4LS07CiAgICAgICAgICAgICAgICBnb1RvU2xpZGUoY3VycmVudEluZGV4KTsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgZnVuY3Rpb24gYW5pbWF0aW9uKCkgewogICAgICAgICAgICAgICAgY2Fyb3VzZWxUcmFjay5zdHlsZS50cmFuc2Zvcm0gPSBgdHJhbnNsYXRlWCgke2N1cnJlbnRUcmFuc2xhdGV9cHgpYDsKICAgICAgICAgICAgICAgIGlmIChpc0RyYWdnaW5nKQogICAgICAgICAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRpb24pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHNsaWRlcy5mb3JFYWNoKHNsaWRlID0+IHsKICAgICAgICAgICAgICAgIFsndG91Y2hzdGFydCcsICdtb3VzZWRvd24nXS5mb3JFYWNoKGV2dCA9PiBzbGlkZS5hZGRFdmVudExpc3RlbmVyKGV2dCwgdG91Y2hTdGFydCkpOwogICAgICAgICAgICAgICAgWyd0b3VjaGVuZCcsICdtb3VzZXVwJywgJ21vdXNlbGVhdmUnXS5mb3JFYWNoKGV2dCA9PiBzbGlkZS5hZGRFdmVudExpc3RlbmVyKGV2dCwgdG91Y2hFbmQpKTsKICAgICAgICAgICAgICAgIFsndG91Y2htb3ZlJywgJ21vdXNlbW92ZSddLmZvckVhY2goZXZ0ID0+IHNsaWRlLmFkZEV2ZW50TGlzdGVuZXIoZXZ0LCB0b3VjaE1vdmUpKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIG5ldyBSZXNpemVPYnNlcnZlcigoKSA9PiBnb1RvU2xpZGUoY3VycmVudEluZGV4KSkub2JzZXJ2ZShjYXJvdXNlbFdyYXBwZXIpOwogICAgICAgIH0KICAgIH0KICAgIC8vIC0tLSBEb3dubG9hZCBGdW5jdGlvbiAtLS0KICAgIGFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlQW5kRG93bmxvYWRIdG1sKCkgewogICAgICAgIGlmICh0eXBlb2YgSlNaaXAgPT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgIGFsZXJ0KCdFcnJvcjogTGEgbGlicmVyw61hIGRlIGNvbXByZXNpw7NuIG5vIHNlIGhhIGNhcmdhZG8uIFBvciBmYXZvciwgcmV2aXNlIHN1IGNvbmV4acOzbiBhIGludGVybmV0LicpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNvbnN0IGxvYWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhY3Rpb24tbG9hZGVyJyk7CiAgICAgICAgaWYgKGxvYWRlcikKICAgICAgICAgICAgbG9hZGVyLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIDEuIEZldGNoIGV4dGVybmFsIGZpbGVzIGFuZCBnZXQgc3R5bGVzCiAgICAgICAgICAgIGNvbnN0IFttYW5pZmVzdENvbnRlbnQsIHN3Q29udGVudF0gPSBhd2FpdCBQcm9taXNlLmFsbChbCiAgICAgICAgICAgICAgICBmZXRjaCgnbWFuaWZlc3QuanNvbicpLnRoZW4ocmVzID0+IHJlcy50ZXh0KCkpLAogICAgICAgICAgICAgICAgZmV0Y2goJ3N3LmpzJykudGhlbihyZXMgPT4gcmVzLnRleHQoKSkKICAgICAgICAgICAgXSk7CiAgICAgICAgICAgIGNvbnN0IHN0eWxlQ29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ3N0eWxlJykuaW5uZXJIVE1MOwogICAgICAgICAgICAvLyAyLiBDcmVhdGUgUEhQIGJhY2tlbmQgY29udGVudAogICAgICAgICAgICBjb25zdCBwaHBDb250ZW50ID0gYDw/cGhwCmhlYWRlcignQ29udGVudC1UeXBlOiBhcHBsaWNhdGlvbi9qc29uJyk7CmVycm9yX3JlcG9ydGluZygwKTsgLy8gT3B0aW9uYWw6IFR1cm4gb2ZmIGZvciBwcm9kdWN0aW9uCgokdXNlcnNfZmlsZSA9ICd1c3Vhcmlvcy5qc29uJzsKJHJlcXVlc3RfcGF5bG9hZCA9IGpzb25fZGVjb2RlKGZpbGVfZ2V0X2NvbnRlbnRzKCdwaHA6Ly9pbnB1dCcpLCB0cnVlKTsKJGFjdGlvbiA9ICRfR0VUWydhY3Rpb24nXSA/PyAkcmVxdWVzdF9wYXlsb2FkWydhY3Rpb24nXSA/PyBudWxsOwoKZnVuY3Rpb24gZ2V0X3VzZXJzKCRmaWxlKSB7CiAgICBpZiAoIWZpbGVfZXhpc3RzKCRmaWxlKSkgewogICAgICAgIGZpbGVfcHV0X2NvbnRlbnRzKCRmaWxlLCAnW10nKTsKICAgICAgICByZXR1cm4gW107CiAgICB9CiAgICAkY29udGVudCA9IGZpbGVfZ2V0X2NvbnRlbnRzKCRmaWxlKTsKICAgICR1c2VycyA9IGpzb25fZGVjb2RlKCRjb250ZW50LCB0cnVlKTsKICAgIHJldHVybiBpc19hcnJheSgkdXNlcnMpID8gJHVzZXJzIDogW107Cn0KCmZ1bmN0aW9uIHNhdmVfdXNlcnMoJGZpbGUsICR1c2VycykgewogICAgLy8gVXNlIGFycmF5X3ZhbHVlcyB0byByZXNldCBrZXlzIGFmdGVyIGZpbHRlcmluZwogICAgZmlsZV9wdXRfY29udGVudHMoJGZpbGUsIGpzb25fZW5jb2RlKGFycmF5X3ZhbHVlcygkdXNlcnMpLCBKU09OX1BSRVRUWV9QUklOVCB8IEpTT05fVU5FU0NBUEVEX1VOSUNPREUpKTsKfQoKc3dpdGNoICgkYWN0aW9uKSB7CiAgICBjYXNlICdsb2dpbic6CiAgICAgICAgJHVzZXJuYW1lID0gJHJlcXVlc3RfcGF5bG9hZFsndXNlcm5hbWUnXSA/PyAnJzsKICAgICAgICAkcGFzc3dvcmQgPSAkcmVxdWVzdF9wYXlsb2FkWydwYXNzd29yZCddID8/ICcnOwogICAgICAgICR1c2VycyA9IGdldF91c2VycygkdXNlcnNfZmlsZSk7CiAgICAgICAgJGZvdW5kX3VzZXIgPSBudWxsOwogICAgICAgIGZvcmVhY2ggKCR1c2VycyBhcyAkdXNlcikgewogICAgICAgICAgICBpZiAoJHVzZXJbJ3VzZXJuYW1lJ10gPT09ICR1c2VybmFtZSAmJiAkdXNlclsncGFzc3dvcmQnXSA9PT0gJHBhc3N3b3JkKSB7CiAgICAgICAgICAgICAgICAkZm91bmRfdXNlciA9ICR1c2VyOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCRmb3VuZF91c2VyKSB7CiAgICAgICAgICAgIGVjaG8ganNvbl9lbmNvZGUoWydzdWNjZXNzJyA9PiB0cnVlLCAndXNlcicgPT4gJGZvdW5kX3VzZXJdKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBlY2hvIGpzb25fZW5jb2RlKFsnc3VjY2VzcycgPT4gZmFsc2UsICdtZXNzYWdlJyA9PiAnVXN1YXJpbyBvIGNvbnRyYXNlw7FhIGluY29ycmVjdG9zLiddKTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CgogICAgY2FzZSAnZ2V0X3VzZXJzJzoKICAgICAgICBlY2hvIGpzb25fZW5jb2RlKGdldF91c2VycygkdXNlcnNfZmlsZSkpOwogICAgICAgIGJyZWFrOwoKICAgIGNhc2UgJ3NhdmVfdXNlcic6CiAgICAgICAgJHVzZXJzID0gZ2V0X3VzZXJzKCR1c2Vyc19maWxlKTsKICAgICAgICAkdXNlcl9kYXRhID0gJHJlcXVlc3RfcGF5bG9hZFsndXNlckRhdGEnXTsKICAgICAgICAkaXNfZWRpdGluZyA9ICRyZXF1ZXN0X3BheWxvYWRbJ2lzRWRpdGluZyddOwogICAgICAgICRjdXJyZW50bHlfZWRpdGluZ191c2VyID0gJHJlcXVlc3RfcGF5bG9hZFsnY3VycmVudGx5RWRpdGluZ1VzZXInXTsKICAgICAgICAkdXNlcm5hbWUgPSAkdXNlcl9kYXRhWyd1c2VybmFtZSddOwogICAgICAgIAogICAgICAgICR1c2VyX2V4aXN0cyA9IGZhbHNlOwogICAgICAgIGZvcmVhY2ggKCR1c2VycyBhcyAkdXNlcikgewogICAgICAgICAgICBpZiAoJHVzZXJbJ3VzZXJuYW1lJ10gPT09ICR1c2VybmFtZSAmJiAoISRpc19lZGl0aW5nIHx8ICRjdXJyZW50bHlfZWRpdGluZ191c2VyICE9PSAkdXNlcm5hbWUpKSB7CiAgICAgICAgICAgICAgICAkdXNlcl9leGlzdHMgPSB0cnVlOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICgkdXNlcl9leGlzdHMpIHsKICAgICAgICAgICAgZWNobyBqc29uX2VuY29kZShbJ3N1Y2Nlc3MnID0+IGZhbHNlLCAnbWVzc2FnZScgPT4gIkVsIG5vbWJyZSBkZSB1c3VhcmlvICd7JHVzZXJuYW1lfScgeWEgZXhpc3RlLiJdKTsKICAgICAgICAgICAgZXhpdDsKICAgICAgICB9CgogICAgICAgIGlmICgkaXNfZWRpdGluZykgewogICAgICAgICAgICAkZm91bmQgPSBmYWxzZTsKICAgICAgICAgICAgZm9yZWFjaCAoJHVzZXJzIGFzICYkdXNlcikgeyAvLyBVc2UgcmVmZXJlbmNlIHRvIG1vZGlmeSBpbiBwbGFjZQogICAgICAgICAgICAgICAgaWYgKCR1c2VyWyd1c2VybmFtZSddID09PSAkY3VycmVudGx5X2VkaXRpbmdfdXNlcikgewogICAgICAgICAgICAgICAgICAgICR1c2VyWyd1c2VybmFtZSddID0gJHVzZXJfZGF0YVsndXNlcm5hbWUnXTsKICAgICAgICAgICAgICAgICAgICAkdXNlclsncm9sZSddID0gJHVzZXJfZGF0YVsncm9sZSddOwogICAgICAgICAgICAgICAgICAgICR1c2VyWydkbmlEYXRhJ10gPSAkdXNlcl9kYXRhWydkbmlEYXRhJ107CiAgICAgICAgICAgICAgICAgICAgaWYgKCFlbXB0eSgkdXNlcl9kYXRhWydwYXNzd29yZCddKSkgewogICAgICAgICAgICAgICAgICAgICAgICAkdXNlclsncGFzc3dvcmQnXSA9ICR1c2VyX2RhdGFbJ3Bhc3N3b3JkJ107CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICRmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYoISRmb3VuZCkgeyAvLyBJZiBvcmlnaW5hbCB1c2VyIG5vdCBmb3VuZCAoZS5nLiwgZGVsZXRlZCksIGFkZCBhcyBuZXcKICAgICAgICAgICAgICAgICAkdXNlcnNbXSA9ICR1c2VyX2RhdGE7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkdXNlcnNbXSA9ICR1c2VyX2RhdGE7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHNhdmVfdXNlcnMoJHVzZXJzX2ZpbGUsICR1c2Vycyk7CiAgICAgICAgZWNobyBqc29uX2VuY29kZShbJ3N1Y2Nlc3MnID0+IHRydWUsICdtZXNzYWdlJyA9PiAnVXN1YXJpbyBndWFyZGFkbyBjb24gw6l4aXRvLiddKTsKICAgICAgICBicmVhazsKCiAgICBjYXNlICdkZWxldGVfdXNlcic6CiAgICAgICAgJHVzZXJuYW1lX3RvX2RlbGV0ZSA9ICRyZXF1ZXN0X3BheWxvYWRbJ3VzZXJuYW1lJ107CiAgICAgICAgJHVzZXJzID0gZ2V0X3VzZXJzKCR1c2Vyc19maWxlKTsKICAgICAgICAkdXNlcnMgPSBhcnJheV9maWx0ZXIoJHVzZXJzLCBmdW5jdGlvbigkdXNlcikgdXNlICgkdXNlcm5hbWVfdG9fZGVsZXRlKSB7CiAgICAgICAgICAgIHJldHVybiAkdXNlclsndXNlcm5hbWUnXSAhPT0gJHVzZXJuYW1lX3RvX2RlbGV0ZTsKICAgICAgICB9KTsKICAgICAgICBzYXZlX3VzZXJzKCR1c2Vyc19maWxlLCAkdXNlcnMpOwogICAgICAgIGVjaG8ganNvbl9lbmNvZGUoWydzdWNjZXNzJyA9PiB0cnVlLCAnbWVzc2FnZScgPT4gJ1VzdWFyaW8gZWxpbWluYWRvLiddKTsKICAgICAgICBicmVhazsKCiAgICBjYXNlICdpbXBvcnRfdXNlcnMnOgogICAgICAgICRuZXdfdXNlcnMgPSAkcmVxdWVzdF9wYXlsb2FkWyd1c2VycyddOwogICAgICAgIGlmIChpc19hcnJheSgkbmV3X3VzZXJzKSkgewogICAgICAgICAgICBzYXZlX3VzZXJzKCR1c2Vyc19maWxlLCAkbmV3X3VzZXJzKTsKICAgICAgICAgICAgZWNobyBqc29uX2VuY29kZShbJ3N1Y2Nlc3MnID0+IHRydWUsICdtZXNzYWdlJyA9PiAnVXN1YXJpb3MgaW1wb3J0YWRvcyBjb24gw6l4aXRvLiddKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBlY2hvIGpzb25fZW5jb2RlKFsnc3VjY2VzcycgPT4gZmFsc2UsICdtZXNzYWdlJyA9PiAnRGF0b3MgaW52w6FsaWRvcy4nXSk7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICAgIAogICAgZGVmYXVsdDoKICAgICAgICBlY2hvIGpzb25fZW5jb2RlKFsnc3VjY2VzcycgPT4gZmFsc2UsICdtZXNzYWdlJyA9PiAnQWNjacOzbiBubyB2w6FsaWRhLiddKTsKICAgICAgICBicmVhazsKfQo/PmA7CiAgICAgICAgICAgIC8vIDMuIENyZWF0ZSB0aGUgbWFpbiBzY3JpcHQgY29udGVudCwgZW5zdXJpbmcgaXQgdXNlcyB0aGUgUEhQIGJhY2tlbmQuCiAgICAgICAgICAgIGNvbnN0IG1haW5TY3JpcHRDb250ZW50ID0gYApkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgKCkgPT4gewogICAgLy8gLS0tIEVsZW1lbnQgU2VsZWN0b3JzIChzYW1lIGFzIGxpdmUgYXBwKSAtLS0KICAgIGNvbnN0IGxvZ2luU2NyZWVuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvZ2luLXNjcmVlbicpOwogICAgY29uc3QgbWFpblNjcmVlbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYWluLXNjcmVlbicpOwogICAgY29uc3QgZG9jdW1lbnRvc1NjcmVlbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkb2N1bWVudG9zLXNjcmVlbicpOwogICAgY29uc3QgZWRpdG9yU2NyZWVuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXRvci1zY3JlZW4nKTsKICAgIGNvbnN0IGRuaURldGFpbHNTY3JlZW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZG5pLWRldGFpbHMtc2NyZWVuJyk7CiAgICBjb25zdCB0ZWxlZm9ub3NTY3JlZW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGVsZWZvbm9zLXNjcmVlbicpOwogICAgY29uc3QgYm90dG9tTmF2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JvdHRvbS1uYXYnKTsKICAgIGNvbnN0IGxvYWRpbmdPdmVybGF5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRpbmctb3ZlcmxheScpOwogICAgY29uc3QgbG9naW5Mb2FkaW5nT3ZlcmxheSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2dpbi1sb2FkaW5nLW92ZXJsYXknKTsKICAgIGNvbnN0IGFjdGlvbkxvYWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhY3Rpb24tbG9hZGVyJyk7CiAgICBjb25zdCBsb2dpbkJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2dpbi1idG4nKTsKICAgIGNvbnN0IGd1ZXN0TG9naW5CdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3Vlc3QtbG9naW4tYnRuJyk7CiAgICBjb25zdCB1c2VybmFtZUlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VzZXJuYW1lLWlucHV0Jyk7CiAgICBjb25zdCBwYXNzd29yZElucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Bhc3N3b3JkLWlucHV0Jyk7CiAgICBjb25zdCBsb2dpbkVycm9yTXNnID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvZ2luLWVycm9yLW1zZycpOwogICAgY29uc3QgZG9jdW1lbnRvc0J0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkb2N1bWVudG9zLWJ0bicpOwogICAgY29uc3QgZWRpdG9yQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXRvci1idG4nKTsKICAgIGNvbnN0IHRlbGVmb25vc0J0bkRvY3MgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGVsZWZvbm9zLWJ0bi1kb2NzJyk7CiAgICBjb25zdCB0ZWxlZm9ub3NCdG5EZXRhaWxzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RlbGVmb25vcy1idG4tZGV0YWlscycpOwogICAgY29uc3QgdGVsZWZvbm9zSW5pY2lvQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RlbGVmb25vcy1pbmljaW8tYnRuJyk7CiAgICBjb25zdCBiYWNrQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JhY2stYnRuJyk7CiAgICBjb25zdCBlZGl0b3JCYWNrQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXRvci1iYWNrLWJ0bicpOwogICAgY29uc3QgZGV0YWlsc0JhY2tCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGV0YWlscy1iYWNrLWJ0bicpOwogICAgY29uc3QgaW5pY2lvQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2luaWNpby1idG4nKTsKICAgIGNvbnN0IHNvbGljaXRhckRuaUJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzb2xpY2l0YXItZG5pLWJ0bicpOwogICAgY29uc3QgZG5pSW5pdGlhbFZpZXcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZG5pLWluaXRpYWwtdmlldycpOwogICAgY29uc3QgZG5pU29saWNpdHVkVmlldyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkbmktc29saWNpdHVkLXZpZXcnKTsKICAgIGNvbnN0IGRuaUNhcmRIZWFkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZG5pLWNhcmQtaGVhZGVyJyk7CiAgICBjb25zdCBkbmlDYXJkQm9keSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkbmktY2FyZC1ib2R5Jyk7CiAgICBjb25zdCBjb25maXJtYXJTb2xpY2l0dWRCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZmlybWFyLXNvbGljaXR1ZC1idG4nKTsKICAgIGNvbnN0IGRuaURpZ2l0YWxEaXNwbGF5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RuaS1kaWdpdGFsLWRpc3BsYXknKTsKICAgIGNvbnN0IG1haW5EbmlQcm9maWxlUGljID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21haW4tZG5pLXByb2ZpbGUtcGljJyk7CiAgICBjb25zdCBtYWluRG5pUHJvZmlsZUltYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21haW4tZG5pLXByb2ZpbGUtaW1hZ2UnKTsKICAgIGNvbnN0IHZlckRldGFsbGVCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmVyLWRldGFsbGUtYnRuJyk7CiAgICBjb25zdCB2ZXJEbmlEaWdpdGFsQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Zlci1kbmktZGlnaXRhbC1idG4nKTsKICAgIGNvbnN0IGRvY3VtZW50b3NIZWFkZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZG9jdW1lbnRvcy1oZWFkZXInKTsKICAgIGNvbnN0IGRvY3VtZW50b3NIZWFkZXJUaXRsZSA9IGRvY3VtZW50b3NIZWFkZXIucXVlcnlTZWxlY3RvcignaDInKTsKICAgIGNvbnN0IHJlZnJlc2hJY29uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlZnJlc2gtaWNvbicpOwogICAgY29uc3Qgd2VsY29tZU5hbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd2VsY29tZS1uYW1lJyk7CiAgICBjb25zdCBkbmlEaWdpdGFsVGl0bGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZG5pLWRpZ2l0YWwtdGl0bGUnKTsKICAgIGNvbnN0IHNvbGljaXR1ZERuaU5hbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc29saWNpdHVkLWRuaS1uYW1lJyk7CiAgICBjb25zdCBlZGl0b3JEbmlQcm9maWxlUGljID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXRvci1kbmktcHJvZmlsZS1waWMnKTsKICAgIGNvbnN0IGVkaXRvckRuaVByb2ZpbGVJbWFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlZGl0b3ItZG5pLXByb2ZpbGUtaW1hZ2UnKTsKICAgIGNvbnN0IGltYWdlVXJsSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW1hZ2UtdXJsLWlucHV0Jyk7CiAgICBjb25zdCB0b3BTbGlkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9wLXNsaWRlcicpOwogICAgY29uc3QgbGVmdFNsaWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsZWZ0LXNsaWRlcicpOwogICAgY29uc3Qgd2lkdGhTbGlkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd2lkdGgtc2xpZGVyJyk7CiAgICBjb25zdCBoZWlnaHRTbGlkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVpZ2h0LXNsaWRlcicpOwogICAgY29uc3QgdG9wVmFsdWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9wLXZhbHVlJyk7CiAgICBjb25zdCBsZWZ0VmFsdWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGVmdC12YWx1ZScpOwogICAgY29uc3Qgd2lkdGhWYWx1ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3aWR0aC12YWx1ZScpOwogICAgY29uc3QgaGVpZ2h0VmFsdWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVpZ2h0LXZhbHVlJyk7CiAgICBjb25zdCBtYWluRG5pUXJQaWMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFpbi1kbmktcXItcGljJyk7CiAgICBjb25zdCBtYWluRG5pUXJJbWFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYWluLWRuaS1xci1pbWFnZScpOwogICAgY29uc3QgZWRpdG9yRG5pUXJQaWMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWRpdG9yLWRuaS1xci1waWMnKTsKICAgIGNvbnN0IGVkaXRvckRuaVFySW1hZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWRpdG9yLWRuaS1xci1pbWFnZScpOwogICAgY29uc3QgcXJVcmxJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxci11cmwtaW5wdXQnKTsKICAgIGNvbnN0IHFyVG9wU2xpZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FyLXRvcC1zbGlkZXInKTsKICAgIGNvbnN0IHFyTGVmdFNsaWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxci1sZWZ0LXNsaWRlcicpOwogICAgY29uc3QgcXJXaWR0aFNsaWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxci13aWR0aC1zbGlkZXInKTsKICAgIGNvbnN0IHFySGVpZ2h0U2xpZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FyLWhlaWdodC1zbGlkZXInKTsKICAgIGNvbnN0IHFyVG9wVmFsdWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXItdG9wLXZhbHVlJyk7CiAgICBjb25zdCBxckxlZnRWYWx1ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxci1sZWZ0LXZhbHVlJyk7CiAgICBjb25zdCBxcldpZHRoVmFsdWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXItd2lkdGgtdmFsdWUnKTsKICAgIGNvbnN0IHFySGVpZ2h0VmFsdWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXItaGVpZ2h0LXZhbHVlJyk7CiAgICBjb25zdCBkZXRhaWxzQmFyY29kZUltYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RldGFpbHMtYmFyY29kZS1pbWFnZScpOwogICAgY29uc3QgZGV0YWlsc1Byb2ZpbGVJbWFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZXRhaWxzLXByb2ZpbGUtaW1hZ2UnKTsKICAgIGNvbnN0IG1haW5EbmlCYWNrSW1hZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFpbi1kbmktYmFjay1pbWFnZScpOwogICAgY29uc3QgZWRpdG9yRG5pQmFja0ltYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXRvci1kbmktYmFjay1pbWFnZScpOwogICAgY29uc3QgZG5pQmFja1VybElucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RuaS1iYWNrLXVybC1pbnB1dCcpOwogICAgY29uc3QgdXNlclByb2ZpbGVCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndXNlci1wcm9maWxlLWJ0bicpOwogICAgY29uc3QgcHJvZmlsZUFycm93ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2ZpbGUtYXJyb3cnKTsKICAgIGNvbnN0IHVzZXJNZW51ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VzZXItbWVudScpOwogICAgY29uc3QgbWVudUVkaXRvckJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZW51LWVkaXRvci1idG4nKTsKICAgIGNvbnN0IG1lbnVVc2VyTmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZW51LXVzZXItbmFtZScpOwogICAgY29uc3QgbWVudVVzZXJJZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZW51LXVzZXItaWQnKTsKICAgIGNvbnN0IG5ld1VzZXJuYW1lSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmV3LXVzZXJuYW1lLWlucHV0Jyk7CiAgICBjb25zdCBuZXdQYXNzd29yZElucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25ldy1wYXNzd29yZC1pbnB1dCcpOwogICAgY29uc3QgbmV3VXNlclJvbGVTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmV3LXVzZXItcm9sZS1zZWxlY3QnKTsKICAgIGNvbnN0IHNhdmVVc2VyQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NhdmUtdXNlci1idG4nKTsKICAgIGNvbnN0IHVzZXJMaXN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VzZXItbGlzdCcpOwogICAgY29uc3QgaW1wb3J0VXNlcnNCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW1wb3J0LXVzZXJzLWJ0bicpOwogICAgY29uc3QgaW1wb3J0VXNlcnNJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbXBvcnQtdXNlcnMtaW5wdXQnKTsKICAgIGNvbnN0IGV4cG9ydFVzZXJzQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V4cG9ydC11c2Vycy1idG4nKTsKICAgIAogICAgLy8gLS0tIFN0YXRlIC0tLQogICAgbGV0IGN1cnJlbnRseUVkaXRpbmdVc2VyID0gbnVsbDsKICAgIGxldCBsb2dnZWRJblVzZXIgPSBudWxsOwogICAgbGV0IGlzRmxpcHBlZCA9IGZhbHNlOwoKICAgIC8vIC0tLSBTZXJ2aWNlIFdvcmtlciBSZWdpc3RyYXRpb24gLS0tCiAgICBpZiAoJ3NlcnZpY2VXb3JrZXInIGluIG5hdmlnYXRvcikgewogICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgKCkgPT4gewogICAgICAgICAgICBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5yZWdpc3RlcignLi9zdy5qcycpLnRoZW4ocmVnID0+IGNvbnNvbGUubG9nKCdTVyByZWdpc3RlcmVkLicsIHJlZykpLmNhdGNoKGVyciA9PiBjb25zb2xlLmxvZygnU1cgcmVnaXN0cmF0aW9uIGZhaWxlZDonLCBlcnIpKTsKICAgICAgICB9KTsKICAgIH0KCiAgICAvLyAtLS0gQVBJIENvbW11bmljYXRpb24gKFBIUCBCYWNrZW5kKSAtLS0KICAgIGFzeW5jIGZ1bmN0aW9uIGFwaUNhbGwoYWN0aW9uLCBwYXlsb2FkID0ge30pIHsKICAgICAgICAvLyBGb3IgR0VUIHJlcXVlc3RzLCBhcHBlbmQgYWN0aW9uIHRvIHF1ZXJ5IHN0cmluZy4gRm9yIG90aGVycywgc2VuZCBpbiBib2R5LgogICAgICAgIGNvbnN0IGlzR2V0ID0gYWN0aW9uID09PSAnZ2V0X3VzZXJzJzsKICAgICAgICBjb25zdCB1cmwgPSBpc0dldCA/IFxgYXBpLnBocD9hY3Rpb249XCR7YWN0aW9ufVxgIDogJ2FwaS5waHAnOwogICAgICAgIAogICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7CiAgICAgICAgICAgIG1ldGhvZDogaXNHZXQgPyAnR0VUJyA6ICdQT1NUJywKICAgICAgICAgICAgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH0sCiAgICAgICAgICAgIGJvZHk6IGlzR2V0ID8gbnVsbCA6IEpTT04uc3RyaW5naWZ5KHsgYWN0aW9uLCAuLi5wYXlsb2FkIH0pCiAgICAgICAgfTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmwsIG9wdGlvbnMpOwogICAgICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdBUEkgRXJyb3IgUmVzcG9uc2U6JywgYXdhaXQgcmVzcG9uc2UudGV4dCgpKTsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTmV0d29yayByZXNwb25zZSB3YXMgbm90IG9rJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTsKICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCdBUEkgQ2FsbCBFcnJvcjonLCBlcnJvcik7CiAgICAgICAgICAgIGFsZXJ0KCdFcnJvciBkZSBjb25leGnDs24gY29uIGVsIHNlcnZpZG9yLiBBc2Vnw7pyZXNlIGRlIHF1ZSBsYSBhcGxpY2FjacOzbiBzZSBlc3TDoSBlamVjdXRhbmRvIGVuIHVuIHNlcnZpZG9yIFBIUCAocG9yIGVqZW1wbG8sIFhBTVBQLCBXQU1QLCBNQU1QKSB5IG5vIGNvbW8gdW4gYXJjaGl2byBsb2NhbCAoZmlsZTovLykuJyk7CiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiAnRXJyb3IgZGUgY29uZXhpw7NuIGNvbiBlbCBzZXJ2aWRvci4nIH07CiAgICAgICAgfQogICAgfQoKICAgIC8vIC0tLSBVc2VyIE1hbmFnZW1lbnQgJiBBdXRoIC0tLQogICAgZnVuY3Rpb24gdXBkYXRlVWlGb3JVc2VyUm9sZSgpIHsKICAgICAgICBjb25zdCBpc0FkbWluID0gbG9nZ2VkSW5Vc2VyICYmIGxvZ2dlZEluVXNlci5yb2xlID09PSAnYWRtaW4nOwogICAgICAgIGlmIChlZGl0b3JCdG4pIGVkaXRvckJ0bi5zdHlsZS5kaXNwbGF5ID0gaXNBZG1pbiA/ICdmbGV4JyA6ICdub25lJzsKICAgICAgICBpZiAobWVudUVkaXRvckJ0bikgbWVudUVkaXRvckJ0bi5zdHlsZS5kaXNwbGF5ID0gaXNBZG1pbiA/ICdibG9jaycgOiAnbm9uZSc7CiAgICB9CgogICAgZnVuY3Rpb24gZ2F0aGVyQ3VycmVudERuaURhdGEoKSB7CiAgICAgICAgY29uc3QgZGF0YSA9IHt9OwogICAgICAgIGNvbnN0IGlucHV0cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJyNlZGl0b3Itc2NyZWVuIC5jdXN0b20taW5wdXQsICNlZGl0b3Itc2NyZWVuIGlucHV0W3R5cGU9InJhbmdlIl0sICNlZGl0b3Itc2NyZWVuIC5jdXN0b20tc2VsZWN0Jyk7CiAgICAgICAgaW5wdXRzLmZvckVhY2goaW5wdXQgPT4gewogICAgICAgICAgICBkYXRhW2lucHV0LmlkXSA9IGlucHV0LnZhbHVlOwogICAgICAgIH0pOwogICAgICAgIHJldHVybiBkYXRhOwogICAgfQoKICAgIGZ1bmN0aW9uIGFwcGx5VXNlckRhdGEoZG5pRGF0YSkgewogICAgICAgIGlmICghZG5pRGF0YSkgcmV0dXJuOwogICAgICAgIGNvbnN0IGlucHV0cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJyNlZGl0b3Itc2NyZWVuIC5jdXN0b20taW5wdXQsICNlZGl0b3Itc2NyZWVuIGlucHV0W3R5cGU9InJhbmdlIl0sICNlZGl0b3Itc2NyZWVuIC5jdXN0b20tc2VsZWN0Jyk7CiAgICAgICAgaW5wdXRzLmZvckVhY2goaW5wdXQgPT4gewogICAgICAgICAgICBpZiAoZG5pRGF0YVtpbnB1dC5pZF0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgaW5wdXQudmFsdWUgPSBkbmlEYXRhW2lucHV0LmlkXTsKICAgICAgICAgICAgICAgIGlucHV0LmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCdpbnB1dCcsIHsgYnViYmxlczogdHJ1ZSB9KSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KCiAgICBhc3luYyBmdW5jdGlvbiBkZWxldGVVc2VyKHVzZXJuYW1lVG9EZWxldGUpIHsKICAgICAgICBpZiAoIWNvbmZpcm0oXGDCv0VzdMOhIHNlZ3VybyBkZSBxdWUgZGVzZWEgZWxpbWluYXIgYWwgdXN1YXJpbyAiXCR7dXNlcm5hbWVUb0RlbGV0ZX0iP1xgKSkgcmV0dXJuOwogICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGFwaUNhbGwoJ2RlbGV0ZV91c2VyJywgeyB1c2VybmFtZTogdXNlcm5hbWVUb0RlbGV0ZSB9KTsKICAgICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHsKICAgICAgICAgICAgaWYgKHVzZXJuYW1lVG9EZWxldGUgPT09IGN1cnJlbnRseUVkaXRpbmdVc2VyKSB7CiAgICAgICAgICAgICAgICByZXNldFVzZXJGb3JtKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVuZGVyVXNlckxpc3QoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBhbGVydChcYEVycm9yOiBcJHtyZXN1bHQubWVzc2FnZSB8fCAnTm8gc2UgcHVkbyBlbGltaW5hciBhbCB1c3VhcmlvLid9XGApOwogICAgICAgIH0KICAgIH0KICAgIAogICAgZnVuY3Rpb24gcmVzZXRVc2VyRm9ybSgpIHsKICAgICAgICBuZXdVc2VybmFtZUlucHV0LnZhbHVlID0gJyc7CiAgICAgICAgbmV3UGFzc3dvcmRJbnB1dC52YWx1ZSA9ICcnOwogICAgICAgIGlmIChuZXdVc2VyUm9sZVNlbGVjdCkgbmV3VXNlclJvbGVTZWxlY3QudmFsdWUgPSAndXNlcic7CiAgICAgICAgc2F2ZVVzZXJCdG4udGV4dENvbnRlbnQgPSAnR3VhcmRhciBOdWV2byBVc3VhcmlvJzsKICAgICAgICBjdXJyZW50bHlFZGl0aW5nVXNlciA9IG51bGw7CiAgICB9CgogICAgYXN5bmMgZnVuY3Rpb24gcmVuZGVyVXNlckxpc3QoKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY29uc3QgdXNlcnMgPSBhd2FpdCBhcGlDYWxsKCdnZXRfdXNlcnMnKTsKICAgICAgICAgICAgdXNlckxpc3QuaW5uZXJIVE1MID0gJyc7CiAgICAgICAgICAgIGlmICghdXNlcnMgfHwgIUFycmF5LmlzQXJyYXkodXNlcnMpIHx8IHVzZXJzLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgdXNlckxpc3QuaW5uZXJIVE1MID0gJzxwIHN0eWxlPSJjb2xvcjogdmFyKC0tdGV4dC1saWdodCk7IHRleHQtYWxpZ246IGNlbnRlcjsiPk5vIGhheSB1c3VhcmlvcyBndWFyZGFkb3MuPC9wPic7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdXNlcnMuZm9yRWFjaCh1c2VyID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IHVzZXJJdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgICAgICB1c2VySXRlbS5jbGFzc05hbWUgPSAndXNlci1saXN0LWl0ZW0nOwogICAgICAgICAgICAgICAgY29uc3QgdXNlck5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7CiAgICAgICAgICAgICAgICB1c2VyTmFtZS5jbGFzc05hbWUgPSAndXNlci1saXN0LWl0ZW0tbmFtZSc7CiAgICAgICAgICAgICAgICB1c2VyTmFtZS50ZXh0Q29udGVudCA9IFxgXCR7dXNlci51c2VybmFtZX0gKFwke3VzZXIucm9sZSB8fCAndXNlcid9KVxgOwogICAgICAgICAgICAgICAgY29uc3QgYWN0aW9uc0NvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgICAgICAgICAgYWN0aW9uc0NvbnRhaW5lci5jbGFzc05hbWUgPSAndXNlci1saXN0LWl0ZW0tYWN0aW9ucyc7CiAgICAgICAgICAgICAgICBjb25zdCBlZGl0QnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7CiAgICAgICAgICAgICAgICBlZGl0QnRuLnRleHRDb250ZW50ID0gJ0VkaXRhcic7CiAgICAgICAgICAgICAgICBlZGl0QnRuLmNsYXNzTmFtZSA9ICdlZGl0LWJ0bic7CiAgICAgICAgICAgICAgICBlZGl0QnRuLm9uY2xpY2sgPSAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgYXBwbHlVc2VyRGF0YSh1c2VyLmRuaURhdGEpOwogICAgICAgICAgICAgICAgICAgIG5ld1VzZXJuYW1lSW5wdXQudmFsdWUgPSB1c2VyLnVzZXJuYW1lOwogICAgICAgICAgICAgICAgICAgIG5ld1Bhc3N3b3JkSW5wdXQudmFsdWUgPSAnJzsKICAgICAgICAgICAgICAgICAgICBuZXdQYXNzd29yZElucHV0LnBsYWNlaG9sZGVyID0gIkRlamFyIGVuIGJsYW5jbyBwYXJhIG5vIGNhbWJpYXIiOwogICAgICAgICAgICAgICAgICAgIGlmKG5ld1VzZXJSb2xlU2VsZWN0KSBuZXdVc2VyUm9sZVNlbGVjdC52YWx1ZSA9IHVzZXIucm9sZSB8fCAndXNlcic7CiAgICAgICAgICAgICAgICAgICAgc2F2ZVVzZXJCdG4udGV4dENvbnRlbnQgPSAnQWN0dWFsaXphciBVc3VhcmlvJzsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50bHlFZGl0aW5nVXNlciA9IHVzZXIudXNlcm5hbWU7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LnNjcm9sbFRvKDAsMCk7CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgY29uc3QgZGVsZXRlQnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7CiAgICAgICAgICAgICAgICBkZWxldGVCdG4udGV4dENvbnRlbnQgPSAnRWxpbWluYXInOwogICAgICAgICAgICAgICAgZGVsZXRlQnRuLmNsYXNzTmFtZSA9ICdkZWxldGUtYnRuJzsKICAgICAgICAgICAgICAgIGRlbGV0ZUJ0bi5vbmNsaWNrID0gKCkgPT4gZGVsZXRlVXNlcih1c2VyLnVzZXJuYW1lKTsKICAgICAgICAgICAgICAgIGFjdGlvbnNDb250YWluZXIuYXBwZW5kQ2hpbGQoZWRpdEJ0bik7CiAgICAgICAgICAgICAgICBhY3Rpb25zQ29udGFpbmVyLmFwcGVuZENoaWxkKGRlbGV0ZUJ0bik7CiAgICAgICAgICAgICAgICB1c2VySXRlbS5hcHBlbmRDaGlsZCh1c2VyTmFtZSk7CiAgICAgICAgICAgICAgICB1c2VySXRlbS5hcHBlbmRDaGlsZChhY3Rpb25zQ29udGFpbmVyKTsKICAgICAgICAgICAgICAgIHVzZXJMaXN0LmFwcGVuZENoaWxkKHVzZXJJdGVtKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgZmV0Y2hpbmcgdXNlcnM6IiwgZXJyb3IpOwogICAgICAgICAgICB1c2VyTGlzdC5pbm5lckhUTUwgPSAnPHAgc3R5bGU9ImNvbG9yOiByZWQ7IHRleHQtYWxpZ246IGNlbnRlcjsiPkVycm9yIGFsIGNhcmdhciBsYSBsaXN0YSBkZSB1c3Vhcmlvcy48L3A+JzsKICAgICAgICB9CiAgICB9CgogICAgLy8gLS0tIENvcmUgQXBwIExvZ2ljIC0tLQogICAgZnVuY3Rpb24gc2V0dXBTbGlkZXIoc2xpZGVyLCB0YXJnZXRzLCBwcm9wZXJ0eSwgdmFsdWVTcGFuLCB1bml0ID0gJyUnKSB7CiAgICAgICAgaWYgKHNsaWRlciAmJiB0YXJnZXRzICYmIHRhcmdldHMubGVuZ3RoID4gMCAmJiB2YWx1ZVNwYW4pIHsKICAgICAgICAgICAgY29uc3QgdXBkYXRlID0gKCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBzbGlkZXIudmFsdWU7CiAgICAgICAgICAgICAgICB0YXJnZXRzLmZvckVhY2godGFyZ2V0ID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAodGFyZ2V0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldC5zdHlsZVtwcm9wZXJ0eV0gPSBcYFwke3ZhbHVlfVwke3VuaXR9XGA7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB2YWx1ZVNwYW4udGV4dENvbnRlbnQgPSB2YWx1ZTsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgc2xpZGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgdXBkYXRlKTsKICAgICAgICAgICAgdXBkYXRlKCk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHVwZGF0ZUR5bmFtaWNIZWFkZXJEYXRhKCkgewogICAgICAgIGNvbnN0IGFwZWxsaWRvSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYXBlbGxpZG8taW5wdXQnKTsKICAgICAgICBjb25zdCBub21icmVJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdub21icmUtaW5wdXQnKTsKICAgICAgICBjb25zdCBjdWlsSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3VpbC1pbnB1dCcpOwogICAgICAgIAogICAgICAgIGlmIChhcGVsbGlkb0lucHV0ICYmIG5vbWJyZUlucHV0ICYmIGN1aWxJbnB1dCkgewogICAgICAgICAgICBjb25zdCBhcGVsbGlkbyA9IGFwZWxsaWRvSW5wdXQudmFsdWU7CiAgICAgICAgICAgIGNvbnN0IG5vbWJyZSA9IG5vbWJyZUlucHV0LnZhbHVlOwogICAgICAgICAgICBjb25zdCBjdWlsID0gY3VpbElucHV0LnZhbHVlOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgZHJvcGRvd25OYW1lID0gXGBcJHtub21icmV9IFwke2FwZWxsaWRvfVxgOyAKICAgICAgICAgICAgY29uc3QgZG5pVGl0bGVOYW1lID0gXGBcJHthcGVsbGlkb30gXCR7bm9tYnJlfVxgOwogICAgICAgICAgICBjb25zdCBtZW51TmFtZSA9IFxgXCR7bm9tYnJlfSBcJHthcGVsbGlkb31cYDsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICh3ZWxjb21lTmFtZSkgd2VsY29tZU5hbWUudGV4dENvbnRlbnQgPSBub21icmU7CiAgICAgICAgICAgIGlmIChkbmlEaWdpdGFsVGl0bGUpIGRuaURpZ2l0YWxUaXRsZS50ZXh0Q29udGVudCA9IGRuaVRpdGxlTmFtZTsKICAgICAgICAgICAgaWYgKHNvbGljaXR1ZERuaU5hbWUpIHNvbGljaXR1ZERuaU5hbWUudGV4dENvbnRlbnQgPSBkcm9wZG93bk5hbWU7CiAgICAgICAgICAgIGlmIChtZW51VXNlck5hbWUpIG1lbnVVc2VyTmFtZS50ZXh0Q29udGVudCA9IG1lbnVOYW1lOwogICAgICAgICAgICBpZiAobWVudVVzZXJJZCkgbWVudVVzZXJJZC50ZXh0Q29udGVudCA9IGN1aWw7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHNldHVwVGV4dENvbnRyb2woZmllbGQpIHsKICAgICAgICBjb25zdCB0ZXh0SW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcYFwke2ZpZWxkfS1pbnB1dFxgKTsKICAgICAgICBjb25zdCB0b3BTbGlkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcYFwke2ZpZWxkfS10b3Atc2xpZGVyXGApOwogICAgICAgIGNvbnN0IGxlZnRTbGlkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcYFwke2ZpZWxkfS1sZWZ0LXNsaWRlclxgKTsKICAgICAgICBjb25zdCBmb250c2l6ZVNsaWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFxgXCR7ZmllbGR9LWZvbnRzaXplLXNsaWRlclxgKTsKICAgICAgICBjb25zdCBmb250U2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXGBcJHtmaWVsZH0tZm9udC1zZWxlY3RcYCk7CiAgICAgICAgY29uc3QgdG9wVmFsdWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcYFwke2ZpZWxkfS10b3AtdmFsdWVcYCk7CiAgICAgICAgY29uc3QgbGVmdFZhbHVlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXGBcJHtmaWVsZH0tbGVmdC12YWx1ZVxgKTsKICAgICAgICBjb25zdCBmb250c2l6ZVZhbHVlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXGBcJHtmaWVsZH0tZm9udHNpemUtdmFsdWVcYCk7CiAgICAgICAgY29uc3QgbWFpblRhcmdldCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFxgbWFpbi1kbmktXCR7ZmllbGR9XGApOwogICAgICAgIGNvbnN0IGVkaXRvclRhcmdldCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFxgZWRpdG9yLWRuaS1cJHtmaWVsZH1cYCk7CiAgICAgICAgY29uc3QgdGFyZ2V0cyA9IFttYWluVGFyZ2V0LCBlZGl0b3JUYXJnZXRdLmZpbHRlcihlbCA9PiBlbCk7CgogICAgICAgIGlmICh0ZXh0SW5wdXQgJiYgdGFyZ2V0cy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZSA9ICgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IG5ld1ZhbHVlID0gdGV4dElucHV0LnZhbHVlOwogICAgICAgICAgICAgICAgdGFyZ2V0cy5mb3JFYWNoKHRhcmdldCA9PiB0YXJnZXQudGV4dENvbnRlbnQgPSBuZXdWYWx1ZSk7CiAgICAgICAgICAgICAgICBpZiAoZmllbGQgPT09ICdub21icmUnIHx8IGZpZWxkID09PSAnYXBlbGxpZG8nIHx8IGZpZWxkID09PSAnY3VpbCcpIHsKICAgICAgICAgICAgICAgICAgICB1cGRhdGVEeW5hbWljSGVhZGVyRGF0YSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgICB0ZXh0SW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCB1cGRhdGUpOwogICAgICAgICAgICB1cGRhdGUoKTsKICAgICAgICB9CgogICAgICAgIHNldHVwU2xpZGVyKHRvcFNsaWRlciwgdGFyZ2V0cywgJ3RvcCcsIHRvcFZhbHVlLCAnJScpOwogICAgICAgIHNldHVwU2xpZGVyKGxlZnRTbGlkZXIsIHRhcmdldHMsICdsZWZ0JywgbGVmdFZhbHVlLCAnJScpOwogICAgICAgIHNldHVwU2xpZGVyKGZvbnRzaXplU2xpZGVyLCB0YXJnZXRzLCAnZm9udFNpemUnLCBmb250c2l6ZVZhbHVlLCAncHgnKTsKCiAgICAgICAgaWYgKGZvbnRTZWxlY3QgJiYgdGFyZ2V0cy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZSA9ICgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IG5ld0ZvbnQgPSBmb250U2VsZWN0LnZhbHVlOwogICAgICAgICAgICAgICAgdGFyZ2V0cy5mb3JFYWNoKHRhcmdldCA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRhcmdldCkgdGFyZ2V0LnN0eWxlLmZvbnRGYW1pbHkgPSBuZXdGb250OwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGZvbnRTZWxlY3QuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCB1cGRhdGUpOwogICAgICAgICAgICB1cGRhdGUoKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gcmVzZXREbmlDYXJkKCkgewogICAgICAgIGlmIChkbmlDYXJkSGVhZGVyKSBkbmlDYXJkSGVhZGVyLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7CiAgICAgICAgaWYgKGRuaUluaXRpYWxWaWV3KSBkbmlJbml0aWFsVmlldy5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICBpZiAoZG5pU29saWNpdHVkVmlldykgZG5pU29saWNpdHVkVmlldy5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgIGlmIChkbmlEaWdpdGFsRGlzcGxheSkgZG5pRGlnaXRhbERpc3BsYXkuc3R5bGUuZGlzcGxheSA9ICdub25lJzsgCiAgICAgICAgaWYgKGRuaUNhcmRCb2R5KSBkbmlDYXJkQm9keS5jbGFzc0xpc3QucmVtb3ZlKCduby1oZWFkZXInKTsKICAgICAgICBpZiAoZG9jdW1lbnRvc0hlYWRlclRpdGxlKSBkb2N1bWVudG9zSGVhZGVyVGl0bGUudGV4dENvbnRlbnQgPSAnRG9jdW1lbnRvcyc7CiAgICAgICAgaWYgKHJlZnJlc2hJY29uKSByZWZyZXNoSWNvbi5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgIGlmIChkb2N1bWVudG9zSGVhZGVyKSBkb2N1bWVudG9zSGVhZGVyLnN0eWxlLmp1c3RpZnlDb250ZW50ID0gJ2ZsZXgtc3RhcnQnOwoKICAgICAgICBjb25zdCBkbmlGbGlwcGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RuaS1mbGlwcGVyJyk7CiAgICAgICAgaWYoZG5pRmxpcHBlciAmJiBpc0ZsaXBwZWQpIHsKICAgICAgICAgICAgIGRuaUZsaXBwZXIuc3R5bGUudHJhbnNpdGlvbiA9ICd0cmFuc2Zvcm0gMC42cyBjdWJpYy1iZXppZXIoMC4zNCwgMS41NiwgMC42NCwgMSknOwogICAgICAgICAgICAgZG5pRmxpcHBlci5zdHlsZS50cmFuc2Zvcm0gPSAncm90YXRlWSgwZGVnKSc7CiAgICAgICAgfQogICAgICAgIGlzRmxpcHBlZCA9IGZhbHNlOwogICAgfQoKICAgIGZ1bmN0aW9uIHNob3dTY3JlZW4oc2NyZWVuTmFtZSkgewogICAgICAgIFtsb2dpblNjcmVlbiwgbWFpblNjcmVlbiwgZG9jdW1lbnRvc1NjcmVlbiwgZWRpdG9yU2NyZWVuLCBkbmlEZXRhaWxzU2NyZWVuLCB0ZWxlZm9ub3NTY3JlZW5dLmZvckVhY2gocyA9PiBzLnN0eWxlLmRpc3BsYXkgPSAnbm9uZScpOwogICAgICAgIGlmIChib3R0b21OYXYpIGJvdHRvbU5hdi5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwoKICAgICAgICBzd2l0Y2ggKHNjcmVlbk5hbWUpIHsKICAgICAgICAgICAgY2FzZSAnbG9naW4nOiBsb2dpblNjcmVlbi5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOyBicmVhazsKICAgICAgICAgICAgY2FzZSAnbWFpbic6IG1haW5TY3JlZW4uc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsgcmVzZXREbmlDYXJkKCk7IGJyZWFrOwogICAgICAgICAgICBjYXNlICdkb2N1bWVudG9zJzogZG9jdW1lbnRvc1NjcmVlbi5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOyBpZiAoYm90dG9tTmF2KSBib3R0b21OYXYuc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ2VkaXRvcic6CiAgICAgICAgICAgICAgICAgaWYgKGxvZ2dlZEluVXNlciAmJiBsb2dnZWRJblVzZXIucm9sZSA9PT0gJ2FkbWluJykgewogICAgICAgICAgICAgICAgICAgIGVkaXRvclNjcmVlbi5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBhbGVydCgnQWNjZXNvIGRlbmVnYWRvLiBTZSByZXF1aWVyZW4gcGVybWlzb3MgZGUgYWRtaW5pc3RyYWRvci4nKTsKICAgICAgICAgICAgICAgICAgICBzaG93U2NyZWVuKCdtYWluJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAnZGV0YWlscyc6IGRuaURldGFpbHNTY3JlZW4uc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ3RlbGVmb25vcyc6IHRlbGVmb25vc1NjcmVlbi5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOyBicmVhazsKICAgICAgICB9CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHNob3dEbmlEaWdpdGFsVmlldygpIHsKICAgICAgICBpZiAoZG5pSW5pdGlhbFZpZXcpIGRuaUluaXRpYWxWaWV3LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgaWYgKGRuaVNvbGljaXR1ZFZpZXcpIGRuaVNvbGljaXR1ZFZpZXcuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICBpZiAoZG5pRGlnaXRhbERpc3BsYXkpIGRuaURpZ2l0YWxEaXNwbGF5LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgIGlmIChkbmlDYXJkSGVhZGVyKSBkbmlDYXJkSGVhZGVyLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgaWYgKGRuaUNhcmRCb2R5KSBkbmlDYXJkQm9keS5jbGFzc0xpc3QuYWRkKCduby1oZWFkZXInKTsKICAgICAgICBpZiAoZG9jdW1lbnRvc0hlYWRlclRpdGxlKSBkb2N1bWVudG9zSGVhZGVyVGl0bGUudGV4dENvbnRlbnQgPSAnRE5JIERpZ2l0YWwnOwogICAgICAgIGlmIChyZWZyZXNoSWNvbikgcmVmcmVzaEljb24uc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgaWYgKGRvY3VtZW50b3NIZWFkZXIpIGRvY3VtZW50b3NIZWFkZXIuc3R5bGUuanVzdGlmeUNvbnRlbnQgPSAnc3BhY2UtYmV0d2Vlbic7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHBvcHVsYXRlRG5pRGV0YWlscygpIHsKICAgICAgICBjb25zdCBkbmkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZG9jdW1lbnRvLWlucHV0JykudmFsdWU7CiAgICAgICAgY29uc3QgdHJhbWl0ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0cmFtaXRlLWlucHV0JykudmFsdWU7CiAgICAgICAgY29uc3QgZW1pc2lvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlbWlzaW9uLWlucHV0JykudmFsdWU7CiAgICAgICAgY29uc3QgdmVuY2ltaWVudG8gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmVuY2ltaWVudG8taW5wdXQnKS52YWx1ZTsKICAgICAgICBjb25zdCBub21icmUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbm9tYnJlLWlucHV0JykudmFsdWU7CiAgICAgICAgY29uc3QgYXBlbGxpZG8gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYXBlbGxpZG8taW5wdXQnKS52YWx1ZTsKICAgICAgICBjb25zdCBzZXhvID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NleG8taW5wdXQnKS52YWx1ZTsKICAgICAgICBjb25zdCBuYWNpbWllbnRvID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25hY2ltaWVudG8taW5wdXQnKS52YWx1ZTsKICAgICAgICBjb25zdCBkb21pY2lsaW8gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZG9taWNpbGlvLWlucHV0JykudmFsdWU7CiAgICAgICAgY29uc3QgY3VpbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdWlsLWlucHV0JykudmFsdWU7CiAgICAgICAgY29uc3QgbmFjaW9uYWxpZGFkID0gJ0FSJzsKICAgICAgICBjb25zdCBsdWdhck5hY2ltaWVudG8gPSAnQVJHRU5USU5BJzsKICAgIAogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZXRhaWxzLWRuaScpLnRleHRDb250ZW50ID0gZG5pOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZXRhaWxzLXRyYW1pdGUnKS50ZXh0Q29udGVudCA9IHRyYW1pdGU7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RldGFpbHMtZW1pc2lvbicpLnRleHRDb250ZW50ID0gZW1pc2lvbjsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGV0YWlscy12ZW5jaW1pZW50bycpLnRleHRDb250ZW50ID0gdmVuY2ltaWVudG87CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RldGFpbHMtbm9tYnJlJykudGV4dENvbnRlbnQgPSBub21icmU7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RldGFpbHMtYXBlbGxpZG8nKS50ZXh0Q29udGVudCA9IGFwZWxsaWRvOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZXRhaWxzLWN1aWwnKS50ZXh0Q29udGVudCA9IGN1aWw7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RldGFpbHMtc2V4bycpLnRleHRDb250ZW50ID0gc2V4bzsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGV0YWlscy1uYWNpbWllbnRvJykudGV4dENvbnRlbnQgPSBuYWNpbWllbnRvOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZXRhaWxzLW5hY2lvbmFsaWRhZCcpLnRleHRDb250ZW50ID0gbmFjaW9uYWxpZGFkOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZXRhaWxzLWx1Z2FyLW5hY2ltaWVudG8nKS50ZXh0Q29udGVudCA9IGx1Z2FyTmFjaW1pZW50bzsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGV0YWlscy1kb21pY2lsaW8nKS50ZXh0Q29udGVudCA9IGRvbWljaWxpbzsKICAgIH0KCiAgICAvLyAtLS0gRmxpcHBlciAmIENhcm91c2VsIEhlbHBlcnMgLS0tCiAgICBmdW5jdGlvbiBzZXR1cEZsaXBwZXIoY29udGFpbmVyLCBmbGlwcGVyKSB7CiAgICAgICAgaWYgKCFjb250YWluZXIgfHwgIWZsaXBwZXIpIHJldHVybjsKCiAgICAgICAgbGV0IGlzRHJhZ2dpbmcgPSBmYWxzZSwgc3RhcnRYID0gMCwgc3RhcnRBbmdsZSA9IDAsIGN1cnJlbnRBbmdsZSA9IDA7CiAgICAgICAgY29uc3QgZ2V0RXZlbnRYID0gKGUpID0+IGUudHlwZS5pbmNsdWRlcygnbW91c2UnKSA/IGUuc2NyZWVuWCA6IGUuY2hhbmdlZFRvdWNoZXNbMF0uc2NyZWVuWDsKICAgICAgICAKICAgICAgICBjb25zdCBoYW5kbGVEcmFnU3RhcnQgPSAoZSkgPT4gewogICAgICAgICAgICBpZiAoZS50eXBlID09PSAnbW91c2Vkb3duJyAmJiBlLmJ1dHRvbiAhPT0gMCkgcmV0dXJuOwogICAgICAgICAgICBpc0RyYWdnaW5nID0gdHJ1ZTsKICAgICAgICAgICAgc3RhcnRYID0gZ2V0RXZlbnRYKGUpOwogICAgICAgICAgICBzdGFydEFuZ2xlID0gY3VycmVudEFuZ2xlOwogICAgICAgICAgICBmbGlwcGVyLnN0eWxlLnRyYW5zaXRpb24gPSAnbm9uZSc7CiAgICAgICAgICAgIGlmIChlLnR5cGUgIT09ICd0b3VjaHN0YXJ0JykgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIH07CgogICAgICAgIGNvbnN0IGhhbmRsZURyYWdNb3ZlID0gKGUpID0+IHsKICAgICAgICAgICAgaWYgKCFpc0RyYWdnaW5nKSByZXR1cm47CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgY29uc3QgZGVsdGFYID0gZ2V0RXZlbnRYKGUpIC0gc3RhcnRYOwogICAgICAgICAgICBjb25zdCByb3RhdGlvblNlbnNpdGl2aXR5ID0gMTgwIC8gY29udGFpbmVyLm9mZnNldFdpZHRoOwogICAgICAgICAgICBjdXJyZW50QW5nbGUgPSBzdGFydEFuZ2xlICsgKGRlbHRhWCAqIHJvdGF0aW9uU2Vuc2l0aXZpdHkpOwogICAgICAgICAgICBmbGlwcGVyLnN0eWxlLnRyYW5zZm9ybSA9IFxgcm90YXRlWShcJHtjdXJyZW50QW5nbGV9ZGVnKVxgOwogICAgICAgIH07CiAgICAgICAgCiAgICAgICAgY29uc3QgaGFuZGxlRHJhZ0VuZCA9ICgpID0+IHsKICAgICAgICAgICAgaWYgKCFpc0RyYWdnaW5nKSByZXR1cm47CiAgICAgICAgICAgIGlzRHJhZ2dpbmcgPSBmYWxzZTsKICAgICAgICAgICAgZmxpcHBlci5zdHlsZS50cmFuc2l0aW9uID0gJ3RyYW5zZm9ybSAwLjZzIGN1YmljLWJlemllcigwLjM0LCAxLjU2LCAwLjY0LCAxKSc7CiAgICAgICAgICAgIGNvbnN0IGZpbmFsUm90YXRpb24gPSBNYXRoLnJvdW5kKGN1cnJlbnRBbmdsZSAvIDE4MCkgKiAxODA7CiAgICAgICAgICAgIGlmIChjb250YWluZXIuaWQuaW5jbHVkZXMoJ21haW4tZG5pJykpIHsKICAgICAgICAgICAgICAgICBpc0ZsaXBwZWQgPSAoTWF0aC5yb3VuZChmaW5hbFJvdGF0aW9uIC8gMTgwKSAlIDIpICE9PSAwOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZsaXBwZXIuc3R5bGUudHJhbnNmb3JtID0gXGByb3RhdGVZKFwke2ZpbmFsUm90YXRpb259ZGVnKVxgOwogICAgICAgICAgICBjdXJyZW50QW5nbGUgPSBmaW5hbFJvdGF0aW9uOwogICAgICAgIH07CgogICAgICAgIGNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBoYW5kbGVEcmFnU3RhcnQpOwogICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIGhhbmRsZURyYWdNb3ZlKTsKICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgaGFuZGxlRHJhZ0VuZCk7CiAgICAgICAgY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCBoYW5kbGVEcmFnU3RhcnQsIHsgcGFzc2l2ZTogZmFsc2UgfSk7CiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJywgaGFuZGxlRHJhZ01vdmUsIHsgcGFzc2l2ZTogZmFsc2UgfSk7CiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCBoYW5kbGVEcmFnRW5kKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gc2V0dXBDYXJvdXNlbCgpIHsKICAgICAgICBjb25zdCBjYXJvdXNlbFdyYXBwZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWRpdG9yLWNhcm91c2VsLXdyYXBwZXInKTsKICAgICAgICBjb25zdCBjYXJvdXNlbFRyYWNrID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXRvci1jYXJvdXNlbC10cmFjaycpOwogICAgICAgIGNvbnN0IHNsaWRlcyA9IGNhcm91c2VsVHJhY2sgPyBBcnJheS5mcm9tKGNhcm91c2VsVHJhY2suY2hpbGRyZW4pIDogW107CiAgICAgICAgY29uc3QgZG90c0NvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlZGl0b3ItY2Fyb3VzZWwtZG90cycpOwogICAgICAgIAogICAgICAgIGlmIChjYXJvdXNlbFdyYXBwZXIgJiYgY2Fyb3VzZWxUcmFjayAmJiBzbGlkZXMubGVuZ3RoID4gMCAmJiBkb3RzQ29udGFpbmVyKSB7CiAgICAgICAgICAgIGxldCBjdXJyZW50SW5kZXggPSAwLCBpc0RyYWdnaW5nID0gZmFsc2UsIHN0YXJ0UG9zID0gMCwgY3VycmVudFRyYW5zbGF0ZSA9IDAsIHByZXZUcmFuc2xhdGUgPSAwLCBhbmltYXRpb25JRDsKICAgICAgICAgICAgY29uc3Qgc2xpZGVXaWR0aCA9ICgpID0+IHNsaWRlc1swXS5vZmZzZXRXaWR0aDsKICAgIAogICAgICAgICAgICBkb3RzQ29udGFpbmVyLmlubmVySFRNTCA9ICcnOwogICAgICAgICAgICBzbGlkZXMuZm9yRWFjaCgoXywgaSkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgZG90ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpOwogICAgICAgICAgICAgICAgZG90LmNsYXNzTGlzdC5hZGQoJ2Nhcm91c2VsLWRvdCcpOwogICAgICAgICAgICAgICAgaWYgKGkgPT09IDApIGRvdC5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgIGRvdC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IGdvVG9TbGlkZShpKSk7CiAgICAgICAgICAgICAgICBkb3RzQ29udGFpbmVyLmFwcGVuZENoaWxkKGRvdCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBjb25zdCBkb3RzID0gQXJyYXkuZnJvbShkb3RzQ29udGFpbmVyLmNoaWxkcmVuKTsKICAgIAogICAgICAgICAgICBmdW5jdGlvbiBnb1RvU2xpZGUoc2xpZGVJbmRleCkgewogICAgICAgICAgICAgICAgaWYgKHNsaWRlSW5kZXggPCAwIHx8IHNsaWRlSW5kZXggPj0gc2xpZGVzLmxlbmd0aCkgcmV0dXJuOwogICAgICAgICAgICAgICAgY29uc3Qgb2Zmc2V0ID0gLXNsaWRlSW5kZXggKiBzbGlkZVdpZHRoKCk7CiAgICAgICAgICAgICAgICBjYXJvdXNlbFRyYWNrLnN0eWxlLnRyYW5zZm9ybSA9IFxgdHJhbnNsYXRlWChcJHtvZmZzZXR9cHgpXGA7CiAgICAgICAgICAgICAgICBjYXJvdXNlbFRyYWNrLnN0eWxlLnRyYW5zaXRpb24gPSAndHJhbnNmb3JtIDAuM3MgZWFzZS1pbi1vdXQnOwogICAgICAgICAgICAgICAgY3VycmVudEluZGV4ID0gc2xpZGVJbmRleDsKICAgICAgICAgICAgICAgIGRvdHMuZm9yRWFjaCgoZG90LCBpKSA9PiBkb3QuY2xhc3NMaXN0LnRvZ2dsZSgnYWN0aXZlJywgaSA9PT0gY3VycmVudEluZGV4KSk7CiAgICAgICAgICAgICAgICBwcmV2VHJhbnNsYXRlID0gb2Zmc2V0OwogICAgICAgICAgICB9CiAgICAKICAgICAgICAgICAgY29uc3QgZ2V0UG9zaXRpb25YID0gKGUpID0+IGUudHlwZS5pbmNsdWRlcygnbW91c2UnKSA/IGUucGFnZVggOiBlLnRvdWNoZXNbMF0uY2xpZW50WDsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IHRvdWNoU3RhcnQgPSAoZSkgPT4gewogICAgICAgICAgICAgICAgaWYgKGUudGFyZ2V0LmNsb3Nlc3QoJy5jb250cm9sLWdyb3VwJykpIHJldHVybjsKICAgICAgICAgICAgICAgIGlzRHJhZ2dpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgc3RhcnRQb3MgPSBnZXRQb3NpdGlvblgoZSk7CiAgICAgICAgICAgICAgICBhbmltYXRpb25JRCA9IHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRpb24pOwogICAgICAgICAgICAgICAgY2Fyb3VzZWxUcmFjay5zdHlsZS50cmFuc2l0aW9uID0gJ25vbmUnOwogICAgICAgICAgICB9CiAgICAKICAgICAgICAgICAgY29uc3QgdG91Y2hNb3ZlID0gKGUpID0+IHsKICAgICAgICAgICAgICAgIGlmIChpc0RyYWdnaW5nKSBjdXJyZW50VHJhbnNsYXRlID0gcHJldlRyYW5zbGF0ZSArIGdldFBvc2l0aW9uWChlKSAtIHN0YXJ0UG9zOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCB0b3VjaEVuZCA9ICgpID0+IHsKICAgICAgICAgICAgICAgIGlmICghaXNEcmFnZ2luZykgcmV0dXJuOwogICAgICAgICAgICAgICAgaXNEcmFnZ2luZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgY2FuY2VsQW5pbWF0aW9uRnJhbWUoYW5pbWF0aW9uSUQpOwogICAgICAgICAgICAgICAgY29uc3QgbW92ZWRCeSA9IGN1cnJlbnRUcmFuc2xhdGUgLSBwcmV2VHJhbnNsYXRlOwogICAgICAgICAgICAgICAgaWYgKG1vdmVkQnkgPCAtMTAwICYmIGN1cnJlbnRJbmRleCA8IHNsaWRlcy5sZW5ndGggLSAxKSBjdXJyZW50SW5kZXgrKzsKICAgICAgICAgICAgICAgIGlmIChtb3ZlZEJ5ID4gMTAwICYmIGN1cnJlbnRJbmRleCA+IDApIGN1cnJlbnRJbmRleC0tOwogICAgICAgICAgICAgICAgZ29Ub1NsaWRlKGN1cnJlbnRJbmRleCk7CiAgICAgICAgICAgIH0KICAgIAogICAgICAgICAgICBmdW5jdGlvbiBhbmltYXRpb24oKSB7CiAgICAgICAgICAgICAgICBjYXJvdXNlbFRyYWNrLnN0eWxlLnRyYW5zZm9ybSA9IFxgdHJhbnNsYXRlWChcJHtjdXJyZW50VHJhbnNsYXRlfXB4KVxgOwogICAgICAgICAgICAgICAgaWYgKGlzRHJhZ2dpbmcpIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRpb24pOwogICAgICAgICAgICB9CiAgICAKICAgICAgICAgICAgc2xpZGVzLmZvckVhY2goc2xpZGUgPT4gewogICAgICAgICAgICAgICAgWyd0b3VjaHN0YXJ0JywgJ21vdXNlZG93biddLmZvckVhY2goZXZ0ID0+IHNsaWRlLmFkZEV2ZW50TGlzdGVuZXIoZXZ0LCB0b3VjaFN0YXJ0KSk7CiAgICAgICAgICAgICAgICBbJ3RvdWNoZW5kJywgJ21vdXNldXAnLCAnbW91c2VsZWF2ZSddLmZvckVhY2goZXZ0ID0+IHNsaWRlLmFkZEV2ZW50TGlzdGVuZXIoZXZ0LCB0b3VjaEVuZCkpOwogICAgICAgICAgICAgICAgWyd0b3VjaG1vdmUnLCAnbW91c2Vtb3ZlJ10uZm9yRWFjaChldnQgPT4gc2xpZGUuYWRkRXZlbnRMaXN0ZW5lcihldnQsIHRvdWNoTW92ZSkpOwogICAgICAgICAgICB9KTsKICAgIAogICAgICAgICAgICBuZXcgUmVzaXplT2JzZXJ2ZXIoKCkgPT4gZ29Ub1NsaWRlKGN1cnJlbnRJbmRleCkpLm9ic2VydmUoY2Fyb3VzZWxXcmFwcGVyKTsKICAgICAgICB9CiAgICB9CgogICAgLy8gLS0tIEV2ZW50IExpc3RlbmVycyAtLS0KICAgIGlmIChsb2dpbkJ0bikgewogICAgICAgIGxvZ2luQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKGUpID0+IHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBsb2dpbkVycm9yTXNnLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgIGNvbnN0IHVzZXJuYW1lID0gdXNlcm5hbWVJbnB1dC52YWx1ZTsKICAgICAgICAgICAgY29uc3QgcGFzc3dvcmQgPSBwYXNzd29yZElucHV0LnZhbHVlOwogICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBhcGlDYWxsKCdsb2dpbicsIHsgdXNlcm5hbWUsIHBhc3N3b3JkIH0pOwogICAgICAgICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHsKICAgICAgICAgICAgICAgIGlmIChsb2dpbkxvYWRpbmdPdmVybGF5KSBsb2dpbkxvYWRpbmdPdmVybGF5LnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7CiAgICAgICAgICAgICAgICBsb2dnZWRJblVzZXIgPSByZXN1bHQudXNlcjsKICAgICAgICAgICAgICAgIGFwcGx5VXNlckRhdGEocmVzdWx0LnVzZXIuZG5pRGF0YSk7CiAgICAgICAgICAgICAgICB1cGRhdGVVaUZvclVzZXJSb2xlKCk7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAobG9naW5Mb2FkaW5nT3ZlcmxheSkgbG9naW5Mb2FkaW5nT3ZlcmxheS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICAgICAgICAgIHNob3dTY3JlZW4oJ21haW4nKTsKICAgICAgICAgICAgICAgIH0sIDIwMDApOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbG9naW5FcnJvck1zZy50ZXh0Q29udGVudCA9IHJlc3VsdC5tZXNzYWdlIHx8ICdVc3VhcmlvIG8gY29udHJhc2XDsWEgaW5jb3JyZWN0b3MuJzsKICAgICAgICAgICAgICAgIGxvZ2luRXJyb3JNc2cuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KCiAgICBpZiAoZ3Vlc3RMb2dpbkJ0bikgewogICAgICAgIGd1ZXN0TG9naW5CdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIGlmIChsb2dpbkxvYWRpbmdPdmVybGF5KSBsb2dpbkxvYWRpbmdPdmVybGF5LnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7CiAgICAgICAgICAgIGxvZ2dlZEluVXNlciA9IHsgdXNlcm5hbWU6ICdJbnZpdGFkbycsIHJvbGU6ICdhZG1pbicgfTsKICAgICAgICAgICAgdXBkYXRlVWlGb3JVc2VyUm9sZSgpOwogICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgIGlmIChsb2dpbkxvYWRpbmdPdmVybGF5KSBsb2dpbkxvYWRpbmdPdmVybGF5LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgICAgICBzaG93U2NyZWVuKCdtYWluJyk7CiAgICAgICAgICAgIH0sIDE1MDApOwogICAgICAgIH0pOwogICAgfQoKICAgIGlmIChzYXZlVXNlckJ0bikgewogICAgICAgIHNhdmVVc2VyQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKCkgPT4gewogICAgICAgICAgICBjb25zdCB1c2VybmFtZSA9IG5ld1VzZXJuYW1lSW5wdXQudmFsdWUudHJpbSgpOwogICAgICAgICAgICBjb25zdCBwYXNzd29yZCA9IG5ld1Bhc3N3b3JkSW5wdXQudmFsdWUudHJpbSgpOwogICAgICAgICAgICBjb25zdCByb2xlID0gbmV3VXNlclJvbGVTZWxlY3QudmFsdWU7CiAgICAgICAgICAgIGNvbnN0IGlzRWRpdGluZyA9ICEhY3VycmVudGx5RWRpdGluZ1VzZXI7CiAgICAgICAgICAgIGlmICghdXNlcm5hbWUpIHsgYWxlcnQoJ1BvciBmYXZvciwgaW5ncmVzZSB1biBub21icmUgZGUgdXN1YXJpby4nKTsgcmV0dXJuOyB9CiAgICAgICAgICAgIGlmICghaXNFZGl0aW5nICYmICFwYXNzd29yZCkgeyBhbGVydCgnUG9yIGZhdm9yLCBpbmdyZXNlIHVuYSBjb250cmFzZcOxYSBwYXJhIGVsIG51ZXZvIHVzdWFyaW8uJyk7IHJldHVybjsgfQogICAgICAgICAgICBpZiAocGFzc3dvcmQgJiYgcGFzc3dvcmQubGVuZ3RoIDwgNikgeyBhbGVydCgnTGEgY29udHJhc2XDsWEgZGViZSB0ZW5lciBhbCBtZW5vcyA2IGNhcmFjdGVyZXMuJyk7IHJldHVybjsgfQogICAgICAgICAgICBjb25zdCB1c2VyRGF0YSA9IHsgdXNlcm5hbWUsIHBhc3N3b3JkLCByb2xlLCBkbmlEYXRhOiBnYXRoZXJDdXJyZW50RG5pRGF0YSgpIH07CiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGFwaUNhbGwoJ3NhdmVfdXNlcicsIHsgaXNFZGl0aW5nLCBjdXJyZW50bHlFZGl0aW5nVXNlciwgdXNlckRhdGEgfSk7CiAgICAgICAgICAgIGlmIChyZXN1bHQuc3VjY2VzcykgewogICAgICAgICAgICAgICAgYWxlcnQocmVzdWx0Lm1lc3NhZ2UgfHwgXGDCoVVzdWFyaW8gIlwke3VzZXJuYW1lfSIgZ3VhcmRhZG8gY29uIMOpeGl0byFcYCk7CiAgICAgICAgICAgICAgICByZXNldFVzZXJGb3JtKCk7CiAgICAgICAgICAgICAgICByZW5kZXJVc2VyTGlzdCgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgYWxlcnQoXGBFcnJvcjogXCR7cmVzdWx0Lm1lc3NhZ2UgfHwgJ05vIHNlIHB1ZG8gZ3VhcmRhciBlbCB1c3VhcmlvLid9XGApOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CgogICAgaWYgKGV4cG9ydFVzZXJzQnRuKSB7CiAgICAgICAgZXhwb3J0VXNlcnNCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHVzZXJzID0gYXdhaXQgYXBpQ2FsbCgnZ2V0X3VzZXJzJyk7CiAgICAgICAgICAgIGlmICghdXNlcnMgfHwgdXNlcnMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgICBhbGVydCgnTm8gaGF5IHVzdWFyaW9zIHBhcmEgZXhwb3J0YXIuJyk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgZGF0YVN0ciA9IEpTT04uc3RyaW5naWZ5KHVzZXJzLCBudWxsLCAyKTsKICAgICAgICAgICAgY29uc3QgZGF0YUJsb2IgPSBuZXcgQmxvYihbZGF0YVN0cl0sIHt0eXBlOiAiYXBwbGljYXRpb24vanNvbiJ9KTsKICAgICAgICAgICAgY29uc3QgdXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTChkYXRhQmxvYik7CiAgICAgICAgICAgIGNvbnN0IGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7CiAgICAgICAgICAgIGEuaHJlZiA9IHVybDsKICAgICAgICAgICAgYS5kb3dubG9hZCA9ICd1c3Vhcmlvcy5qc29uJzsKICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChhKTsKICAgICAgICAgICAgYS5jbGljaygpOwogICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGEpOwogICAgICAgICAgICBVUkwucmV2b2tlT2JqZWN0VVJMKHVybCk7CiAgICAgICAgfSk7CiAgICB9CgogICAgaWYgKGltcG9ydFVzZXJzSW5wdXQpIHsKICAgICAgICBpbXBvcnRVc2Vyc0lucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIChldmVudCkgPT4gewogICAgICAgICAgICBjb25zdCBmaWxlID0gZXZlbnQudGFyZ2V0LmZpbGVzPy5bMF07CiAgICAgICAgICAgIGlmICghZmlsZSkgcmV0dXJuOwogICAgICAgICAgICBpZiAoIWNvbmZpcm0oJ8K/RXN0w6Egc2VndXJvPyBFc3RvIHJlZW1wbGF6YXLDoSB0b2RvcyBsb3MgdXN1YXJpb3MgZ3VhcmRhZG9zIGFjdHVhbG1lbnRlLicpKSB7CiAgICAgICAgICAgICAgICAgZXZlbnQudGFyZ2V0LnZhbHVlID0gJyc7IHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwogICAgICAgICAgICByZWFkZXIub25sb2FkID0gYXN5bmMgKGUpID0+IHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29udGVudCA9IGUudGFyZ2V0Py5yZXN1bHQ7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdXNlcnMgPSBKU09OLnBhcnNlKGNvbnRlbnQpOwogICAgICAgICAgICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheSh1c2VycykpIHRocm93IG5ldyBFcnJvcignRWwgYXJjaGl2byBKU09OIG5vIGVzIHVuIGFycmF5IHbDoWxpZG8uJyk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYXBpQ2FsbCgnaW1wb3J0X3VzZXJzJywgeyB1c2VycyB9KTsKICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVuZGVyVXNlckxpc3QoKTsKICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnQoJ8KhVXN1YXJpb3MgaW1wb3J0YWRvcyBjb24gw6l4aXRvIScpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihyZXN1bHQubWVzc2FnZSB8fCAnRXJyb3IgZW4gZWwgc2Vydmlkb3IuJyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICBhbGVydCgnRXJyb3IgYWwgaW1wb3J0YXIgZWwgYXJjaGl2bzogJyArIGVycm9yLm1lc3NhZ2UpOwogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpOwogICAgICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICAgZXZlbnQudGFyZ2V0LnZhbHVlID0gJyc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHJlYWRlci5yZWFkQXNUZXh0KGZpbGUpOwogICAgICAgIH0pOwogICAgfQoKICAgIGlmIChpbWFnZVVybElucHV0ICYmIG1haW5EbmlQcm9maWxlSW1hZ2UgJiYgZWRpdG9yRG5pUHJvZmlsZUltYWdlKSB7CiAgICAgICAgaW1hZ2VVcmxJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsICgpID0+IHsKICAgICAgICAgICAgY29uc3QgbmV3VXJsID0gaW1hZ2VVcmxJbnB1dC52YWx1ZTsKICAgICAgICAgICAgbWFpbkRuaVByb2ZpbGVJbWFnZS5zcmMgPSBuZXdVcmw7CiAgICAgICAgICAgIGVkaXRvckRuaVByb2ZpbGVJbWFnZS5zcmMgPSBuZXdVcmw7CiAgICAgICAgICAgIGlmIChkZXRhaWxzUHJvZmlsZUltYWdlKSBkZXRhaWxzUHJvZmlsZUltYWdlLnNyYyA9IG5ld1VybDsKICAgICAgICB9KTsKICAgIH0KCiAgICBpZiAoZG5pQmFja1VybElucHV0ICYmIG1haW5EbmlCYWNrSW1hZ2UgJiYgZWRpdG9yRG5pQmFja0ltYWdlKSB7CiAgICAgICAgZG5pQmFja1VybElucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgKCkgPT4gewogICAgICAgICAgICBjb25zdCBuZXdVcmwgPSBkbmlCYWNrVXJsSW5wdXQudmFsdWU7CiAgICAgICAgICAgIG1haW5EbmlCYWNrSW1hZ2Uuc3JjID0gbmV3VXJsOwogICAgICAgICAgICBlZGl0b3JEbmlCYWNrSW1hZ2Uuc3JjID0gbmV3VXJsOwogICAgICAgIH0pOwogICAgfQoKICAgIGlmIChxclVybElucHV0KSB7CiAgICAgICAgcXJVcmxJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsICgpID0+IHsKICAgICAgICAgICAgY29uc3QgbmV3VXJsID0gcXJVcmxJbnB1dC52YWx1ZTsKICAgICAgICAgICAgaWYgKG1haW5EbmlRckltYWdlKSBtYWluRG5pUXJJbWFnZS5zcmMgPSBuZXdVcmw7CiAgICAgICAgICAgIGlmIChlZGl0b3JEbmlRckltYWdlKSBlZGl0b3JEbmlRckltYWdlLnNyYyA9IG5ld1VybDsKICAgICAgICAgICAgaWYgKGRldGFpbHNCYXJjb2RlSW1hZ2UpIGRldGFpbHNCYXJjb2RlSW1hZ2Uuc3JjID0gbmV3VXJsOwogICAgICAgIH0pOwogICAgfQoKICAgIGlmIChkb2N1bWVudG9zQnRuKSB7CiAgICAgICAgZG9jdW1lbnRvc0J0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgaWYgKGxvYWRpbmdPdmVybGF5KSBsb2FkaW5nT3ZlcmxheS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICBzaG93U2NyZWVuKCdkb2N1bWVudG9zJyk7CiAgICAgICAgICAgICAgICBpZiAobG9hZGluZ092ZXJsYXkpIGxvYWRpbmdPdmVybGF5LmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICB9LCAxNTAwKTsKICAgICAgICB9KTsKICAgIH0KICAgIAogICAgaWYgKHZlckRuaURpZ2l0YWxCdG4pIHsKICAgICAgICB2ZXJEbmlEaWdpdGFsQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBpZiAoYWN0aW9uTG9hZGVyKSBhY3Rpb25Mb2FkZXIuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgc2hvd0RuaURpZ2l0YWxWaWV3KCk7CiAgICAgICAgICAgICAgICBpZiAoYWN0aW9uTG9hZGVyKSBhY3Rpb25Mb2FkZXIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgICAgIH0sIDE1MDApOwogICAgICAgIH0pOwogICAgfQoKICAgIGlmIChlZGl0b3JCdG4pIHsKICAgICAgICBlZGl0b3JCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIHNob3dTY3JlZW4oJ2VkaXRvcicpOwogICAgICAgIH0pOwogICAgfQoKICAgIGlmIChiYWNrQnRuKSB7CiAgICAgICAgYmFja0J0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgIGlmKGRuaURpZ2l0YWxEaXNwbGF5ICYmIGdldENvbXB1dGVkU3R5bGUoZG5pRGlnaXRhbERpc3BsYXkpLmRpc3BsYXkgIT09ICdub25lJykgewogICAgICAgICAgICAgICAgcmVzZXREbmlDYXJkKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgc2hvd1NjcmVlbignbWFpbicpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CiAgICAKICAgIGlmIChkZXRhaWxzQmFja0J0bikgewogICAgICAgIGRldGFpbHNCYWNrQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBzaG93U2NyZWVuKCdkb2N1bWVudG9zJyk7CiAgICAgICAgICAgIHNob3dEbmlEaWdpdGFsVmlldygpOwogICAgICAgIH0pOwogICAgfQoKICAgIGlmIChlZGl0b3JCYWNrQnRuKSB7CiAgICAgICAgZWRpdG9yQmFja0J0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgc2hvd1NjcmVlbignbWFpbicpOwogICAgICAgIH0pOwogICAgfQoKICAgIGlmIChpbmljaW9CdG4pIHsKICAgICAgICBpbmljaW9CdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgc2hvd1NjcmVlbignbWFpbicpOwogICAgICAgIH0pOwogICAgfQoKICAgIGNvbnN0IGhhbmRsZVRlbGVmb25vc05hdiA9IChlKSA9PiB7CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIGlmIChsb2FkaW5nT3ZlcmxheSkgbG9hZGluZ092ZXJsYXkuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgIHNob3dTY3JlZW4oJ3RlbGVmb25vcycpOwogICAgICAgICAgICBpZiAobG9hZGluZ092ZXJsYXkpIGxvYWRpbmdPdmVybGF5LmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgIH0sIDE1MDApOwogICAgfTsKCiAgICBpZiAodGVsZWZvbm9zQnRuRG9jcykgdGVsZWZvbm9zQnRuRG9jcy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZVRlbGVmb25vc05hdik7CiAgICBpZiAodGVsZWZvbm9zQnRuRGV0YWlscykgdGVsZWZvbm9zQnRuRGV0YWlscy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZVRlbGVmb25vc05hdik7CiAgICBpZiAodGVsZWZvbm9zSW5pY2lvQnRuKSB7CiAgICAgICAgdGVsZWZvbm9zSW5pY2lvQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBpZiAobG9hZGluZ092ZXJsYXkpIGxvYWRpbmdPdmVybGF5LmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgIHNob3dTY3JlZW4oJ21haW4nKTsKICAgICAgICAgICAgICAgIGlmIChsb2FkaW5nT3ZlcmxheSkgbG9hZGluZ092ZXJsYXkuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgICAgIH0sIDE1MDApOwogICAgICAgIH0pOwogICAgfQoKICAgIGlmIChzb2xpY2l0YXJEbmlCdG4pIHsKICAgICAgICBzb2xpY2l0YXJEbmlCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIGlmIChhY3Rpb25Mb2FkZXIpIGFjdGlvbkxvYWRlci5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoZG5pSW5pdGlhbFZpZXcpIGRuaUluaXRpYWxWaWV3LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgICAgICBpZiAoZG5pQ2FyZEhlYWRlcikgZG5pQ2FyZEhlYWRlci5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICAgICAgaWYgKGRuaVNvbGljaXR1ZFZpZXcpIGRuaVNvbGljaXR1ZFZpZXcuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgICAgICAgICBpZiAoZG5pQ2FyZEJvZHkpIGRuaUNhcmRCb2R5LmNsYXNzTGlzdC5hZGQoJ25vLWhlYWRlcicpOwogICAgICAgICAgICAgICAgaWYgKGFjdGlvbkxvYWRlcikgYWN0aW9uTG9hZGVyLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICB9LCAxNTAwKTsKICAgICAgICB9KTsKICAgIH0KICAgIAogICAgaWYgKGNvbmZpcm1hclNvbGljaXR1ZEJ0bikgewogICAgICAgIGNvbmZpcm1hclNvbGljaXR1ZEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgaWYgKGFjdGlvbkxvYWRlcikgYWN0aW9uTG9hZGVyLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgIGlmIChkbmlTb2xpY2l0dWRWaWV3KSBkbmlTb2xpY2l0dWRWaWV3LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgICAgICBzaG93RG5pRGlnaXRhbFZpZXcoKTsKICAgICAgICAgICAgICAgIGlmIChhY3Rpb25Mb2FkZXIpIGFjdGlvbkxvYWRlci5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgfSwgMTUwMCk7CiAgICAgICAgfSk7CiAgICB9CiAgICAKICAgIGlmICh2ZXJEZXRhbGxlQnRuKSB7CiAgICAgICAgdmVyRGV0YWxsZUJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgcG9wdWxhdGVEbmlEZXRhaWxzKCk7CiAgICAgICAgICAgIHNob3dTY3JlZW4oJ2RldGFpbHMnKTsKICAgICAgICB9KTsKICAgIH0KCiAgICBpZiAodXNlclByb2ZpbGVCdG4gJiYgdXNlck1lbnUgJiYgcHJvZmlsZUFycm93KSB7CiAgICAgICAgdXNlclByb2ZpbGVCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgICB1c2VyTWVudS5jbGFzc0xpc3QudG9nZ2xlKCdhY3RpdmUnKTsKICAgICAgICAgICAgcHJvZmlsZUFycm93LmNsYXNzTGlzdC50b2dnbGUoJ3JvdGF0ZWQnKTsKICAgICAgICB9KTsKCiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgICAgICAgICBpZiAodXNlck1lbnUuY2xhc3NMaXN0LmNvbnRhaW5zKCdhY3RpdmUnKSkgewogICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0ID0gZS50YXJnZXQ7CiAgICAgICAgICAgICAgICBpZiAoIXVzZXJNZW51LmNvbnRhaW5zKHRhcmdldCkgJiYgIXVzZXJQcm9maWxlQnRuLmNvbnRhaW5zKHRhcmdldCkpIHsKICAgICAgICAgICAgICAgICAgICB1c2VyTWVudS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgICAgICBwcm9maWxlQXJyb3cuY2xhc3NMaXN0LnJlbW92ZSgncm90YXRlZCcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CgogICAgaWYgKG1lbnVFZGl0b3JCdG4pIHsKICAgICAgICBtZW51RWRpdG9yQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBzaG93U2NyZWVuKCdlZGl0b3InKTsKICAgICAgICAgICAgaWYgKHVzZXJNZW51ICYmIHByb2ZpbGVBcnJvdykgewogICAgICAgICAgICAgICAgIHVzZXJNZW51LmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgIHByb2ZpbGVBcnJvdy5jbGFzc0xpc3QucmVtb3ZlKCdyb3RhdGVkJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KCiAgICBpZiAodXNlck1lbnUgJiYgcHJvZmlsZUFycm93KSB7CiAgICAgICAgY29uc3Qgc2VsZWN0b3IgPSAnLnVzZXItbWVudS1saXN0IGE6bm90KCNtZW51LWVkaXRvci1idG4pLCAudXNlci1tZW51LWZvb3RlciBhJzsKICAgICAgICBjb25zdCBpbmFjdGl2ZUxpbmtzID0gdXNlck1lbnUucXVlcnlTZWxlY3RvckFsbChzZWxlY3Rvcik7CiAgICAgICAgaW5hY3RpdmVMaW5rcy5mb3JFYWNoKGxpbmsgPT4gewogICAgICAgICAgICBsaW5rLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgIHVzZXJNZW51LmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgcHJvZmlsZUFycm93LmNsYXNzTGlzdC5yZW1vdmUoJ3JvdGF0ZWQnKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICB9CgogICAgY29uc3QgZG5pQ2FyZCA9IGRvY3VtZW50b3NTY3JlZW4ucXVlcnlTZWxlY3RvcignLmRuaS1jYXJkJyk7CiAgICBpZiAoZG5pQ2FyZEhlYWRlciAmJiBkbmlDYXJkKSB7CiAgICAgICAgZG5pQ2FyZEhlYWRlci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgICAgY29uc3QgaXNJbml0aWFsU3RhdGUgPSBnZXRDb21wdXRlZFN0eWxlKGRuaUluaXRpYWxWaWV3KS5kaXNwbGF5ICE9PSAnbm9uZScgfHwgZ2V0Q29tcHV0ZWRTdHlsZShkbmlTb2xpY2l0dWRWaWV3KS5kaXNwbGF5ICE9PSAnbm9uZSc7CiAgICAgICAgICAgIGlmIChpc0luaXRpYWxTdGF0ZSkgewogICAgICAgICAgICAgICAgZG5pQ2FyZC5jbGFzc0xpc3QudG9nZ2xlKCdpcy1jb2xsYXBzZWQnKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfQp9KTtgOwogICAgICAgICAgICAvLyA0LiBDcmVhdGUgZmluYWwgSFRNTCBjb250ZW50CiAgICAgICAgICAgIGNvbnN0IGh0bWxEb2MgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xvbmVOb2RlKHRydWUpOwogICAgICAgICAgICBodG1sRG9jLnF1ZXJ5U2VsZWN0b3IoJyNhY3Rpb24tbG9hZGVyJyk/LmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICBodG1sRG9jLnF1ZXJ5U2VsZWN0b3IoJ3N0eWxlJykucmVtb3ZlKCk7CiAgICAgICAgICAgIGNvbnN0IGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaW5rJyk7CiAgICAgICAgICAgIGxpbmsucmVsID0gJ3N0eWxlc2hlZXQnOwogICAgICAgICAgICBsaW5rLmhyZWYgPSAnc3R5bGUuY3NzJzsKICAgICAgICAgICAgaHRtbERvYy5xdWVyeVNlbGVjdG9yKCdoZWFkJykuYXBwZW5kQ2hpbGQobGluayk7CiAgICAgICAgICAgIGh0bWxEb2MucXVlcnlTZWxlY3Rvcignc2NyaXB0W3R5cGU9Im1vZHVsZSJdJyk/LnJlbW92ZSgpOwogICAgICAgICAgICBBcnJheS5mcm9tKGh0bWxEb2MucXVlcnlTZWxlY3RvckFsbCgnc2NyaXB0JykpLmZpbmQocyA9PiBzLnNyYy5pbmNsdWRlcygnanN6aXAnKSk/LnJlbW92ZSgpOwogICAgICAgICAgICBjb25zdCBkb3dubG9hZEJ0bkluQ2xvbmUgPSBodG1sRG9jLnF1ZXJ5U2VsZWN0b3IoJyNkb3dubG9hZC1hcHAtYnRuJyk7CiAgICAgICAgICAgIGlmIChkb3dubG9hZEJ0bkluQ2xvbmUpIHsKICAgICAgICAgICAgICAgIGRvd25sb2FkQnRuSW5DbG9uZS5wcmV2aW91c0VsZW1lbnRTaWJsaW5nPy5yZW1vdmUoKTsgLy8gcmVtb3ZlIGhvcml6b250YWwgcnVsZQogICAgICAgICAgICAgICAgZG93bmxvYWRCdG5JbkNsb25lLnJlbW92ZSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IG5ld1NjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpOwogICAgICAgICAgICBuZXdTY3JpcHQuc3JjID0gYGFwcC5qcz92PSR7bmV3IERhdGUoKS5nZXRUaW1lKCl9YDsgLy8gQ2FjaGUgYnVzdGluZwogICAgICAgICAgICBodG1sRG9jLnF1ZXJ5U2VsZWN0b3IoJ2JvZHknKS5hcHBlbmRDaGlsZChuZXdTY3JpcHQpOwogICAgICAgICAgICBjb25zdCBmaW5hbEh0bWwgPSAnPCFET0NUWVBFIGh0bWw+XFxuJyArIGh0bWxEb2Mub3V0ZXJIVE1MOwogICAgICAgICAgICAvLyA1LiBaaXAgYW5kIERvd25sb2FkCiAgICAgICAgICAgIGNvbnN0IHppcCA9IG5ldyBKU1ppcCgpOwogICAgICAgICAgICB6aXAuZmlsZSgiaW5kZXguaHRtbCIsIGZpbmFsSHRtbCk7CiAgICAgICAgICAgIHppcC5maWxlKCJzdHlsZS5jc3MiLCBzdHlsZUNvbnRlbnQpOwogICAgICAgICAgICB6aXAuZmlsZSgiYXBwLmpzIiwgbWFpblNjcmlwdENvbnRlbnQpOwogICAgICAgICAgICB6aXAuZmlsZSgiYXBpLnBocCIsIHBocENvbnRlbnQpOwogICAgICAgICAgICB6aXAuZmlsZSgibWFuaWZlc3QuanNvbiIsIG1hbmlmZXN0Q29udGVudCk7CiAgICAgICAgICAgIHppcC5maWxlKCJzdy5qcyIsIHN3Q29udGVudCk7CiAgICAgICAgICAgIHppcC5maWxlKCJ1c3Vhcmlvcy5qc29uIiwgIltdIik7CiAgICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSBhd2FpdCB6aXAuZ2VuZXJhdGVBc3luYyh7IHR5cGU6ICJibG9iIiB9KTsKICAgICAgICAgICAgY29uc3QgdXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTChjb250ZW50KTsKICAgICAgICAgICAgY29uc3QgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsKICAgICAgICAgICAgYS5ocmVmID0gdXJsOwogICAgICAgICAgICBhLmRvd25sb2FkID0gJ21pLWFyZ2VudGluYS1hcHAuemlwJzsKICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChhKTsKICAgICAgICAgICAgYS5jbGljaygpOwogICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGEpOwogICAgICAgICAgICBVUkwucmV2b2tlT2JqZWN0VVJMKHVybCk7CiAgICAgICAgfQogICAgICAgIGNhdGNoIChlcnJvcikgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBnZW5lcmF0aW5nIFpJUDoiLCBlcnJvcik7CiAgICAgICAgICAgIGFsZXJ0KCJPY3VycmnDsyB1biBlcnJvciBhbCBnZW5lcmFyIGVsIGFyY2hpdm8gWklQLiIpOwogICAgICAgIH0KICAgICAgICBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKGxvYWRlcikKICAgICAgICAgICAgICAgIGxvYWRlci5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICB9CiAgICB9CiAgICAvLyAtLS0gRXZlbnQgTGlzdGVuZXJzIC0tLQogICAgaWYgKGxvZ2luQnRuKSB7CiAgICAgICAgbG9naW5CdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoZSkgPT4gewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIGxvZ2luRXJyb3JNc2cuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgY29uc3QgdXNlcm5hbWUgPSB1c2VybmFtZUlucHV0LnZhbHVlOwogICAgICAgICAgICBjb25zdCBwYXNzd29yZCA9IHBhc3N3b3JkSW5wdXQudmFsdWU7CiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGFwaUNhbGwoJ2xvZ2luJywgeyB1c2VybmFtZSwgcGFzc3dvcmQgfSk7CiAgICAgICAgICAgIGlmIChyZXN1bHQuc3VjY2VzcykgewogICAgICAgICAgICAgICAgaWYgKGxvZ2luTG9hZGluZ092ZXJsYXkpCiAgICAgICAgICAgICAgICAgICAgbG9naW5Mb2FkaW5nT3ZlcmxheS5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOwogICAgICAgICAgICAgICAgbG9nZ2VkSW5Vc2VyID0gcmVzdWx0LnVzZXI7CiAgICAgICAgICAgICAgICBhcHBseVVzZXJEYXRhKHJlc3VsdC51c2VyLmRuaURhdGEpOwogICAgICAgICAgICAgICAgdXBkYXRlVWlGb3JVc2VyUm9sZSgpOwogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGxvZ2luTG9hZGluZ092ZXJsYXkpCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2luTG9hZGluZ092ZXJsYXkuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgICAgICAgICBzaG93U2NyZWVuKCdtYWluJyk7CiAgICAgICAgICAgICAgICB9LCAyMDAwKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGxvZ2luRXJyb3JNc2cudGV4dENvbnRlbnQgPSByZXN1bHQubWVzc2FnZSB8fCAnVXN1YXJpbyBvIGNvbnRyYXNlw7FhIGluY29ycmVjdG9zLic7CiAgICAgICAgICAgICAgICBsb2dpbkVycm9yTXNnLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CiAgICBpZiAoZ3Vlc3RMb2dpbkJ0bikgewogICAgICAgIGd1ZXN0TG9naW5CdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIGlmIChsb2dpbkxvYWRpbmdPdmVybGF5KQogICAgICAgICAgICAgICAgbG9naW5Mb2FkaW5nT3ZlcmxheS5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOwogICAgICAgICAgICBsb2dnZWRJblVzZXIgPSB7IHVzZXJuYW1lOiAnSW52aXRhZG8nLCByb2xlOiAnYWRtaW4nIH07CiAgICAgICAgICAgIHVwZGF0ZVVpRm9yVXNlclJvbGUoKTsKICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAobG9naW5Mb2FkaW5nT3ZlcmxheSkKICAgICAgICAgICAgICAgICAgICBsb2dpbkxvYWRpbmdPdmVybGF5LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgICAgICBzaG93U2NyZWVuKCdtYWluJyk7CiAgICAgICAgICAgIH0sIDE1MDApOwogICAgICAgIH0pOwogICAgfQogICAgaWYgKHNhdmVVc2VyQnRuKSB7CiAgICAgICAgc2F2ZVVzZXJCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHVzZXJuYW1lID0gbmV3VXNlcm5hbWVJbnB1dC52YWx1ZS50cmltKCk7CiAgICAgICAgICAgIGNvbnN0IHBhc3N3b3JkID0gbmV3UGFzc3dvcmRJbnB1dC52YWx1ZS50cmltKCk7CiAgICAgICAgICAgIGNvbnN0IHJvbGUgPSBuZXdVc2VyUm9sZVNlbGVjdC52YWx1ZTsKICAgICAgICAgICAgY29uc3QgaXNFZGl0aW5nID0gISFjdXJyZW50bHlFZGl0aW5nVXNlcjsKICAgICAgICAgICAgaWYgKCF1c2VybmFtZSkgewogICAgICAgICAgICAgICAgYWxlcnQoJ1BvciBmYXZvciwgaW5ncmVzZSB1biBub21icmUgZGUgdXN1YXJpby4nKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIWlzRWRpdGluZyAmJiAhcGFzc3dvcmQpIHsKICAgICAgICAgICAgICAgIGFsZXJ0KCdQb3IgZmF2b3IsIGluZ3Jlc2UgdW5hIGNvbnRyYXNlw7FhIHBhcmEgZWwgbnVldm8gdXN1YXJpby4nKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocGFzc3dvcmQgJiYgcGFzc3dvcmQubGVuZ3RoIDwgNikgewogICAgICAgICAgICAgICAgYWxlcnQoJ0xhIGNvbnRyYXNlw7FhIGRlYmUgdGVuZXIgYWwgbWVub3MgNiBjYXJhY3RlcmVzLicpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IHVzZXJEYXRhID0geyB1c2VybmFtZSwgcGFzc3dvcmQsIHJvbGUsIGRuaURhdGE6IGdhdGhlckN1cnJlbnREbmlEYXRhKCkgfTsKICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYXBpQ2FsbCgnc2F2ZV91c2VyJywgeyBpc0VkaXRpbmcsIGN1cnJlbnRseUVkaXRpbmdVc2VyLCB1c2VyRGF0YSB9KTsKICAgICAgICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7CiAgICAgICAgICAgICAgICBhbGVydChyZXN1bHQubWVzc2FnZSB8fCBgwqFVc3VhcmlvICIke3VzZXJuYW1lfSIgZ3VhcmRhZG8gY29uIMOpeGl0byFgKTsKICAgICAgICAgICAgICAgIHJlc2V0VXNlckZvcm0oKTsKICAgICAgICAgICAgICAgIHJlbmRlclVzZXJMaXN0KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBhbGVydChgRXJyb3I6ICR7cmVzdWx0Lm1lc3NhZ2UgfHwgJ05vIHNlIHB1ZG8gZ3VhcmRhciBlbCB1c3VhcmlvLid9YCk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KICAgIGlmIChleHBvcnRVc2Vyc0J0bikgewogICAgICAgIGV4cG9ydFVzZXJzQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKCkgPT4gewogICAgICAgICAgICBjb25zdCB1c2VycyA9IGF3YWl0IGFwaUNhbGwoJ2dldF91c2VycycpOwogICAgICAgICAgICBpZiAoIXVzZXJzIHx8IHVzZXJzLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgYWxlcnQoJ05vIGhheSB1c3VhcmlvcyBwYXJhIGV4cG9ydGFyLicpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGRhdGFTdHIgPSBKU09OLnN0cmluZ2lmeSh1c2VycywgbnVsbCwgMik7CiAgICAgICAgICAgIGNvbnN0IGRhdGFCbG9iID0gbmV3IEJsb2IoW2RhdGFTdHJdLCB7IHR5cGU6ICJhcHBsaWNhdGlvbi9qc29uIiB9KTsKICAgICAgICAgICAgY29uc3QgdXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTChkYXRhQmxvYik7CiAgICAgICAgICAgIGNvbnN0IGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7CiAgICAgICAgICAgIGEuaHJlZiA9IHVybDsKICAgICAgICAgICAgYS5kb3dubG9hZCA9ICd1c3Vhcmlvcy5qc29uJzsKICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChhKTsKICAgICAgICAgICAgYS5jbGljaygpOwogICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGEpOwogICAgICAgICAgICBVUkwucmV2b2tlT2JqZWN0VVJMKHVybCk7CiAgICAgICAgfSk7CiAgICB9CiAgICBpZiAoaW1wb3J0VXNlcnNJbnB1dCkgewogICAgICAgIGltcG9ydFVzZXJzSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKGV2ZW50KSA9PiB7CiAgICAgICAgICAgIGNvbnN0IGZpbGUgPSBldmVudC50YXJnZXQuZmlsZXM/LlswXTsKICAgICAgICAgICAgaWYgKCFmaWxlKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBpZiAoIWNvbmZpcm0oJ8K/RXN0w6Egc2VndXJvPyBFc3RvIHJlZW1wbGF6YXLDoSB0b2RvcyBsb3MgdXN1YXJpb3MgZ3VhcmRhZG9zIGFjdHVhbG1lbnRlLicpKSB7CiAgICAgICAgICAgICAgICBldmVudC50YXJnZXQudmFsdWUgPSAnJzsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwogICAgICAgICAgICByZWFkZXIub25sb2FkID0gYXN5bmMgKGUpID0+IHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29udGVudCA9IGUudGFyZ2V0Py5yZXN1bHQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFjb250ZW50KQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0VsIGFyY2hpdm8gZXN0w6EgdmFjw61vLicpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHVzZXJzID0gSlNPTi5wYXJzZShjb250ZW50KTsKICAgICAgICAgICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkodXNlcnMpKQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0VsIGFyY2hpdm8gSlNPTiBubyBlcyB1biBhcnJheSB2w6FsaWRvLicpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGFwaUNhbGwoJ2ltcG9ydF91c2VycycsIHsgdXNlcnMgfSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlbmRlclVzZXJMaXN0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0KCfCoVVzdWFyaW9zIGltcG9ydGFkb3MgY29uIMOpeGl0byEnKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihyZXN1bHQubWVzc2FnZSB8fCAnRXJyb3IgZW4gZWwgc2Vydmlkb3IuJyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICAgICAgYWxlcnQoJ0Vycm9yIGFsIGltcG9ydGFyIGVsIGFyY2hpdm86ICcgKyBlcnJvci5tZXNzYWdlKTsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZpbmFsbHkgewogICAgICAgICAgICAgICAgICAgIGV2ZW50LnRhcmdldC52YWx1ZSA9ICcnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgICByZWFkZXIucmVhZEFzVGV4dChmaWxlKTsKICAgICAgICB9KTsKICAgIH0KICAgIGlmIChpbWFnZVVybElucHV0ICYmIG1haW5EbmlQcm9maWxlSW1hZ2UgJiYgZWRpdG9yRG5pUHJvZmlsZUltYWdlKSB7CiAgICAgICAgaW1hZ2VVcmxJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsICgpID0+IHsKICAgICAgICAgICAgY29uc3QgbmV3VXJsID0gaW1hZ2VVcmxJbnB1dC52YWx1ZTsKICAgICAgICAgICAgbWFpbkRuaVByb2ZpbGVJbWFnZS5zcmMgPSBuZXdVcmw7CiAgICAgICAgICAgIGVkaXRvckRuaVByb2ZpbGVJbWFnZS5zcmMgPSBuZXdVcmw7CiAgICAgICAgICAgIGlmIChkZXRhaWxzUHJvZmlsZUltYWdlKQogICAgICAgICAgICAgICAgZGV0YWlsc1Byb2ZpbGVJbWFnZS5zcmMgPSBuZXdVcmw7CiAgICAgICAgfSk7CiAgICB9CiAgICBpZiAoZG5pQmFja1VybElucHV0ICYmIG1haW5EbmlCYWNrSW1hZ2UgJiYgZWRpdG9yRG5pQmFja0ltYWdlKSB7CiAgICAgICAgZG5pQmFja1VybElucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgKCkgPT4gewogICAgICAgICAgICBjb25zdCBuZXdVcmwgPSBkbmlCYWNrVXJsSW5wdXQudmFsdWU7CiAgICAgICAgICAgIG1haW5EbmlCYWNrSW1hZ2Uuc3JjID0gbmV3VXJsOwogICAgICAgICAgICBlZGl0b3JEbmlCYWNrSW1hZ2Uuc3JjID0gbmV3VXJsOwogICAgICAgIH0pOwogICAgfQogICAgaWYgKHFyVXJsSW5wdXQpIHsKICAgICAgICBxclVybElucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgKCkgPT4gewogICAgICAgICAgICBjb25zdCBuZXdVcmwgPSBxclVybElucHV0LnZhbHVlOwogICAgICAgICAgICBpZiAobWFpbkRuaVFySW1hZ2UpCiAgICAgICAgICAgICAgICBtYWluRG5pUXJJbWFnZS5zcmMgPSBuZXdVcmw7CiAgICAgICAgICAgIGlmIChlZGl0b3JEbmlRckltYWdlKQogICAgICAgICAgICAgICAgZWRpdG9yRG5pUXJJbWFnZS5zcmMgPSBuZXdVcmw7CiAgICAgICAgICAgIGlmIChkZXRhaWxzQmFyY29kZUltYWdlKQogICAgICAgICAgICAgICAgZGV0YWlsc0JhcmNvZGVJbWFnZS5zcmMgPSBuZXdVcmw7CiAgICAgICAgfSk7CiAgICB9CiAgICBpZiAoZG9jdW1lbnRvc0J0bikgewogICAgICAgIGRvY3VtZW50b3NCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIGlmIChsb2FkaW5nT3ZlcmxheSkKICAgICAgICAgICAgICAgIGxvYWRpbmdPdmVybGF5LmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgIHNob3dTY3JlZW4oJ2RvY3VtZW50b3MnKTsKICAgICAgICAgICAgICAgIGlmIChsb2FkaW5nT3ZlcmxheSkKICAgICAgICAgICAgICAgICAgICBsb2FkaW5nT3ZlcmxheS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgfSwgMTUwMCk7CiAgICAgICAgfSk7CiAgICB9CiAgICBpZiAodmVyRG5pRGlnaXRhbEJ0bikgewogICAgICAgIHZlckRuaURpZ2l0YWxCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIGlmIChhY3Rpb25Mb2FkZXIpCiAgICAgICAgICAgICAgICBhY3Rpb25Mb2FkZXIuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgc2hvd0RuaURpZ2l0YWxWaWV3KCk7CiAgICAgICAgICAgICAgICBpZiAoYWN0aW9uTG9hZGVyKQogICAgICAgICAgICAgICAgICAgIGFjdGlvbkxvYWRlci5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgfSwgMTUwMCk7CiAgICAgICAgfSk7CiAgICB9CiAgICBpZiAoZWRpdG9yQnRuKSB7CiAgICAgICAgZWRpdG9yQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBzaG93U2NyZWVuKCdlZGl0b3InKTsKICAgICAgICB9KTsKICAgIH0KICAgIGlmIChiYWNrQnRuKSB7CiAgICAgICAgYmFja0J0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgaWYgKGRuaURpZ2l0YWxEaXNwbGF5ICYmIGdldENvbXB1dGVkU3R5bGUoZG5pRGlnaXRhbERpc3BsYXkpLmRpc3BsYXkgIT09ICdub25lJykgewogICAgICAgICAgICAgICAgcmVzZXREbmlDYXJkKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBzaG93U2NyZWVuKCdtYWluJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KICAgIGlmIChkZXRhaWxzQmFja0J0bikgewogICAgICAgIGRldGFpbHNCYWNrQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBzaG93U2NyZWVuKCdkb2N1bWVudG9zJyk7CiAgICAgICAgICAgIHNob3dEbmlEaWdpdGFsVmlldygpOwogICAgICAgIH0pOwogICAgfQogICAgaWYgKGVkaXRvckJhY2tCdG4pIHsKICAgICAgICBlZGl0b3JCYWNrQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBzaG93U2NyZWVuKCdtYWluJyk7CiAgICAgICAgfSk7CiAgICB9CiAgICBpZiAoaW5pY2lvQnRuKSB7CiAgICAgICAgaW5pY2lvQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBzaG93U2NyZWVuKCdtYWluJyk7CiAgICAgICAgfSk7CiAgICB9CiAgICBjb25zdCBoYW5kbGVUZWxlZm9ub3NOYXYgPSAoZSkgPT4gewogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICBpZiAobG9hZGluZ092ZXJsYXkpCiAgICAgICAgICAgIGxvYWRpbmdPdmVybGF5LmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICBzaG93U2NyZWVuKCd0ZWxlZm9ub3MnKTsKICAgICAgICAgICAgaWYgKGxvYWRpbmdPdmVybGF5KQogICAgICAgICAgICAgICAgbG9hZGluZ092ZXJsYXkuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgfSwgMTUwMCk7CiAgICB9OwogICAgaWYgKHRlbGVmb25vc0J0bkRvY3MpCiAgICAgICAgdGVsZWZvbm9zQnRuRG9jcy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZVRlbGVmb25vc05hdik7CiAgICBpZiAodGVsZWZvbm9zQnRuRGV0YWlscykKICAgICAgICB0ZWxlZm9ub3NCdG5EZXRhaWxzLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlVGVsZWZvbm9zTmF2KTsKICAgIGlmICh0ZWxlZm9ub3NJbmljaW9CdG4pIHsKICAgICAgICB0ZWxlZm9ub3NJbmljaW9CdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIGlmIChsb2FkaW5nT3ZlcmxheSkKICAgICAgICAgICAgICAgIGxvYWRpbmdPdmVybGF5LmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgIHNob3dTY3JlZW4oJ21haW4nKTsKICAgICAgICAgICAgICAgIGlmIChsb2FkaW5nT3ZlcmxheSkKICAgICAgICAgICAgICAgICAgICBsb2FkaW5nT3ZlcmxheS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgfSwgMTUwMCk7CiAgICAgICAgfSk7CiAgICB9CiAgICBpZiAoc29saWNpdGFyRG5pQnRuKSB7CiAgICAgICAgc29saWNpdGFyRG5pQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBpZiAoYWN0aW9uTG9hZGVyKQogICAgICAgICAgICAgICAgYWN0aW9uTG9hZGVyLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgIGlmIChkbmlJbml0aWFsVmlldykKICAgICAgICAgICAgICAgICAgICBkbmlJbml0aWFsVmlldy5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICAgICAgaWYgKGRuaUNhcmRIZWFkZXIpCiAgICAgICAgICAgICAgICAgICAgZG5pQ2FyZEhlYWRlci5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICAgICAgaWYgKGRuaVNvbGljaXR1ZFZpZXcpCiAgICAgICAgICAgICAgICAgICAgZG5pU29saWNpdHVkVmlldy5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICAgICAgICAgIGlmIChkbmlDYXJkQm9keSkKICAgICAgICAgICAgICAgICAgICBkbmlDYXJkQm9keS5jbGFzc0xpc3QuYWRkKCduby1oZWFkZXInKTsKICAgICAgICAgICAgICAgIGlmIChhY3Rpb25Mb2FkZXIpCiAgICAgICAgICAgICAgICAgICAgYWN0aW9uTG9hZGVyLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICB9LCAxNTAwKTsKICAgICAgICB9KTsKICAgIH0KICAgIGlmIChjb25maXJtYXJTb2xpY2l0dWRCdG4pIHsKICAgICAgICBjb25maXJtYXJTb2xpY2l0dWRCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIGlmIChhY3Rpb25Mb2FkZXIpCiAgICAgICAgICAgICAgICBhY3Rpb25Mb2FkZXIuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgaWYgKGRuaVNvbGljaXR1ZFZpZXcpCiAgICAgICAgICAgICAgICAgICAgZG5pU29saWNpdHVkVmlldy5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICAgICAgc2hvd0RuaURpZ2l0YWxWaWV3KCk7CiAgICAgICAgICAgICAgICBpZiAoYWN0aW9uTG9hZGVyKQogICAgICAgICAgICAgICAgICAgIGFjdGlvbkxvYWRlci5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgfSwgMTUwMCk7CiAgICAgICAgfSk7CiAgICB9CiAgICBpZiAodmVyRGV0YWxsZUJ0bikgewogICAgICAgIHZlckRldGFsbGVCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIHBvcHVsYXRlRG5pRGV0YWlscygpOwogICAgICAgICAgICBzaG93U2NyZWVuKCdkZXRhaWxzJyk7CiAgICAgICAgfSk7CiAgICB9CiAgICBpZiAodXNlclByb2ZpbGVCdG4gJiYgdXNlck1lbnUgJiYgcHJvZmlsZUFycm93KSB7CiAgICAgICAgdXNlclByb2ZpbGVCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgICB1c2VyTWVudS5jbGFzc0xpc3QudG9nZ2xlKCdhY3RpdmUnKTsKICAgICAgICAgICAgcHJvZmlsZUFycm93LmNsYXNzTGlzdC50b2dnbGUoJ3JvdGF0ZWQnKTsKICAgICAgICB9KTsKICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICAgICAgICAgIGlmICh1c2VyTWVudS5jbGFzc0xpc3QuY29udGFpbnMoJ2FjdGl2ZScpKSB7CiAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXQgPSBlLnRhcmdldDsKICAgICAgICAgICAgICAgIGlmICghdXNlck1lbnUuY29udGFpbnModGFyZ2V0KSAmJiAhdXNlclByb2ZpbGVCdG4uY29udGFpbnModGFyZ2V0KSkgewogICAgICAgICAgICAgICAgICAgIHVzZXJNZW51LmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgICAgIHByb2ZpbGVBcnJvdy5jbGFzc0xpc3QucmVtb3ZlKCdyb3RhdGVkJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KICAgIGlmIChtZW51RWRpdG9yQnRuKSB7CiAgICAgICAgbWVudUVkaXRvckJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgc2hvd1NjcmVlbignZWRpdG9yJyk7CiAgICAgICAgICAgIGlmICh1c2VyTWVudSAmJiBwcm9maWxlQXJyb3cpIHsKICAgICAgICAgICAgICAgIHVzZXJNZW51LmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgcHJvZmlsZUFycm93LmNsYXNzTGlzdC5yZW1vdmUoJ3JvdGF0ZWQnKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfQogICAgaWYgKHVzZXJNZW51ICYmIHByb2ZpbGVBcnJvdykgewogICAgICAgIGNvbnN0IHNlbGVjdG9yID0gJy51c2VyLW1lbnUtbGlzdCBhOm5vdCgjbWVudS1lZGl0b3ItYnRuKSwgLnVzZXItbWVudS1mb290ZXIgYSc7CiAgICAgICAgY29uc3QgaW5hY3RpdmVMaW5rcyA9IHVzZXJNZW51LnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpOwogICAgICAgIGluYWN0aXZlTGlua3MuZm9yRWFjaChsaW5rID0+IHsKICAgICAgICAgICAgbGluay5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICB1c2VyTWVudS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgIHByb2ZpbGVBcnJvdy5jbGFzc0xpc3QucmVtb3ZlKCdyb3RhdGVkJyk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgfQogICAgY29uc3QgZG5pQ2FyZCA9IGRvY3VtZW50b3NTY3JlZW4ucXVlcnlTZWxlY3RvcignLmRuaS1jYXJkJyk7CiAgICBpZiAoZG5pQ2FyZEhlYWRlciAmJiBkbmlDYXJkKSB7CiAgICAgICAgZG5pQ2FyZEhlYWRlci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgICAgY29uc3QgaXNJbml0aWFsU3RhdGUgPSAoZG5pSW5pdGlhbFZpZXcgJiYgZ2V0Q29tcHV0ZWRTdHlsZShkbmlJbml0aWFsVmlldykuZGlzcGxheSAhPT0gJ25vbmUnKSB8fAogICAgICAgICAgICAgICAgKGRuaVNvbGljaXR1ZFZpZXcgJiYgZ2V0Q29tcHV0ZWRTdHlsZShkbmlTb2xpY2l0dWRWaWV3KS5kaXNwbGF5ICE9PSAnbm9uZScpOwogICAgICAgICAgICBpZiAoaXNJbml0aWFsU3RhdGUpIHsKICAgICAgICAgICAgICAgIGRuaUNhcmQuY2xhc3NMaXN0LnRvZ2dsZSgnaXMtY29sbGFwc2VkJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KICAgIGlmIChkb3dubG9hZEFwcEJ0bikgewogICAgICAgIGRvd25sb2FkQXBwQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZ2VuZXJhdGVBbmREb3dubG9hZEh0bWwpOwogICAgfQogICAgLy8gSGFuZGxlIFRpbmEgbGlua3MgdG8gb3BlbiBXaGF0c0FwcAogICAgY29uc3QgdGluYUxpbmtzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnRpbmEtbGluaycpOwogICAgdGluYUxpbmtzLmZvckVhY2gobGluayA9PiB7CiAgICAgICAgbGluay5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgY29uc3Qgd2hhdHNhcHBVcmwgPSAnaHR0cHM6Ly93YS5tZS81NDkxMTM5MTAxMDEwJzsKICAgICAgICAgICAgd2luZG93Lm9wZW4od2hhdHNhcHBVcmwsICdfYmxhbmsnLCAnbm9vcGVuZXIsbm9yZWZlcnJlcicpOwogICAgICAgIH0pOwogICAgfSk7CiAgICAvLyBQcmV2ZW50IHBsYWNlaG9sZGVyIGxpbmtzIGZyb20gbmF2aWdhdGluZyBhd2F5IGZyb20gdGhlIGFwcAogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnYVtocmVmPSIjIl06bm90KC50aW5hLWxpbmspJykuZm9yRWFjaChsaW5rID0+IHsKICAgICAgICBsaW5rLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIH0pOwogICAgfSk7CiAgICAvLyAtLS0gSW5pdGlhbCBTZXR1cCAtLS0KICAgIGNvbnN0IHByb2ZpbGVQaWNUYXJnZXRzID0gW2VkaXRvckRuaVByb2ZpbGVQaWMsIG1haW5EbmlQcm9maWxlUGljXTsKICAgIHNldHVwU2xpZGVyKHRvcFNsaWRlciwgcHJvZmlsZVBpY1RhcmdldHMsICd0b3AnLCB0b3BWYWx1ZSwgJyUnKTsKICAgIHNldHVwU2xpZGVyKGxlZnRTbGlkZXIsIHByb2ZpbGVQaWNUYXJnZXRzLCAnbGVmdCcsIGxlZnRWYWx1ZSwgJyUnKTsKICAgIHNldHVwU2xpZGVyKHdpZHRoU2xpZGVyLCBwcm9maWxlUGljVGFyZ2V0cywgJ3dpZHRoJywgd2lkdGhWYWx1ZSwgJyUnKTsKICAgIHNldHVwU2xpZGVyKGhlaWdodFNsaWRlciwgcHJvZmlsZVBpY1RhcmdldHMsICdoZWlnaHQnLCBoZWlnaHRWYWx1ZSwgJyUnKTsKICAgIGNvbnN0IHFyUGljVGFyZ2V0cyA9IFtlZGl0b3JEbmlRclBpYywgbWFpbkRuaVFyUGljXTsKICAgIHNldHVwU2xpZGVyKHFyVG9wU2xpZGVyLCBxclBpY1RhcmdldHMsICd0b3AnLCBxclRvcFZhbHVlLCAnJScpOwogICAgc2V0dXBTbGlkZXIocXJMZWZ0U2xpZGVyLCBxclBpY1RhcmdldHMsICdsZWZ0JywgcXJMZWZ0VmFsdWUsICclJyk7CiAgICBzZXR1cFNsaWRlcihxcldpZHRoU2xpZGVyLCBxclBpY1RhcmdldHMsICd3aWR0aCcsIHFyV2lkdGhWYWx1ZSwgJyUnKTsKICAgIHNldHVwU2xpZGVyKHFySGVpZ2h0U2xpZGVyLCBxclBpY1RhcmdldHMsICdoZWlnaHQnLCBxckhlaWdodFZhbHVlLCAnJScpOwogICAgY29uc3QgdGV4dEZpZWxkcyA9IFsnYXBlbGxpZG8nLCAnbm9tYnJlJywgJ2RvY3VtZW50bycsICduYWNpbWllbnRvJywgJ3RyYW1pdGUnLCAnZWplbXBsYXInLCAnZW1pc2lvbicsICd2ZW5jaW1pZW50bycsICdkb21pY2lsaW8nLCAnc2V4bycsICdjdWlsJ107CiAgICB0ZXh0RmllbGRzLmZvckVhY2goc2V0dXBUZXh0Q29udHJvbCk7CiAgICBzZXR1cEZsaXBwZXIoZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmRuaS1mbGlwcGVyLWNvbnRhaW5lcicpLCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZG5pLWZsaXBwZXInKSk7CiAgICBzZXR1cEZsaXBwZXIoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXRvci1kbmktZmxpcHBlci1jb250YWluZXInKSwgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXRvci1kbmktZmxpcHBlcicpKTsKICAgIHNldHVwQ2Fyb3VzZWwoKTsKICAgIGNvbnN0IGluaXRpYWxEYXRhID0gZ2F0aGVyQ3VycmVudERuaURhdGEoKTsKICAgIGFwcGx5VXNlckRhdGEoaW5pdGlhbERhdGEpOwogICAgcmVuZGVyVXNlckxpc3QoKTsKfSk7Cg==","@/sw":"data:application/javascript;base64,Y29uc3QgQ0FDSEVfTkFNRSA9ICdtaWFyZ2VudGluYS1jYWNoZS12NCc7Ci8vIFRoaXMgbGlzdCBzaG91bGQgaW5jbHVkZSBhbGwgdGhlIGZ1bmRhbWVudGFsIGZpbGVzIGZvciB5b3VyIGFwcCBzaGVsbCB0byB3b3JrIG9mZmxpbmUuCmNvbnN0IHVybHNUb0NhY2hlID0gWwogICcvJywKICAnaW5kZXguaHRtbCcsCiAgLy8gVGhlIEpTIGFuZCBDU1MgYXJlIGlubGluZSwgc28gY2FjaGluZyBpbmRleC5odG1sIGlzIGVub3VnaC4KICAvLyBBZGQgYW55IGV4dGVybmFsIGFzc2V0cyB0aGF0IGFyZSBjcml0aWNhbC4KICAnaHR0cHM6Ly9paWxpLmlvL0tYRlJxS3UubWQucG5nJywgLy8gRE5JIEZyb250CiAgJ2h0dHBzOi8vaWlsaS5pby9LVzF6SWIxLm1kLnBuZycsIC8vIEROSSBCYWNrCiAgJ2h0dHBzOi8vaWlsaS5pby9LWFJCbnRhLmpwZycgLy8gQXBwIEljb24KXTsKCi8vIEluc3RhbGwgZXZlbnQ6IGZpcmVzIHdoZW4gdGhlIGJyb3dzZXIgaW5zdGFsbHMgdGhlIHNlcnZpY2Ugd29ya2VyLgpzZWxmLmFkZEV2ZW50TGlzdGVuZXIoJ2luc3RhbGwnLCBldmVudCA9PiB7CiAgZXZlbnQud2FpdFVudGlsKAogICAgY2FjaGVzLm9wZW4oQ0FDSEVfTkFNRSkKICAgICAgLnRoZW4oY2FjaGUgPT4gewogICAgICAgIGNvbnNvbGUubG9nKCdPcGVuZWQgY2FjaGUsIGFkZGluZyBhcHAgc2hlbGwgZmlsZXMnKTsKICAgICAgICByZXR1cm4gY2FjaGUuYWRkQWxsKHVybHNUb0NhY2hlKTsKICAgICAgfSkKICApOwp9KTsKCi8vIEFjdGl2YXRlIGV2ZW50OiBmaXJlcyB3aGVuIHRoZSBzZXJ2aWNlIHdvcmtlciBiZWNvbWVzIGFjdGl2ZS4KLy8gVGhpcyBpcyBhIGdvb2QgcGxhY2UgdG8gbWFuYWdlIG9sZCBjYWNoZXMuCnNlbGYuYWRkRXZlbnRMaXN0ZW5lcignYWN0aXZhdGUnLCBldmVudCA9PiB7CiAgY29uc3QgY2FjaGVXaGl0ZWxpc3QgPSBbQ0FDSEVfTkFNRV07CiAgZXZlbnQud2FpdFVudGlsKAogICAgY2FjaGVzLmtleXMoKS50aGVuKGNhY2hlTmFtZXMgPT4gewogICAgICByZXR1cm4gUHJvbWlzZS5hbGwoCiAgICAgICAgY2FjaGVOYW1lcy5tYXAoY2FjaGVOYW1lID0+IHsKICAgICAgICAgIC8vIElmIGEgY2FjaGUgbmFtZSBpcyBub3QgaW4gb3VyIHdoaXRlbGlzdCwgd2UgZGVsZXRlIGl0LgogICAgICAgICAgaWYgKGNhY2hlV2hpdGVsaXN0LmluZGV4T2YoY2FjaGVOYW1lKSA9PT0gLTEpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coJ0RlbGV0aW5nIG9sZCBjYWNoZTonLCBjYWNoZU5hbWUpOwogICAgICAgICAgICByZXR1cm4gY2FjaGVzLmRlbGV0ZShjYWNoZU5hbWUpOwogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICk7CiAgICB9KQogICk7Cn0pOwoKLy8gRmV0Y2ggZXZlbnQ6IGZpcmVzIGZvciBldmVyeSBuZXR3b3JrIHJlcXVlc3QuCi8vIEltcGxlbWVudHMgYSAiTmV0d29yayBGaXJzdCwgZmFsbGluZyBiYWNrIHRvIENhY2hlIiBzdHJhdGVneS4Kc2VsZi5hZGRFdmVudExpc3RlbmVyKCdmZXRjaCcsIGV2ZW50ID0+IHsKICBldmVudC5yZXNwb25kV2l0aCgKICAgIC8vIFRyeSB0byBmZXRjaCBmcm9tIHRoZSBuZXR3b3JrIGZpcnN0LgogICAgZmV0Y2goZXZlbnQucmVxdWVzdCkudGhlbihuZXR3b3JrUmVzcG9uc2UgPT4gewogICAgICAvLyBJZiB0aGUgZmV0Y2ggaXMgc3VjY2Vzc2Z1bCwgd2Ugc2hvdWxkIGNhY2hlIHRoZSBuZXcgcmVzcG9uc2UuCiAgICAgIHJldHVybiBjYWNoZXMub3BlbihDQUNIRV9OQU1FKS50aGVuKGNhY2hlID0+IHsKICAgICAgICAvLyBXZSBjbG9uZSB0aGUgcmVzcG9uc2UgYmVjYXVzZSBhIHJlc3BvbnNlIGNhbiBvbmx5IGJlIGNvbnN1bWVkIG9uY2UuCiAgICAgICAgY2FjaGUucHV0KGV2ZW50LnJlcXVlc3QsIG5ldHdvcmtSZXNwb25zZS5jbG9uZSgpKTsKICAgICAgICAvLyBSZXR1cm4gdGhlIG9yaWdpbmFsIHJlc3BvbnNlIGZyb20gdGhlIG5ldHdvcmsuCiAgICAgICAgcmV0dXJuIG5ldHdvcmtSZXNwb25zZTsKICAgICAgfSk7CiAgICB9KS5jYXRjaCgoKSA9PiB7CiAgICAgIC8vIElmIHRoZSBuZXR3b3JrIHJlcXVlc3QgZmFpbHMgKGUuZy4sIHdlJ3JlIG9mZmxpbmUpLAogICAgICAvLyB3ZSBmYWxsIGJhY2sgdG8gdGhlIGNhY2hlLgogICAgICByZXR1cm4gY2FjaGVzLm1hdGNoKGV2ZW50LnJlcXVlc3QpOwogICAgfSkKICApOwp9KTs="}}</script>
        <script>
          window.APPLET_FILES = ["index.tsx","metadata.json","index.html","manifest.json","sw.js"];
          </script>
        
        <base href="https://ai.studio">



    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Argentina</title>
    <meta name="theme-color" content="#303f9f">
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Mi Argentina">
    <link rel="icon" type="image/jpeg" href="https://iili.io/KXRBnta.jpg">
    <link rel="apple-touch-icon" href="https://iili.io/KXRBnta.jpg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@400;700&amp;family=Roboto:wght@400;500;700&amp;display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-blue: #303f9f;
            --light-gray-bg: #f4f6f8;
            --text-dark: #333;
            --text-light: #6c757d;
            --card-white: #ffffff;
            --info-blue-bg: #d1e7fd;
            --info-blue-text: #0a58ca;
            --warning-pink-bg: #fde2e4;
            --warning-pink-text: #b13a3a;
            --border-color: #e0e0e0;
            --success-green-bg: #d1e7dd;
            --success-green-text: #0f5132;
        }

        html, body {
            height: 100%;
            margin: 0;
            overflow: hidden; /* Prevent body scroll on mobile */
        }
        
        body {
            font-family: 'Roboto', -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
            background-color: var(--light-gray-bg);
            color: var(--text-dark);
        }
        
        #screen-container {
            position: relative;
            width: 100%;
            height: 100%;
            max-width: 420px;
            margin: 0 auto;
            overflow: hidden; /* Container for screens */
        }
        
        #login-screen, #main-screen, #documentos-screen, #editor-screen, #dni-details-screen, #telefonos-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--light-gray-bg);
            overflow-y: auto; /* Allow individual screen scrolling */
            display: none; /* Initially hide all */
            flex-direction: column;
        }

        #login-screen {
             display: flex; /* Show the login screen by default */
             background-color: white;
        }
        
        /* Login Screen Styles */
        .login-header {
            background-color: var(--primary-blue);
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-shrink: 0;
        }
        .login-header .logo {
            font-size: 24px;
            font-weight: 300;
        }
        .login-header .logo .mi-logo-part {
            color: #c5cae9; /* Muted white */
        }
        .login-header .logo .arg-logo-part {
            color: #ffffff;
            font-weight: 700;
        }
        .login-main {
            padding: 32px 24px;
            flex-grow: 1;
        }
        .login-main h1 {
            font-size: 28px;
            font-weight: 700;
            margin: 0 0 24px 0;
            color: var(--text-dark);
        }
        .login-form-group {
            margin-bottom: 20px;
            position: relative;
        }
        .login-form-group label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--text-light);
        }
        .login-form-group .login-input {
            width: 100%;
            padding: 12px 16px;
            font-size: 16px;
            border: 1px solid #ced4da;
            border-radius: 8px;
            box-sizing: border-box;
        }
        .login-form-group .password-toggle {
            position: absolute;
            right: 16px;
            top: 40px;
            width: 24px;
            height: 24px;
            color: var(--text-light);
            cursor: pointer;
        }
        .login-main a {
            color: var(--primary-blue);
            text-decoration: underline;
            font-size: 14px;
            font-weight: 500;
        }
        .login-main .btn {
            width: 100%;
            padding: 14px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 50px;
            cursor: pointer;
            margin-top: 16px;
            box-sizing: border-box;
        }
        .login-section-divider {
            margin: 40px 0;
        }
        .login-main h2 {
            font-size: 22px;
            font-weight: 700;
            margin: 0 0 16px 0;
        }
        .login-footer {
            padding: 24px;
            text-align: center;
            border-top: 1px solid var(--border-color);
            flex-shrink: 0;
        }
        .login-footer .logo {
            font-size: 22px;
            font-weight: 300;
            margin-bottom: 16px;
        }
        .login-footer .logo .mi {
            color: #90a4ae;
        }
        .login-footer .logo .arg {
            color: var(--primary-blue);
            font-weight: 700;
        }
        .login-footer-links {
            display: flex;
            justify-content: center;
            gap: 24px;
        }

        #main-screen {
            display: none; /* Hide the main screen by default */
        }

        .app-container {
            width: 100%;
            min-height: 100%;
            display: flex;
            flex-direction: column;
            padding-bottom: 80px; /* Space for bottom nav */
            box-sizing: border-box;
        }

        /* Header */
        .app-header {
            background-color: var(--primary-blue);
            color: white;
            padding: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0; /* Prevent header from shrinking */
        }

        .app-header .icon {
            width: 24px;
            height: 24px;
            stroke: white;
            cursor: pointer;
        }

        .logo {
            font-size: 22px;
            color: white;
            font-weight: 500;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            position: relative;
            z-index: 1001; /* Above menu */
        }
        .user-profile .icon-user-circle {
            fill: white;
        }
        .user-profile .icon-chevron {
            stroke: white;
            width: 16px;
            height: 16px;
            transition: transform 0.3s ease;
        }
        .user-profile .icon-chevron.rotated {
            transform: rotate(180deg);
        }

        /* User Menu */
        .user-menu {
            position: absolute;
            top: 68px; /* Below header */
            right: 16px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            width: 280px;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: opacity 0.2s ease, transform 0.2s ease, visibility 0.2s ease;
        }

        .user-menu.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .user-menu-header {
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .user-menu-header .name {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-dark);
            margin: 0 0 4px;
        }
        
        .user-menu-header .id {
            font-size: 14px;
            color: var(--text-light);
            margin: 0 0 8px;
        }

        .user-menu-header .validation-level {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
            font-weight: 500;
            color: var(--primary-blue);
        }
        
        .user-menu-header .validation-level .icon {
            width: 18px;
            height: 18px;
            fill: var(--primary-blue);
            stroke: none;
        }

        .user-menu-list a, .user-menu-list div {
            display: block;
            padding: 12px 16px;
            font-size: 15px;
            color: var(--text-dark);
            text-decoration: none;
            cursor: pointer;
        }
        
        .user-menu-list a:hover, .user-menu-list div:hover {
            background-color: #f8f9fa;
        }
        
        .user-menu-footer {
             border-top: 1px solid var(--border-color);
        }


        /* Main Content */
        main {
            padding: 24px 16px;
            flex-grow: 1;
        }

        h1 {
            font-size: 28px;
            margin-top: 0;
            margin-bottom: 8px;
            font-weight: 700;
        }

        .sub-headline {
            font-size: 16px;
            color: var(--text-light);
            margin-bottom: 24px;
            line-height: 1.5;
        }

        /* Cards */
        .card {
            background-color: var(--card-white);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .card .icon-container {
            flex-shrink: 0;
        }

        .card .icon {
            width: 40px;
            height: 40px;
            color: var(--primary-blue);
        }
        
        .card .card-content {
            flex-grow: 1;
        }

        .card h3 {
            margin: 0 0 4px;
            font-size: 16px;
            font-weight: 600;
        }

        .card p {
            margin: 0;
            font-size: 14px;
            color: var(--text-light);
            line-height: 1.4;
        }

        .turnos-card p {
            color: var(--text-dark);
            margin-bottom: 12px;
        }

        .turnos-card .btn {
            background-color: var(--primary-blue);
            color: white;
            border: none;
            border-radius: 20px;
            padding: 8px 16px;
            font-weight: bold;
            cursor: pointer;
            font-size: 14px;
        }

        .section-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 16px;
        }

        /* Grid Menu */
        .grid-menu {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }

        .grid-item {
            background-color: var(--card-white);
            border-radius: 16px;
            padding: 16px 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            font-size: 13px;
            font-weight: 500;
            color: var(--text-dark);
            text-decoration: none;
            min-height: 90px;
            cursor: pointer;
        }

        .grid-item .icon {
            width: 32px;
            height: 32px;
            margin-bottom: 8px;
            color: var(--primary-blue);
        }

        /* Info Cards */
        .info-card {
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .info-card--blue {
            background-color: var(--info-blue-bg);
        }
        .info-card--blue .icon {
            color: var(--info-blue-text);
        }
        .info-card--blue .info-title {
            color: var(--text-light);
            font-size: 14px;
        }
        .info-card--blue .info-main {
            font-weight: bold;
            font-size: 18px;
            color: var(--text-dark);
            margin: 2px 0;
        }
        .info-card--blue .info-sub {
            font-size: 14px;
            color: var(--text-light);
        }

        .info-card--pink {
            background-color: var(--warning-pink-bg);
        }
        .info-card--pink .icon {
            color: var(--warning-pink-text);
        }
        .info-card--pink .info-main {
            font-weight: 600;
            font-size: 16px;
            color: var(--warning-pink-text);
        }
        
        /* Documentos Screen */
        .documentos-header {
            position: relative;
        }
        
        .documentos-header h2 {
            margin: 0;
            font-size: 20px;
            font-weight: 600;
            flex-grow: 1;
            text-align: center;
        }

        .documentos-header #back-btn, .documentos-header #editor-back-btn {
            position: absolute;
            left: 16px;
        }

        .documentos-header #refresh-icon {
            position: absolute;
            right: 16px;
        }
        
        .dni-card {
            flex-direction: column;
            align-items: stretch;
            padding: 0;
        }
        
        .dni-card-header {
            display: flex;
            align-items: center;
            padding: 16px;
            gap: 16px;
            cursor: pointer;
        }

        .dni-card-header .card-content {
            flex-grow: 1;
        }
        .dni-card-header .card-content h3 {
            font-size: 18px;
            font-weight: 400;
        }
        .dni-card-header .card-content h3 span {
            font-weight: 600;
        }

        .dni-card-header .icon {
            width: 24px;
            height: 24px;
        }

        .dni-card-body {
            padding: 0 16px 16px;
            border-top: 1px solid var(--border-color);
            margin-top: 8px;
            padding-top: 24px;
            max-height: 1000px;
            overflow: hidden;
        }
        
        .dni-card-body.no-header {
             border-top: none;
             margin-top: 0;
             padding-top: 16px;
        }

        .dni-card-body .btn {
            width: 100%;
            padding: 14px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 50px;
            border: 2px solid var(--primary-blue);
            cursor: pointer;
            margin-bottom: 12px;
            box-sizing: border-box;
        }
        .btn-outline {
            background-color: transparent;
            color: var(--primary-blue);
            border: 1px solid var(--primary-blue);
        }
        .btn-solid {
            background-color: var(--primary-blue);
            color: white;
            border: 1px solid var(--primary-blue);
        }

        .dni-card-body p {
            text-align: center;
            margin: 16px 0;
            font-size: 14px;
            color: var(--text-light);
            line-height: 1.5;
        }

        .renaper-link {
            color: var(--info-blue-text);
            font-weight: 600;
            cursor: pointer;
        }
        
        .device-change-info {
            display: flex;
            align-items: center;
            gap: 12px;
            border-top: 1px solid var(--border-color);
            padding-top: 16px;
            margin-top: 16px;
            font-size: 15px;
            color: var(--text-dark);
        }
        .device-change-info .icon {
             width: 24px;
             height: 24px;
             color: var(--primary-blue);
        }
        
        .select-wrapper {
            position: relative;
            margin: 16px 0;
        }

        .select-wrapper::after {
            content: '▼';
            font-size: 12px;
            color: var(--text-dark);
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
        }

        .custom-select {
            width: 100%;
            padding: 12px 16px;
            border: none;
            border-bottom: 1px solid var(--text-dark);
            background-color: transparent;
            font-size: 16px;
            color: var(--text-dark);
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            cursor: pointer;
        }

        /* DNI Collapse/Expand Styles */
        #dni-toggle-arrow {
            /* transition removed */
        }
        .dni-card.is-collapsed #dni-toggle-arrow {
            transform: rotate(180deg);
        }
        .dni-card.is-collapsed .dni-card-body {
            max-height: 0;
            padding-top: 0;
            padding-bottom: 0;
            margin-top: 0;
            border-top-width: 0;
        }

        /* DNI Digital Display */
        #dni-digital-display {
            padding: 0;
            text-align: left;
        }
        #dni-digital-display h3 {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 16px;
        }

        .dni-card-visual {
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden; /* Ensures the image corners are rounded */
        }
        
        .dni-profile-pic {
            position: absolute;
            top: 26.3%;
            left: 6.1%;
            width: 25.8%;
            height: 40.9%;
        }

        .dni-qr-pic {
            position: absolute;
            background-color: white;
        }

        .profile-image-inner {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .dni-image {
            width: 100%;
            display: block;
            border-radius: 12px;
        }
        
        .dni-text-overlay {
            position: absolute;
            font-family: 'Roboto Condensed', sans-serif;
            color: #2b2b2b;
            font-weight: 700;
            white-space: nowrap;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .dni-text-overlay--light {
            font-weight: 400;
            letter-spacing: normal;
        }

        .last-update {
            text-align: center;
            font-size: 13px;
            color: var(--text-light);
            margin: 24px 0;
        }
        
        .dni-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1px;
            background-color: var(--border-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 16px;
        }
        .dni-actions button {
            background-color: white;
            border: none;
            padding: 16px 8px;
            font-size: 15px;
            font-weight: 500;
            color: var(--text-dark);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .dni-actions button .icon {
            width: 20px;
            height: 20px;
        }
        
        .dni-qr-verify {
            background-color: white;
            border-radius: 8px;
            padding: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 15px;
            font-weight: 500;
            border: 1px solid var(--border-color);
        }
        .dni-qr-verify .icon {
            width: 28px;
            height: 28px;
            color: var(--primary-blue);
        }
        .dni-qr-verify .icon-chevron {
            width: 20px;
            height: 20px;
            color: var(--text-light);
        }

        /* DNI Flipper Styles */
        .dni-flipper-container {
            perspective: 1000px;
            cursor: grab;
            user-select: none;
        }
        .dni-flipper-container:active {
            cursor: grabbing;
        }
        /* Make DNI card contents unselectable and unclickable to prevent context menus */
        .dni-card-visual img, .dni-card-visual .dni-text-overlay, .dni-card-visual .dni-profile-pic, .dni-card-visual .dni-qr-pic {
            pointer-events: none;
            user-select: none;
            -webkit-user-select: none; /* Safari */
        }
        .dni-flipper {
            position: relative;
            width: 100%;
            transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
            transform-style: preserve-3d;
        }
        /* This pseudo-element will define the aspect ratio of the container */
        .dni-flipper::before {
            content: '';
            display: block;
            padding-top: 63.1%; /* Aspect ratio of DNI image 344/545 */
        }
        .dni-card-front,
        .dni-card-back {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
        }
        .dni-card-back {
            transform: rotateY(180deg);
        }
        
        /* Editor Screen Controls */
        #editor-screen .app-container {
            background-color: var(--light-gray-bg);
        }
        .controls-container {
            background-color: var(--card-white);
            padding: 16px;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        .control-group {
            margin-bottom: 16px;
        }
        .control-group:last-child {
            margin-bottom: 0;
        }
        .control-group label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-dark);
            margin-bottom: 8px;
        }
        .control-group input[type="range"] {
            width: 100%;
            cursor: pointer;
            margin-top: 4px;
        }
        .custom-input {
            width: 100%;
            padding: 8px 12px;
            font-size: 14px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-sizing: border-box;
        }
        .control-group-divider {
            border-top: 1px solid var(--border-color);
            margin: 20px 0;
        }
        
        .controls-container .select-wrapper {
            margin: 0;
        }
        
        .controls-container .custom-select {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: white;
            padding: 8px 12px;
        }
        .controls-container .select-wrapper::after {
            right: 12px;
        }

        /* Carousel Styles */
        .carousel-wrapper {
            overflow: hidden;
            width: 100%;
            margin-bottom: 16px;
        }

        .carousel-track {
            display: flex;
            transition: transform 0.3s ease-in-out;
        }

        .carousel-slide {
            width: 100%;
            flex-shrink: 0;
            box-sizing: border-box;
            padding: 0;
        }
        
        .carousel-dots {
            text-align: center;
            margin-bottom: 24px;
        }

        .carousel-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #ccc;
            margin: 0 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .carousel-dot.active {
            background-color: var(--primary-blue);
        }

        /* User Management List */
        .user-list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            border-bottom: 1px solid var(--border-color);
        }
        .user-list-item:last-child {
            border-bottom: none;
        }
        .user-list-item-name {
            font-weight: 500;
            color: var(--text-dark);
        }
        .user-list-item-actions {
            display: flex;
            gap: 8px;
        }
        .user-list-item-actions button {
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
        }
        .user-list-item-actions .edit-btn {
            background-color: var(--info-blue-bg);
            color: var(--info-blue-text);
        }
        .user-list-item-actions .delete-btn {
            background-color: var(--warning-pink-bg);
            color: var(--warning-pink-text);
        }
        .file-ops-container {
            display: flex;
            gap: 10px;
            margin-bottom: 16px;
        }
        .file-ops-container .btn {
            flex: 1;
            padding: 10px;
            margin: 0;
        }

        /* Bottom Nav */
        #bottom-nav, .details-bottom-nav, .telefonos-bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 420px;
            background-color: var(--card-white);
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: space-around;
            padding: 8px 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
            box-sizing: border-box;
            z-index: 100;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: var(--text-light);
            font-size: 12px;
            gap: 4px;
        }
        .nav-item .icon {
            width: 24px;
            height: 24px;
        }
        .nav-item.active {
            color: var(--primary-blue);
        }
        
        /* DNI Details Screen Styles - REVISED */
        #dni-details-screen .app-container {
            background-color: white;
            padding-bottom: 80px;
        }

        .dni-details-header {
            background-color: #373383;
            color: white;
            padding: 16px;
            display: flex;
            align-items: center;
            position: relative;
            flex-shrink: 0;
        }

        .dni-details-header .icon {
            width: 24px;
            height: 24px;
            stroke: white;
            cursor: pointer;
        }

        .dni-details-header #details-back-btn {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
        }

        .dni-details-header h2 {
            margin: 0;
            font-size: 18px;
            font-weight: 500;
            flex-grow: 1;
            text-align: center;
        }

        .dni-details-main {
            padding: 16px 24px;
        }

        .barcode-container {
            margin-bottom: 24px;
        }

        .barcode-image {
            display: block;
            height: 70px;
            width: auto;
            max-width: 100%;
            margin: 0 auto;
        }

        .details-profile-container {
            text-align: center;
            margin-bottom: 24px;
        }
        #details-profile-image {
            width: 270px;
            height: 270px;
            border-radius: 0;
            object-fit: cover;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            row-gap: 24px;
            column-gap: 16px;
            margin-bottom: 24px;
        }
        
        .info-list {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .details-divider {
            border: none;
            border-top: 1px solid #eeeeee;
            margin: 24px 0;
        }

        .info-item {
            display: flex;
            flex-direction: column;
        }

        .info-label {
            font-size: 14px;
            color: var(--text-light);
            margin-bottom: 4px;
        }

        .info-value {
            font-size: 16px;
            color: var(--text-dark);
            font-weight: 500;
            line-height: 1.4;
        }

        .info-value.uppercase {
            font-weight: 700;
            text-transform: uppercase;
        }
        
        /* Login Loading Overlay */
        #login-loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            display: none; /* Hidden by default */
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10001;
        }
        .login-loading-logo {
            font-family: 'Roboto', sans-serif;
            font-size: 96px;
            font-weight: 700;
            color: var(--primary-blue);
            margin-bottom: 32px;
            line-height: 1;
        }
        .login-loading-spinner {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 4px solid transparent;
            border-top-color: var(--primary-blue);
            animation: spin 1s linear infinite;
            margin-bottom: 24px;
        }
        #login-loading-overlay p {
            font-size: 16px;
            color: var(--text-light);
            margin: 0;
        }
        
        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--light-gray-bg);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transform: translateX(100%);
            transition: transform 0.4s cubic-bezier(0.77, 0, 0.175, 1);
            visibility: hidden;
        }

        .loading-overlay.active {
            transform: translateX(0);
            visibility: visible;
        }

        .spinner {
            border: 6px solid rgba(0, 0, 0, 0.1);
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border-left-color: var(--primary-blue);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
        
        /* Action Loader (Spinner only) */
        .action-loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(244, 246, 248, 0.85); /* Subtle bg */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s ease, visibility 0.2s ease;
        }
        .action-loader.active {
            opacity: 1;
            visibility: visible;
        }

        /* Telefonos Screen Styles */
        #telefonos-screen .app-container {
            background-color: #fff;
        }
        
        #telefonos-screen main {
            background-color: var(--light-gray-bg);
        }

        #telefonos-screen h2 {
            font-size: 24px;
            font-weight: 700;
            margin-top: 0;
            margin-bottom: 24px;
        }

        .telefonos-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .telefono-item {
            background-color: var(--card-white);
            border-radius: 12px;
            padding: 16px;
            display: flex;
            align-items: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }

        .telefono-number {
            font-size: 28px;
            font-weight: 500;
            color: var(--primary-blue);
            width: 80px;
            flex-shrink: 0;
        }
        
        .telefono-description {
            flex-grow: 1;
            font-size: 16px;
            color: var(--text-dark);
            padding: 0 16px;
            border-left: 1px solid var(--border-color);
        }

        .telefono-icon {
            width: 24px;
            height: 24px;
            color: var(--text-light);
            flex-shrink: 0;
        }
    </style>
<link rel="stylesheet" href="style.css"></head>
<body>
    <div id="login-loading-overlay">
        <div class="login-loading-logo">mi</div>
        <div class="login-loading-spinner"></div>
        <p>Cargando información…</p>
    </div>
    <div id="loading-overlay" class="loading-overlay">
        <div class="spinner"></div>
    </div>
    <div id="action-loader" class="action-loader">
        <div class="spinner"></div>
    </div>
    
    <div id="screen-container">
        <!-- Login Screen -->
        <div id="login-screen">
            <header class="login-header">
                <div class="logo"><span class="mi-logo-part">mi</span><span class="arg-logo-part">Argentina</span></div>
            </header>
            <main class="login-main">
                <h1>Ingresá a tu cuenta</h1>
                <form onsubmit="return false;">
                    <div class="login-form-group">
                        <label for="username-input">Usuario</label>
                        <input type="text" id="username-input" class="login-input" placeholder="">
                    </div>
                    <div class="login-form-group">
                        <label for="password-input">Contraseña</label>
                        <input type="password" id="password-input" class="login-input" placeholder="">
                        <svg class="password-toggle" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                    </div>
                    <a href="#">¿Olvidaste tu contraseña?</a>
                    <button id="login-btn" class="btn btn-solid">Ingresar</button>
                    <button id="guest-login-btn" class="btn btn-outline" style="margin-top: 10px;">Ingresar sin cuenta</button>
                    <p id="login-error-msg" style="color: red; text-align: center; display: none; margin-top: 10px;"></p>
                </form>
                <div class="login-section-divider">
                    <h2>¿No tenés cuenta?</h2>
                    <button class="btn btn-outline">Creá tu cuenta</button>
                </div>
                 
                
            </main>
            <footer class="login-footer">
                <div class="logo">
                    <span class="mi">mi</span><span class="arg">Argentina</span>
                </div>
                <div class="login-footer-links">
                    <a href="#">Preguntas frecuentes</a>
                    <a href="#">Términos y condiciones</a>
                </div>
            </footer>
        </div>

        <div id="main-screen">
            <div class="app-container">
                <header class="app-header">
                    <!-- Hamburger Icon -->
                    <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"></path>
                    </svg>

                    <div class="logo">Mi Argentina</div>

                    <div id="user-profile-btn" class="user-profile">
                        <!-- User Icon -->
                        <svg class="icon icon-user-circle" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                          <path fill-rule="evenodd" d="M18.685 19.097A9.723 9.723 0 0021.75 12c0-5.385-4.365-9.75-9.75-9.75S2.25 6.615 2.25 12a9.723 9.723 0 003.065 7.097A9.716 9.716 0 0012 21.75a9.716 9.716 0 006.685-2.653zm-12.54-1.285A7.486 7.486 0 0112 15a7.486 7.486 0 015.855 2.812A8.224 8.224 0 0112 20.25a8.224 8.224 0 01-5.855-2.438zM15.75 9a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" clip-rule="evenodd"></path>
                        </svg>
                        <!-- Chevron Down Icon -->
                        <svg id="profile-arrow" class="icon icon-chevron" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="3">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5"></path>
                        </svg>
                    </div>
                </header>

                <div id="user-menu" class="user-menu">
                    <div class="user-menu-header">
                        <p class="name" id="menu-user-name">CLAUDIO PASCUAL MOSCARIELLO</p>
                        <p class="id" id="menu-user-id">20-32872182-2</p>
                        <div class="validation-level">
                            Validado Nivel 3
                            <svg class="icon" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                        </div>
                    </div>
                    <div class="user-menu-list">
                        <a href="#">Mi perfil</a>
                        <a href="#" id="menu-editor-btn" style="display: none;">Panel de Edición</a>
                        <a href="#">Suscribir servicios</a>
                        <a href="#">Configurar mi cuenta</a>
                        <a href="#">Seguridad</a>
                        <a href="#">Términos y Condiciones</a>
                    </div>
                    <div class="user-menu-footer">
                        <a href="#">Cerrar la sesión</a>
                    </div>
                </div>

                <main>
                    <h1>¡Hola <span id="welcome-name">CLAUDIO PASCUAL</span>!</h1>
                    <p class="sub-headline">Gestioná trámites, sacá turnos, accedé a tus credenciales y recibí información personalizada.</p>

                    <section class="turnos-card card">
                        <div class="icon-container">
                             <!-- Ticket Icon -->
                             <svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M15 5H9C6.79086 5 5 6.79086 5 9V10.5C6.10457 10.5 7 11.3954 7 12.5C7 13.6046 6.10457 14.5 5 14.5V16C5 18.2091 6.79086 20 9 20H15C17.2091 20 19 18.2091 19 16V14.5C17.8954 14.5 17 13.6046 17 12.5C17 11.3954 17.8954 10.5 19 10.5V9C19 6.79086 17.2091 5 15 5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                                <text x="8" y="17.5" font-family="Arial, sans-serif" font-size="6" font-weight="bold" fill="currentColor">01</text>
                            </svg>
                        </div>
                        <div class="card-content">
                            <p>No tenés turnos programados</p>
                            <button class="btn">Sacar turno</button>
                        </div>
                    </section>

                    <section class="elecciones-card card">
                         <div class="icon-container">
                            <!-- Ballot Box Icon -->
                            <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                              <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 9.75h16.5v10.5h-16.5z"></path>
                              <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 9.75L12 3.75l8.25 6"></path>
                              <path stroke-linecap="round" stroke-linejoin="round" d="M9 8.25h6v3.75H9z"></path>
                              <path stroke-linecap="round" stroke-linejoin="round" d="M12 8.25V6"></path>
                            </svg>
                         </div>
                         <div class="card-content">
                            <h3>Elecciones 2025</h3>
                            <p>Conocé donde votar en las próximas elecciones</p>
                         </div>
                    </section>

                    <h2 class="section-title">¿Qué necesitás hoy?</h2>

                    <div class="grid-menu">
                        <a href="#" id="documentos-btn" class="grid-item">
                            <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 002.25-2.25V6.75A2.25 2.25 0 0019.5 4.5h-15A2.25 2.25 0 002.25 6.75v10.5A2.25 2.25 0 004.5 21z"></path></svg>
                            Documentos
                        </a>
                        <a href="#" class="grid-item">
                            <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 18.75a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m3 0h6m-9 0H3.375a1.125 1.125 0 01-1.125-1.125V14.25m17.25 4.5a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m3 0h1.125c.621 0 1.125-.504 1.125-1.125V14.25m-17.25 4.5v-1.875a3.375 3.375 0 013.375-3.375h9.75a3.375 3.375 0 013.375 3.375v1.875m-17.25 4.5h16.5M6 12V6.375c0-1.036.84-1.875 1.875-1.875h7.5c1.035 0 1.875.84 1.875 1.875V12m-12 0h12"></path></svg>
                            Vehículos
                        </a>
                        <a href="#" class="grid-item">
                            <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125V6.375c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v.001c0 .621.504 1.125 1.125 1.125z"></path></svg>
                            Trabajo
                        </a>
                        <a href="#" class="grid-item">
                            <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z"></path></svg>
                            Salud
                        </a>
                        <a href="#" class="grid-item">
                            <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18.75a60.07 60.07 0 0115.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 013 6h-.75m0 0v-.375c0-.621.504-1.125 1.125-1.125H20.25M2.25 6v9m18-10.5v.75c0 .414.336.75.75.75h.75m-1.5-1.5h.375c.621 0 1.125.504 1.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-.375m1.5-1.5H21a.75.75 0 00-.75.75v.75m0 0H3.75m0 0h-.375a1.125 1.125 0 01-1.125-1.125V15m1.5 1.5v-.75A.75.75 0 003 15h-.75M15 10.5a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                            Cobros
                        </a>
                        <a href="#" class="grid-item">
                            <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"></path></svg>
                            Trámites
                        </a>
                        <a href="#" class="grid-item">
                            <svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M15 5H9C6.79086 5 5 6.79086 5 9V10.5C6.10457 10.5 7 11.3954 7 12.5C7 13.6046 6.10457 14.5 5 14.5V16C5 18.2091 6.79086 20 9 20H15C17.2091 20 19 18.2091 19 16V14.5C17.8954 14.5 17 13.6046 17 12.5C17 11.3954 17.8954 10.5 19 10.5V9C19 6.79086 17.2091 5 15 5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                                <text x="8" y="17.5" font-family="Arial, sans-serif" font-size="6" font-weight="bold" fill="currentColor">01</text>
                            </svg>
                            Turnos
                        </a>
                        <a href="#" id="editor-btn" class="grid-item" style="display: none;">
                            <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"></path>
                            </svg>
                            Editor
                        </a>
                    </div>

                    <section class="info-card info-card--blue">
                        <div class="icon-container">
                            <svg class="icon" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <rect x="6" y="7" width="28" height="29" rx="4" stroke="currentColor" stroke-width="2"></rect>
                                <path d="M13 7 V 4" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
                                <path d="M27 7 V 4" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
                                <rect x="10" y="14" width="5.5" height="5.5" rx="1" stroke="currentColor" stroke-width="1.5"></rect>
                                <rect x="17.25" y="14" width="5.5" height="5.5" rx="1" stroke="currentColor" stroke-width="1.5"></rect>
                                <rect x="24.5" y="14" width="5.5" height="5.5" rx="1" stroke="currentColor" stroke-width="1.5"></rect>
                                <rect x="10" y="21.25" width="5.5" height="5.5" rx="1" stroke="currentColor" stroke-width="1.5"></rect>
                                <g>
                                    <rect x="17.25" y="21.25" width="5.5" height="5.5" rx="1" stroke="currentColor" stroke-width="1.5"></rect>
                                    <path d="M19 24.5 l2 2 l3.5 -4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                                </g>
                                <rect x="24.5" y="21.25" width="5.5" height="5.5" rx="1" stroke="currentColor" stroke-width="1.5"></rect>
                                <rect x="10" y="28.5" width="5.5" height="5.5" rx="1" stroke="currentColor" stroke-width="1.5"></rect>
                                <rect x="17.25" y="28.5" width="5.5" height="5.5" rx="1" stroke="currentColor" stroke-width="1.5"></rect>
                                <rect x="24.5" y="28.5" width="5.5" height="5.5" rx="1" stroke="currentColor" stroke-width="1.5"></rect>
                            </svg>
                        </div>
                        <div class="card-content">
                            <div class="info-title">Próximo feriado</div>
                            <div class="info-main">12 de Octubre</div>
                            <div class="info-sub">12 de octubre. Día de la raza.</div>
                        </div>
                    </section>

                    <section class="info-card info-card--pink">
                        <div class="icon-container">
                            <svg class="icon" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M31.5 12 C 34.98 17.06 34.42 23.61 30.58 27.97 C 26.74 32.33 20.47 33.15 15.5 30" stroke="#f06292" stroke-width="3" stroke-linecap="round"></path>
                                <circle cx="31.5" cy="12" r="1.5" fill="#f06292"></circle>
                                <g stroke="currentColor">
                                    <circle cx="20" cy="20" r="11" stroke-width="1.5"></circle>
                                    <path d="M20 19C21.6569 19 23 17.6569 23 16C23 14.3431 21.6569 13 20 13C18.3431 13 17 14.3431 17 16C17 17.6569 18.3431 19 20 19Z" stroke-width="1.5"></path>
                                    <path d="M16 25C16 22.7909 17.7909 21 20 21C22.2091 21 24 22.7909 24 25" stroke-width="1.5" stroke-linecap="round"></path>
                                </g>
                            </svg>
                        </div>
                        <div class="card-content">
                            <div class="info-main">Mantené tu perfil actualizado</div>
                        </div>
                    </section>

                </main>
            </div>
        </div>

        <div id="documentos-screen">
            <div class="app-container">
                 <header class="app-header documentos-header">
                    <!-- Back Arrow Icon -->
                    <svg id="back-btn" class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5"></path>
                    </svg>
                    <h2>Documentos</h2>
                    <svg id="refresh-icon" class="icon" style="display: none;" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0011.664 0M2.985 19.644A8.25 8.25 0 0111.664 2.985m7.007 11.664v4.992h-4.992m0 0l-3.181-3.183a8.25 8.25 0 00-11.664 0m11.664 0l-3.181 3.183"></path>
                    </svg>
                </header>
                <main>
                    <section class="card dni-card">
                        <div class="dni-card-header" id="dni-card-header">
                            <div class="icon-container">
                                 <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 002.25-2.25V6.75A2.25 2.25 0 0019.5 4.5h-15A2.25 2.25 0 002.25 6.75v10.5A2.25 2.25 0 004.5 21z"></path></svg>
                            </div>
                            <div class="card-content">
                                 <h3><span>Documento Nacional de Identidad</span><br>(DNI)</h3>
                            </div>
                            <!-- Up Arrow Icon -->
                            <svg class="icon" id="dni-toggle-arrow" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor">
                               <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 15.75l7.5-7.5 7.5 7.5"></path>
                            </svg>
                        </div>
                        <div class="dni-card-body" id="dni-card-body">
                            
                            <div id="dni-initial-view">
                                <button id="solicitar-dni-btn" class="btn btn-outline" style="border-width: 2px;">Solicitar DNI Digital por primera vez</button>
                                <button id="ver-dni-digital-btn" class="btn btn-solid">Ver DNI Digital</button>
                                <p>Datos suministrados por <span class="renaper-link">RENAPER</span></p>
                                <p>Recordá que podés solicitar el DNI para vos e tus hijos y tenerlos disponibles en la App.</p>
                                <div class="device-change-info">
                                    <!-- Info Icon -->
                                    <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                       <path stroke-linecap="round" stroke-linejoin="round" d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z"></path>
                                    </svg>
                                    <span>Cambié o voy a cambiar de dispositivo</span>
                                </div>
                            </div>

                            <div id="dni-solicitud-view" style="display: none;">
                                <p>Recordá que podés solicitar el DNI para vos e tus hijos y tenerlos disponibles en la App.</p>
                                <div class="select-wrapper">
                                    <select class="custom-select" id="solicitud-dni-select">
                                        <option id="solicitud-dni-name">CLAUDIO PASCUAL MOSCARIELLO</option>
                                    </select>
                                </div>
                                <button id="confirmar-solicitud-btn" class="btn btn-solid">Solicitar DNI Digital</button>
                                <p>Recordá que podés solicitar el DNI para vos e tus hijos y tenerlos disponibles en la App.</p>
                                <button class="btn btn-outline" style="border-width: 2px;">Asociar un hijo/a</button>
                            </div>
                            
                            <div id="dni-digital-display" style="display: none;">
                               <h3 id="dni-digital-title">MOSCARIELLO CLAUDIO PASCUAL</h3>
                               <div class="dni-flipper-container">
                                   <div id="dni-flipper" class="dni-flipper">
                                       <div class="dni-card-visual dni-card-front">
                                           <div class="dni-profile-pic" id="main-dni-profile-pic" style="top: 30.1%; left: 5%; width: 25.1%; height: 47.8%;">
                                               <img alt="Foto de perfil" class="profile-image-inner" id="main-dni-profile-image" src="https://iili.io/KS83rap.jpg">
                                           </div>
                                           <!-- Text Overlays -->
                                           <div class="dni-text-overlay dni-text-overlay--light" id="main-dni-apellido" style="top: 19.6%; left: 30.7%; font-size: 14px; font-family: &quot;Roboto Condensed&quot;, sans-serif;">MOSCARIELLO</div>
                                           <div class="dni-text-overlay dni-text-overlay--light" id="main-dni-nombre" style="top: 29.6%; left: 30.7%; font-size: 17px; font-family: &quot;Roboto Condensed&quot;, sans-serif;">CLAUDIO PASCUAL</div>
                                           <div class="dni-text-overlay" id="main-dni-documento" style="top: 87.2%; left: 3.1%; font-size: 21px; font-family: &quot;Roboto Condensed&quot;, sans-serif;">32.872.182</div>
                                           <div class="dni-text-overlay dni-text-overlay--light" id="main-dni-nacimiento" style="top: 52.2%; left: 30.7%; font-size: 15px; font-family: &quot;Roboto Condensed&quot;, sans-serif;">11 MAR/MAR 1987</div>
                                           <div class="dni-text-overlay dni-text-overlay--light" id="main-dni-tramite" style="top: 90%; left: 31%; font-size: 10px; font-family: &quot;Roboto Condensed&quot;, sans-serif;">681417890</div>
                                           <div class="dni-text-overlay dni-text-overlay--light" id="main-dni-ejemplar" style="top: 41.9%; left: 78.4%; font-size: 14px; font-family: &quot;Roboto Condensed&quot;, sans-serif;">B</div>
                                           <div class="dni-text-overlay dni-text-overlay--light" id="main-dni-emision" style="top: 63.4%; left: 31%; font-size: 15px; font-family: &quot;Roboto Condensed&quot;, sans-serif;">09 NOV/NOV 2021</div>
                                           <div class="dni-text-overlay dni-text-overlay--light" id="main-dni-vencimiento" style="top: 74.9%; left: 31%; font-size: 15px; font-family: &quot;Roboto Condensed&quot;, sans-serif;">09 NOV/NOV 2036</div>
                                           <div class="dni-text-overlay dni-text-overlay--light" id="main-dni-sexo" style="top: 41.3%; left: 31%; font-size: 17px; font-family: &quot;Roboto Condensed&quot;, sans-serif;">M</div>
                                           <!-- Barcode -->
                                           <div class="dni-qr-pic" id="main-dni-qr-pic" style="top: 81.3%; left: 55.7%; width: 40%; height: 16.6%;">
                                               <img alt="Código de barras" class="profile-image-inner" id="main-dni-qr-image" src="https://iili.io/KS89H9n.gif">
                                           </div>
                                           <!-- Base Image -->
                                           <img src="https://iili.io/KXFRqKu.md.png" alt="DNI Digital" class="dni-image">
                                       </div>
                                       <div class="dni-card-visual dni-card-back">
                                           <div class="dni-text-overlay dni-text-overlay--light" id="main-dni-domicilio" style="top: 3.7%; left: 23.1%; font-size: 14px; font-family: &quot;Roboto Condensed&quot;, sans-serif;">ENTRE RIOS 256 MONTE GRANDE</div>
                                           <img src="https://iili.io/KW1zIb1.md.png" alt="DNI Digital Reverso" class="dni-image" id="main-dni-back-image">
                                       </div>
                                   </div>
                               </div>
                               <p class="last-update">Última actualización: 03/10/2025 16:59:27 hs</p>
                               <div class="dni-actions">
                                   <button id="ver-detalle-btn">
                                       <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                                       Ver detalle
                                    </button>
                                   <button>
                                       <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path></svg>
                                       Desactivar DNI
                                    </button>
                               </div>
                               <div class="dni-qr-verify">
                                    <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 4.5A.75.75 0 014.5 3h3.75a.75.75 0 010 1.5H5.25v3.75a.75.75 0 01-1.5 0V4.5zM19.5 3a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V5.25h-3.75a.75.75 0 010-1.5H19.5zM3.75 19.5a.75.75 0 01.75-.75h3.75a.75.75 0 010 1.5H5.25v-3.75a.75.75 0 01-1.5 0v3.75zM19.5 19.5a.75.75 0 01.75-.75h.75a.75.75 0 01.75.75v3.75a.75.75 0 01-.75.75h-3.75a.75.75 0 010-1.5h3v-2.25zM10.5 9.75h3v3h-3v-3zM10.5 15h3v3h-3v-3zM6 9.75h3v3H6v-3zM6 15h3v3H6v-3z"></path></svg>
                                    <span>Verifica código QR</span>
                                    <svg class="icon icon-chevron" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5"></path></svg>
                               </div>
                            </div>
                        </div>
                    </section>
                </main>
                <nav id="bottom-nav">
                    <a href="#" id="inicio-btn" class="nav-item active">
                        <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path d="M11.47 3.84a.75.75 0 011.06 0l8.69 8.69a.75.75 0 101.06-1.06l-8.689-8.69a2.25 2.25 0 00-3.182 0l-8.69 8.69a.75.75 0 001.061 1.06l8.69-8.69z"></path><path d="M12 5.432l8.159 8.159c.026.026.05.054.07.084v6.101A2.25 2.25 0 0117.25 22h-2.5a.75.75 0 01-.75-.75V17.5a.75.75 0 00-.75-.75h-2.5a.75.75 0 00-.75.75v3.75a.75.75 0 01-.75-.75h-2.5A2.25 2.25 0 013.75 19.775v-6.101c.02-.03.044-.058.07-.084L12 5.432z"></path></svg>
                        <span>Inicio</span>
                    </a>
                    <a href="#" class="nav-item">
                        <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"></path></svg>
                        <span>Novedades</span>
                    </a>
                    <a href="#" id="telefonos-btn-docs" class="nav-item">
                        <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z"></path></svg>
                        <span>Teléfonos</span>
                    </a>
                    <a href="#" class="nav-item tina-link">
                        <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 21a9 9 0 100-18 9 9 0 000 18z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M15.91 11.672a.375.375 0 01.33.633l-3.25 2.5a.375.375 0 01-.66 0l-3.25-2.5a.375.375 0 01.33-.633H15.91zM9.75 9.75a.375.375 0 01.375-.375h3.75a.375.375 0 01.375.375v.375a.375.375 0 01-.375.375h-3.75a.375.375 0 01-.375-.375V9.75z"></path></svg>
                        <span>Tina</span>
                    </a>
                </nav>
            </div>
        </div>
        
        <div id="editor-screen">
            <div class="app-container">
                 <header class="app-header documentos-header">
                    <!-- Back Arrow Icon -->
                    <svg id="editor-back-btn" class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5"></path>
                    </svg>
                    <h2>Panel de Edición</h2>
                </header>
                <main>
                    <div class="dni-flipper-container" id="editor-dni-flipper-container" style="margin-bottom: 24px;">
                        <div id="editor-dni-flipper" class="dni-flipper">
                            <div class="dni-card-visual dni-card-front">
                               <div class="dni-profile-pic" id="editor-dni-profile-pic" style="top: 30.1%; left: 5%; width: 25.1%; height: 47.8%;">
                                    <img alt="Foto de perfil" class="profile-image-inner" id="editor-dni-profile-image" src="https://iili.io/KS83rap.jpg">
                               </div>
                               <!-- Text Overlays -->
                               <div class="dni-text-overlay dni-text-overlay--light" id="editor-dni-apellido" style="top: 19.6%; left: 30.7%; font-size: 14px; font-family: &quot;Roboto Condensed&quot;, sans-serif;">MOSCARIELLO</div>
                               <div class="dni-text-overlay dni-text-overlay--light" id="editor-dni-nombre" style="top: 29.6%; left: 30.7%; font-size: 17px; font-family: &quot;Roboto Condensed&quot;, sans-serif;">CLAUDIO PASCUAL</div>
                               <div class="dni-text-overlay" id="editor-dni-documento" style="top: 87.2%; left: 3.1%; font-size: 21px; font-family: &quot;Roboto Condensed&quot;, sans-serif;">32.872.182</div>
                               <div class="dni-text-overlay dni-text-overlay--light" id="editor-dni-nacimiento" style="top: 52.2%; left: 30.7%; font-size: 15px; font-family: &quot;Roboto Condensed&quot;, sans-serif;">11 MAR/MAR 1987</div>
                               <div class="dni-text-overlay dni-text-overlay--light" id="editor-dni-tramite" style="top: 90%; left: 31%; font-size: 10px; font-family: &quot;Roboto Condensed&quot;, sans-serif;">681417890</div>
                               <div class="dni-text-overlay dni-text-overlay--light" id="editor-dni-ejemplar" style="top: 41.9%; left: 78.4%; font-size: 14px; font-family: &quot;Roboto Condensed&quot;, sans-serif;">B</div>
                               <div class="dni-text-overlay dni-text-overlay--light" id="editor-dni-emision" style="top: 63.4%; left: 31%; font-size: 15px; font-family: &quot;Roboto Condensed&quot;, sans-serif;">09 NOV/NOV 2021</div>
                               <div class="dni-text-overlay dni-text-overlay--light" id="editor-dni-vencimiento" style="top: 74.9%; left: 31%; font-size: 15px; font-family: &quot;Roboto Condensed&quot;, sans-serif;">09 NOV/NOV 2036</div>
                               <div class="dni-text-overlay dni-text-overlay--light" id="editor-dni-sexo" style="top: 41.3%; left: 31%; font-size: 17px; font-family: &quot;Roboto Condensed&quot;, sans-serif;">M</div>
                               <!-- Barcode -->
                               <div class="dni-qr-pic" id="editor-dni-qr-pic" style="top: 81.3%; left: 55.7%; width: 40%; height: 16.6%;">
                                   <img alt="Código de barras" class="profile-image-inner" id="editor-dni-qr-image" src="https://iili.io/KS89H9n.gif">
                               </div>
                               <!-- Base Image -->
                               <img src="https://iili.io/KXFRqKu.md.png" alt="DNI Digital" class="dni-image">
                            </div>
                            <div class="dni-card-visual dni-card-back">
                                <div class="dni-text-overlay dni-text-overlay--light" id="editor-dni-domicilio" style="top: 3.7%; left: 23.1%; font-size: 14px; font-family: &quot;Roboto Condensed&quot;, sans-serif;">ENTRE RIOS 256 MONTE GRANDE</div>
                               <img src="https://iili.io/KW1zIb1.md.png" alt="DNI Digital Reverso" class="dni-image" id="editor-dni-back-image">
                           </div>
                        </div>
                    </div>
                    
                    <div class="carousel-wrapper" id="editor-carousel-wrapper">
                        <div class="carousel-track" id="editor-carousel-track" style="transform: translateX(0px); transition: transform 0.3s ease-in-out;">
                            <!-- Slide 1: Imágenes y QR -->
                            <div class="carousel-slide">
                                 <div class="controls-container">
                                    <h3 class="section-title" style="margin-top:0; margin-bottom: 20px;">Ajuste de Imágenes</h3>
                                    <div class="control-group" style="display: none;">
                                        <label for="image-url-input">URL de la Imagen (Frente)</label>
                                        <input type="url" id="image-url-input" class="custom-input" value="https://iili.io/KS83rap.jpg">
                                    </div>
                                     <div class="control-group" style="display: none;">
                                        <label for="dni-back-url-input">URL de la Imagen (Reverso)</label>
                                        <input type="url" id="dni-back-url-input" class="custom-input" value="https://iili.io/KW1zIb1.md.png">
                                    </div>
                                    <div class="control-group">
                                        <label for="top-slider">Top: <span id="top-value">30.1</span>%</label>
                                        <input type="range" id="top-slider" min="0" max="100" step="0.1" value="30.1">
                                    </div>
                                    <div class="control-group" style="margin-top: 20px;">
                                        <label for="left-slider">Left: <span id="left-value">5</span>%</label>
                                        <input type="range" id="left-slider" min="0" max="100" step="0.1" value="5">
                                    </div>
                                    <div class="control-group">
                                        <label for="width-slider">Width: <span id="width-value">25.1</span>%</label>
                                        <input type="range" id="width-slider" min="0" max="100" step="0.1" value="25.1">
                                    </div>
                                    <div class="control-group">
                                        <label for="height-slider">Height: <span id="height-value">47.8</span>%</label>
                                        <input type="range" id="height-slider" min="0" max="100" step="0.1" value="47.8">
                                    </div>
                                    <hr class="control-group-divider"><div class="control-group" style="display: none;">
                                        <label for="qr-url-input">URL del Código de Barras</label>
                                        <input type="url" id="qr-url-input" class="custom-input" value="https://iili.io/KS89H9n.gif">
                                    </div>
                                    <div class="control-group">
                                        <label for="qr-top-slider">Top: <span id="qr-top-value">81.3</span>%</label>
                                        <input type="range" id="qr-top-slider" min="0" max="100" step="0.1" value="81.3">
                                    </div>
                                    <div class="control-group">
                                        <label for="qr-left-slider">Left: <span id="qr-left-value">55.7</span>%</label>
                                        <input type="range" id="qr-left-slider" min="0" max="100" step="0.1" value="55.7">
                                    </div>
                                    <div class="control-group">
                                        <label for="qr-width-slider">Width: <span id="qr-width-value">40</span>%</label>
                                        <input type="range" id="qr-width-slider" min="0" max="100" step="0.1" value="40">
                                    </div>
                                    <div class="control-group">
                                        <label for="qr-height-slider">Height: <span id="qr-height-value">16.6</span>%</label>
                                        <input type="range" id="qr-height-slider" min="0" max="100" step="0.1" value="16.6">
                                    </div>
                                </div>
                            </div>
                            <!-- Slide 2: Datos Personales -->
                            <div class="carousel-slide">
                                <div class="controls-container">
                                    <h3 class="section-title" style="margin-top:0; margin-bottom: 20px;">Datos Personales</h3>
                                    <!-- Apellido -->
                                    <div class="control-group">
                                        <label for="apellido-input">Apellido</label>
                                        <input type="text" id="apellido-input" class="custom-input" value="MOSCARIELLO">
                                        <label for="apellido-top-slider">Top: <span id="apellido-top-value">19.6</span>%</label>
                                        <input type="range" id="apellido-top-slider" min="0" max="100" step="0.1" value="19.6">
                                        <label for="apellido-left-slider">Left: <span id="apellido-left-value">30.7</span>%</label>
                                        <input type="range" id="apellido-left-slider" min="0" max="100" step="0.1" value="30.7">
                                        <label for="apellido-fontsize-slider">Font Size: <span id="apellido-fontsize-value">14</span>px</label>
                                        <input type="range" id="apellido-fontsize-slider" min="8" max="40" step="1" value="14">
                                        <label for="apellido-font-select" style="margin-top: 8px;">Tipo de Texto</label>
                                        <div class="select-wrapper">
                                            <select id="apellido-font-select" class="custom-select">
                                                <option value="'Roboto Condensed', sans-serif">DNI Oficial</option>
                                                <option value="-apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, Helvetica, Arial, sans-serif">Sans-serif (App)</option>
                                                <option value="Georgia, serif">Serif</option>
                                            </select>
                                        </div>
                                    </div>
                                    <hr class="control-group-divider">
                                    <!-- Nombre -->
                                    <div class="control-group">
                                        <label for="nombre-input">Nombre</label>
                                        <input type="text" id="nombre-input" class="custom-input" value="CLAUDIO PASCUAL">
                                        <label for="nombre-top-slider">Top: <span id="nombre-top-value">29.6</span>%</label>
                                        <input type="range" id="nombre-top-slider" min="0" max="100" step="0.1" value="29.6">
                                        <label for="nombre-left-slider">Left: <span id="nombre-left-value">30.7</span>%</label>
                                        <input type="range" id="nombre-left-slider" min="0" max="100" step="0.1" value="30.7">
                                        <label for="nombre-fontsize-slider">Font Size: <span id="nombre-fontsize-value">17</span>px</label>
                                        <input type="range" id="nombre-fontsize-slider" min="8" max="40" step="1" value="17">
                                        <label for="nombre-font-select" style="margin-top: 8px;">Tipo de Texto</label>
                                        <div class="select-wrapper">
                                            <select id="nombre-font-select" class="custom-select">
                                                <option value="'Roboto Condensed', sans-serif">DNI Oficial</option>
                                                <option value="-apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, Helvetica, Arial, sans-serif">Sans-serif (App)</option>
                                                <option value="Georgia, serif">Serif</option>
                                            </select>
                                        </div>
                                    </div>
                                    <hr class="control-group-divider">
                                    <!-- Documento -->
                                    <div class="control-group">
                                        <label for="documento-input">N° de Documento</label>
                                        <input type="text" id="documento-input" class="custom-input" value="32.872.182">
                                        <label for="documento-top-slider">Top: <span id="documento-top-value">87.2</span>%</label>
                                        <input type="range" id="documento-top-slider" min="0" max="100" step="0.1" value="87.2">
                                        <label for="documento-left-slider">Left: <span id="documento-left-value">3.1</span>%</label>
                                        <input type="range" id="documento-left-slider" min="0" max="100" step="0.1" value="3.1">
                                        <label for="documento-fontsize-slider">Font Size: <span id="documento-fontsize-value">21</span>px</label>
                                        <input type="range" id="documento-fontsize-slider" min="8" max="40" step="1" value="21">
                                        <label for="documento-font-select" style="margin-top: 8px;">Tipo de Texto</label>
                                        <div class="select-wrapper">
                                            <select id="documento-font-select" class="custom-select">
                                                <option value="'Roboto Condensed', sans-serif">DNI Oficial</option>
                                                <option value="-apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, Helvetica, Arial, sans-serif">Sans-serif (App)</option>
                                                <option value="Georgia, serif">Serif</option>
                                            </select>
                                        </div>
                                    </div>
                                     <hr class="control-group-divider">
                                    <!-- Nacimiento -->
                                    <div class="control-group">
                                        <label for="nacimiento-input">Fecha de Nacimiento</label>
                                        <input type="text" id="nacimiento-input" class="custom-input" value="11 MAR/MAR 1987">
                                        <label for="nacimiento-top-slider">Top: <span id="nacimiento-top-value">52.2</span>%</label>
                                        <input type="range" id="nacimiento-top-slider" min="0" max="100" step="0.1" value="52.2">
                                        <label for="nacimiento-left-slider">Left: <span id="nacimiento-left-value">30.7</span>%</label>
                                        <input type="range" id="nacimiento-left-slider" min="0" max="100" step="0.1" value="30.7">
                                        <label for="nacimiento-fontsize-slider">Font Size: <span id="nacimiento-fontsize-value">15</span>px</label>
                                        <input type="range" id="nacimiento-fontsize-slider" min="8" max="40" step="1" value="15">
                                        <label for="nacimiento-font-select" style="margin-top: 8px;">Tipo de Texto</label>
                                        <div class="select-wrapper">
                                            <select id="nacimiento-font-select" class="custom-select">
                                                <option value="'Roboto Condensed', sans-serif">DNI Oficial</option>
                                                <option value="-apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, Helvetica, Arial, sans-serif">Sans-serif (App)</option>
                                                <option value="Georgia, serif">Serif</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Slide 3: Datos del DNI -->
                            <div class="carousel-slide">
                                 <div class="controls-container">
                                    <h3 class="section-title" style="margin-top:0; margin-bottom: 20px;">Datos del DNI</h3>
                                    <!-- Trámite -->
                                    <div class="control-group">
                                        <label for="tramite-input">N° de Trámite</label>
                                        <input type="text" id="tramite-input" class="custom-input" value="681417890">
                                         <label for="tramite-top-slider">Top: <span id="tramite-top-value">90</span>%</label>
                                        <input type="range" id="tramite-top-slider" min="0" max="100" step="0.1" value="90">
                                        <label for="tramite-left-slider">Left: <span id="tramite-left-value">31</span>%</label>
                                        <input type="range" id="tramite-left-slider" min="0" max="100" step="0.1" value="31">
                                        <label for="tramite-fontsize-slider">Font Size: <span id="tramite-fontsize-value">10</span>px</label>
                                        <input type="range" id="tramite-fontsize-slider" min="8" max="40" step="1" value="10">
                                        <label for="tramite-font-select" style="margin-top: 8px;">Tipo de Texto</label>
                                        <div class="select-wrapper">
                                            <select id="tramite-font-select" class="custom-select">
                                                <option value="'Roboto Condensed', sans-serif">DNI Oficial</option>
                                                <option value="-apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, Helvetica, Arial, sans-serif">Sans-serif (App)</option>
                                                <option value="Georgia, serif">Serif</option>
                                            </select>
                                        </div>
                                    </div>
                                    <hr class="control-group-divider">
                                    <!-- Ejemplar -->
                                    <div class="control-group">
                                        <label for="ejemplar-input">Ejemplar</label>
                                        <input type="text" id="ejemplar-input" class="custom-input" value="B">
                                         <label for="ejemplar-top-slider">Top: <span id="ejemplar-top-value">41.9</span>%</label>
                                        <input type="range" id="ejemplar-top-slider" min="0" max="100" step="0.1" value="41.9">
                                        <label for="ejemplar-left-slider">Left: <span id="ejemplar-left-value">78.4</span>%</label>
                                        <input type="range" id="ejemplar-left-slider" min="0" max="100" step="0.1" value="78.4">
                                        <label for="ejemplar-fontsize-slider">Font Size: <span id="ejemplar-fontsize-value">14</span>px</label>
                                        <input type="range" id="ejemplar-fontsize-slider" min="8" max="40" step="1" value="14">
                                        <label for="ejemplar-font-select" style="margin-top: 8px;">Tipo de Texto</label>
                                        <div class="select-wrapper">
                                            <select id="ejemplar-font-select" class="custom-select">
                                                <option value="'Roboto Condensed', sans-serif">DNI Oficial</option>
                                                <option value="-apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, Helvetica, Arial, sans-serif">Sans-serif (App)</option>
                                                <option value="Georgia, serif">Serif</option>
                                            </select>
                                        </div>
                                    </div>
                                    <hr class="control-group-divider">
                                    <!-- Sexo -->
                                    <div class="control-group">
                                        <label for="sexo-input">Sexo</label>
                                        <input type="text" id="sexo-input" class="custom-input" value="M">
                                        <label for="sexo-top-slider">Top: <span id="sexo-top-value">41.3</span>%</label>
                                        <input type="range" id="sexo-top-slider" min="0" max="100" step="0.1" value="41.3">
                                        <label for="sexo-left-slider">Left: <span id="sexo-left-value">31</span>%</label>
                                        <input type="range" id="sexo-left-slider" min="0" max="100" step="0.1" value="31">
                                        <label for="sexo-fontsize-slider">Font Size: <span id="sexo-fontsize-value">17</span>px</label>
                                        <input type="range" id="sexo-fontsize-slider" min="8" max="40" step="1" value="17">
                                        <label for="sexo-font-select" style="margin-top: 8px;">Tipo de Texto</label>
                                        <div class="select-wrapper">
                                            <select id="sexo-font-select" class="custom-select">
                                                <option value="'Roboto Condensed', sans-serif">DNI Oficial</option>
                                                <option value="-apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, Helvetica, Arial, sans-serif">Sans-serif (App)</option>
                                                <option value="Georgia, serif">Serif</option>
                                            </select>
                                        </div>
                                    </div>
                                    <hr class="control-group-divider">
                                    <!-- Emision -->
                                    <div class="control-group">
                                        <label for="emision-input">Fecha de Emisión</label>
                                        <input type="text" id="emision-input" class="custom-input" value="09 NOV/NOV 2021">
                                         <label for="emision-top-slider">Top: <span id="emision-top-value">63.4</span>%</label>
                                        <input type="range" id="emision-top-slider" min="0" max="100" step="0.1" value="63.4">
                                        <label for="emision-left-slider">Left: <span id="emision-left-value">31</span>%</label>
                                        <input type="range" id="emision-left-slider" min="0" max="100" step="0.1" value="31">
                                        <label for="emision-fontsize-slider">Font Size: <span id="emision-fontsize-value">15</span>px</label>
                                        <input type="range" id="emision-fontsize-slider" min="8" max="40" step="1" value="15">
                                        <label for="emision-font-select" style="margin-top: 8px;">Tipo de Texto</label>
                                        <div class="select-wrapper">
                                            <select id="emision-font-select" class="custom-select">
                                                <option value="'Roboto Condensed', sans-serif">DNI Oficial</option>
                                                <option value="-apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, Helvetica, Arial, sans-serif">Sans-serif (App)</option>
                                                <option value="Georgia, serif">Serif</option>
                                            </select>
                                        </div>
                                    </div>
                                    <hr class="control-group-divider">
                                    <!-- Vencimiento -->
                                    <div class="control-group">
                                        <label for="vencimiento-input">Fecha de Vencimiento</label>
                                        <input type="text" id="vencimiento-input" class="custom-input" value="09 NOV/NOV 2036">
                                         <label for="vencimiento-top-slider">Top: <span id="vencimiento-top-value">74.9</span>%</label>
                                        <input type="range" id="vencimiento-top-slider" min="0" max="100" step="0.1" value="74.9">
                                        <label for="vencimiento-left-slider">Left: <span id="vencimiento-left-value">31</span>%</label>
                                        <input type="range" id="vencimiento-left-slider" min="0" max="100" step="0.1" value="31">
                                        <label for="vencimiento-fontsize-slider">Font Size: <span id="vencimiento-fontsize-value">15</span>px</label>
                                        <input type="range" id="vencimiento-fontsize-slider" min="8" max="40" step="1" value="15">
                                        <label for="vencimiento-font-select" style="margin-top: 8px;">Tipo de Texto</label>
                                        <div class="select-wrapper">
                                            <select id="vencimiento-font-select" class="custom-select">
                                                <option value="'Roboto Condensed', sans-serif">DNI Oficial</option>
                                                <option value="-apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, Helvetica, Arial, sans-serif">Sans-serif (App)</option>
                                                <option value="Georgia, serif">Serif</option>
                                            </select>
                                        </div>
                                    </div>
                                    <hr class="control-group-divider">
                                    <!-- Domicilio -->
                                    <div class="control-group">
                                        <label for="domicilio-input">Domicilio</label>
                                        <input type="text" id="domicilio-input" class="custom-input" value="ENTRE RIOS 256 MONTE GRANDE">
                                        <label for="domicilio-top-slider">Top: <span id="domicilio-top-value">3.7</span>%</label>
                                        <input type="range" id="domicilio-top-slider" min="0" max="100" step="0.1" value="3.7">
                                        <label for="domicilio-left-slider">Left: <span id="domicilio-left-value">23.1</span>%</label>
                                        <input type="range" id="domicilio-left-slider" min="0" max="100" step="0.1" value="23.1">
                                        <label for="domicilio-fontsize-slider">Font Size: <span id="domicilio-fontsize-value">14</span>px</label>
                                        <input type="range" id="domicilio-fontsize-slider" min="8" max="40" step="1" value="14">
                                        <label for="domicilio-font-select" style="margin-top: 8px;">Tipo de Texto</label>
                                        <div class="select-wrapper">
                                            <select id="domicilio-font-select" class="custom-select">
                                                <option value="'Roboto Condensed', sans-serif">DNI Oficial</option>
                                                <option value="-apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, Helvetica, Arial, sans-serif">Sans-serif (App)</option>
                                                <option value="Georgia, serif">Serif</option>
                                            </select>
                                        </div>
                                    </div>
                                    <hr class="control-group-divider">
                                    <!-- CUIL -->
                                    <div class="control-group">
                                        <label for="cuil-input">CUIL</label>
                                        <input type="text" id="cuil-input" class="custom-input" value="20-32872182-2">
                                        <label for="cuil-top-slider">Top: <span id="cuil-top-value">45</span>%</label>
                                        <input type="range" id="cuil-top-slider" min="0" max="100" step="0.1" value="45">
                                        <label for="cuil-left-slider">Left: <span id="cuil-left-value">9</span>%</label>
                                        <input type="range" id="cuil-left-slider" min="0" max="100" step="0.1" value="9">
                                        <label for="cuil-fontsize-slider">Font Size: <span id="cuil-fontsize-value">15</span>px</label>
                                        <input type="range" id="cuil-fontsize-slider" min="8" max="40" step="1" value="15">
                                        <label for="cuil-font-select" style="margin-top: 8px;">Tipo de Texto</label>
                                        <div class="select-wrapper">
                                            <select id="cuil-font-select" class="custom-select">
                                                <option value="'Roboto Condensed', sans-serif">DNI Oficial</option>
                                                <option value="-apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, Helvetica, Arial, sans-serif">Sans-serif (App)</option>
                                                <option value="Georgia, serif">Serif</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="carousel-dots" id="editor-carousel-dots"><span class="carousel-dot active"></span><span class="carousel-dot"></span><span class="carousel-dot"></span></div>
                </main>
            </div>
        </div>
        
        <div id="dni-details-screen">
            <div class="app-container">
                <header class="dni-details-header">
                    <!-- Back Arrow Icon -->
                    <svg id="details-back-btn" class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5"></path>
                    </svg>
                    <h2>DNI Digital</h2>
                </header>
                <main class="dni-details-main">
                    <div class="details-profile-container">
                        <img id="details-profile-image" alt="Foto de perfil" src="https://iili.io/KS83rap.jpg" style="width: 270px; height: 270px;">
                    </div>
                    <div class="barcode-container">
                        <img id="details-barcode-image" src="https://iili.io/KS89H9n.gif" alt="Barcode" class="barcode-image">
                    </div>
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">DNI</span>
                            <span class="info-value" id="details-dni"></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Número de trámite</span>
                            <span class="info-value" id="details-tramite"></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Fecha de emisión</span>
                            <span class="info-value" id="details-emision"></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Fecha de vencimiento</span>
                            <span class="info-value" id="details-vencimiento"></span>
                        </div>
                    </div>
                    <hr class="details-divider">
                    <div class="info-list">
                         <div class="info-item">
                            <span class="info-label">Nombre</span>
                            <span class="info-value" id="details-nombre"></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Apellido</span>
                            <span class="info-value uppercase" id="details-apellido"></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">CUIL</span>
                            <span class="info-value" id="details-cuil"></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Sexo</span>
                            <span class="info-value uppercase" id="details-sexo"></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Fecha de nacimiento</span>
                            <span class="info-value" id="details-nacimiento"></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Nacionalidad</span>
                            <span class="info-value uppercase" id="details-nacionalidad"></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Lugar de nacimiento</span>
                            <span class="info-value uppercase" id="details-lugar-nacimiento"></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Domicilio</span>
                            <span class="info-value uppercase" id="details-domicilio"></span>
                        </div>
                    </div>
                </main>
                <nav class="details-bottom-nav">
                    <a href="#" class="nav-item active">
                        <!-- Home Icon -->
                        <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                          <path d="M11.47 3.84a.75.75 0 011.06 0l8.69 8.69a.75.75 0 101.06-1.06l-8.689-8.69a2.25 2.25 0 00-3.182 0l-8.69 8.69a.75.75 0 001.061 1.06l8.69-8.69z"></path>
                          <path d="M12 5.432l8.159 8.159c.026.026.05.054.07.084v6.101A2.25 2.25 0 0117.25 22h-2.5a.75.75 0 01-.75-.75V17.5a.75.75 0 00-.75-.75h-2.5a.75.75 0 00-.75.75v3.75a.75.75 0 01-.75-.75h-2.5A2.25 2.25 0 013.75 19.775v-6.101c.02-.03.044-.058.07-.084L12 5.432z"></path>
                        </svg>
                        <span>Inicio</span>
                    </a>
                    <a href="#" class="nav-item">
                        <!-- List Icon -->
                        <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"></path>
                        </svg>
                        <span>Novedades</span>
                    </a>
                    <a href="#" id="telefonos-btn-details" class="nav-item">
                        <!-- Phone Icon -->
                        <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z"></path>
                        </svg>
                        <span>Teléfonos</span>
                    </a>
                    <a href="#" class="nav-item tina-link">
                        <!-- Tina Icon -->
                        <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M12 21a9 9 0 100-18 9 9 0 000 18z"></path>
                          <path stroke-linecap="round" stroke-linejoin="round" d="M15.91 11.672a.375.375 0 01.33.633l-3.25 2.5a.375.375 0 01-.66 0l-3.25-2.5a.375.375 0 01.33-.633H15.91zM9.75 9.75a.375.375 0 01.375-.375h3.75a.375.375 0 01.375.375v.375a.375.375 0 01-.375.375h-3.75a.375.375 0 01-.375-.375V9.75z"></path>
                        </svg>
                        <span>Tina</span>
                    </a>
                </nav>
            </div>
        </div>

        <div id="telefonos-screen">
            <div class="app-container">
                <header class="app-header">
                     <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"></path>
                    </svg>
                    <div class="logo">Mi Argentina</div>
                    <div class="user-profile">
                        <svg class="icon icon-user-circle" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                          <path fill-rule="evenodd" d="M18.685 19.097A9.723 9.723 0 0021.75 12c0-5.385-4.365-9.75-9.75-9.75S2.25 6.615 2.25 12a9.723 9.723 0 003.065 7.097A9.716 9.716 0 0012 21.75a9.716 9.716 0 006.685-2.653zm-12.54-1.285A7.486 7.486 0 0112 15a7.486 7.486 0 015.855 2.812A8.224 8.224 0 0112 20.25a8.224 8.224 0 01-5.855-2.438zM15.75 9a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" clip-rule="evenodd"></path>
                        </svg>
                    </div>
                </header>
                <main>
                    <h2>Teléfonos útiles</h2>
                    <div class="telefonos-list">
                        <div class="telefono-item">
                            <div class="telefono-number">911</div>
                            <div class="telefono-description">Central de emergencias</div>
                            <svg class="telefono-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z"></path></svg>
                        </div>
                        <div class="telefono-item">
                            <div class="telefono-number">144</div>
                            <div class="telefono-description">Víctimas de violencia</div>
                            <svg class="telefono-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z"></path></svg>
                        </div>
                        <div class="telefono-item">
                            <div class="telefono-number">107</div>
                            <div class="telefono-description">Emergencias Médicas</div>
                            <svg class="telefono-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z"></path></svg>
                        </div>
                         <div class="telefono-item">
                            <div class="telefono-number">100</div>
                            <div class="telefono-description">Bomberos</div>
                            <svg class="telefono-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z"></path></svg>
                        </div>
                         <div class="telefono-item">
                            <div class="telefono-number">102</div>
                            <div class="telefono-description">La línea de las chicas y los...</div>
                            <svg class="telefono-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z"></path></svg>
                        </div>
                         <div class="telefono-item">
                            <div class="telefono-number">103</div>
                            <div class="telefono-description">Defensa Civil</div>
                            <svg class="telefono-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z"></path></svg>
                        </div>
                         <div class="telefono-item">
                            <div class="telefono-number">106</div>
                            <div class="telefono-description">Emergencia Náutica</div>
                            <svg class="telefono-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z"></path></svg>
                        </div>
                         <div class="telefono-item">
                            <div class="telefono-number">135</div>
                            <div class="telefono-description">Asistencia</div>
                            <svg class="telefono-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z"></path></svg>
                        </div>
                    </div>
                </main>
                <nav class="telefonos-bottom-nav">
                    <a href="#" id="telefonos-inicio-btn" class="nav-item">
                        <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path d="M11.47 3.84a.75.75 0 011.06 0l8.69 8.69a.75.75 0 101.06-1.06l-8.689-8.69a2.25 2.25 0 00-3.182 0l-8.69 8.69a.75.75 0 001.061 1.06l8.69-8.69z"></path><path d="M12 5.432l8.159 8.159c.026.026.05.054.07.084v6.101A2.25 2.25 0 0117.25 22h-2.5a.75.75 0 01-.75-.75V17.5a.75.75 0 00-.75-.75h-2.5a.75.75 0 00-.75.75v3.75a.75.75 0 01-.75-.75h-2.5A2.25 2.25 0 013.75 19.775v-6.101c.02-.03.044-.058.07-.084L12 5.432z"></path></svg>
                        <span>Inicio</span>
                    </a>
                    <a href="#" class="nav-item">
                        <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"></path></svg>
                        <span>Novedades</span>
                    </a>
                    <a href="#" class="nav-item active">
                        <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z"></path></svg>
                        <span>Teléfonos</span>
                    </a>
                    <a href="#" class="nav-item tina-link">
                        <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 21a9 9 0 100-18 9 9 0 000 18z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M15.91 11.672a.375.375 0 01.33.633l-3.25 2.5a.375.375 0 01-.66 0l-3.25-2.5a.375.375 0 01.33-.633H15.91zM9.75 9.75a.375.375 0 01.375-.375h3.75a.375.375 0 01.375.375v.375a.375.375 0 01-.375.375h-3.75a.375.375 0 01-.375-.375V9.75z"></path></svg>
                        <span>Tina</span>
                    </a>
                </nav>
            </div>
        </div>
    </div>


    <script type="module" src="index.tsx"></script>


        <script type="module" onerror="console.error('Failed to load the app. Try reloading it.')">import '@/index';</script>
        <script src="app.js?v=1761046331928"></script></body></html>